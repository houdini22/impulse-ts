(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Computation:()=>Lo,Dataset:()=>Mo,DatasetBuilder:()=>Do,DatasetBuilderSource:()=>Ko,DatasetModifier:()=>No,Layer:()=>zo,Math:()=>Wo,NetworkBuilder:()=>To,Optimizer:()=>Bo,Trainer:()=>Co});const r=require("fs");function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=function(){function t(){var e,r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r={},(e="kernels")in this?Object.defineProperty(this,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[e]=r}var e,r;return e=t,r=[{key:"addKernel",value:function(t,e){return this.kernels[t]=e,this}},{key:"execute",value:function(t){if(!this.kernels[t])throw new Error("Kernel '".concat(t,"' not exists."));for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.kernels[t].apply(null,r)}}],r&&n(e.prototype,r),t}();function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function u(t,e){return u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},u(t,e)}function a(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}var s=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)r[n][o]=t.data[n][o]/e.data[n][o]}return new A(t.rows,e.cols,r)},f=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)r[n][o]=t.data[n][o]/e}return new A(t.rows,t.cols,r)},l=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)e[r][n]=Math.exp(t.data[r][n])}var o=new A(t.rows,t.cols,e),i=new A(1,t.cols,o.colwiseSum().data).replicate(t.rows,1);return new A(t.rows,t.cols,s(o,i).data)},y=function(t,e){for(var r=[],n=0;n<e.rows;n+=1){r[n]=[];for(var o=0;o<e.cols;o+=1)r[n][o]=t.data[n][o]*Math.log(e.data[n][o]+1e-8)}return new A(t.rows,t.cols,r).sum()},p=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)e[r][n]=1/(1+Math.exp(-t.data[r][n]))}return new A(t.rows,t.cols,e)},h=function(t,e){for(var r=[],n=0;n<e.rows;n+=1){r[n]=[];for(var o=0;o<e.cols;o+=1)e.data&&(r[n][o]=Math.log(e.data[n][o]+1e-8))}for(var i=E(new A(e.rows,e.cols,r),t),u=[],a=0;a<t.rows;a+=1){u[a]=[];for(var c=0;c<t.cols;c+=1)t.data&&(u[a][c]=1-t.data[a][c])}for(var s=new A(t.rows,t.cols,u),f=[],l=0;l<e.rows;l+=1){f[l]=[];for(var y=0;y<e.cols;y+=1)e.data&&(f[l][y]=Math.log(1-e.data[l][y]+1e-8))}var p=new A(e.rows,e.cols,f);return k(E(T(i,-1),t),E(T(p,-1),W(s,1))).sum()},b=function(t,e){return E(e,E(W(t,1),e))},d=function(t,e){return E(e,P(t,E(t,e).colwiseSum().replicate(e.rows,1)))},v=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=2/(1+Math.exp(-2*t.data[r][n]))-1)}return new A(t.rows,t.cols,e)},w=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.max(0,t.data[r][n]))}return new A(t.rows,t.cols,e)},m=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=e.data[n][o]>0?1:0)}return E(new A(t.rows,t.cols,r),t)},g=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.log(1+Math.exp(t.data[r][n])))}return new A(t.rows,t.cols,e)},O=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.pow(t.data[r][n],2))}return new A(t.rows,t.cols,e).sum()},S=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.sqrt(t.data[r][n]+1e-8))}return new A(t.rows,t.cols,e)},x=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=t.data[n][o]-Math.pow(e[n][o],2))}return new A(t.rows,t.cols,r).sum()},j=function(t,e){if(t.cols!==e.rows)throw new Error("DIMENSIONS error. m1.cols ".concat(t.cols," !== m2.rows ").concat(e.rows,"."));for(var r=[],n=0;n<t.rows;++n){r[n]=new Array(e.cols);for(var o=0;o<e.cols;++o){r[n][o]=0;for(var i=0;i<t.cols;++i)t.data&&e.data&&(r[n][o]+=t.data[n][i]*e.data[i][o])}}return new A(t.rows,e.cols,r)},k=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal. m1.cols ".concat(t.cols," !== m2.cols ").concat(e.cols));for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&e.data&&(r[n][o]=t.data[n][o]+e.data[n][o])}return new A(t.rows,t.cols,r)},P=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal: m1.rows ".concat(t.rows," !== m2.rows ").concat(e.rows));if(t.cols!==e.cols)throw new Error("COLS number not equal: m1.cols ".concat(t.cols," !== m2.cols ").concat(e.cols));for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&e.data&&(r[n][o]=t.data[n][o]-e.data[n][o])}return new A(t.rows,t.cols,r)},_=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)r[n][o]=(4*Math.random()-2)*Math.sqrt(2/e)}return new A(t.rows,t.cols,r)},R=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)e[r][n]=0}return new A(t.rows,t.cols,e)},E=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal: m1.rows ".concat(t.rows," !== m2.rows ").concat(e.rows));if(t.cols!==e.cols)throw new Error("COLS number not equal: m1.cols ".concat(t.cols," !== m2.cols ").concat(e.cols));for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&e.data&&(r[n][o]=t.data[n][o]*e.data[n][o])}return new A(t.rows,t.cols,r)},T=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=t.data[n][o]*e)}return new A(t.rows,t.cols,r)},W=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=e-t.data[n][o])}return new A(t.rows,t.cols,r)},z=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=Math.pow(t.data[n][o],e))}return new A(t.rows,t.cols,r)},D=function(t){for(var e=[],r=0;r<t.cols;r+=1){e[r]=[];for(var n=0;n<t.rows;n+=1)t.data&&(e[r][n]=t.data[n][r])}return new A(t.cols,t.rows,e)},B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(o,t);var e,r,n=(e=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=c(e);if(r){var o=c(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return a(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this)).addKernel("multiply",j),t.addKernel("add",k),t.addKernel("subtract",P),t.addKernel("subtractFromNumber",W),t.addKernel("fillRandom",_),t.addKernel("fillZeros",R),t.addKernel("elementWiseMultiply",E),t.addKernel("multiplyNumber",T),t.addKernel("elementWiseDivide",s),t.addKernel("divideNumber",f),t.addKernel("softmaxActivation",l),t.addKernel("softmaxLoss",y),t.addKernel("logisticActivation",p),t.addKernel("logisticLoss",h),t.addKernel("logisticBackpropagation",b),t.addKernel("tanhActivation",v),t.addKernel("reluActivation",w),t.addKernel("reluBackpropagation",m),t.addKernel("softplusActivation",g),t.addKernel("penalty",O),t.addKernel("sqrt",S),t.addKernel("purelinLoss",x),t.addKernel("transpose",D),t.addKernel("pow",z),t.addKernel("softmaxBackpropagation",d),t}return o}(o),C=new B,N=function(){return C};function L(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function M(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function K(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var A=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;L(this,t),K(this,"rows",0),K(this,"cols",0),K(this,"data",null),this.resize(e,r),n&&this.generateData(n)}var e,r;return e=t,(r=[{key:"resize",value:function(t,e){this.rows=t,this.cols=e,this.data=[];for(var r=0;r<this.rows;r+=1)this.data[r]=new Array(this.cols);return this}},{key:"generateData",value:function(t){for(var e=[],r=0;r<this.rows;r+=1)e[r]=new Array(this.cols);for(var n=0;n<this.cols;n+=1)for(var o=0;o<this.rows;o+=1)"number"==typeof t[o]?e[o][n]=t[o]:t[o]instanceof Float32Array||t[o]&&"number"==typeof t[o][n]?e[o][n]=t[o][n]:"string"==typeof t[o][n]?e[o][n]=t[o][n].length?Number(t[o][n]):NaN:e[o][n]=NaN;return this.data=e,this}},{key:"sum",value:function(){for(var t=0,e=0;e<this.rows;e+=1)for(var r=0;r<this.cols;r+=1)t+=this.data[e][r];return t}},{key:"colwiseSum",value:function(){for(var e=[],r=this.transpose(),n=0;n<r.rows;n+=1){e[n]=[0];for(var o=0;o<r.cols;o+=1)e[n][0]+=r.data[n][o]}return new t(this.cols,1,e)}},{key:"rowwiseSum",value:function(){for(var e=[[]],r=0;r<this.rows;r+=1){for(var n=0,o=0;o<this.cols;o+=1)n+=this.data[r][o];e[0].push(n)}return new t(1,this.rows,e)}},{key:"replicate",value:function(e,r){var n=this.data,o=[],i=null;if(1===e&&1===this.cols&&r>1){i=new t(this.rows,r);for(var u=0;u<this.rows;u+=1){o[u]=[];for(var a=0;a<r;a+=1)o[u][a]=n[u][0]}}else if(1===r&&1===this.rows&&e>1){i=new t(e,this.cols);for(var c=0;c<e;c+=1){o[c]=[];for(var s=0;s<this.cols;s+=1)o[c][s]=n[0][s]}}return i?(i.generateData(o),i):this}},{key:"transpose",value:function(){return N().execute("transpose",this)}},{key:"colMaxCoeffIndex",value:function(t){for(var e=-1,r=-1/0,n=0;n<this.rows;n+=1)this.data&&this.data[n][t]>r&&(r=this.data[n][t],e=n);return e}},{key:"block",value:function(e,r,n,o){for(var i=[],u=e,a=0;u<this.rows&&u<e+n;u+=1,a+=1){i[a]=new Array(o);for(var c=r,s=0;c<this.cols&&c<r+o;c+=1,s+=1)i[a][s]=this.data[u][c]}return new t(n,o,i)}},{key:"col",value:function(e){for(var r=[],n=0;n<this.rows;n+=1)r[n]=[this.data[n][e]];return new t(this.rows,1,r)}},{key:"setCol",value:function(t,e){for(var r=0;r<this.rows;r+=1)this.data&&e.data&&(this.data[r][t]=e.data[r][0]);return this}},{key:"rollToColMatrix",value:function(){for(var e=[],r=0,n=0;n<this.rows;n+=1){e[n]=[];for(var o=0;o<this.cols;o+=1)this.data&&(e[r++][0]=this.data[n][o])}return new t(this.rows*this.cols,1,e)}}])&&M(e.prototype,r),t}();function Z(t){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(t)}function F(t,e){return F=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},F(t,e)}function q(t,e){if(e&&("object"===Z(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function H(t){return H=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},H(t)}var I=new(require("gpu.js").GPU)({mode:"gpu"}),U=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=I.createKernel((function(t,e){return t[this.thread.x][this.thread.y]/e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new A(t.rows,t.cols,r(t.data,e.data))},Q=function(t,e){var r=I.createKernel((function(t){return t[this.thread.x][this.thread.y]/this.constants.number})).setOutput([t.rows,t.cols]).setConstants({number:e});return new A(t.rows,t.cols,r(t.data))},J=function(t){var e=I.createKernel((function(t){return Math.exp(t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]),r=new A(t.rows,t.cols,e(t.data)),n=new A(1,t.cols,r.colwiseSum().data).replicate(t.rows,1);return new A(t.rows,t.cols,U(r,n).data)},G=function(t,e){var r=I.createKernel((function(t){return Math.log(t[this.thread.x][this.thread.y])})).setOutput([e.rows,e.cols]);return new A(t.rows,t.cols,st(t,new A(t.rows,t.cols,r(e.data))).data).sum()},V=function(t){var e=I.createKernel((function(t){return 1/(1+Math.exp(-t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new A(t.rows,t.cols,e(t.data))},X=function(t,e){var r=I.createKernel((function(t){return Math.log(t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]),n=I.createKernel((function(t){return 1-t[this.thread.x][this.thread.y]})).setOutput([t.rows,t.cols]),o=I.createKernel((function(t){return Math.log(1-t[this.thread.x][this.thread.y])})).setOutput([e.rows,e.cols]);return it(st(t,new A(t.rows,t.cols,r(t.data))),st(new A(t.rows,t.cols,n(t.data)),new A(e.rows,e.cols,o(e.data)))).sum()},Y=function(t){var e=I.createKernel((function(t){return 2/(1+Math.exp(-2*t[this.thread.x][this.thread.y]))-1})).setOutput([t.rows,t.cols]);return new A(t.rows,t.cols,e(t.data))},$=function(t){var e=I.createKernel((function(t){return Math.max(0,t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]);return new A(t.rows,t.cols,e(t.data))},tt=function(t){var e=I.createKernel((function(t){return Math.log(1+Math.exp(t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new A(t.rows,t.cols,e(t.data))},et=function(t){var e=I.createKernel((function(t){return Math.pow(t[this.thread.x][this.thread.y],2)})).setOutput([t.rows,t.cols]);return new A(t.rows,t.cols,e(t.data)).sum()},rt=function(t){var e=I.createKernel((function(t){return Math.sqrt(t[this.thread.x][this.thread.y]+1e-8)})).setOutput([t.rows,t.cols]);return new A(t.rows,t.cols,e(t.data))},nt=function(t,e){var r=I.createKernel((function(t,e){return e[this.thread.x][this.thread.y]-Math.pow(t[this.thread.x][this.thread.y],2)})).setOutput([t.rows,t.cols]);return new A(t.rows,t.cols,r(t.data)).sum()},ot=function(t,e){if(t.cols!==e.rows)throw new Error("DIMENSIONS error. m1.cols ".concat(t.cols," !== m2.rows ").concat(e.rows,"."));var r=I.createKernel((function(t,e){for(var r=0,n=0;n<this.constants.cols;n++)r+=t[this.thread.x][n]*e[n][this.thread.y];return r})).setOutput([t.rows,e.cols]).setConstants({cols:t.rows});return new A(t.rows,e.cols,r(t.data,e.data))},it=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=I.createKernel((function(t,e){return t[this.thread.x][this.thread.y]+e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new A(t.rows,e.cols,r(t.data,e.data))},ut=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=I.createKernel((function(t,e){return t[this.thread.x][this.thread.y]-e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new A(t.rows,e.cols,r(t.data,e.data))},at=function(t,e){var r=I.createKernel((function(){return Math.random()-.5})).setOutput([t.rows,t.cols]).setConstants({parameter:e});return new A(t.rows,t.cols,r())},ct=function(t){var e=I.createKernel((function(){return 0})).setOutput([t.rows,t.cols]);return new A(t.rows,t.cols,e())},st=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=I.createKernel((function(t,e){return t[this.thread.x][this.thread.y]*e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new A(t.rows,e.cols,r(t.data,e.data))},ft=function(t,e){var r=I.createKernel((function(t){return t[this.thread.x][this.thread.y]*this.constants.number})).setOutput([t.rows,t.cols]).setConstants({number:e});return new A(t.rows,t.cols,r(t.data))},lt=function(t){var e=I.createKernel((function(t){return t[this.thread.y][this.thread.x]})).setOutput([t.cols,t.rows]);return new A(t.cols,t.rows,e(t.data))},yt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&F(t,e)}(o,t);var e,r,n=(e=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=H(e);if(r){var o=H(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return q(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this)).addKernel("multiply",ot),t.addKernel("add",it),t.addKernel("subtract",ut),t.addKernel("fillRandom",at),t.addKernel("fillZeros",ct),t.addKernel("elementWiseMultiply",st),t.addKernel("multiplyNumber",ft),t.addKernel("elementWiseDivide",U),t.addKernel("divideNumber",Q),t.addKernel("softmaxActivation",J),t.addKernel("softmaxLoss",G),t.addKernel("logisticActivation",V),t.addKernel("logisticLoss",X),t.addKernel("tanhActivation",Y),t.addKernel("reluActivation",$),t.addKernel("softplusActivation",tt),t.addKernel("penalty",et),t.addKernel("sqrt",rt),t.addKernel("purelinLoss",nt),t.addKernel("transpose",lt),t}return o}(o);function pt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ht(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var bt,dt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ht(this,"dimensions",null),ht(this,"size",0),ht(this,"layers",[]),this.dimensions=e}var e,n;return e=t,(n=[{key:"addLayer",value:function(t){return this.size++,this.layers.push(t),this}},{key:"getLayers",value:function(){return this.layers}},{key:"forward",value:function(t){var e=t;return this.layers.forEach((function(t){e=t.forward(e)})),e}},{key:"backward",value:function(t,e,r,n){for(var o=t.cols,i=N().execute("subtract",r,e),u=this.layers.length-1;u>=0;u-=1){var a=this.layers[u].getBackPropagation();a&&(i=a.propagate(t,o,n,i))}}},{key:"loss",value:function(t,e){return this.layers[this.layers.length-1].loss(t,e)}},{key:"error",value:function(t){return this.layers[this.layers.length-1].error(t)}},{key:"save",value:function(t){var e={dimensions:this.dimensions,layers:[]};this.layers.forEach((function(t){e.layers.push({type:t.getType(),size:t.getSize(),weights:{W:t.W.data,b:t.b.data}})}));var n=JSON.stringify(e);return new Promise((function(e,o){r.writeFile(t,n,(function(t){t&&(console.error(t),o()),e(n)}))}))}}])&&pt(e.prototype,n),t}();function vt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}!function(t){t.logistic="logistic",t.softmax="softmax",t.tanh="tanh",t.relu="relu",t.softplus="softplus",t.conv="conv",t.maxpool="maxpool",t.fullyconnected="fullyconnected",t.purelin="purelin"}(bt||(bt={}));var wt=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),vt(this,"layer",null),vt(this,"previousLayer",null),this.layer=e,this.previousLayer=r};function mt(t){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mt(t)}function gt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ot(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function St(t,e){return St=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},St(t,e)}function xt(t,e){if(e&&("object"===mt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function jt(t){return jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},jt(t)}var kt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&St(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=jt(n);if(o){var r=jt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return xt(this,t)});function u(){return gt(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){var o=null!==this.previousLayer?this.previousLayer.A:t,i=this.layer.backpropagation(n);return this.layer.gW=N().execute("multiply",i,o.transpose()),this.layer.gW=N().execute("multiplyNumber",this.layer.gW,1/e),this.layer.gb=N().execute("multiplyNumber",i.rowwiseSum().transpose(),1/e),null!==this.previousLayer?N().execute("multiply",this.layer.W.transpose(),i):new A}}])&&Ot(e.prototype,r),u}(wt);function Pt(t){return Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pt(t)}function _t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Rt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Et(t,e){return Et=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Et(t,e)}function Tt(t,e){if(e&&("object"===Pt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Wt(t){return Wt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Wt(t)}var zt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Et(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Wt(n);if(o){var r=Wt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Tt(this,t)});function u(){return _t(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){return n}}])&&Rt(e.prototype,r),u}(wt);function Dt(t){return Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dt(t)}function Bt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ct(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Nt(t,e){return Nt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Nt(t,e)}function Lt(t,e){if(e&&("object"===Dt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Mt(t)}function Mt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Kt(t){return Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Kt(t)}function At(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Zt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Nt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Kt(n);if(o){var r=Kt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Lt(this,t)});function u(){var t;Bt(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return At(Mt(t=i.call.apply(i,[this].concat(r))),"previousLayer",null),t}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){var o=this.previousLayer;if(o){for(var i=N().execute("fillZeros",new A(o.Z.rows,o.Z.cols)),u=o.getFilterSize(),a=o.getStride(),c=o.getWidth(),s=o.getHeight(),f=(o.getDepth(),o.getOutputWidth()),l=o.getOutputHeight(),y=o.getOutputDepth(),p=0;p<e;p++)for(var h=0;h<y;h++)for(var b=0;b<l;b++)for(var d=0;d<f;d++){for(var v=a*d,w=-1/0,m=s*c*h,g=l*f*h,O=0,S=0,x=0,j=a*b;x<u;x++,j++)for(var k=0,P=v;k<u;k++,P++)o.Z.data&&w<o.Z.data[m+j*c+P][p]&&(w=o.Z.data[m+j*c+P][p],O=P,S=j);i.data&&n.data&&(i.data[m+S*c+O][p]=n.data[g+b*f+d][p])}return i}return new A}}])&&Ct(e.prototype,r),u}(wt);function Ft(t){return Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ft(t)}function qt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ht(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function It(t,e){return It=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},It(t,e)}function Ut(t,e){if(e&&("object"===Ft(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Qt(t)}function Qt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Jt(t){return Jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Jt(t)}function Gt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Vt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&It(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Jt(n);if(o){var r=Jt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ut(this,t)});function u(){var t;qt(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Gt(Qt(t=i.call.apply(i,[this].concat(r))),"previousLayer",null),t}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){var o=this.previousLayer;if(o){var i=o.getPadding(),u=o.getStride(),a=o.getFilterSize(),c=o.getOutputWidth(),s=o.getOutputHeight(),f=o.getOutputDepth(),l=o.getWidth(),y=o.getHeight(),p=o.getDepth(),h=N().execute("fillZeros",new A((l+2*i)*(y+2*i)*p,e)),b=new A(l*y*p,e);o.gW=N().execute("fillZeros",o.gW),o.gb=N().execute("fillZeros",o.gb);for(var d=0;d<e;d++){for(var v=0;v<f;v++)for(var w=0;w<s;w++)for(var m=0;m<c;m++){for(var g=u*w,O=u*m,S=0;S<p;S++)for(var x=0,j=g,k=-i;x<a;x++,j++,k++)for(var P=0,_=O,R=-i;P<a;P++,_++,R++){o.W.data&&h.data&&n.data&&(h.data[S*(l+2*i)*(y+2*i)+j*(l+2*i)+_][d]+=o.W.data[v][S*a*a+x*a+P]*n.data[v*c*s+w*c+m][d]);var E=0;0==i?o.Z.data&&(E=o.Z.data[S*l*y+j*l+_][d]):k>=0&&R>=0&&k<y&&R<l&&o.Z.data&&(E=o.Z.data[S*l*y+k*l+R][d]),o.gW.data&&n.data&&(o.gW.data[v][S*a*a+x*a+P]+=E*n.data[v*(c*s)+w*c+m][d]/e)}o.gb.data&&n.data&&(o.gb.data[v][0]+=n.data[v*(c*s)+w*c+m][d]/e)}if(i>0)for(var T=0;T<p;T++)for(var W=-i,z=0;W<y+i;W++,z++)for(var D=-i,B=0;D<l+i;D++,B++)D>=0&&W>=0&&D<l&&W<y&&b.data&&h.data&&(b.data[T*l*y+W*l+D][d]=h.data[T*(l+2*i)*(y+2*i)+z*(l+2*i)+B][d])}return i>0?b:h}}}])&&Ht(e.prototype,r),u}(wt);function Xt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Yt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"create",value:function(t,e){if(null==t){if(e.is1D())return new kt(e,t);if(e.getType()==bt.conv)return new zt(e,t)}else{if(t.getType()==bt.maxpool)return new Zt(e,t);if(t.getType()==bt.conv)return new Vt(e,t);if(t.is1D()||t.getType()==bt.fullyconnected)return new kt(e,t)}return null}}],null&&Xt(e.prototype,null),r&&Xt(e,r),t}();function $t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function te(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ee=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),te(this,"dimensions",null),te(this,"lastLayer",null),te(this,"network",null),this.dimensions=e,this.network=new dt(e)}var e,r;return e=t,r=[{key:"createLayer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.network){var r=new t;"function"==typeof e&&e(r),null===this.lastLayer?this.firstLayerTransition(r):r.transition(this.lastLayer),r.setPreviousLayer(this.lastLayer),r.configure(),r.setBackPropagation(Yt.create(this.lastLayer,r)),this.network.addLayer(r),this.lastLayer=r}return this}},{key:"getNetwork",value:function(){return this.network}}],r&&$t(e.prototype,r),t}();function re(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ne(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var oe=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ne(this,"width",0),ne(this,"height",0),ne(this,"depth",0),ne(this,"previousLayer",null),ne(this,"backPropagation",null),this.W=new A,this.b=new A,this.A=new A,this.Z=new A,this.gW=new A,this.gb=new A,this.vW=new A,this.vb=new A,this.sW=new A,this.sb=new A,this.dW=new A,this.db=new A,this.dZ=new A}var e,r;return e=t,(r=[{key:"setBackPropagation",value:function(t){return this.backPropagation=t,this}},{key:"setPreviousLayer",value:function(t){this.previousLayer=t}},{key:"getBackPropagation",value:function(){return this.backPropagation}},{key:"forward",value:function(t){return this.Z=N().execute("add",N().execute("multiply",this.W,t),this.b.replicate(1,t.cols)),this.A=this.activation(this.Z),this.A}},{key:"setWidth",value:function(t){return this.width=t,this}},{key:"getWidth",value:function(){return this.width}},{key:"setHeight",value:function(t){return this.height=t,this}},{key:"getHeight",value:function(){return this.height}},{key:"setDepth",value:function(t){return this.depth=t,this}},{key:"getDepth",value:function(){return this.depth}},{key:"transition",value:function(t){return this.previousLayer=t,this}},{key:"penalty",value:function(){return N().execute("penalty",this.W)}}])&&re(e.prototype,r),t}();function ie(t){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ie(t)}function ue(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ae(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ce(t,e,r){return ce="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ye(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}},ce(t,e,r||t)}function se(t,e){return se=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},se(t,e)}function fe(t,e){if(e&&("object"===ie(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return le(t)}function le(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ye(t){return ye=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ye(t)}function pe(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var he=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&se(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ye(n);if(o){var r=ye(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return fe(this,t)});function u(){var t;ue(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return pe(le(t=i.call.apply(i,[this].concat(r))),"depth",1),t}return e=u,(r=[{key:"configure",value:function(){var t=this.previousLayer;this.W.resize(this.height,this.width),this.W=N().execute("fillRandom",this.W,t?t.getHeight():this.height),this.b.resize(this.height,1),this.b=N().execute("fillRandom",this.b,t?t.getHeight():this.height),this.gW.resize(this.height,this.width),this.gW=N().execute("fillZeros",this.gW),this.gb.resize(this.height,1),this.gb=N().execute("fillZeros",this.gb),this.sW.resize(this.height,this.width),this.sW=N().execute("fillZeros",this.sW),this.sb.resize(this.height,1),this.sb=N().execute("fillZeros",this.sb),this.vW.resize(this.height,this.width),this.vW=N().execute("fillZeros",this.vW),this.vb.resize(this.height,1),this.vb=N().execute("fillZeros",this.sb),this.dW.resize(this.height,this.width),this.dW=N().execute("fillZeros",this.sW),this.db.resize(this.height,1),this.db=N().execute("fillZeros",this.sb),this.dZ.resize(this.height,this.width),this.dZ=N().execute("fillZeros",this.sW)}},{key:"is1D",value:function(){return!0}},{key:"is3D",value:function(){return!1}},{key:"transition",value:function(t){return t.is1D()?this.setWidth(t.getSize()):t.is3D()&&this.setWidth(t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth()),ce(ye(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){return this.setHeight(t),this}},{key:"getSize",value:function(){return this.height}},{key:"getOutputWidth",value:function(){return this.width}},{key:"getOutputHeight",value:function(){return this.height}},{key:"getOutputDepth",value:function(){return 1}}])&&ae(e.prototype,r),u}(oe);function be(t){return be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},be(t)}function de(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ve(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function we(t,e){return we=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},we(t,e)}function me(t,e){if(e&&("object"===be(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ge(t){return ge=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ge(t)}var Oe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&we(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ge(n);if(o){var r=ge(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return me(this,t)});function u(){return de(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return N().execute("softmaxActivation",t)}},{key:"getType",value:function(){return bt.softmax}},{key:"loss",value:function(t,e){return N().execute("softmaxLoss",t,e)}},{key:"error",value:function(t){return-1/t}},{key:"backpropagation",value:function(t){return this.dZ=N().execute("softmaxBackpropagation",t,this.A),this.dZ}}])&&ve(e.prototype,r),u}(he);function Se(t){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Se(t)}function xe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function je(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ke(t,e){return ke=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ke(t,e)}function Pe(t,e){if(e&&("object"===Se(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _e(t){return _e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},_e(t)}var Re=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ke(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=_e(n);if(o){var r=_e(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Pe(this,t)});function u(){return xe(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return N().execute("logisticActivation",t)}},{key:"getType",value:function(){return bt.logistic}},{key:"loss",value:function(t,e){return N().execute("logisticLoss",t,e)}},{key:"error",value:function(t){return 1/t}},{key:"backpropagation",value:function(t){return this.dZ=N().execute("logisticBackpropagation",t,this.A),this.dZ}}])&&je(e.prototype,r),u}(he);function Ee(t){return Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ee(t)}function Te(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function We(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ze(t,e){return ze=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ze(t,e)}function De(t,e){if(e&&("object"===Ee(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Be(t){return Be=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Be(t)}var Ce=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ze(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Be(n);if(o){var r=Be(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return De(this,t)});function u(){return Te(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return N().execute("tanhActivation",t)}},{key:"getType",value:function(){return bt.tanh}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}}])&&We(e.prototype,r),u}(he);function Ne(t){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ne(t)}function Le(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Me(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ke(t,e){return Ke=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ke(t,e)}function Ae(t,e){if(e&&("object"===Ne(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ze(t){return Ze=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ze(t)}var Fe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ke(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ze(n);if(o){var r=Ze(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ae(this,t)});function u(){return Le(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return N().execute("reluActivation",t)}},{key:"getType",value:function(){return bt.relu}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}},{key:"backpropagation",value:function(t){return this.dZ=N().execute("reluBackpropagation",t,this.A),this.dZ}}])&&Me(e.prototype,r),u}(he);function qe(t){return qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qe(t)}function He(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ie(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ue(t,e){return Ue=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ue(t,e)}function Qe(t,e){if(e&&("object"===qe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Je(t){return Je=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Je(t)}var Ge=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ue(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Je(n);if(o){var r=Je(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Qe(this,t)});function u(){return He(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return N().execute("softplusActivation",t)}},{key:"getType",value:function(){return bt.softplus}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}}])&&Ie(e.prototype,r),u}(he),Ve=function(t,e,r,n,o,i,u,a,c,s){for(var f=i*o*e,l=((n-i+2*a)/s+1)*((r-o+2*u)/c+1),y=0,p=N().execute("fillZeros",new A(f,l)),h=-u;h+o<=r+u;h+=c)for(var b=-a;b+i<=n+a;b+=s){for(var d=0,v=0;v<e;v++)for(var w=r*n*v,m=0;m<o;m++)for(var g=0;g<i;g++)h+m>=0&&b+g>=0&&b+g<n&&h+m<r&&p.data&&t.data&&p.data[d]&&(p.data[d][y]=t.data[(m+h)*n+b+g+w][0]),d++;y++}return p},Xe=function(t,e,r,n,o,i,u,a){for(var c=(n-i)/a+1,s=(r-o)/u+1,f=e,l=0,y=N().execute("fillZeros",new A(c*s*f,1)),p=0;p+o<=r;p+=u)for(var h=0;h+i<=n;h+=a){for(var b=0;b<e;b++){for(var d=-1/0,v=r*n*b,w=c*s*b,m=0;m<o;m++)for(var g=0;g<i;g++)d=Math.max(d,t.data[v+(m+p)*n+h+g][0]);y.data&&(y.data[w+l][0]=d)}l++}return new A},Ye=function(t,e){return Math.round((t+Number.EPSILON)*Math.pow(10,e))/Math.pow(10,e)};function $e(t){return $e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$e(t)}function tr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function er(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function rr(t,e,r){return rr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ir(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}},rr(t,e,r||t)}function nr(t,e){return nr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},nr(t,e)}function or(t,e){if(e&&("object"===$e(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ir(t){return ir=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ir(t)}var ur=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&nr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ir(n);if(o){var r=ir(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return or(this,t)});function u(){return tr(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"configure",value:function(){}},{key:"is1D",value:function(){return!1}},{key:"is3D",value:function(){return!0}},{key:"transition",value:function(t){return t.is3D()&&this.setSize([t.getOutputWidth(),t.getOutputHeight(),t.getOutputDepth()]),rr(ir(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){return this.setWidth(t[0]),this.setHeight(t[1]),this.setDepth(t[2]),this}},{key:"getSize",value:function(){return[this.getWidth(),this.getHeight(),this.getDepth()]}}])&&er(e.prototype,r),u}(oe);function ar(t){return ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ar(t)}function cr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function sr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function fr(t,e){return fr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},fr(t,e)}function lr(t,e){if(e&&("object"===ar(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return yr(t)}function yr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function pr(t){return pr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},pr(t)}function hr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var br=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=pr(n);if(o){var r=pr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return lr(this,t)});function u(){var t;cr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return hr(yr(t=i.call.apply(i,[this].concat(r))),"numFilters",32),hr(yr(t),"filterSize",4),hr(yr(t),"padding",1),hr(yr(t),"stride",1),t}return e=u,(r=[{key:"configure",value:function(){this.W.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.W=N().execute("fillRandom",this.W,this.width*this.height*this.depth),this.b.resize(this.numFilters,1),this.b=N().execute("fillRandom",this.b,.01),this.gW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.gW=N().execute("fillZeros",this.gW),this.gb.resize(this.numFilters,1),this.gb=N().execute("fillZeros",this.gb),this.sW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.sW=N().execute("fillZeros",this.gb),this.sb.resize(this.numFilters,1),this.sb=N().execute("fillZeros",this.sb),this.vW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.vW=N().execute("fillZeros",this.vW),this.vb.resize(this.numFilters,1),this.vb=N().execute("fillZeros",this.vb)}},{key:"getOutputHeight",value:function(){return(this.width-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.height-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.numFilters}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setNumFilters",value:function(t){return this.numFilters=t,this}},{key:"getNumFilters",value:function(){return this.numFilters}},{key:"setPadding",value:function(t){return this.padding=t,this}},{key:"getPadding",value:function(){return this.padding}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"forward",value:function(t){for(var e=new A(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols),r=0;r<t.cols;r+=1){var n=Ve(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.padding,this.padding,this.stride,this.stride),o=N().execute("add",N().execute("multiply",this.W,n),this.b.replicate(1,t.cols));e.setCol(r,o.rollToColMatrix())}return this.Z=e,this.activation(this.Z),this.A}},{key:"activation",value:function(t){return N().execute("reluActivation",t)}},{key:"getType",value:function(){return bt.conv}},{key:"loss",value:function(t,e){throw new Error("Unsupported.")}},{key:"error",value:function(t){throw new Error("Unsupported.")}}])&&sr(e.prototype,r),u}(ur);function dr(t){return dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dr(t)}function vr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function mr(t,e){return mr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},mr(t,e)}function gr(t,e){if(e&&("object"===dr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Or(t){return Or=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Or(t)}var Sr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&mr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Or(n);if(o){var r=Or(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return gr(this,t)});function u(){return vr(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"configure",value:function(){}},{key:"transition",value:function(t){if(!t.is3D())throw new Error("Invalid usage. Cannot fully connect with previous 1D Layer.");if(t.getType()!=bt.maxpool)throw new Error("Invalid usage. Cannot fully connect with previous non maxpool Layer.");return this.filterSize=t.getOutputWidth(),this.padding=0,this.stride=1,this.width=t.getOutputWidth(),this.height=t.getOutputHeight(),this.depth=t.getOutputDepth(),this.numFilters=t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth(),this}},{key:"setSize",value:function(t){return this}},{key:"setFilterSize",value:function(t){return this}},{key:"setStride",value:function(t){return this}},{key:"setPadding",value:function(t){return this}},{key:"setWidth",value:function(t){return this}},{key:"setHeight",value:function(t){return this}},{key:"setDepth",value:function(t){return this}},{key:"setNumFilters",value:function(t){return this}}])&&wr(e.prototype,r),u}(br);function xr(t){return xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xr(t)}function jr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Pr(t,e){return Pr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Pr(t,e)}function _r(t,e){if(e&&("object"===xr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Rr(t)}function Rr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Er(t){return Er=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Er(t)}function Tr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Wr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Er(n);if(o){var r=Er(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return _r(this,t)});function u(){var t;jr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Tr(Rr(t=i.call.apply(i,[this].concat(r))),"filterSize",0),Tr(Rr(t),"stride",0),t}return e=u,(r=[{key:"configure",value:function(){}},{key:"getOutputHeight",value:function(){return(this.height-this.filterSize)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.width-this.filterSize)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.depth}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"getPadding",value:function(){return 0}},{key:"forward",value:function(t){for(var e=new A(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols),r=0;r<t.cols;r+=1){var n=Xe(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.stride,this.stride).rollToColMatrix();e.setCol(r,n)}return this.Z=e,this.activation(this.Z),this.A}},{key:"activation",value:function(t){throw new Error("No activation for MAXPOOL Layer.")}},{key:"getType",value:function(){return bt.maxpool}},{key:"loss",value:function(t,e){throw new Error("Unsupported.")}},{key:"error",value:function(t){throw new Error("Unsupported.")}}])&&kr(e.prototype,r),u}(ur);function zr(t){return zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zr(t)}function Dr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Br(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Cr(t,e){return Cr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Cr(t,e)}function Nr(t,e){if(e&&("object"===zr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Lr(t){return Lr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Lr(t)}var Mr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Cr(t,e)}(c,t);var e,n,o,i,u,a=(i=c,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Lr(i);if(u){var r=Lr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Nr(this,t)});function c(){return Dr(this,c),a.apply(this,arguments)}return e=c,o=[{key:"fromJSON",value:function(t){return new Promise((function(e,n){r.readFile(t,(function(t,r){if(t)n(t);else{var o=JSON.parse(r.toString()),i=new c(o.dimensions);o.layers.forEach((function(t){var e=null;"logistic"===t.type?e=Re:"softmax"===t.type?e=Oe:"relu"===t.type?e=Fe:"softplus"===t.type?e=Ge:"tanh"===t.type&&(e=Ce),i.createLayer(e,(function(e){e.setSize(t.size)}))}));var u=i.getNetwork();u&&(u.getLayers().forEach((function(t,e){t.W=new A(o.layers[e].weights.W.length,o.layers[e].weights.W[0].length,o.layers[e].weights.W),t.b=new A(o.layers[e].weights.b.length,o.layers[e].weights.b[0].length,o.layers[e].weights.b)})),e(u))}}))}))}}],(n=[{key:"firstLayerTransition",value:function(t){t.setWidth(this.dimensions[0])}}])&&Br(e.prototype,n),o&&Br(e,o),c}(ee);function Kr(t){return Kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kr(t)}function Ar(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Zr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Fr(t,e){return Fr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Fr(t,e)}function qr(t,e){if(e&&("object"===Kr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Hr(t){return Hr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Hr(t)}var Ir=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Fr(t,e)}(c,t);var e,n,o,i,u,a=(i=c,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Hr(i);if(u){var r=Hr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return qr(this,t)});function c(){return Ar(this,c),a.apply(this,arguments)}return e=c,o=[{key:"fromJSON",value:function(t){return new Promise((function(e,n){r.readFile(t,(function(t,r){if(t)n(t);else{var o=JSON.parse(r.toString()),i=new c(o.size);o.layers.forEach((function(t){"logistic"===t.type?i.createLayer(Re,(function(e){e.setSize(t.size)})):"softmax"===t.type?i.createLayer(Oe,(function(e){e.setSize(t.size)})):"relu"===t.type?i.createLayer(Fe,(function(e){e.setSize(t.size)})):"softplus"===t.type?i.createLayer(Ge,(function(e){e.setSize(t.size)})):"tanh"===t.type?i.createLayer(Ce,(function(e){e.setSize(t.size)})):"conv"===t.type?i.createLayer(br,(function(e){e.setSize(t.size),e.setFilterSize(t.filterSize),e.setStride(t.stride),e.setNumFilters(t.numFilters),e.setPadding(t.padding)})):"maxpool"===t.type?i.createLayer(Wr,(function(e){e.setSize(t.size),e.setFilterSize(t.filterSize),e.setStride(t.stride)})):"fullyconnected"===t.type&&i.createLayer(Wr)}));var u=i.getNetwork();u&&(u.getLayers().forEach((function(t,e){t.W=o.layers.W,t.b=o.layers.b})),e(u))}}))}))}}],(n=[{key:"firstLayerTransition",value:function(t){this.dimensions&&t.setSize(this.dimensions)}}])&&Zr(e.prototype,n),o&&Zr(e,o),c}(ee);function Ur(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Jr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Gr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(Ur(this,t),Jr(this,"exampleSize",0),Jr(this,"numberOfExamples",0),Jr(this,"data",null),this.exampleSize=e,this.numberOfExamples=r,n){for(var o=[],i=0;i<e;i+=1){o[i]=new Array(r);for(var u=0;u<r;u+=1)"string"==typeof n[i][u]?o[i][u]=n[i][u].length?Number(n[i][u]):NaN:"number"==typeof n[i][u]&&(o[i][u]=n[i][u])}this.data=new A(this.exampleSize,this.numberOfExamples,o)}}var e,r,n;return e=t,n=[{key:"fromMatrix",value:function(e){var r=new t;return r.exampleSize=e.rows,r.numberOfExamples=e.cols,r.data=e,r}}],(r=[{key:"exampleAt",value:function(t){return this.data.col(t)}},{key:"getNumberOfExamples",value:function(){return this.numberOfExamples}},{key:"getExampleSize",value:function(){return this.exampleSize}},{key:"getBatch",value:function(e,r){var n=this.data.block(0,e,this.data.rows,r);return t.fromMatrix(n)}}])&&Qr(e.prototype,r),n&&Qr(e,n),t}();function Vr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Xr=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"fromSource",value:function(t){return new Promise((function(e){t.then((function(t){var r=t.parse(),n=r.cols,o=r.rows,i=new Gr(o,n,r.data);e(i)}))}))}}],null&&Vr(e.prototype,null),r&&Vr(e,r),t}();function Yr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function $r(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var tn=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),$r(this,"batchSize",0),$r(this,"t",0),$r(this,"learningRate",0)}var e,r;return e=t,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"setT",value:function(t){return this.t=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}}])&&Yr(e.prototype,r),t}();function en(t){return en="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},en(t)}function rn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function on(t,e){return on=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},on(t,e)}function un(t,e){if(e&&("object"===en(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return an(t)}function an(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function cn(t){return cn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},cn(t)}function sn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var fn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&on(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=cn(n);if(o){var r=cn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return un(this,t)});function u(){var t;rn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return sn(an(t=i.call.apply(i,[this].concat(r))),"beta1",.9),sn(an(t),"beta2",.999),t}return e=u,(r=[{key:"setBeta1",value:function(t){return this.beta1=t,this}},{key:"setBeta2",value:function(t){return this.beta2=t,this}},{key:"optimize",value:function(t){this.adam(t,this.learningRate,this.t)}},{key:"adam",value:function(t,e,r){t.vW=N().execute("add",N().execute("multiplyNumber",t.vW,this.beta1),N().execute("multiplyNumber",t.gW,1-this.beta1));var n=N().execute("divideNumber",t.vW,1-Math.pow(this.beta1,r));t.sW=N().execute("add",N().execute("multiplyNumber",t.sW,this.beta2),N().execute("multiplyNumber",t.gW,1-this.beta2));var o=N().execute("sqrt",N().execute("multiplyNumber",N().execute("elementWiseMultiply",t.gW,t.gW),1-Math.pow(this.beta2,r)));t.W=N().execute("subtract",t.W,N().execute("multiplyNumber",N().execute("elementWiseDivide",n,N().execute("sqrt",o)),e)),t.vb=N().execute("add",N().execute("multiplyNumber",t.vb,this.beta1),N().execute("multiplyNumber",t.gb,1-this.beta1));var i=N().execute("divideNumber",t.vb,1-Math.pow(this.beta1,r));t.sb=N().execute("add",N().execute("multiplyNumber",t.sb,this.beta2),N().execute("multiplyNumber",N().execute("elementWiseMultiply",t.gb,t.gb),1-this.beta2));var u=N().execute("divideNumber",t.sb,1-Math.pow(this.beta2,r));t.b=N().execute("subtract",t.b,N().execute("multiplyNumber",N().execute("elementWiseDivide",i,N().execute("sqrt",u)),e))}}])&&nn(e.prototype,r),u}(tn);function ln(t){return ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ln(t)}function yn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function hn(t,e){return hn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},hn(t,e)}function bn(t,e){if(e&&("object"===ln(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dn(t){return dn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},dn(t)}var vn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&hn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=dn(n);if(o){var r=dn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return bn(this,t)});function u(){return yn(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.gradientDescent(t,this.learningRate)}},{key:"gradientDescent",value:function(t,e){t.W=N().execute("subtract",t.W,N().execute("multiplyNumber",t.gW,e)),t.b=N().execute("subtract",t.b,N().execute("multiplyNumber",t.gb,e))}}])&&pn(e.prototype,r),u}(tn);function wn(t){return wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wn(t)}function mn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function On(t,e){return On=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},On(t,e)}function Sn(t,e){if(e&&("object"===wn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function xn(t){return xn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},xn(t)}var jn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&On(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=xn(n);if(o){var r=xn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Sn(this,t)});function u(){return mn(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.adadelta(t,this.learningRate,this.t)}},{key:"adadelta",value:function(t,e,r){var n=.9;t.sW=N().execute("add",N().execute("multiplyNumber",t.sW,n),N().execute("multiplyNumber",N().execute("elementWiseMultiply",t.gW,t.gW),1-n));var o=N().execute("elementWiseMultiply",N().execute("multiplyNumber",N().execute("elementWiseDivide",N().execute("sqrt",t.vW),N().execute("sqrt",t.sW)),-1),t.gW);t.vW=N().execute("add",N().execute("multiplyNumber",t.sW,n),N().execute("multiplyNumber",N().execute("pow",o,2),1-n)),t.W=N().execute("add",t.W,o),t.sb=N().execute("add",N().execute("multiplyNumber",t.gb,n),N().execute("multiplyNumber",N().execute("elementWiseMultiply",t.gb,t.gb),1-n));var i=N().execute("elementWiseMultiply",N().execute("multiplyNumber",N().execute("elementWiseDivide",N().execute("sqrt",t.vb),t.sb),-1),t.gb);t.vb=N().execute("add",N().execute("multiplyNumber",t.sb,n),N().execute("multiplyNumber",N().execute("pow",t.sb,2),1-n)),t.b=N().execute("elementWiseMultiply",t.b,i)}}])&&gn(e.prototype,r),u}(tn);function kn(t){return kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kn(t)}function Pn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Rn(t,e){return Rn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Rn(t,e)}function En(t,e){if(e&&("object"===kn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Tn(t)}function Tn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Wn(t){return Wn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Wn(t)}function zn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Dn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Wn(n);if(o){var r=Wn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return En(this,t)});function u(){var t;Pn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return zn(Tn(t=i.call.apply(i,[this].concat(r))),"beta",.9),t}return e=u,(r=[{key:"optimize",value:function(t){this.momentum(t,this.learningRate)}},{key:"setBeta",value:function(t){return this.beta=t,this}},{key:"momentum",value:function(t,e){t.vW=N().execute("add",N().execute("multiplyNumber",t.vW,this.beta),N().execute("multiplyNumber",t.gW,1-this.beta)),t.vb=N().execute("add",N().execute("multiplyNumber",t.vb,this.beta),N().execute("multiplyNumber",t.gb,1-this.beta)),t.W=N().execute("subtract",t.W,N().execute("multiplyNumber",t.vW,e)),t.b=N().execute("subtract",t.b,N().execute("multiplyNumber",t.vb,e))}}])&&_n(e.prototype,r),u}(tn);function Bn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Cn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Nn=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Cn(this,"network",null),Cn(this,"optimizer",null),Cn(this,"regularization",1e-8),Cn(this,"iterations",1e3),Cn(this,"learningRate",.01),Cn(this,"verbose",!0),Cn(this,"verboseStep",1),Cn(this,"stepCallback",(function(t){})),this.network=e,this.optimizer=r}var e,r;return e=t,r=[{key:"setRegularization",value:function(t){return this.regularization=t,this}},{key:"setIterations",value:function(t){return this.iterations=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}},{key:"setVerbose",value:function(t){return this.verbose=t,this}},{key:"setVerboseStep",value:function(t){return this.verboseStep=t,this}},{key:"setStepCallback",value:function(t){return this.stepCallback=t,this}},{key:"cost",value:function(t,e){var r=t.getNumberOfExamples(),n=(Math.ceil(r/100),0),o=0;this.network.getLayers().forEach((function(t){o+=t.penalty()}));for(var i=this.network.forward(t.data),u=e.data,a=this.network.loss(u,i),c=(this.network.error(t.getNumberOfExamples()),a+this.regularization/(2*o*t.getNumberOfExamples())),s=0;s<i.cols;s+=1)i.colMaxCoeffIndex(s)===u.colMaxCoeffIndex(s)&&n++;return{cost:c,accuracy:(n-1)/r*100}}}],r&&Bn(e.prototype,r),t}();function Ln(t){return Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ln(t)}function Mn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Kn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function An(t,e){return An=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},An(t,e)}function Zn(t,e){if(e&&("object"===Ln(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Fn(t)}function Fn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function qn(t){return qn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},qn(t)}function Hn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var In=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&An(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=qn(n);if(o){var r=qn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Zn(this,t)});function u(){var t;Mn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Hn(Fn(t=i.call.apply(i,[this].concat(r))),"batchSize",100),t}return e=u,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"train",value:function(t,e){var r=this,n=t.getNumberOfExamples(),o=0;this.optimizer.setBatchSize(this.batchSize),this.optimizer.setLearningRate(this.learningRate);for(var i=0;i<this.iterations;i+=1){for(var u=(new Date).getTime(),a=(new Date).getTime(),c=0,s=0;c<n;c+=this.batchSize,s+=this.batchSize){var f=(new Date).getTime(),l=t.getBatch(s,this.batchSize),y=e.getBatch(s,this.batchSize),p=this.network.forward(l.data);if(this.network.backward(l.data,y.data,p,this.regularization),this.optimizer.setT(++o),this.network.getLayers().forEach((function(t){r.optimizer.optimize(t)})),this.verbose){var h=(new Date).getTime();console.log("Batch: ".concat(s," / ").concat(n," | Batch time: ").concat(h-f,"ms | Time from start: ").concat(Ye((h-a)/1e3,1),"s."))}}if(this.verbose&&(i+1)%this.verboseStep==0){var b=(new Date).getTime(),d=this.cost(t,e);console.log("Iteration: ".concat(i+1," | Cost: ").concat(Ye(d.cost,5)," | Accuracy: ").concat(d.accuracy,"% | Time: ").concat((b-u)/100," s."))}"function"==typeof this.stepCallback&&this.stepCallback.call(null,{iteration:i})}return this}}])&&Kn(e.prototype,r),u}(Nn),Un=function t(e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(r="dataset")in this?Object.defineProperty(this,r,{value:null,enumerable:!0,configurable:!0,writable:!0}):this[r]=null,this.dataset=e};function Qn(t){return Qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qn(t)}function Jn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Gn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Vn(t,e){return Vn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Vn(t,e)}function Xn(t,e){if(e&&("object"===Qn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Yn(t)}function Yn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function $n(t){return $n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},$n(t)}function to(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var eo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$n(n);if(o){var r=$n(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Xn(this,t)});function u(){var t;Jn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return to(Yn(t=i.call.apply(i,[this].concat(r))),"callback",(function(t){return t})),t}return e=u,(r=[{key:"apply",value:function(){for(var t=0;t<this.dataset.getNumberOfExamples();t+=1)for(var e=this.callback(this.dataset.exampleAt(t)),r=0;r<this.dataset.data.rows;r+=1)e&&(this.dataset.data.data[r][t]=e.data[r][0]);return this.dataset}},{key:"setCallback",value:function(t){return this.callback=t,this}}])&&Gn(e.prototype,r),u}(Un);function ro(t){return ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ro(t)}function no(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function oo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function io(t,e){return io=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},io(t,e)}function uo(t,e){if(e&&("object"===ro(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ao(t){return ao=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ao(t)}var co=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&io(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ao(n);if(o){var r=ao(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return uo(this,t)});function u(){return no(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"apply",value:function(){for(var t=1/0,e=-1/0,r=0;r<this.dataset.getNumberOfExamples();r+=1)for(var n=this.dataset.exampleAt(r),o=0;o<n.rows;o+=1)t>n.data[o][0]&&(t=n.data[o][0]),e<n.data[o][0]&&(e=n.data[o][0]);for(var i=0;i<this.dataset.getNumberOfExamples();i+=1)for(var u=this.dataset.exampleAt(i),a=0;a<u.rows;a+=1)this.dataset.data.data[a][i]=(u.data[a][0]-t)/(e-t);return this.dataset}}])&&oo(e.prototype,r),u}(Un);function so(t){return so="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},so(t)}function fo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function yo(t,e){return yo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},yo(t,e)}function po(t,e){if(e&&("object"===so(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ho(t)}function ho(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function bo(t){return bo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},bo(t)}function vo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var wo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yo(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=bo(n);if(o){var r=bo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return po(this,t)});function u(){var t;fo(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return vo(ho(t=i.call.apply(i,[this].concat(r))),"modificationType","mean"),t}return e=u,(r=[{key:"apply",value:function(){for(var t=this,e=[],r=0,n=0,o=0,i=0;i<this.dataset.getNumberOfExamples();i+=1)for(var u=this.dataset.exampleAt(i),a=0;a<this.dataset.getExampleSize();a+=1)isNaN(u.data[a][0])||void 0===u.data[a][0]?e.push({row:a,col:u}):(n+=u.data[a][0],r++);return"mean"===this.modificationType&&(o=n/r),e.forEach((function(e){var r=e.row,n=e.col;t.dataset&&t.dataset.data&&t.dataset.data.data&&(t.dataset.data.data[r][n]=o)})),this.dataset}},{key:"setModificationType",value:function(t){return this.modificationType=t,this}}])&&lo(e.prototype,r),u}(Un),mo=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)};const go=require("csvtojson");function Oo(t){return Oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oo(t)}function So(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function xo(t,e){return xo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},xo(t,e)}function jo(t,e){if(e&&("object"===Oo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ko(t)}function ko(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Po(t){return Po=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Po(t)}function _o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Ro;!function(t){t[t.UnquotedField=0]="UnquotedField",t[t.QuotedField=1]="QuotedField",t[t.QuotedQuote=2]="QuotedQuote"}(Ro||(Ro={}));var Eo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xo(t,e)}(a,t);var e,r,n,o,i,u=(o=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Po(o);if(i){var r=Po(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return jo(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),_o(ko(e=u.call(this)),"data",null),_o(ko(e),"matrixData",null),e.data=t,e}return e=a,n=[{key:"fromLocalFile",value:function(t){return new Promise((function(e){go({noheader:!0,output:"csv"}).fromFile(t).then((function(t){e(new a(t))}))}))}}],(r=[{key:"parse",value:function(){var t=this.data.length,e=this.data[0].length;return new A(t,e,this.data).transpose()}}])&&So(e.prototype,r),n&&So(e,n),a}(mo),To={NetworkBuilder1D:Mr,NetworkBuilder3D:Ir},Wo={Matrix:A},zo={SoftmaxLayer:Oe,LogisticLayer:Re,ReluLayer:Fe,SoftplusLayer:Ge,TanhLayer:Ce,ConvLayer:br,MaxPoolLayer:Wr,FullyConnectedLayer:Sr},Do={DatasetBuilder:Xr},Bo={OptimizerAdam:fn,OptimizerGradientDescent:vn,OptimizerAdadelta:jn,OptimizerMomentum:Dn},Co={MiniBatchTrainer:In},No={CallbackDatabaseModifier:eo,MinMaxScalingDatabaseModifier:co,MissingDataScalingDatabaseModifier:wo},Lo={ComputationCPU:B,ComputationGPU:yt,setComputation:function(t){C=t},getComputation:N},Mo={Dataset:Gr},Ko={DatasetBuilderSourceCSV:Eo};module.exports=e})();
//# sourceMappingURL=impulse-ts.js.map