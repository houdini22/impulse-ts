(()=>{var t={568:(t,e,r)=>{(()=>{var e={382:(t,e,r)=>{t=r.nmd(t);try{process.dlopen(t,__dirname+r(17).sep+r.p+"9e034ce62a57cddc1a2b4486c9983546.node")}catch(t){throw new Error("node-loader:\n"+t)}},17:t=>{"use strict";t.exports=r(17)}},n={};function o(t){var r=n[t];if(void 0!==r)return r.exports;var i=n[t]={id:t,loaded:!1,exports:{}};return e[t](i,i.exports,o),i.loaded=!0,i.exports}o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),o.p="";var i={};(()=>{"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(e){var r=function(e,r){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===t(r)?r:String(r)}o.r(i),o.d(i,{ComputationCPU:()=>m,ComputationMultiCore:()=>l,Matrix:()=>W,getComputation:()=>O,im2col:()=>_,maxpool:()=>R,round:()=>E,setComputation:()=>g});var r=function(){function t(){var r,n,o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o={},(n=e(n="kernels"))in r?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o}var r,n;return r=t,n=[{key:"addKernel",value:function(t,e){return this.kernels[t]=e,this}},{key:"execute",value:function(t){if(!this.kernels[t])throw new Error("Kernel '".concat(t,"' not exists."));for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.kernels[t].apply(null,r)}}],n&&function(t,r){for(var n=0;n<r.length;n++){var o=r[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,e(o.key),o)}}(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),t}(),n=o(382),u=function(t,e){console.log((0,n.MatrixMultiply)([1,2,3,4],[4,3,2,1]))};function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}function f(t,e){if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function s(t){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},s(t)}var l=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=s(r);if(n){var o=s(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return f(this,t)});function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this)).addKernel("dot",u),t}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(r),y=function(t,e){if(t.cols!==e.rows)throw new Error("DIMENSIONS error. m1.cols ".concat(t.rows," ").concat(t.cols," !== m2.rows ").concat(e.rows," ").concat(e.cols,"."));for(var r=[],n=0;n<t.rows;++n){r[n]=new Array(e.cols);for(var o=0;o<e.cols;++o){r[n][o]=0;for(var i=0;i<t.cols;++i)t.data&&e.data&&(r[n][o]+=t.data[n][i]*e.data[i][o])}}return new W(t.rows,e.cols,r)},p=function(t){for(var e=[],r=0;r<t.cols;++r){e[r]=new Array(t.rows);for(var n=0;n<t.rows;++n)e[r][n]=t.data[n][r]}return new W(t.cols,t.rows,e)};function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function b(t,e){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},b(t,e)}function v(t,e){if(e&&("object"===h(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function d(t){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},d(t)}var m=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&b(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=d(r);if(n){var o=d(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return v(this,t)});function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this)).addKernel("dot",y),t.addKernel("transpose",p),t}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(r),w=new m,g=function(t){w=t},O=function(){return w};function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function j(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,x(n.key),n)}}function k(t,e,r){return(e=x(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function x(t){var e=function(t,e){if("object"!==S(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===S(e)?e:String(e)}var W=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;j(this,t),k(this,"rows",0),k(this,"cols",0),k(this,"data",null),this.resize(e,r),n&&this.generateData(n)}var e,r,n;return e=t,r=[{key:"resize",value:function(t,e){this.rows=t,this.cols=e,this.data=new Array(this.rows);for(var r=0;r<this.rows;r+=1)this.data[r]=new Array(this.cols);return this}},{key:"generateData",value:function(t){for(var e=[],r=0;r<this.rows;r+=1)e[r]=new Array(this.cols);for(var n=0;n<this.cols;n+=1)for(var o=0;o<this.rows;o+=1)"number"==typeof t[o]?e[o][n]=t[o]:"string"==typeof t[o][n]&&/^[0-9.]+$/.test(String(t[o][n]))?e[o][n]=Number(t[o][n]):e[o][n]=t[o][n];return this.data=e,this}},{key:"sum",value:function(){for(var t=0,e=0;e<this.rows;e+=1)for(var r=0;r<this.cols;r+=1)t+=this.data[e][r];return t}},{key:"colwiseSum",value:function(){for(var e=[],r=this.transpose(),n=0;n<r.rows;n+=1){e[n]=[0];for(var o=0;o<r.cols;o+=1)e[n][0]+=r.data[n][o]}return new t(this.cols,1,e)}},{key:"rowwiseSum",value:function(){for(var e=[[]],r=0;r<this.rows;r+=1){for(var n=0,o=0;o<this.cols;o+=1)n+=this.data[r][o];e[0].push(n)}return new t(1,this.rows,e)}},{key:"flatten",value:function(){for(var t=[],e=0;e<this.rows;e+=1)for(var r=0;r<this.cols;r+=1)t.push(this.data[e][r]);return t}},{key:"replicate",value:function(e,r){if(1===e&&1===this.cols&&r>1){for(var n=[],o=0;o<this.rows;o+=1){n[o]=[];for(var i=0;i<r;i+=1)n[o][i]=this.data[o][0]}return t.from(n)}if(1===r&&1===this.rows&&e>1){for(var u=[],a=0;a<e;a+=1){u[a]=[];for(var c=0;c<this.cols;c+=1)u[a][c]=this.data[0][c]}return t.from(u)}return this}},{key:"transpose",value:function(){return O().execute("transpose",this)}},{key:"colMaxCoeffIndex",value:function(t){for(var e=-1,r=-1/0,n=0;n<this.rows;n+=1)this.data&&this.data[n][t]>r&&(r=this.data[n][t],e=n);return e}},{key:"rowMaxCoeffIndex",value:function(t){for(var e=-1,r=-1/0,n=0;n<this.cols;n+=1)this.data[t][n]>r&&(r=this.data[t][n],e=n);return e}},{key:"block",value:function(e,r,n,o){for(var i=[],u=e,a=0;u<this.rows&&u<e+n;u+=1,a+=1){i[a]=new Array(o);for(var c=r,f=0;c<this.cols&&c<r+o;c+=1,f+=1)i[a][f]=this.data[u][c]}return new t(n,o,i)}},{key:"col",value:function(e){for(var r=[],n=0;n<this.rows;n+=1)r[n]=[this.data[n][e]];return new t(this.rows,1,r)}},{key:"row",value:function(e){for(var r=[],n=0;n<this.cols;n+=1)r[n]=[this.data[e][n]];return new t(this.cols,1,r)}},{key:"setCol",value:function(t,e){for(var r=0;r<this.rows;r+=1)this.data&&e.data&&(this.data[r][t]=e.data[r][0]);return this}},{key:"sigmoid",value:function(){return this.multiply(-1).exp().add(1).fraction(1)}},{key:"rollToColMatrix",value:function(){for(var e=[],r=0,n=0;n<this.rows;n+=1)for(var o=0;o<this.cols;o+=1)e[r]=[],e[r++][0]=this.data[n][o];return t.from(e)}},{key:"abs",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=Math.abs(this.data[r][n])}return t.from(e)}},{key:"mean",value:function(){for(var t=0,e=this.rows*this.cols,r=0;r<this.rows;r+=1)for(var n=0;n<this.cols;n+=1)t+=this.data[r][n];return t/e}},{key:"max",value:function(){for(var t=-1/0,e=0;e<this.rows;e+=1)for(var r=0;r<this.cols;r+=1)t=Math.max(this.data[e][r],t);return t}},{key:"setMax",value:function(e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=Math.min(this.data[n][o],e)}return t.from(r)}},{key:"setMin",value:function(e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=Math.max(this.data[n][o],e)}return t.from(r)}},{key:"setZeros",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=0}return t.from(e)}},{key:"setOnes",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=1}return t.from(e)}},{key:"setRandom",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=(4*Math.random()-2)*Math.sqrt(2/e)}return t.from(r)}},{key:"fraction",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=e/this.data[n][o]}return t.from(r)}},{key:"sqrt",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=Math.sqrt(this.data[r][n]+1e-8)}return t.from(e)}},{key:"dot",value:function(t){return O().execute("dot",this,t)}},{key:"multiply",value:function(e){if("number"==typeof e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=this.data[n][o]*e}return t.from(r)}if(e.rows!==this.rows||this.cols!==e.cols)throw new Error("Dimension error: ".concat(this.shape()," !== ").concat(e.shape()));for(var i=[],u=0;u<this.rows;u+=1){i[u]=[];for(var a=0;a<this.cols;a+=1)i[u][a]=this.data[u][a]*e.data[u][a]}return t.from(i)}},{key:"subtract",value:function(e){if("number"==typeof e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=this.data[n][o]-e}return t.from(r)}if(this.rows!==e.rows||this.cols!==e.cols)throw new Error("Dimensions error: ".concat(this.rows,", ").concat(this.cols," !== ").concat(e.rows,", ").concat(e.cols));for(var i=[],u=0;u<this.rows;u+=1){i[u]=[];for(var a=0;a<this.cols;a+=1)i[u][a]=this.data[u][a]-e.data[u][a]}return t.from(i)}},{key:"forEach",value:function(e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=e(this.data[n][o])}return t.from(r)}},{key:"shape",value:function(){return[this.rows,this.cols]}},{key:"divide",value:function(e){if("number"==typeof e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=this.data[n][o]/e}return t.from(r)}if(e.rows!==this.rows||e.cols!==this.cols)throw new Error("Dimensions error (".concat(this.rows,", ").concat(this.cols,") !== (").concat(e.rows,", ").concat(e.cols,")"));for(var i=[],u=0;u<this.rows;u+=1){i[u]=[];for(var a=0;a<this.cols;a+=1)i[u][a]=this.data[u][a]/e.data[u][a]}return t.from(i)}},{key:"minusOne",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=1-this.data[r][n]}return t.from(e)}},{key:"subtractFromNumber",value:function(e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=e-this.data[n][o]}return t.from(r)}},{key:"add",value:function(e){if("number"==typeof e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=this.data[n][o]+e}return t.from(r)}if(e instanceof t){if(e.rows!==this.rows||e.cols!==this.cols)throw new Error("Dimention error: rows (x: ".concat(this.rows,", y: ").concat(this.cols,") !== (x: ").concat(e.rows,", y: ").concat(e.cols,")"));for(var i=[],u=0;u<this.rows;u+=1){i[u]=[];for(var a=0;a<this.cols;a+=1)i[u][a]=this.data[u][a]+e.data[u][a]}return t.from(i)}return this}},{key:"log",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=Math.log(this.data[r][n]+1e-8)}return t.from(e)}},{key:"tanh",value:function(){return this.exp().subtract(this.multiply(-1).exp()).divide(this.exp().add(this.multiply(-1).exp()))}},{key:"softmax",value:function(){var t=this.max()-1e-8;return this.subtract(t).exp().divide(this.rowwiseSum().replicate(this.cols,1).transpose())}},{key:"exp",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=Math.exp(this.data[r][n]+1e-8)}return t.from(e)}},{key:"pow",value:function(e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=Math.pow(this.data[n][o],e)}return t.from(r)}},{key:"value",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return void 0===r?this.data[t][e]:(this.data[t][e]=r,this)}},{key:"copy",value:function(){return t.from(this.data)}},{key:"concat",value:function(t){for(var e=0;e<t.rows;e+=1)this.data.push(t.data[e]);return this}}],n=[{key:"from",value:function(e){var r;return new t(e.length,(null===(r=e[0])||void 0===r?void 0:r.length)||0,e)}}],r&&P(e.prototype,r),n&&P(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),_=function(t,e,r,n,o,i,u,a,c,f){for(var s=0,l=new W(((n-i+2*a)/f+1)*((r-o+2*u)/c+1),i*o*e).setZeros(),y=-u;y+o<=r+u;y+=c)for(var p=-a;p+i<=n+a;p+=f){for(var h=0,b=0;b<e;b++)for(var v=r*n*b,d=0;d<o;d++)for(var m=0;m<i;m++)y+d>=0&&p+m>=0&&p+m<n&&y+d<r&&(l.data[s][h]=t.data[(d+y)*n+p+m+v][0]),h++;s++}return l},R=function(t,e,r,n,o,i,u,a){for(var c=(n-i)/a+1,f=(r-o)/u+1,s=0,l=new W(c*f*e,1).setZeros(),y=0;y+o<=r;y+=u)for(var p=0;p+i<=n;p+=a){for(var h=0;h<e;h++){for(var b=-1/0,v=r*n*h,d=c*f*h,m=0;m<o;m++)for(var w=0;w<i;w++)b=Math.max(b,t.data[v+(m+y)*n+p+w][0]);l.data[d+s][0]=b}s++}return l},E=function(t,e){return Math.round((t+223e-18)*Math.pow(10,e))/Math.pow(10,e)}})(),t.exports=i})()},17:t=>{"use strict";t.exports=require("path")}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n),r.d(n,{Layer:()=>ro,Math:()=>eo,Network:()=>io,NetworkBuilder:()=>to,Optimizer:()=>no,Trainer:()=>oo});const t=require("fs");function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,u(n.key),n)}}function i(t,e,r){return(e=u(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t){var r=function(t,r){if("object"!==e(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===e(r)?r:String(r)}var a=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"dimensions",null),i(this,"size",0),i(this,"layers",[]),this.dimensions=t}var r,n;return r=e,(n=[{key:"addLayer",value:function(t){return this.size++,this.layers.push(t),this}},{key:"getLayers",value:function(){return this.layers}},{key:"forward",value:function(t){var e=t;return this.layers.forEach((function(t){e=t.forward(e)})),e}},{key:"backward",value:function(t,e,r){for(var n=t.cols,o=this.forward(t).subtract(e),i=this.layers.length-1;i>=0;i-=1)o=this.layers[i].getBackPropagation().propagate(t,n,r,this.layers[i],this.layers[i].derivative(o))}},{key:"save",value:function(e){var r={dimensions:this.dimensions,layers:[]};this.layers.forEach((function(t){r.layers.push({type:t.getType(),size:t.getSize(),weights:{W:t.W.data,b:t.b.data}})}));var n=JSON.stringify(r);return new Promise((function(r,o){t.writeFile(e,n,(function(t){t&&(console.error(t),o()),r(n)}))}))}}])&&o(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),e}(),c=r(568);function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,u,a=[],c=!0,f=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==e);c=!0);}catch(t){f=!0,o=t}finally{try{if(!c&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(f)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,h(n.key),n)}}function p(t,e,r){return(e=h(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function h(t){var e=function(t,e){if("object"!==f(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===f(e)?e:String(e)}var b,v=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),p(this,"dimensions",null),p(this,"size",0),p(this,"layers",[]),this.dimensions=e}var e,r;return e=t,(r=[{key:"addLayer",value:function(t){return this.size++,this.layers.push(t),this}},{key:"getLayers",value:function(){return this.layers}},{key:"loss",value:function(t,e){return-Math.log(1/t)*e}},{key:"sample",value:function(t){for(var e=this.layers[0].Waa,r=this.layers[0].Wax,n=this.layers[0].Wya,o=this.layers[0].by,i=this.layers[0].b,u=[],a=t.getCharIndices(),f=a["\n"],s=t.getChars(),l=new c.Matrix(this.dimensions[1],1).setZeros(),y=new c.Matrix(this.dimensions[0],1).setRandom(this.dimensions[1]),p=-1,h=0;p!=f&&50!=h;){var b=r.dot(l).add(e.dot(y)).add(i).setMin(.001).tanh(),v=n.dot(b).add(o).softmax();p=a[s[v.colMaxCoeffIndex(0)]],l=new c.Matrix(this.dimensions[1],1).setZeros();var d=v.colMaxCoeffIndex(0);-1===d&&(d=Math.floor(Math.random()*this.dimensions[1]),p=a[s[d]]),l.data[d][0]=1,u.push(p),y=b,h+=1}return 50===h&&u.push(f),u.map((function(t){return s[t]})).join("")}},{key:"forward",value:function(t,e,r){for(var n=[null],o=[r],i=[null],u=0,a=1;a<=t.rows;a+=1){n[a]=new c.Matrix(this.dimensions[1],this.dimensions[0]).setZeros(),n[a].data[t.data[a-1][0]][0]=1;var f=s(this.layers[0].forward(n[a],o[a-1]),2),l=f[0],y=f[1];o[a]=l,i[a]=y,u+=0}return this.layers[0].A=o,this.layers[0].X=n,this.layers[0].Y=i,[u]}},{key:"backward",value:function(t){for(var e=this.layers[0].A,r=this.layers[0].X,n=(this.layers[0].Y,new c.Matrix(this.layers[0].Wax.rows,this.layers[0].Wax.cols).setZeros()),o=new c.Matrix(this.layers[0].Waa.rows,this.layers[0].Waa.cols).setZeros(),i=new c.Matrix(this.layers[0].Wya.rows,this.layers[0].Wya.cols).setZeros(),u=new c.Matrix(this.layers[0].db.rows,this.layers[0].db.cols).setZeros(),a=new c.Matrix(this.layers[0].dby.rows,this.layers[0].dby.cols).setZeros(),f=new c.Matrix(this.layers[0].daNext.rows,this.layers[0].daNext.rows).setZeros(),s=t.rows-1;s>=1;s-=1){var l=c.Matrix.from(e[s].data);l.data[t.data[s-1][0]][0]-=1;var y=this.layers[0].backward(l,r[s],e[s],e[s-1]),p=y.dWax,h=y.dWya,b=y.dWaa,v=y.db,d=y.dby,m=y.daNext;n=n.add(p.replicate(1,n.cols)),o=o.add(b.replicate(1,o.cols)),i=i.add(h),u=u.add(v),a=a.add(d),f=f.add(m)}this.layers[0].dWax=n.setMin(-5).setMax(5),this.layers[0].dWaa=o.setMin(-5).setMax(5),this.layers[0].dWya=i.setMin(-5).setMax(5),this.layers[0].db=a.setMin(-5).setMax(5),this.layers[0].dby=a.setMin(-5).setMax(5),this.layers[0].daNext=f.setMin(-5).setMax(5)}},{key:"optimize",value:function(t,e,r,n){var o=s(this.forward(t,e,r),1)[0];return this.backward(t),this.layers[0].Wax=this.layers[0].Wax.add(this.layers[0].dWax.replicate(1,this.getDimensions()[2]).multiply(-n)),this.layers[0].Waa=this.layers[0].Waa.add(this.layers[0].dWaa.multiply(-n)),this.layers[0].Wya=this.layers[0].Wya.add(this.layers[0].dWya.multiply(-n)),[o,this.layers[0].A[t.rows-1]]}},{key:"getDimensions",value:function(){return this.dimensions}}])&&y(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function m(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,O(n.key),n)}}function w(t,e,r){return e&&m(t.prototype,e),r&&m(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function g(t,e,r){return(e=O(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function O(t){var e=function(t,e){if("object"!==d(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===d(e)?e:String(e)}!function(t){t.logistic="logistic",t.softmax="softmax",t.tanh="tanh",t.relu="relu",t.softplus="softplus",t.conv="conv",t.maxpool="maxpool",t.fullyconnected="fullyconnected",t.purelin="purelin",t.rnnlayer="rnnlayer"}(b||(b={}));var S=w((function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),g(this,"layer",null),g(this,"previousLayer",null),this.layer=e,this.previousLayer=r}));function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function P(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function k(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==j(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==j(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===j(o)?o:String(o)),n)}var o}function x(t,e){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},x(t,e)}function W(t,e){if(e&&("object"===j(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _(t){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_(t)}var R=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&x(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=_(n);if(o){var r=_(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return W(this,t)});function u(){return P(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"propagate",value:function(t,e,r,n,o){var i=null!==this.previousLayer?this.previousLayer.A:t,u=o.dot(i.transpose());if(this.layer.gW=u.divide(e).add(n.W.multiply(r/e)),this.layer.gb=o.rowwiseSum().transpose().divide(e),null!==this.previousLayer){var a=this.layer.W.transpose().dot(o);if(a.rows!==i.rows||a.cols!==i.cols)throw new Error("Dimension error 1. (".concat(a.rows,", ").concat(a.cols,") | (").concat(i.rows,", ").concat(i.cols,")"));if(this.layer.gW.rows!==this.layer.W.rows||this.layer.gW.cols!==this.layer.W.cols)throw new Error("Dimension error 2. (".concat(this.layer.gW.rows,", ").concat(this.layer.gW.cols,") | (").concat(this.layer.W.rows,", ").concat(this.layer.W.cols,")"));if(this.layer.gb.rows!==this.layer.b.rows||this.layer.gb.cols!==this.layer.b.cols)throw new Error("Dimension error 3. (".concat(this.layer.gb.rows,", ").concat(this.layer.gb.cols,") | (").concat(this.layer.b.rows,", ").concat(this.layer.b.cols,")"));return a}return new c.Matrix}}])&&k(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(S);function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}function T(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==E(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===E(o)?o:String(o)),n)}var o}function M(t,e){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},M(t,e)}function D(t,e){if(e&&("object"===E(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function C(t){return C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},C(t)}var B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&M(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=C(n);if(o){var r=C(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return D(this,t)});function u(){return T(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"propagate",value:function(t,e,r,n,o){return o}}])&&z(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(S);function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function A(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,J(n.key),n)}}function N(t,e){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},N(t,e)}function H(t,e){if(e&&("object"===L(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return F(t)}function F(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function I(t){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},I(t)}function q(t,e,r){return(e=J(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function J(t){var e=function(t,e){if("object"!==L(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===L(e)?e:String(e)}var K=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&N(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=I(n);if(o){var r=I(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return H(this,t)});function u(){var t;A(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return q(F(t=i.call.apply(i,[this].concat(r))),"previousLayer",null),t}return e=u,(r=[{key:"propagate",value:function(t,e,r,n,o){var i=this.previousLayer;if(i){for(var u=(0,c.getComputation)().execute("fillZeros",new c.Matrix(i.Z.rows,i.Z.cols)),a=i.getFilterSize(),f=i.getStride(),s=i.getWidth(),l=i.getHeight(),y=(i.getDepth(),i.getOutputWidth()),p=i.getOutputHeight(),h=i.getOutputDepth(),b=0;b<e;b++)for(var v=0;v<h;v++)for(var d=0;d<p;d++)for(var m=0;m<y;m++){for(var w=f*m,g=-1/0,O=l*s*v,S=p*y*v,j=0,P=0,k=0,x=f*d;k<a;k++,x++)for(var W=0,_=w;W<a;W++,_++)i.Z.data&&g<i.Z.data[O+x*s+_][b]&&(g=i.Z.data[O+x*s+_][b],j=_,P=x);u.data&&o.data&&(u.data[O+P*s+j][b]=o.data[S+d*y+m][b])}return u}return new c.Matrix}}])&&Z(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(S);function U(t){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U(t)}function X(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,et(n.key),n)}}function $(t,e){return $=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},$(t,e)}function V(t,e){if(e&&("object"===U(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return G(t)}function G(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Q(t){return Q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Q(t)}function tt(t,e,r){return(e=et(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function et(t){var e=function(t,e){if("object"!==U(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==U(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===U(e)?e:String(e)}var rt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Q(n);if(o){var r=Q(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return V(this,t)});function u(){var t;X(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return tt(G(t=i.call.apply(i,[this].concat(r))),"previousLayer",null),t}return e=u,(r=[{key:"propagate",value:function(t,e,r,n,o){var i=this.previousLayer;if(i){var u=i.getPadding(),a=i.getStride(),f=i.getFilterSize(),s=i.getOutputWidth(),l=i.getOutputHeight(),y=i.getOutputDepth(),p=i.getWidth(),h=i.getHeight(),b=i.getDepth(),v=(0,c.getComputation)().execute("fillZeros",new c.Matrix((p+2*u)*(h+2*u)*b,e)),d=new c.Matrix(p*h*b,e);i.gW=(0,c.getComputation)().execute("fillZeros",i.gW),i.gb=(0,c.getComputation)().execute("fillZeros",i.gb);for(var m=0;m<e;m++){for(var w=0;w<y;w++)for(var g=0;g<l;g++)for(var O=0;O<s;O++){for(var S=a*g,j=a*O,P=0;P<b;P++)for(var k=0,x=S,W=-u;k<f;k++,x++,W++)for(var _=0,R=j,E=-u;_<f;_++,R++,E++){i.W.data&&v.data&&o.data&&(v.data[P*(p+2*u)*(h+2*u)+x*(p+2*u)+R][m]+=i.W.data[w][P*f*f+k*f+_]*o.data[w*s*l+g*s+O][m]);var T=0;0==u?i.Z.data&&(T=i.Z.data[P*p*h+x*p+R][m]):W>=0&&E>=0&&W<h&&E<p&&i.Z.data&&(T=i.Z.data[P*p*h+W*p+E][m]),i.gW.data&&o.data&&(i.gW.data[w][P*f*f+k*f+_]+=T*o.data[w*(s*l)+g*s+O][m]/e)}i.gb.data&&o.data&&(i.gb.data[w][0]+=o.data[w*(s*l)+g*s+O][m]/e)}if(u>0)for(var z=0;z<b;z++)for(var M=-u,D=0;M<h+u;M++,D++)for(var C=-u,B=0;C<p+u;C++,B++)C>=0&&M>=0&&C<p&&M<h&&d.data&&v.data&&(d.data[z*p*h+M*p+C][m]=v.data[z*(p+2*u)*(h+2*u)+D*(p+2*u)+B][m])}return u>0?d:v}}}])&&Y(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(S);function nt(t){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(t)}function ot(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==nt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===nt(o)?o:String(o)),n)}var o}var it=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"create",value:function(t,e){if(null==t){if(e.is1D())return new R(e,t);if(e.getType()==b.conv)return new B(e,t)}else{if(t.getType()==b.maxpool)return new K(e,t);if(t.getType()==b.conv)return new rt(e,t);if(t.is1D()||t.getType()==b.fullyconnected)return new R(e,t)}return null}}],null&&ot(e.prototype,null),r&&ot(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ut(t){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ut(t)}function at(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ct(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,st(n.key),n)}}function ft(t,e,r){return(e=st(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function st(t){var e=function(t,e){if("object"!==ut(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ut(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===ut(e)?e:String(e)}var lt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ft(this,"dimensions",null),ft(this,"size",0),ft(this,"layers",[]),this.dimensions=e}var e,r;return e=t,(r=[{key:"addLayer",value:function(t){return this.size++,this.layers.push(t),this}},{key:"getLayers",value:function(){return this.layers}},{key:"loss",value:function(t,e){return-Math.log(1/t)*e}},{key:"sample",value:function(t){}},{key:"forward",value:function(t,e){for(var r=this,n=(t.length,t[0].rows),o=t[0].cols,i=this.layers[0].Wy.rows,u=this.layers[0].Wy.cols,a=(new Array(u).map((function(){return new c.Matrix(n,o).setZeros()})),new Array(u).map((function(){return new c.Matrix(n,o).setZeros()})),new Array(i).map((function(){return new c.Matrix(n,o).setZeros()})),e),f=new c.Matrix(u,n).setZeros(),s=function(e){var n=[];t.forEach((function(t,r){n[r]=[];for(var o=0;o<t.rows;o+=1)n[r].push(t.data[o][e])}));var o,i,u=c.Matrix.from(n),s=(o=r.layers[0].forward(u,a,f),i=3,function(t){if(Array.isArray(t))return t}(o)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,u,a=[],c=!0,f=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==e);c=!0);}catch(t){f=!0,o=t}finally{try{if(!c&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(f)throw o}}return a}}(o,i)||function(t,e){if(t){if("string"==typeof t)return at(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?at(t,e):void 0}}(o,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());s[0],s[1],s[2]},l=0;l<o;l+=1)s(l)}},{key:"backward",value:function(t){t.length,t[0].rows;for(var e=t[0].cols,r=(this.layers[0].x1.rows,e-1);r>=0;r-=1);}}])&&ct(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function yt(t){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yt(t)}function pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ht(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,vt(n.key),n)}}function bt(t,e,r){return(e=vt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function vt(t){var e=function(t,e){if("object"!==yt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==yt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===yt(e)?e:String(e)}var dt=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DNN";pt(this,t),bt(this,"dimensions",null),bt(this,"lastLayer",null),bt(this,"network",null),this.dimensions=e,"DNN"===r?this.network=new a(this.dimensions):"RNN"===r?this.network=new v(this.dimensions):"LSTM"===r&&(this.network=new lt(this.dimensions))}var e,r;return e=t,r=[{key:"createLayer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=new t;return"function"==typeof e&&e(r),null===this.lastLayer?this.firstLayerTransition(r):r.transition(this.lastLayer),r.configure(),r.setBackPropagation(it.create(this.lastLayer,r)),this.network.addLayer(r),this.lastLayer=r,this}},{key:"getNetwork",value:function(){return this.network}}],r&&ht(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function mt(t){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mt(t)}function wt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ot(n.key),n)}}function gt(t,e,r){return(e=Ot(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ot(t){var e=function(t,e){if("object"!==mt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==mt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===mt(e)?e:String(e)}var St=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),gt(this,"width",0),gt(this,"height",0),gt(this,"depth",0),gt(this,"previousLayer",null),gt(this,"backPropagation",null)}var e,r;return e=t,(r=[{key:"setBackPropagation",value:function(t){return this.backPropagation=t,this}},{key:"getBackPropagation",value:function(){return this.backPropagation}},{key:"setWidth",value:function(t){return this.width=t,this}},{key:"getWidth",value:function(){return this.width}},{key:"setHeight",value:function(t){return this.height=t,this}},{key:"getHeight",value:function(){return this.height}},{key:"setDepth",value:function(t){return this.depth=t,this}},{key:"getDepth",value:function(){return this.depth}},{key:"transition",value:function(t){return this.previousLayer=t,this}}])&&wt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function jt(t){return jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jt(t)}function Pt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Tt(n.key),n)}}function kt(){return kt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=xt(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},kt.apply(this,arguments)}function xt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Et(t)););return t}function Wt(t,e){return Wt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Wt(t,e)}function _t(t,e){if(e&&("object"===jt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Rt(t)}function Rt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Et(t){return Et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Et(t)}function Tt(t){var e=function(t,e){if("object"!==jt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==jt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===jt(e)?e:String(e)}var zt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Et(n);if(o){var r=Et(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return _t(this,t)});function u(){var t,e,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),e=Rt(t=i.call(this)),1,(r=Tt(r="depth"))in e?Object.defineProperty(e,r,{value:1,enumerable:!0,configurable:!0,writable:!0}):e[r]=1,t.W=new c.Matrix,t.b=new c.Matrix,t.A=new c.Matrix,t.Z=new c.Matrix,t.gW=new c.Matrix,t.gb=new c.Matrix,t.vW=new c.Matrix,t.vb=new c.Matrix,t.sW=new c.Matrix,t.sb=new c.Matrix,t.dW=new c.Matrix,t.db=new c.Matrix,t}return e=u,(r=[{key:"configure",value:function(){this.W.resize(this.getHeight(),this.getWidth()),this.W=this.W.setRandom(this.previousLayer?this.previousLayer.getHeight():this.getHeight()),this.b.resize(this.getHeight(),1),this.b=this.b.setRandom(this.previousLayer?this.previousLayer.getHeight():this.getHeight()),this.gW.resize(this.getHeight(),this.getWidth()),this.gW=this.gW.setZeros(),this.gb.resize(this.getHeight(),1),this.gb=this.gb.setZeros(),this.sW.resize(this.getHeight(),this.getWidth()),this.sW=this.sW.setZeros(),this.sb.resize(this.getHeight(),1),this.sb=this.sb.setZeros(),this.vW.resize(this.getHeight(),this.getWidth()),this.vW=this.vW.setZeros(),this.vb.resize(this.getHeight(),1),this.vb=this.vb.setZeros(),this.dW.resize(this.getHeight(),this.getWidth()),this.dW=this.dW.setZeros(),this.db.resize(this.getHeight(),1),this.db=this.db.setZeros()}},{key:"forward",value:function(t){return this.Z=this.W.dot(t).add(this.b.replicate(1,t.cols)),this.A=this.activation(this.Z),this.A}},{key:"is1D",value:function(){return!0}},{key:"is3D",value:function(){return!1}},{key:"transition",value:function(t){return t.is1D()?this.setWidth(t.getSize()):t.is3D()&&this.setWidth(t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth()),kt(Et(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){return this.setHeight(t),this}},{key:"getSize",value:function(){return this.height}},{key:"getOutputWidth",value:function(){return this.width}},{key:"getOutputHeight",value:function(){return this.height}},{key:"getOutputDepth",value:function(){return 1}},{key:"penalty",value:function(){return this.W.pow(2).sum()}}])&&Pt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(St);function Mt(t){return Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mt(t)}function Dt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ct(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Mt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Mt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Mt(o)?o:String(o)),n)}var o}function Bt(t,e){return Bt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Bt(t,e)}function Lt(t,e){if(e&&("object"===Mt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function At(t){return At=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},At(t)}var Zt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Bt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=At(n);if(o){var r=At(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Lt(this,t)});function u(){return Dt(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.softmax()}},{key:"getType",value:function(){return b.softmax}},{key:"derivative",value:function(t){return t.multiply(-1).add(1).fraction(1)}}])&&Ct(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(zt);function Nt(t){return Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nt(t)}function Ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ft(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Nt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Nt(o)?o:String(o)),n)}var o}function It(t,e){return It=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},It(t,e)}function qt(t,e){if(e&&("object"===Nt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Jt(t){return Jt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jt(t)}var Kt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&It(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Jt(n);if(o){var r=Jt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return qt(this,t)});function u(){return Ht(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.multiply(-1).exp().add(1).fraction(1)}},{key:"getType",value:function(){return b.logistic}},{key:"derivative",value:function(t){return t.multiply(this.activation(t).multiply(this.activation(t.minusOne())))}}])&&Ft(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(zt);function Ut(t){return Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ut(t)}function Xt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Yt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Ut(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ut(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ut(o)?o:String(o)),n)}var o}function $t(t,e){return $t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},$t(t,e)}function Vt(t,e){if(e&&("object"===Ut(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Gt(t){return Gt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Gt(t)}var Qt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$t(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Gt(n);if(o){var r=Gt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Vt(this,t)});function u(){return Xt(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.tanh()}},{key:"getType",value:function(){return b.tanh}},{key:"derivative",value:function(t){return this.activation(t).pow(2).minusOne()}}])&&Yt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(zt);function te(t){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},te(t)}function ee(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function re(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==te(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===te(o)?o:String(o)),n)}var o}function ne(t,e){return ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ne(t,e)}function oe(t,e){if(e&&("object"===te(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ie(t){return ie=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ie(t)}var ue=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ne(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ie(n);if(o){var r=ie(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return oe(this,t)});function u(){return ee(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.setMin(0)}},{key:"getType",value:function(){return b.relu}},{key:"derivative",value:function(t){return(0,c.getComputation)().execute("reluBackpropagation",t,this.A)}}])&&re(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(zt);function ae(t){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ae(t)}function ce(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==ae(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ae(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===ae(o)?o:String(o)),n)}var o}function se(t,e){return se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},se(t,e)}function le(t,e){if(e&&("object"===ae(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ye(t){return ye=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ye(t)}var pe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&se(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ye(n);if(o){var r=ye(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return le(this,t)});function u(){return ce(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.exp().add(1).log()}},{key:"getType",value:function(){return b.softplus}},{key:"derivative",value:function(t){return t.multiply(-1).exp().add(1).fraction(1)}}])&&fe(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(zt);function he(t){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},he(t)}function be(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==he(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==he(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===he(o)?o:String(o)),n)}var o}function ve(){return ve="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=de(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},ve.apply(this,arguments)}function de(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ge(t)););return t}function me(t,e){return me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},me(t,e)}function we(t,e){if(e&&("object"===he(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ge(t){return ge=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ge(t)}var Oe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&me(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ge(n);if(o){var r=ge(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return we(this,t)});function u(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this)).W=new c.Matrix,t.b=new c.Matrix,t.A=new c.Matrix,t.Z=new c.Matrix,t.gW=new c.Matrix,t.gb=new c.Matrix,t.vW=new c.Matrix,t.vb=new c.Matrix,t.sW=new c.Matrix,t.sb=new c.Matrix,t.dW=new c.Matrix,t.db=new c.Matrix,t}return e=u,(r=[{key:"configure",value:function(){}},{key:"is1D",value:function(){return!1}},{key:"is3D",value:function(){return!0}},{key:"transition",value:function(t){return t.is3D()&&this.setSize([t.getOutputWidth(),t.getOutputHeight(),t.getOutputDepth()]),ve(ge(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){return this.setWidth(t[0]),this.setHeight(t[1]),this.setDepth(t[2]),this}},{key:"getSize",value:function(){return[this.getWidth(),this.getHeight(),this.getDepth()]}},{key:"penalty",value:function(){return this.W.pow(2).sum()}}])&&be(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(St);function Se(t){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Se(t)}function je(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Pe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ee(n.key),n)}}function ke(t,e){return ke=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ke(t,e)}function xe(t,e){if(e&&("object"===Se(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return We(t)}function We(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _e(t){return _e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_e(t)}function Re(t,e,r){return(e=Ee(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ee(t){var e=function(t,e){if("object"!==Se(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Se(e)?e:String(e)}var Te=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ke(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=_e(n);if(o){var r=_e(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return xe(this,t)});function u(){var t;je(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Re(We(t=i.call.apply(i,[this].concat(r))),"numFilters",32),Re(We(t),"filterSize",4),Re(We(t),"padding",1),Re(We(t),"stride",1),t}return e=u,(r=[{key:"configure",value:function(){this.W.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.W=this.W.setRandom(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth()),this.b.resize(this.numFilters,1),this.b=this.b.setRandom(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth()),this.gW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.gW=this.gW.setZeros(),this.gb.resize(this.numFilters,1),this.gb=this.gb.setZeros(),this.sW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.sW=this.sW.setZeros(),this.sb.resize(this.numFilters,1),this.sb=this.sb.setZeros(),this.vW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.vW=this.vW.setZeros(),this.vb.resize(this.numFilters,1),this.vb=this.vb.setZeros()}},{key:"getOutputHeight",value:function(){return(this.width-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.height-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.numFilters}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setNumFilters",value:function(t){return this.numFilters=t,this}},{key:"getNumFilters",value:function(){return this.numFilters}},{key:"setPadding",value:function(t){return this.padding=t,this}},{key:"getPadding",value:function(){return this.padding}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"forward",value:function(t){for(var e=new c.Matrix(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols).setZeros(),r=0;r<t.cols;r+=1){var n=(0,c.im2col)(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.padding,this.padding,this.stride,this.stride),o=this.W.dot(n.transpose()).add(this.b.replicate(1,n.rows));e.setCol(r,o.rollToColMatrix())}return this.Z=e,this.A=this.activation(this.Z),this.A}},{key:"activation",value:function(t){return t.setMin(0)}},{key:"getType",value:function(){return b.conv}},{key:"derivative",value:function(t){return(0,c.getComputation)().execute("reluBackpropagation",t,this.A)}}])&&Pe(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Oe);function ze(t){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ze(t)}function Me(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function De(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==ze(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ze(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===ze(o)?o:String(o)),n)}var o}function Ce(t,e){return Ce=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ce(t,e)}function Be(t,e){if(e&&("object"===ze(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Le(t){return Le=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Le(t)}var Ae=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ce(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Le(n);if(o){var r=Le(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Be(this,t)});function u(){return Me(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"transition",value:function(t){if(!t.is3D())throw new Error("Invalid usage. Cannot fully connect with previous 1D Layer.");if(t.getType()!=b.maxpool)throw new Error("Invalid usage. Cannot fully connect with previous non maxpool Layer.");return this.filterSize=t.getOutputWidth(),this.padding=0,this.stride=1,this.width=t.getOutputWidth(),this.height=t.getOutputHeight(),this.depth=t.getOutputDepth(),this.numFilters=t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth(),this}},{key:"setSize",value:function(t){return this}},{key:"setFilterSize",value:function(t){return this}},{key:"setStride",value:function(t){return this}},{key:"setPadding",value:function(t){return this}},{key:"setWidth",value:function(t){return this}},{key:"setHeight",value:function(t){return this}},{key:"setDepth",value:function(t){return this}},{key:"setNumFilters",value:function(t){return this}}])&&De(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Te);function Ze(t){return Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ze(t)}function Ne(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function He(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ue(n.key),n)}}function Fe(t,e){return Fe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Fe(t,e)}function Ie(t,e){if(e&&("object"===Ze(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return qe(t)}function qe(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Je(t){return Je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Je(t)}function Ke(t,e,r){return(e=Ue(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ue(t){var e=function(t,e){if("object"!==Ze(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ze(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Ze(e)?e:String(e)}var Xe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fe(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Je(n);if(o){var r=Je(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ie(this,t)});function u(){var t;Ne(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Ke(qe(t=i.call.apply(i,[this].concat(r))),"filterSize",0),Ke(qe(t),"stride",0),t}return e=u,(r=[{key:"configure",value:function(){}},{key:"getOutputHeight",value:function(){return(this.height-this.filterSize)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.width-this.filterSize)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.depth}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"getPadding",value:function(){return 0}},{key:"forward",value:function(t){for(var e=new c.Matrix(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols),r=0;r<t.cols;r+=1){var n=(0,c.maxpool)(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.stride,this.stride);e.setCol(r,n.rollToColMatrix())}return this.Z=e,this.A=this.activation(this.Z),this.A}},{key:"activation",value:function(t){return t}},{key:"getType",value:function(){return b.maxpool}},{key:"derivative",value:function(t){return t}}])&&He(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Oe);function Ye(t){return Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ye(t)}function $e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ve(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,nr(n.key),n)}}function Ge(t,e){return Ge=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ge(t,e)}function Qe(t,e){if(e&&("object"===Ye(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tr(t)}function tr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function er(t){return er=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},er(t)}function rr(t,e,r){return(e=nr(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function nr(t){var e=function(t,e){if("object"!==Ye(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ye(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Ye(e)?e:String(e)}var or=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ge(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=er(n);if(o){var r=er(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Qe(this,t)});function u(){var t;$e(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return rr(tr(t=i.call.apply(i,[this].concat(r))),"Wax",null),rr(tr(t),"Waa",null),rr(tr(t),"Wya",null),rr(tr(t),"b",null),rr(tr(t),"by",null),rr(tr(t),"dWax",null),rr(tr(t),"dWaa",null),rr(tr(t),"dWya",null),rr(tr(t),"db",null),rr(tr(t),"dby",null),rr(tr(t),"Y",[]),rr(tr(t),"A",[]),rr(tr(t),"X",[]),rr(tr(t),"aNext",null),rr(tr(t),"aPrev",null),rr(tr(t),"daNext",null),t}return e=u,(r=[{key:"configure",value:function(){this.Wax=new c.Matrix(this.getWidth(),this.getHeight()),this.Wax=this.Wax.setRandom(this.getWidth()),this.Waa=new c.Matrix(this.getWidth(),this.getWidth()),this.Waa=this.Waa.setRandom(this.getWidth()),this.Wya=new c.Matrix(this.getDepth(),this.getWidth()),this.Wya=this.Wya.setRandom(this.getDepth()),this.b=new c.Matrix(this.getWidth(),1),this.b=this.b.setRandom(this.getWidth()),this.by=new c.Matrix(this.getDepth(),1),this.by=this.by.setRandom(this.getDepth()),this.dWax=new c.Matrix(this.getWidth(),this.getHeight()),this.dWax=this.dWax.setZeros(),this.dWaa=new c.Matrix(this.getWidth(),this.getWidth()),this.dWaa=this.dWaa.setZeros(),this.dWya=new c.Matrix(this.getDepth(),this.getWidth()),this.dWya=this.dWya.setZeros(),this.db=new c.Matrix(this.getWidth(),1),this.db=this.db.setZeros(),this.dby=new c.Matrix(this.getDepth(),1),this.dby=this.dby.setZeros(),this.daNext=new c.Matrix(this.getWidth(),this.getWidth()),this.daNext=this.daNext.setZeros()}},{key:"forward",value:function(t,e){var r=this.Wax.dot(t).add(this.Waa.dot(e).replicate(1,this.getWidth())).add(this.b.replicate(1,t.cols)).tanh(),n=this.Wya.dot(r).add(this.by.replicate(1,t.cols)).softmax();return this.A.push(r),this.X.push(t),this.Y.push(n),this.aPrev=e,[r,n]}},{key:"backward",value:function(t,e,r,n){var o=r.pow(2).minusOne().multiply(t),i=o.dot(e.transpose()),u=o.dot(n.transpose()),a=this.db.add(o.colwiseSum().divide(o.cols)).setMin(-5).setMax(5),c=this.dby;return{dWax:i,dWya:this.dWya.add(o.dot(n.transpose())).setMin(-5).setMax(5),dWaa:u,db:a,dby:c,daNext:o.dot(this.Waa.tranpose())}}},{key:"activation",value:function(t){return t}},{key:"getType",value:function(){return b.rnnlayer}},{key:"derivative",value:function(t){return t}},{key:"is1D",value:function(){return!0}},{key:"is3D",value:function(){return!1}},{key:"setSize",value:function(t){return this.setWidth(t[0]),this.setHeight(t[1]),this.setDepth(t[2]),this}},{key:"getSize",value:function(){return this.height}},{key:"getOutputWidth",value:function(){return this.width}},{key:"getOutputHeight",value:function(){return this.height}},{key:"getOutputDepth",value:function(){return this.depth}},{key:"penalty",value:function(){return 0}},{key:"getWidth",value:function(){return this.width}}])&&Ve(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(St);function ir(t){return ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ir(t)}function ur(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ar(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,pr(n.key),n)}}function cr(t,e){return cr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},cr(t,e)}function fr(t,e){if(e&&("object"===ir(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return sr(t)}function sr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function lr(t){return lr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},lr(t)}function yr(t,e,r){return(e=pr(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function pr(t){var e=function(t,e){if("object"!==ir(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ir(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===ir(e)?e:String(e)}var hr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=lr(n);if(o){var r=lr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return fr(this,t)});function u(){var t;ur(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return yr(sr(t=i.call.apply(i,[this].concat(r))),"Wf",null),yr(sr(t),"bf",null),yr(sr(t),"Wi",null),yr(sr(t),"bi",null),yr(sr(t),"Wc",null),yr(sr(t),"bc",null),yr(sr(t),"Wo",null),yr(sr(t),"bo",null),yr(sr(t),"Wy",null),yr(sr(t),"by",null),yr(sr(t),"dxt",null),yr(sr(t),"dWf",null),yr(sr(t),"dWi",null),yr(sr(t),"dWc",null),yr(sr(t),"dWo",null),yr(sr(t),"dbf",null),yr(sr(t),"dbi",null),yr(sr(t),"dbc",null),yr(sr(t),"dbo",null),t}return e=u,(r=[{key:"configure",value:function(){}},{key:"forward",value:function(t,e,r){var n=t.rows,o=t.cols,i=(this.Wy.rows,this.Wy.cols),u=new c.Matrix(n+i,o).concat(t).concat(this.Wy),a=this.Wf.dot(u).add(this.bf).sigmoid(),f=this.Wi.dot(u).add(this.bi).sigmoid(),s=this.Wc.dot(u).add(this.bc).tanh(),l=a.multiply(r).add(f.multiply(s)),y=this.Wo.dot(u).add(this.bo).sigmoid().multiply(l.tanh());return this.Wy.dot(y).add(this.by).softmax(),[y,r]}},{key:"backward",value:function(t,e){}},{key:"activation",value:function(t){return t}},{key:"getType",value:function(){return b.rnnlayer}},{key:"derivative",value:function(t){return t}},{key:"is1D",value:function(){return!0}},{key:"is3D",value:function(){return!1}},{key:"setSize",value:function(t){return this.setWidth(t[0]),this.setHeight(t[1]),this.setDepth(t[2]),this}},{key:"getSize",value:function(){return this.height}},{key:"getOutputWidth",value:function(){return this.width}},{key:"getOutputHeight",value:function(){return this.height}},{key:"getOutputDepth",value:function(){return this.depth}},{key:"penalty",value:function(){return 0}}])&&ar(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(St);function br(t){return br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},br(t)}function vr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==br(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==br(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===br(o)?o:String(o)),n)}var o}function mr(t,e){return mr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},mr(t,e)}function wr(t,e){if(e&&("object"===br(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function gr(t){return gr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gr(t)}var Or=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mr(t,e)}(f,e);var r,n,o,i,u,a=(i=f,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=gr(i);if(u){var r=gr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return wr(this,t)});function f(){return vr(this,f),a.apply(this,arguments)}return r=f,o=[{key:"fromJSON",value:function(e){return new Promise((function(r,n){t.readFile(e,(function(t,e){if(t)n(t);else{var o=JSON.parse(e.toString()),i=new f(o.dimensions);o.layers.forEach((function(t){var e=null;"logistic"===t.type?e=Kt:"softmax"===t.type?e=Zt:"relu"===t.type?e=ue:"softplus"===t.type?e=pe:"tanh"===t.type&&(e=Qt),i.createLayer(e,(function(e){e.setSize(t.size)}))}));var u=i.getNetwork();u.getLayers().forEach((function(t,e){t.W=new c.Matrix(o.layers[e].weights.W.length,o.layers[e].weights.W[0].length,o.layers[e].weights.W),t.b=new c.Matrix(o.layers[e].weights.b.length,o.layers[e].weights.b[0].length,o.layers[e].weights.b)})),r(u)}}))}))}}],(n=[{key:"firstLayerTransition",value:function(t){t.setWidth(this.dimensions[0])}}])&&dr(r.prototype,n),o&&dr(r,o),Object.defineProperty(r,"prototype",{writable:!1}),f}(dt);function Sr(t){return Sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sr(t)}function jr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Pr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Sr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Sr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Sr(o)?o:String(o)),n)}var o}function kr(t,e){return kr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},kr(t,e)}function xr(t,e){if(e&&("object"===Sr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Wr(t){return Wr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Wr(t)}var _r=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&kr(t,e)}(c,e);var r,n,o,i,u,a=(i=c,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Wr(i);if(u){var r=Wr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return xr(this,t)});function c(){return jr(this,c),a.apply(this,arguments)}return r=c,o=[{key:"fromJSON",value:function(e){return new Promise((function(r,n){t.readFile(e,(function(t,e){if(t)n(t);else{var o=JSON.parse(e.toString()),i=new c(o.size);o.layers.forEach((function(t){"logistic"===t.type?i.createLayer(Kt,(function(e){e.setSize(t.size)})):"softmax"===t.type?i.createLayer(Zt,(function(e){e.setSize(t.size)})):"relu"===t.type?i.createLayer(ue,(function(e){e.setSize(t.size)})):"softplus"===t.type?i.createLayer(pe,(function(e){e.setSize(t.size)})):"tanh"===t.type?i.createLayer(Qt,(function(e){e.setSize(t.size)})):"conv"===t.type?i.createLayer(Te,(function(e){e.setSize(t.size),e.setFilterSize(t.filterSize),e.setStride(t.stride),e.setNumFilters(t.numFilters),e.setPadding(t.padding)})):"maxpool"===t.type?i.createLayer(Xe,(function(e){e.setSize(t.size),e.setFilterSize(t.filterSize),e.setStride(t.stride)})):"fullyconnected"===t.type&&i.createLayer(Xe)}));var u=i.getNetwork();u&&(u.getLayers().forEach((function(t,e){t.W=o.layers.W,t.b=o.layers.b})),r(u))}}))}))}}],(n=[{key:"firstLayerTransition",value:function(t){this.dimensions&&t.setSize(this.dimensions)}}])&&Pr(r.prototype,n),o&&Pr(r,o),Object.defineProperty(r,"prototype",{writable:!1}),c}(dt);function Rr(t){return Rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rr(t)}function Er(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,zr(n.key),n)}}function Tr(t,e,r){return(e=zr(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function zr(t){var e=function(t,e){if("object"!==Rr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Rr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Rr(e)?e:String(e)}var Mr=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Tr(this,"batchSize",0),Tr(this,"t",0),Tr(this,"learningRate",0)}var e,r;return e=t,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"setT",value:function(t){return this.t=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}}])&&Er(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Dr(t){return Dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dr(t)}function Cr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Br(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Fr(n.key),n)}}function Lr(t,e){return Lr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Lr(t,e)}function Ar(t,e){if(e&&("object"===Dr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Zr(t)}function Zr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Nr(t){return Nr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Nr(t)}function Hr(t,e,r){return(e=Fr(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Fr(t){var e=function(t,e){if("object"!==Dr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Dr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Dr(e)?e:String(e)}var Ir=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Nr(n);if(o){var r=Nr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ar(this,t)});function u(){var t;Cr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Hr(Zr(t=i.call.apply(i,[this].concat(r))),"beta1",.9),Hr(Zr(t),"beta2",.999),t}return e=u,(r=[{key:"setBeta1",value:function(t){return this.beta1=t,this}},{key:"setBeta2",value:function(t){return this.beta2=t,this}},{key:"optimize",value:function(t){this.adam(t,this.learningRate,this.t)}},{key:"adam",value:function(t,e,r){t.vW=t.vW.multiply(this.beta1).add(t.gW.multiply(1-this.beta1)),t.vb=t.vb.multiply(this.beta1).add(t.gb.multiply(1-this.beta1)),t.sW=t.sW.multiply(this.beta2).add(t.sW.pow(2).multiply(1-this.beta2)),t.sb=t.sb.multiply(this.beta2).add(t.sb.pow(2).multiply(1-this.beta2));var n=t.vW.divide(1-Math.pow(this.beta1,2)),o=t.vb.divide(1-Math.pow(this.beta1,2)),i=t.sW.add(1e-8).sqrt(),u=t.sb.add(1e-8).sqrt();t.W=t.W.subtract(n.divide(i).multiply(e)),t.b=t.b.subtract(o.divide(u).multiply(e))}}])&&Br(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Mr);function qr(t){return qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qr(t)}function Jr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Kr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==qr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==qr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===qr(o)?o:String(o)),n)}var o}function Ur(t,e){return Ur=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ur(t,e)}function Xr(t,e){if(e&&("object"===qr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Yr(t){return Yr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Yr(t)}var $r=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ur(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Yr(n);if(o){var r=Yr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Xr(this,t)});function u(){return Jr(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.gradientDescent(t,this.learningRate)}},{key:"gradientDescent",value:function(t,e){t.W=t.W.subtract(t.gW.multiply(e)),t.b=t.b.subtract(t.b.multiply(e))}}])&&Kr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Mr);function Vr(t){return Vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vr(t)}function Gr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Vr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Vr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Vr(o)?o:String(o)),n)}var o}function tn(t,e){return tn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tn(t,e)}function en(t,e){if(e&&("object"===Vr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function rn(t){return rn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},rn(t)}var nn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=rn(n);if(o){var r=rn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return en(this,t)});function u(){return Gr(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.adagrad(t,this.learningRate)}},{key:"adagrad",value:function(t,e){t.dW=t.dW.add(t.gW.pow(2)),t.W=t.W.subtract(t.gW.multiply(e).divide(t.dW.sqrt().add(1e-8)).multiply(t.gW)),t.db=t.db.add(t.gb.pow(2)),t.b=t.b.subtract(t.db.multiply(e).divide(t.db.sqrt().add(1e-8)).multiply(t.gb))}}])&&Qr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Mr);function on(t){return on="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},on(t)}function un(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function an(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,pn(n.key),n)}}function cn(t,e){return cn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},cn(t,e)}function fn(t,e){if(e&&("object"===on(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return sn(t)}function sn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ln(t){return ln=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ln(t)}function yn(t,e,r){return(e=pn(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function pn(t){var e=function(t,e){if("object"!==on(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==on(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===on(e)?e:String(e)}var hn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ln(n);if(o){var r=ln(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return fn(this,t)});function u(){var t;un(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return yn(sn(t=i.call.apply(i,[this].concat(r))),"beta",.9),t}return e=u,(r=[{key:"optimize",value:function(t){this.momentum(t,this.learningRate)}},{key:"setBeta",value:function(t){return this.beta=t,this}},{key:"momentum",value:function(t,e){t.vW=t.gW.multiply(this.beta).add(t.gW.multiply(1-this.beta)),t.vb=t.gb.multiply(this.beta).add(t.gb.multiply(1-this.beta)),t.W=t.W.subtract(t.vW.multiply(e)),t.b=t.b.subtract(t.vb.multiply(e))}}])&&an(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Mr);function bn(t){return bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bn(t)}function vn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,jn(n.key),n)}}function mn(t,e){return mn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},mn(t,e)}function wn(t,e){if(e&&("object"===bn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return gn(t)}function gn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function On(t){return On=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},On(t)}function Sn(t,e,r){return(e=jn(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function jn(t){var e=function(t,e){if("object"!==bn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==bn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===bn(e)?e:String(e)}var Pn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=On(n);if(o){var r=On(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return wn(this,t)});function u(){var t;vn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Sn(gn(t=i.call.apply(i,[this].concat(r))),"alpha",.001),Sn(gn(t),"beta",.9),t}return e=u,(r=[{key:"setBeta",value:function(t){return this.beta=t,this}},{key:"setAlpha",value:function(t){return this.alpha=t,this}},{key:"optimize",value:function(t){this.rmsprop(t,this.learningRate,this.alpha,this.beta)}},{key:"rmsprop",value:function(t,e,r,n){t.sW=t.sW.multiply(n).add(t.gW.pow(2).multiply(1-n)),t.sb=t.sb.multiply(n).add(t.gb.pow(2).multiply(1-n)),t.W=t.W.subtract(t.gW.multiply(r).divide(t.sW.sqrt().add(1e-8))),t.b=t.b.subtract(t.gb.multiply(r).divide(t.sb.sqrt().add(1e-8)))}}])&&dn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Mr);function kn(t){return kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kn(t)}function xn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_n(n.key),n)}}function Wn(t,e,r){return(e=_n(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _n(t){var e=function(t,e){if("object"!==kn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==kn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===kn(e)?e:String(e)}var Rn=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Wn(this,"network",null),Wn(this,"optimizer",null),Wn(this,"regularization",1e-4),Wn(this,"iterations",1e3),Wn(this,"learningRate",.001),Wn(this,"verbose",!0),Wn(this,"verboseStep",1),Wn(this,"stepCallback",(function(t){})),this.network=e,this.optimizer=r}var e,r;return e=t,(r=[{key:"setRegularization",value:function(t){return this.regularization=t,this}},{key:"setIterations",value:function(t){return this.iterations=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}},{key:"setVerbose",value:function(t){return this.verbose=t,this}},{key:"setVerboseStep",value:function(t){return this.verboseStep=t,this}},{key:"setStepCallback",value:function(t){return this.stepCallback=t,this}},{key:"cost",value:function(t,e){var r=t.getNumberOfExamples(),n=0,o=0;this.network.getLayers().forEach((function(t){o+=t.penalty()}));for(var i=this.network.forward(t.data),u=e.data,a=-1/r*u.multiply(i.log()).sum()+this.regularization/(o*(2*t.data.cols)),c=0;c<i.cols;c+=1)i.colMaxCoeffIndex(c)===u.colMaxCoeffIndex(c)&&n++;return{cost:a,accuracy:n/r*100}}}])&&xn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function En(t){return En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},En(t)}function Tn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function zn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,An(n.key),n)}}function Mn(t,e){return Mn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Mn(t,e)}function Dn(t,e){if(e&&("object"===En(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Cn(t)}function Cn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Bn(t){return Bn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Bn(t)}function Ln(t,e,r){return(e=An(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function An(t){var e=function(t,e){if("object"!==En(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==En(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===En(e)?e:String(e)}var Zn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Mn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Bn(n);if(o){var r=Bn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Dn(this,t)});function u(){var t;Tn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Ln(Cn(t=i.call.apply(i,[this].concat(r))),"batchSize",100),t}return e=u,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"cost",value:function(t,e){var r=this.batchSize,n=t.getNumberOfExamples(),o=(Math.ceil(n/r),0),i=0,u=0;this.network.getLayers().forEach((function(t){u=t.penalty()})),(new Date).getTime(),(new Date).getTime();for(var a=0,c=0;a<n;a+=this.batchSize,c+=this.batchSize){(new Date).getTime();var f=t.getBatch(c,this.batchSize),s=e.getBatch(c,this.batchSize),l=this.network.forward(f.data);o+=-1/n*s.data.multiply(l.log()).sum()+this.regularization/(u*(2*t.data.cols));for(var y=0;y<l.cols;y+=1)l.colMaxCoeffIndex(y)===s.data.colMaxCoeffIndex(y)&&i++}return{cost:o,accuracy:i/n*100}}},{key:"train",value:function(t,e){var r=this,n=t.getNumberOfExamples(),o=0;this.optimizer.setBatchSize(this.batchSize),this.optimizer.setLearningRate(this.learningRate);for(var i=0;i<this.iterations;i+=1){for(var u=(new Date).getTime(),a=(new Date).getTime(),f=0,s=0;f<n;f+=this.batchSize,s+=this.batchSize){var l=(new Date).getTime(),y=t.getBatch(s,this.batchSize),p=e.getBatch(s,this.batchSize);if(this.network.forward(y.data),this.network.backward(y.data,p.data,this.regularization),this.optimizer.setT(++o),this.network.getLayers().forEach((function(t){r.optimizer.optimize(t)})),this.verbose){var h=this.cost(y,p),b=(new Date).getTime();console.log("Batch: ".concat(s," / ").concat(n," | Batch time: ").concat(b-l,"ms | Time from start: ").concat((0,c.round)((b-a)/1e3,1),"s. | Cost: ").concat((0,c.round)(h.cost,2)," | Acc: ").concat(h.accuracy))}}if(this.verbose&&(i+1)%this.verboseStep==0){var v=(new Date).getTime(),d=this.cost(t,e);console.log("Iteration: ".concat(i+1," | Cost: ").concat((0,c.round)(d.cost,5)," | Accuracy: ").concat(d.accuracy,"% | Time: ").concat((v-u)/1e3," s."))}this.stepCallback({iteration:i})}return this}}])&&zn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Rn);function Nn(t){return Nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nn(t)}function Hn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Fn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Nn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Nn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Nn(o)?o:String(o)),n)}var o}function In(t,e){return In=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},In(t,e)}function qn(t,e){if(e&&("object"===Nn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Jn(t){return Jn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jn(t)}var Kn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&In(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Jn(n);if(o){var r=Jn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return qn(this,t)});function u(){return Hn(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"train",value:function(t,e){var r=this,n=t.getNumberOfExamples(),o=0;this.optimizer.setBatchSize(n),this.optimizer.setLearningRate(this.learningRate);for(var i=0;i<this.iterations;i+=1){var u=(new Date).getTime();if(this.network.backward(t.data,e.data,this.regularization),this.optimizer.setT(++o),this.network.getLayers().forEach((function(t){r.optimizer.optimize(t)})),this.verbose&&(i+1)%this.verboseStep==0){var a=this.cost(t,e),f=(new Date).getTime();console.log("Iteration: ".concat(i+1," | Cost: ").concat((0,c.round)(a.cost,5)," | Accuracy: ").concat((0,c.round)(a.accuracy,2),"% | Time: ").concat((f-u)/1e3," s."))}this.stepCallback({iteration:i})}return this}}])&&Fn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Rn);function Un(t){return Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Un(t)}function Xn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,u,a=[],c=!0,f=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==e);c=!0);}catch(t){f=!0,o=t}finally{try{if(!c&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(f)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Yn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Yn(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function $n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Gn(n.key),n)}}function Vn(t,e,r){return(e=Gn(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Gn(t){var e=function(t,e){if("object"!==Un(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Un(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Un(e)?e:String(e)}var Qn=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Vn(this,"network",null),Vn(this,"iterations",1e3),Vn(this,"learningRate",.01),this.network=e}var e,r;return e=t,(r=[{key:"train",value:function(t){for(var e=this.network.loss(t.getVocabularySize(),7),r=Xn(t.buildData(100),2),n=r[0],o=r[1],i=Xn(t.vectorization(n,o),2),u=i[0],a=i[1],f=new c.Matrix(this.network.getDimensions()[0],this.network.getDimensions()[0]).setZeros(),s=0;s<this.iterations;s+=1){var l=s%u.length;e=Xn(this.network.forward(u[l],a,f),1)[0];var y=Xn(this.network.optimize(u[l],a,f,this.learningRate),2),p=y[0];f=y[1],e=.999*e+.001*p,console.log("Iteration ".concat(s+1," | Loss: ").concat(e," | Sample: ").concat(this.network.sample(t).trim()))}return[e]}},{key:"setIterations",value:function(t){return this.iterations=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}}])&&$n(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),to={NetworkBuilder1D:Or,NetworkBuilder3D:_r},eo={Matrix:c.Matrix},ro={SoftmaxLayer:Zt,LogisticLayer:Kt,ReluLayer:ue,SoftplusLayer:pe,TanhLayer:Qt,ConvLayer:Te,MaxPoolLayer:Xe,FullyConnectedLayer:Ae,RecurrentLayer:or,LSTMLayer:hr},no={OptimizerAdam:Ir,OptimizerGradientDescent:$r,OptimizerAdagrad:nn,OptimizerMomentum:hn,OptimizerRMSProp:Pn},oo={MiniBatchTrainer:Zn,Trainer:Kn,RNNTrainer:Qn},io={NetworkRNN:v}})(),module.exports=n})();
//# sourceMappingURL=impulse-ts.js.map