(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}t.r(e),t.d(e,{Builders:()=>Pr,Dataset:()=>Er,Layers:()=>Rr,Math:()=>_r,Optimizers:()=>xr,Trainers:()=>Tr});var i=new(require("gpu.js").GPU)({mode:"gpu"}),u=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r(this,t),o(this,"rows",0),o(this,"cols",0),o(this,"data",null),this.resize(e,n),i&&this.generateData(i)}var e,u;return e=t,(u=[{key:"resize",value:function(t,e){this.rows=t,this.cols=e,this.data=[];for(var r=0;r<this.rows;r+=1)this.data[r]=new Array(this.cols);return this}},{key:"generateData",value:function(t){this.data=[];for(var e=0;e<this.rows;e+=1)this.data[e]=new Array(this.cols);for(var r=0;r<this.cols;r+=1)for(var n=0;n<this.rows;n+=1)"number"==typeof t[r]?this.data[n][r]=t[r]:t[r]instanceof Float32Array?this.data[n][r]=t[r][n]:this.data[n][r]=0;return this}},{key:"toBuffer",value:function(){var t=new ArrayBuffer(this.rows*this.cols*64),e=new DataView(t,0,this.rows*this.cols*64);return this.data.forEach((function(t,r){e.setFloat64(r,t)})),t}},{key:"sum",value:function(){for(var t=0,e=0;e<this.rows;e+=1)for(var r=0;r<this.cols;r+=1)t+=this.data[e][r];return t}},{key:"colwiseSum",value:function(){for(var e=[],r=0;r<this.cols;r+=1){for(var n=0,o=0;o<this.rows;o+=1)n+=this.data[o][r];e[r]=[n]}return new t(1,this.cols,e)}},{key:"rowwiseSum",value:function(){for(var e=[],r=0;r<this.rows;r+=1){for(var n=0,o=0;o<this.rows;o+=1)n+=this.data[r][o];e[r]=[n]}return new t(this.rows,1,e)}},{key:"replicate",value:function(e,r){var n=this.data,o=[],i=null;if(1===e&&1===this.cols&&r>1){i=new t(this.rows,r);for(var u=0;u<this.rows;u+=1){o[u]=[];for(var c=0;c<r;c+=1)o[u][c]=n[u][0]}}else if(1===r&&1===this.rows&&e>1){i=new t(e,this.cols);for(var a=0;a<e;a+=1){o[a]=[];for(var s=0;s<this.cols;s+=1)o[a][s]=n[0][s]}}return i?(i.generateData(o),i):this}},{key:"transpose",value:function(){var e=i.createKernel((function(t){return t[this.thread.y][this.thread.x]})).setOutput([this.cols,this.rows]);return new t(this.cols,this.rows,e(this.data))}},{key:"conjugate",value:function(){return this}},{key:"colMaxCoeffIndex",value:function(t){for(var e=-1,r=-1/0,n=0;n<this.rows;n+=1)this.data[n][t]>r&&(r=this.data[n][t],e=n);return e}},{key:"block",value:function(e,r,n,o){for(var i=[],u=e,c=0;u<this.rows&&u<e+n;u+=1,c+=1){i[u]=new Array(o);for(var a=r,s=0;a<this.cols&&a<r+o;a+=1,s+=1)i[c][s]=this.data[u][a]}return new t(n,o,i)}},{key:"col",value:function(e){for(var r=[],n=0;n<this.rows;n+=1)r[n]=[this.data[n][e]];return new t(this.rows,1,r)}},{key:"setCol",value:function(t,e){for(var r=0;r<this.rows;r+=1)this.data[r][t]=e.data[r][0];return this}},{key:"rollToColMatrix",value:function(){for(var e=[],r=0,n=0;n<this.rows;n+=1){e[n]=[];for(var o=0;o<this.cols;o+=1)e[r++][0]=this.data[n][o]}return new t(this.rows*this.cols,1,e)}}])&&n(e.prototype,u),t}(),c=function(t,e){if(t.cols!==e.rows)throw new Error("DIMENSIONS error. m1.cols ".concat(t.cols," !== m2.rows ").concat(e.rows,"."));var r=i.createKernel((function(t,e){for(var r=0,n=0;n<this.constants.cols;n++)r+=t[this.thread.x][n]*e[n][this.thread.y];return r})).setOutput([t.rows,e.cols]).setConstants({cols:t.rows});return new u(t.rows,e.cols,r(t.data,e.data))},a=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=i.createKernel((function(t,e){return t[this.thread.x][this.thread.y]+e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new u(t.rows,e.cols,r(t.data,e.data))},s=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=i.createKernel((function(t,e){return t[this.thread.x][this.thread.y]-e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new u(t.rows,e.cols,r(t.data,e.data))},f=function(t,e){var r=i.createKernel((function(){return(Math.random()-.5)*Math.sqrt(2/this.constants.parameter)})).setOutput([t.rows,t.cols]).setConstants({parameter:e});return new u(t.rows,t.cols,r())},l=function(t){var e=i.createKernel((function(){return 0})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e())},h=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=i.createKernel((function(t,e){return t[this.thread.x][this.thread.y]*e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new u(t.rows,e.cols,r(t.data,e.data))},y=function(t,e){var r=i.createKernel((function(t){return t[this.thread.x][this.thread.y]*this.constants.number})).setOutput([t.rows,t.cols]).setConstants({number:e});return new u(t.rows,t.cols,r(t.data))},p=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=i.createKernel((function(t,e){return t[this.thread.x][this.thread.y]/e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new u(t.rows,e.cols,r(t.data,e.data))},b=function(t,e){var r=i.createKernel((function(t){return t[this.thread.x][this.thread.y]/this.constants.number})).setOutput([t.rows,t.cols]).setConstants({number:e});return new u(t.rows,t.cols,r(t.data))},v=function(t){var e=i.createKernel((function(t){return Math.max(0,t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))},d=function(t){var e=i.createKernel((function(t){return t[this.thread.x][this.thread.y]>0?1:0})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))},w=function(t){var e=i.createKernel((function(t){return Math.sqrt(t[this.thread.x][this.thread.y]+1e-8)})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))},m=function(t,e,r,n,o,i,c,a,s,f){for(var h=0,y=l(new u(i*o*e,((n-i+2*a)/f+1)*((r-o+2*c)/s+1))),p=-c;p+o<=r+c;p+=s)for(var b=-a;b+i<=n+a;b+=f){for(var v=0,d=0;d<e;d++)for(var w=r*n*d,m=0;m<o;m++)for(var g=0;g<i;g++)p+m>=0&&b+g>=0&&b+g<n&&p+m<r&&(y.data[v][h]=t.data[(m+p)*n+b+g+w][0]),v++;h++}return y},g=function(t,e,r,n,o,i,c,a){for(var s=(n-i)/a+1,f=(r-o)/c+1,h=0,y=l(new u(s*f*e,1)),p=0;p+o<=r;p+=c)for(var b=0;b+i<=n;b+=a){for(var v=0;v<e;v++){for(var d=-1/0,w=r*n*v,m=s*f*v,g=0;g<o;g++)for(var O=0;O<i;O++)d=Math.max(d,t.data[w+(g+p)*n+b+O][0]);y.data[m+h][0]=d}h++}return new u};const O=require("fs");function S(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function k(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const j=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),k(this,"dimensions",null),k(this,"size",0),k(this,"layers",[]),this.dimensions=e}var e,r;return e=t,(r=[{key:"addLayer",value:function(t){this.size++,this.layers.push(t)}},{key:"getLayers",value:function(){return this.layers}},{key:"forward",value:function(t){var e=t;return this.layers.forEach((function(t){e=t.forward(e)})),e}},{key:"backward",value:function(t,e,r,n){var o=function(t){return t.cols}(t),i=s(r,e);this.layers.reverse().forEach((function(e){i=e.getBackPropagation().propagate(t,o,n,i)}))}},{key:"loss",value:function(t,e){return this.layers[this.layers.length-1].loss(t,e)}},{key:"error",value:function(t){return this.layers[this.layers.length-1].error(t)}},{key:"save",value:function(t){var e={dimensions:this.dimensions,layers:[]};this.layers.forEach((function(t){e.layers.push({type:t.getType(),dimensions:[t.getOutputHeight(),t.getOutputWidth(),t.getOutputDepth()],weights:{W:t.W.data,b:t.b.data}})}));var r=JSON.stringify(e);return new Promise((function(e,n){O.writeFile(t,r,(function(t){t&&(console.error(t),n()),e(r)}))}))}}])&&S(e.prototype,r),t}();var P;function _(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}!function(t){t.logistic="logistic",t.softmax="softmax",t.tanh="tanh",t.relu="relu",t.softplus="softplus",t.conv="conv",t.maxpool="maxpool",t.fullyconnected="fullyconnected"}(P||(P={}));var R=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),_(this,"layer",null),_(this,"previousLayer",null),this.layer=e,this.previousLayer=r};function E(t){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function z(t,e){return(z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function W(t,e){if(e&&("object"===E(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function B(t){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var D=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&z(t,e)}(s,t);var e,r,n,o,i=(n=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=B(n);if(o){var r=B(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return W(this,t)});function s(){return x(this,s),i.apply(this,arguments)}return e=s,(r=[{key:"propagate",value:function(t,e,r,n){var o=null!==this.previousLayer?this.previousLayer.A:t,i=c(n,o.transpose().conjugate());return this.layer.gW=a(b(i,e),y(this.layer.W,r/e)),this.layer.gb=b(n.rowwiseSum(),e),null!==this.previousLayer?h(c(this.layer.W.transpose(),n),this.previousLayer.derivative(this.previousLayer.A)):new u}}])&&T(e.prototype,r),s}(R);function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function M(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function F(t,e){return(F=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function K(t,e){if(e&&("object"===C(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function A(t){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var N=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&F(t,e)}(c,t);var e,r,n,o,i=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=A(n);if(o){var r=A(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return K(this,t)});function c(){return L(this,c),i.apply(this,arguments)}return e=c,(r=[{key:"propagate",value:function(t,e,r,n){return new u}}])&&M(e.prototype,r),c}(R);function H(t){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function U(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function q(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function I(t,e){return(I=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Z(t,e){if(e&&("object"===H(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function J(t){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var V=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&I(t,e)}(c,t);var e,r,n,o,i=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=J(n);if(o){var r=J(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Z(this,t)});function c(){return U(this,c),i.apply(this,arguments)}return e=c,(r=[{key:"propagate",value:function(t,e,r,n){return new u}}])&&q(e.prototype,r),c}(R);function G(t){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function X(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Q(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Y(t,e){return(Y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function $(t,e){if(e&&("object"===G(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function tt(t){return(tt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var et=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Y(t,e)}(c,t);var e,r,n,o,i=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=tt(n);if(o){var r=tt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return $(this,t)});function c(){return X(this,c),i.apply(this,arguments)}return e=c,(r=[{key:"propagate",value:function(t,e,r,n){return new u}}])&&Q(e.prototype,r),c}(R);function rt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var nt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"create",value:function(t,e){if(null==t){if(e.is1D())return new D(e,t);if(e.getType()==P.conv)return new N(e,t)}else{if(t.getType()==P.maxpool)return new V(e,t);if(t.getType()==P.conv)return new et(e,t);if(t.is1D()||t.getType()==P.fullyconnected)return new D(e,t)}return null}}],null&&rt(e.prototype,null),r&&rt(e,r),t}();function ot(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function it(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ut=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),it(this,"dimensions",null),it(this,"lastLayer",null),it(this,"network",null),this.dimensions=e,this.network=new j(e)}var e,r;return e=t,(r=[{key:"createLayer",value:function(t,e){var r=new t;"function"==typeof e&&e(r),null===this.lastLayer?this.firstLayerTransition(r):r.transition(this.lastLayer),r.configure(),r.setBackPropagation(nt.create(this.lastLayer,r)),this.network.addLayer(r),this.lastLayer=r}},{key:"getNetwork",value:function(){return this.network}}])&&ot(e.prototype,r),t}();function ct(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function at(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var st=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),at(this,"width",0),at(this,"height",0),at(this,"depth",0),at(this,"previousLayer",null),at(this,"backPropagation",null),this.W=new u,this.b=new u,this.A=new u,this.Z=new u,this.gW=new u,this.gb=new u,this.vW=new u,this.cW=new u,this.vB=new u,this.cB=new u}var e,r;return e=t,(r=[{key:"setBackPropagation",value:function(t){return this.backPropagation=t,this}},{key:"getBackPropagation",value:function(){return this.backPropagation}},{key:"forward",value:function(t){return this.Z=a(c(this.W,t),this.b.replicate(1,t.cols)),this.A=this.activation(this.Z),this.A}},{key:"setWidth",value:function(t){this.width=t}},{key:"getWidth",value:function(){return this.width}},{key:"setHeight",value:function(t){this.height=t}},{key:"getHeight",value:function(){return this.height}},{key:"setDepth",value:function(t){this.depth=t}},{key:"getDepth",value:function(){return this.depth}},{key:"transition",value:function(t){return this.previousLayer=t,this}},{key:"penalty",value:function(){return t=this.W,e=i.createKernel((function(t){return Math.pow(t[this.thread.x][this.thread.y],2)})).setOutput([t.rows,t.cols]),new u(t.rows,t.cols,e(t.data)).sum();var t,e}}])&&ct(e.prototype,r),t}();function ft(t){return(ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ht(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function yt(t,e,r){return(yt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=dt(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function pt(t,e){return(pt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function bt(t,e){if(e&&("object"===ft(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return vt(t)}function vt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dt(t){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function wt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var mt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=dt(n);if(o){var r=dt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return bt(this,t)});function u(){var t;lt(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return wt(vt(t=i.call.apply(i,[this].concat(r))),"depth",1),t}return e=u,(r=[{key:"configure",value:function(){this.W.resize(this.height,this.width),this.W=f(this.W,this.width),this.b.resize(this.height,1),this.b=f(this.b,this.width),this.gW.resize(this.height,this.width),this.gW=l(this.gW),this.gb.resize(this.height,1),this.gb=l(this.gb),this.cW.resize(this.height,this.width),this.cW=l(this.cW),this.cB.resize(this.height,1),this.cB=l(this.cB),this.vW.resize(this.height,this.width),this.vW=l(this.vW),this.vB.resize(this.height,1),this.vB=l(this.cB)}},{key:"is1D",value:function(){return!0}},{key:"is3D",value:function(){return!1}},{key:"transition",value:function(t){return t.is1D()?this.setWidth(t.getSize()):t.is3D()&&this.setWidth(t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth()),yt(dt(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){this.setHeight(t[0])}},{key:"getSize",value:function(){return this.height}},{key:"getOutputWidth",value:function(){return this.width}},{key:"getOutputHeight",value:function(){return this.height}},{key:"getOutputDepth",value:function(){return 1}}])&&ht(e.prototype,r),u}(st);function gt(t){return(gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function St(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function kt(t,e){return(kt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function jt(t,e){if(e&&("object"===gt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Pt(t){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _t=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&kt(t,e)}(a,t);var e,r,n,o,c=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Pt(n);if(o){var r=Pt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return jt(this,t)});function a(){return Ot(this,a),c.apply(this,arguments)}return e=a,(r=[{key:"activation",value:function(t){return function(t){var e=i.createKernel((function(t){return Math.exp(t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]),r=new u(t.rows,t.cols,e(t.data)),n=new u(1,t.cols,r.colwiseSum().data).replicate(t.rows,1);return new u(t.rows,t.cols,p(r,n).data)}(t)}},{key:"derivative",value:function(t){throw new Error("Unsupported usage.")}},{key:"getType",value:function(){return P.softmax}},{key:"loss",value:function(t,e){return function(t,e){var r=i.createKernel((function(t){return Math.log(t[this.thread.x][this.thread.y])})).setOutput([e.rows,e.cols]);return new u(t.rows,t.cols,h(t,new u(t.rows,t.cols,r(e.data))).data).sum()}(t,e)}},{key:"error",value:function(t){return-1/t}}])&&St(e.prototype,r),a}(mt);function Rt(t){return(Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Et(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Tt(t,e){return(Tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function zt(t,e){if(e&&("object"===Rt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Wt(t){return(Wt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Bt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Tt(t,e)}(s,t);var e,r,n,o,c=(n=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Wt(n);if(o){var r=Wt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return zt(this,t)});function s(){return Et(this,s),c.apply(this,arguments)}return e=s,(r=[{key:"activation",value:function(t){return function(t){var e=i.createKernel((function(t){return 1/(1+Math.exp(-t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))}(t)}},{key:"derivative",value:function(t){return function(t){var e=i.createKernel((function(t){return t[this.thread.x][this.thread.y]*(1-t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))}(t)}},{key:"getType",value:function(){return P.logistic}},{key:"loss",value:function(t,e){return function(t,e){var r=i.createKernel((function(t){return Math.log(t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]),n=i.createKernel((function(t){return 1-t[this.thread.x][this.thread.y]})).setOutput([t.rows,t.cols]),o=i.createKernel((function(t){return Math.log(1-t[this.thread.x][this.thread.y])})).setOutput([e.rows,e.cols]);return a(h(t,new u(t.rows,t.cols,r(t.data))),h(new u(t.rows,t.cols,n(t.data)),new u(e.rows,e.cols,o(e.data)))).sum()}(t,e)}},{key:"error",value:function(t){return-1/t}}])&&xt(e.prototype,r),s}(mt);function Dt(t){return(Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ct(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Lt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mt(t,e){return(Mt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ft(t,e){if(e&&("object"===Dt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Kt(t){return(Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var At=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mt(t,e)}(a,t);var e,r,n,o,c=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Kt(n);if(o){var r=Kt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ft(this,t)});function a(){return Ct(this,a),c.apply(this,arguments)}return e=a,(r=[{key:"activation",value:function(t){return function(t){var e=i.createKernel((function(t){return 2/(1+Math.exp(-2*t[this.thread.x][this.thread.y]))-1})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))}(t)}},{key:"derivative",value:function(t){return function(t){var e=i.createKernel((function(t){return 1-Math.pow(2/(1+Math.exp(-2*t[this.thread.x][this.thread.y]))-1,2)})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))}(t)}},{key:"getType",value:function(){return P.tanh}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}}])&&Lt(e.prototype,r),a}(mt);function Nt(t){return(Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ut(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function qt(t,e){return(qt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function It(t,e){if(e&&("object"===Nt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Zt(t){return(Zt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Jt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Zt(n);if(o){var r=Zt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return It(this,t)});function u(){return Ht(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return v(t)}},{key:"derivative",value:function(t){return d(t)}},{key:"getType",value:function(){return P.relu}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}}])&&Ut(e.prototype,r),u}(mt);function Vt(t){return(Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Gt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Qt(t,e){return(Qt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Yt(t,e){if(e&&("object"===Vt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function $t(t){return($t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var te=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Qt(t,e)}(a,t);var e,r,n,o,c=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$t(n);if(o){var r=$t(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Yt(this,t)});function a(){return Gt(this,a),c.apply(this,arguments)}return e=a,(r=[{key:"activation",value:function(t){return function(t){var e=i.createKernel((function(t){return Math.log(1+Math.exp(t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))}(t)}},{key:"derivative",value:function(t){return function(t){var e=i.createKernel((function(t){return 1/(1+Math.exp(-t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))}(t)}},{key:"getType",value:function(){return P.softplus}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}}])&&Xt(e.prototype,r),a}(mt);function ee(t){return(ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function re(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function oe(t,e,r){return(oe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ce(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function ie(t,e){return(ie=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ue(t,e){if(e&&("object"===ee(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ce(t){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ae=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ie(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ce(n);if(o){var r=ce(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ue(this,t)});function u(){return re(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"configure",value:function(){}},{key:"is1D",value:function(){return!1}},{key:"is3D",value:function(){return!0}},{key:"transition",value:function(t){return t.is3D()&&this.setSize([t.getOutputWidth(),t.getOutputHeight(),t.getOutputDepth()]),oe(ce(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){this.setWidth(t[0]),this.setHeight(t[1]),this.setDepth(t[2])}},{key:"getSize",value:function(){return[this.getOutputWidth(),this.getOutputHeight(),this.getOutputDepth()]}}])&&ne(e.prototype,r),u}(st);function se(t){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function le(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function he(t,e){return(he=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ye(t,e){if(e&&("object"===se(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return pe(t)}function pe(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function be(t){return(be=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ve(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var de=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&he(t,e)}(s,t);var e,r,n,o,i=(n=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=be(n);if(o){var r=be(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ye(this,t)});function s(){var t;fe(this,s);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return ve(pe(t=i.call.apply(i,[this].concat(r))),"numFilters",32),ve(pe(t),"filterSize",4),ve(pe(t),"padding",1),ve(pe(t),"stride",1),t}return e=s,(r=[{key:"configure",value:function(){this.W.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.W=f(this.W,this.width*this.height*this.depth),this.b.resize(this.numFilters,1),this.b=f(this.b,.01),this.gW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.gW=l(this.gW),this.gb.resize(this.numFilters,1),this.gb=l(this.gb),this.cW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.cW=l(this.gb),this.cB.resize(this.numFilters,1),this.cB=l(this.cB),this.vW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.vW=l(this.vW),this.vB.resize(this.numFilters,1),this.vB=l(this.vB)}},{key:"getOutputHeight",value:function(){return(this.width-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.height-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.numFilters}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setNumFilters",value:function(t){return this.numFilters=t,this}},{key:"getNumFilters",value:function(){return this.numFilters}},{key:"setPadding",value:function(t){return this.padding=t,this}},{key:"getPadding",value:function(){return this.padding}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"forward",value:function(t){for(var e=new u(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols),r=0;r<t.cols;r+=1){var n=m(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.padding,this.padding,this.stride,this.stride),o=this.Z=a(c(this.W,n),this.b.replicate(1,t.cols)).rollToColMatrix();e.setCol(r,o)}return this.Z=e,this.activation(this.Z),this.A}},{key:"activation",value:function(t){return v(t)}},{key:"derivative",value:function(t){return d(t)}},{key:"getType",value:function(){return P.conv}},{key:"loss",value:function(t,e){throw new Error("Unsupported.")}},{key:"error",value:function(t){throw new Error("Unsupported.")}}])&&le(e.prototype,r),s}(ae);function we(t){return(we="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function me(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ge(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Oe(t,e){return(Oe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Se(t,e){if(e&&("object"===we(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ke(t){return(ke=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var je=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Oe(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ke(n);if(o){var r=ke(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Se(this,t)});function u(){return me(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"configure",value:function(){}},{key:"transition",value:function(t){if(!t.is3D())throw new Error("Invalid usage. Cannot fully connect with previous 1D layer.");if(t.getType()!=P.maxpool)throw new Error("Invalid usage. Cannot fully connect with previous non maxpool layer.");return this.filterSize=t.getOutputWidth(),this.padding=0,this.stride=1,this.width=t.getOutputWidth(),this.height=t.getOutputHeight(),this.depth=t.getOutputDepth(),this.numFilters=t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth(),this}},{key:"setSize",value:function(t){throw new Error("Unsupported")}},{key:"setFilterSize",value:function(t){throw new Error("Unsupported")}},{key:"setStride",value:function(t){throw new Error("Unsupported")}},{key:"setPadding",value:function(t){throw new Error("Unsupported")}},{key:"setWidth",value:function(t){throw new Error("Unsupported")}},{key:"setHeight",value:function(t){throw new Error("Unsupported")}},{key:"setDepth",value:function(t){throw new Error("Unsupported")}},{key:"setNumFilters",value:function(t){throw new Error("Unsupported")}}])&&ge(e.prototype,r),u}(de);function Pe(t){return(Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Re(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ee(t,e){return(Ee=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function xe(t,e){if(e&&("object"===Pe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Te(t){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ze=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ee(t,e)}(c,t);var e,r,n,o,i=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Te(n);if(o){var r=Te(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return xe(this,t)});function c(){return _e(this,c),i.apply(this,arguments)}return e=c,(r=[{key:"configure",value:function(){this.backPropagation=new V(this,this.previousLayer)}},{key:"getOutputHeight",value:function(){return(this.height-this.filterSize)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.width-this.filterSize)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.depth}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"forward",value:function(t){for(var e=new u(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols),r=0;r<t.cols;r+=1){var n=g(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.stride,this.stride).rollToColMatrix();e.setCol(r,n)}return this.Z=e,this.activation(this.Z),this.A}},{key:"activation",value:function(t){throw new Error("No activation for MAXPOOL layer.")}},{key:"derivative",value:function(t){throw new Error("No derivative for MAXPOOL layer.")}},{key:"getType",value:function(){return P.maxpool}},{key:"loss",value:function(t,e){throw new Error("Unsupported.")}},{key:"error",value:function(t){throw new Error("Unsupported.")}}])&&Re(e.prototype,r),c}(ae);function We(t){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Be(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function De(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ce(t,e){return(Ce=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Le(t,e){if(e&&("object"===We(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Me(t){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Fe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ce(t,e)}(c,t);var e,r,n,o,i,u=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Me(o);if(i){var r=Me(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Le(this,t)});function c(){return Be(this,c),u.apply(this,arguments)}return e=c,n=[{key:"fromJSON",value:function(t){return new Promise((function(e,r){O.readFile(t,(function(t,n){if(t)r(t);else{var o=JSON.parse(n.toString()),i=new c(o.dimensions);o.layers.forEach((function(t){var e=null;"logistic"===t.type?e=Bt:"softmax"===t.type?e=_t:"relu"===t.type?e=Jt:"softplus"===t.type?e=te:"tanh"===t.type&&(e=At),i.createLayer(e,(function(e){e.setSize(t.dimensions)}))}));var u=i.getNetwork();u.getLayers().forEach((function(t,e){t.W=o.layers.W,t.b=o.layers.b})),e(u)}}))}))}}],(r=[{key:"firstLayerTransition",value:function(t){t.setWidth(this.dimensions[0])}}])&&De(e.prototype,r),n&&De(e,n),c}(ut);function Ke(t){return(Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ae(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function He(t,e){return(He=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ue(t,e){if(e&&("object"===Ke(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function qe(t){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ie=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&He(t,e)}(c,t);var e,r,n,o,i,u=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=qe(o);if(i){var r=qe(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ue(this,t)});function c(){return Ae(this,c),u.apply(this,arguments)}return e=c,n=[{key:"fromJSON",value:function(t){return new Promise((function(e,r){O.readFile(t,(function(t,n){if(t)r(t);else{var o=JSON.parse(n.toString()),i=new c(o.dimensions);o.layers.forEach((function(t){var e=null;"logistic"===t.type?(e=Bt,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"softmax"===t.type?(e=_t,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"relu"===t.type?(e=Jt,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"softplus"===t.type?(e=te,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"tanh"===t.type?(e=At,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"conv"===t.type?(e=de,i.createLayer(e,(function(e){e.setSize(t.dimensions),e.setFilterSize(t.filterSize),e.setStride(t.stride),e.setNumFilters(t.numFilters),e.setPadding(t.padding)}))):"maxpool"===t.type?(e=ze,i.createLayer(e,(function(e){e.setSize(t.dimensions),e.setFilterSize(t.filterSize),e.setStride(t.stride)}))):"fullyconnected"===t.type&&(e=ze,i.createLayer(e,(function(t){})))}));var u=i.getNetwork();u.getLayers().forEach((function(t,e){t.W=o.layers.W,t.b=o.layers.b})),e(u)}}))}))}}],(r=[{key:"firstLayerTransition",value:function(t){t.setSize(this.dimensions)}}])&&Ne(e.prototype,r),n&&Ne(e,n),c}(ut);const Ze=require("csvtojson");function Je(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ve(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Ge=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ve(this,"exampleSize",0),Ve(this,"numberOfExamples",0),Ve(this,"data",null),this.exampleSize=e,this.numberOfExamples=r;for(var o=[],i=0;i<r;i+=1){o[i]=[];for(var c=0;c<e;c+=1)o[i][c]=Number(n[i][c]||0)}this.data=new u(this.exampleSize,this.numberOfExamples,o)}var e,r;return e=t,(r=[{key:"exampleAt",value:function(t){for(var e=[],r=0;r<this.exampleSize;r+=1)e[r]=[],e[r][0]=this.data.data[t][r];return new u(this.exampleSize,1,e)}},{key:"getNumberOfExamples",value:function(){return this.numberOfExamples}},{key:"getBatch",value:function(t,e){return this.data.block(0,t,this.data.rows,e)}}])&&Je(e.prototype,r),t}();function Xe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Qe=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"fromCSV",value:function(t){return new Promise((function(e){Ze({noheader:!0,output:"csv"}).fromFile(t).then((function(t){var r=t.length,n=t[0].length,o=new Ge(n,r,t);e(o)}))}))}}],null&&Xe(e.prototype,null),r&&Xe(e,r),t}();function Ye(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function $e(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var tr=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),$e(this,"batchSize",0),$e(this,"t",0),$e(this,"learningRate",0)}var e,r;return e=t,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"setT",value:function(t){return this.t=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}}])&&Ye(e.prototype,r),t}();function er(t){return(er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function rr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function or(t,e){return(or=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ir(t,e){if(e&&("object"===er(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ur(t){return(ur=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var cr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&or(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ur(n);if(o){var r=ur(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ir(this,t)});function u(){return rr(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.adam(t,this.learningRate,this.t)}},{key:"adam",value:function(t,e,r){var n=.9,o=.999;t.vW=a(y(t.vW,n),y(t.gW,1-n));var i=b(t.vW,1-Math.pow(n,r));t.cW=a(y(t.cW,n),y(t.gW,1-n));var u=w(y(t.cW,1-Math.pow(o,r)));t.W=s(t.W,y(h(i,u),e)),t.vB=a(y(t.vB,n),y(t.gb,1-n));var c=b(t.vB,1-Math.pow(n,r));t.cB=a(y(t.cB,o),y(h(t.gb,t.gb),1-o));var f=w(b(t.cB,1-Math.pow(o,r)));t.b=s(t.b,y(p(c,f),e))}}])&&nr(e.prototype,r),u}(tr);function ar(t){return(ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function sr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function lr(t,e){return(lr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function hr(t,e){if(e&&("object"===ar(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function yr(t){return(yr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var pr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=yr(n);if(o){var r=yr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return hr(this,t)});function u(){return sr(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.gradientDescent(t,this.learningRate)}},{key:"gradientDescent",value:function(t,e){t.W=s(t.W,y(t.gW,e)),t.b=s(t.b,y(t.gb,e))}}])&&fr(e.prototype,r),u}(tr);function br(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function vr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function dr(t){return(dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function gr(t,e){return(gr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Or(t,e){if(e&&("object"===dr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Sr(t)}function Sr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function kr(t){return(kr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function jr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Pr={Builder1D:Fe,Builder3D:Ie},_r={Matrix:u,matrixMultiply:c,matrixSum:function(t){return t.sum()},matrixFillRandom:f,matrixElementWiseMultiply:h,matrixElementWiseDivide:p,matrixElementWiseAdd:a,matrixElementWiseSubtract:s},Rr={SoftmaxLayer:_t,LogisticLayer:Bt,ReluLayer:Jt,SoftplusLayer:te,TanhLayer:At,ConvLayer:de,MaxPoolLayer:ze,FullyConnectedLayer:je},Er={DatasetBuilder:Qe},xr={OptimizerAdam:cr,OptimizerGradientDescent:pr},Tr={MiniBatchTrainer:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=kr(n);if(o){var r=kr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Or(this,t)});function u(){var t;wr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return jr(Sr(t=i.call.apply(i,[this].concat(r))),"batchSize",100),t}return e=u,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"train",value:function(t,e){for(var r=this,n=t.getNumberOfExamples(),o=(new Date).getTime(),i=0,u=0;u<this.iterations;u+=1){for(var c=(new Date).getTime(),a=0,s=0;a<n;a+=this.batchSize,s+=this.batchSize){var f=t.getBatch(s,this.batchSize),l=e.getBatch(s,this.batchSize),h=this.network.forward(f);if(this.network.backward(f,l,h,this.regularization),this.network.getLayers().forEach((function(t){r.optimizer.setT(++i),r.optimizer.optimize(t)})),this.verbose){var y=(new Date).getTime();console.log("Batch: ".concat(s+1," / ").concat(Math.ceil(n/this.batchSize)," | Time: ").concat(y-c," ms."))}}if(this.verbose&&(u+1)%this.verboseStep==0){var p=(new Date).getTime(),b=this.cost(t,e);console.log("Iteration: ".concat(u+1," | Cost: ").concat(b.cost," | Accuracy: ").concat(b.accuracy,"% | Time: ").concat(p-o," ms."))}"function"==typeof this.stepCallback&&this.stepCallback({iteration:u})}}}])&&mr(e.prototype,r),u}(function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),vr(this,"network",null),vr(this,"optimizer",null),vr(this,"regularization",0),vr(this,"iterations",1e3),vr(this,"learningRate",.1),vr(this,"verbose",!0),vr(this,"verboseStep",1),vr(this,"stepCallback",(function(){return null})),this.network=e,this.optimizer=r}var e,r;return e=t,(r=[{key:"setRegularization",value:function(t){return this.regularization=t,this}},{key:"setIterations",value:function(t){return this.iterations=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}},{key:"setVerbose",value:function(t){return this.verbose=t,this}},{key:"setVerboseStep",value:function(t){return this.verboseStep=t,this}},{key:"setStepCallback",value:function(t){return this.stepCallback=t,this}},{key:"cost",value:function(t,e){var r=100,n=t.getNumberOfExamples(),o=Math.ceil(n/r),i=0,u=0,c=0;this.network.getLayers().forEach((function(t){c+=t.penalty()}));for(var a=0,s=0;a<n;a+=r,s+=1){var f=this.network.forward(t.getBatch(s,r)),l=e.getBatch(s,r),h=l.cols,y=this.network.loss(l,f);i+=(this.network.error(h)*y+this.regularization*c/(2*h))/(o*(h/r));for(var p=0;p<f.cols;p+=1)f.colMaxCoeffIndex(p)==f.colMaxCoeffIndex(p)&&u++}return{cost:i,accuracy:(u-1)/n*100}}}])&&br(e.prototype,r),t}())};module.exports=e})();
//# sourceMappingURL=impulse-ts.js.map