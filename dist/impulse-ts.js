(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Builders:()=>On,Dataset:()=>jn,DatasetModifiers:()=>_n,Layers:()=>kn,Math:()=>Sn,Optimizers:()=>xn,Trainers:()=>Pn});const r=require("fs");function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=function(){function t(){var e,r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r={},(e="kernels")in this?Object.defineProperty(this,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[e]=r}var e,r;return e=t,(r=[{key:"addKernel",value:function(t,e){return this.kernels[t]=e,this}},{key:"execute",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.kernels[t].apply(null,r)}}])&&n(e.prototype,r),t}();function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i(this,t),c(this,"rows",0),c(this,"cols",0),c(this,"data",null),this.resize(e,r),n&&this.generateData(n)}var e,r;return e=t,(r=[{key:"resize",value:function(t,e){this.rows=t,this.cols=e,this.data=[];for(var r=0;r<this.rows;r+=1)this.data[r]=new Array(this.cols);return this}},{key:"generateData",value:function(t){this.data=[];for(var e=0;e<this.rows;e+=1)this.data[e]=new Array(this.cols);for(var r=0;r<this.cols;r+=1)for(var n=0;n<this.rows;n+=1)"number"==typeof t[r]?this.data[n][r]=t[r]:t[r]instanceof Float32Array?this.data[n][r]=t[r][n]:this.data[n][r]=0;return this}},{key:"toBuffer",value:function(){var t=new ArrayBuffer(this.rows*this.cols*64),e=new DataView(t,0,this.rows*this.cols*64);return this.data.forEach((function(t,r){e.setFloat64(r,t)})),t}},{key:"sum",value:function(){for(var t=0,e=0;e<this.rows;e+=1)for(var r=0;r<this.cols;r+=1)t+=this.data[e][r];return t}},{key:"colwiseSum",value:function(){for(var e=[],r=0;r<this.cols;r+=1){for(var n=0,o=0;o<this.rows;o+=1)n+=this.data[o][r];e[r]=[n]}return new t(1,this.cols,e)}},{key:"rowwiseSum",value:function(){for(var e=[],r=0;r<this.rows;r+=1){for(var n=0,o=0;o<this.rows;o+=1)n+=this.data[r][o];e[r]=[n]}return new t(this.rows,1,e)}},{key:"replicate",value:function(e,r){var n=this.data,o=[],i=null;if(1===e&&1===this.cols&&r>1){i=new t(this.rows,r);for(var u=0;u<this.rows;u+=1){o[u]=[];for(var c=0;c<r;c+=1)o[u][c]=n[u][0]}}else if(1===r&&1===this.rows&&e>1){i=new t(e,this.cols);for(var a=0;a<e;a+=1){o[a]=[];for(var s=0;s<this.cols;s+=1)o[a][s]=n[0][s]}}return i?(i.generateData(o),i):this}},{key:"transpose",value:function(){return N().execute("transpose",this)}},{key:"conjugate",value:function(){return this}},{key:"colMaxCoeffIndex",value:function(t){for(var e=-1,r=-1/0,n=0;n<this.rows;n+=1)this.data[n][t]>r&&(r=this.data[n][t],e=n);return e}},{key:"block",value:function(e,r,n,o){for(var i=[],u=e,c=0;u<this.rows&&u<e+n;u+=1,c+=1){i[u]=new Array(o);for(var a=r,s=0;a<this.cols&&a<r+o;a+=1,s+=1)i[c][s]=this.data[u][a]}return new t(n,o,i)}},{key:"col",value:function(e){for(var r=[],n=0;n<this.rows;n+=1)r[n]=[this.data[n][e]];return new t(this.rows,1,r)}},{key:"setCol",value:function(t,e){for(var r=0;r<this.rows;r+=1)this.data[r][t]=e.data[r][0];return this}},{key:"rollToColMatrix",value:function(){for(var e=[],r=0,n=0;n<this.rows;n+=1){e[n]=[];for(var o=0;o<this.cols;o+=1)e[r++][0]=this.data[n][o]}return new t(this.rows*this.cols,1,e)}}])&&u(e.prototype,r),t}();function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t,e){if(e&&("object"===s(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var p=new(require("gpu.js").GPU)({mode:"gpu"}),h=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=p.createKernel((function(t,e){return t[this.thread.x][this.thread.y]/e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new a(t.rows,e.cols,r(t.data,e.data))},b=function(t,e){var r=p.createKernel((function(t){return t[this.thread.x][this.thread.y]/this.constants.number})).setOutput([t.rows,t.cols]).setConstants({number:e});return new a(t.rows,t.cols,r(t.data))},v=function(t){var e=p.createKernel((function(t){return Math.exp(t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]),r=new a(t.rows,t.cols,e(t.data)),n=new a(1,t.cols,r.colwiseSum().data).replicate(t.rows,1);return new a(t.rows,t.cols,h(r,n).data)},d=function(t,e){var r=p.createKernel((function(t){return Math.log(t[this.thread.x][this.thread.y])})).setOutput([e.rows,e.cols]);return new a(t.rows,t.cols,B(t,new a(t.rows,t.cols,r(e.data))).data).sum()},w=function(t){var e=p.createKernel((function(t){return 1/(1+Math.exp(-t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new a(t.rows,t.cols,e(t.data))},m=function(t){var e=p.createKernel((function(t){return t[this.thread.x][this.thread.y]*(1-t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]);return new a(t.rows,t.cols,e(t.data))},g=function(t,e){var r=p.createKernel((function(t){return Math.log(t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]),n=p.createKernel((function(t){return 1-t[this.thread.x][this.thread.y]})).setOutput([t.rows,t.cols]),o=p.createKernel((function(t){return Math.log(1-t[this.thread.x][this.thread.y])})).setOutput([e.rows,e.cols]);return T(B(t,new a(t.rows,t.cols,r(t.data))),B(new a(t.rows,t.cols,n(t.data)),new a(e.rows,e.cols,o(e.data)))).sum()},O=function(t){var e=p.createKernel((function(t){return 2/(1+Math.exp(-2*t[this.thread.x][this.thread.y]))-1})).setOutput([t.rows,t.cols]);return new a(t.rows,t.cols,e(t.data))},S=function(t){var e=p.createKernel((function(t){return 1-Math.pow(2/(1+Math.exp(-2*t[this.thread.x][this.thread.y]))-1,2)})).setOutput([t.rows,t.cols]);return new a(t.rows,t.cols,e(t.data))},k=function(t){var e=p.createKernel((function(t){return Math.max(0,t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]);return new a(t.rows,t.cols,e(t.data))},j=function(t){var e=p.createKernel((function(t){return t[this.thread.x][this.thread.y]>0?1:0})).setOutput([t.rows,t.cols]);return new a(t.rows,t.cols,e(t.data))},x=function(t){var e=p.createKernel((function(t){return Math.log(1+Math.exp(t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new a(t.rows,t.cols,e(t.data))},P=function(t){var e=p.createKernel((function(t){return 1/(1+Math.exp(-t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new a(t.rows,t.cols,e(t.data))},_=function(t){var e=p.createKernel((function(t){return Math.pow(t[this.thread.x][this.thread.y],2)})).setOutput([t.rows,t.cols]);return new a(t.rows,t.cols,e(t.data)).sum()},R=function(t){var e=p.createKernel((function(t){return Math.sqrt(t[this.thread.x][this.thread.y]+1e-8)})).setOutput([t.rows,t.cols]);return new a(t.rows,t.cols,e(t.data))},E=function(t,e){var r=p.createKernel((function(t,e){return e[this.thread.x][this.thread.y]-Math.pow(t[this.thread.x][this.thread.y],2)})).setOutput([t.rows,t.cols]);return new a(t.rows,t.cols,r(t.data)).sum()},W=function(t,e){if(t.cols!==e.rows)throw new Error("DIMENSIONS error. m1.cols ".concat(t.cols," !== m2.rows ").concat(e.rows,"."));var r=p.createKernel((function(t,e){for(var r=0,n=0;n<this.constants.cols;n++)r+=t[this.thread.x][n]*e[n][this.thread.y];return r})).setOutput([t.rows,e.cols]).setConstants({cols:t.rows});return new a(t.rows,e.cols,r(t.data,e.data))},T=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=p.createKernel((function(t,e){return t[this.thread.x][this.thread.y]+e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new a(t.rows,e.cols,r(t.data,e.data))},z=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=p.createKernel((function(t,e){return t[this.thread.x][this.thread.y]-e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new a(t.rows,e.cols,r(t.data,e.data))},D=function(t,e){var r=p.createKernel((function(){return(Math.random()-.5)*Math.sqrt(2/this.constants.parameter)})).setOutput([t.rows,t.cols]).setConstants({parameter:e});return new a(t.rows,t.cols,r())},M=function(t){var e=p.createKernel((function(){return 0})).setOutput([t.rows,t.cols]);return new a(t.rows,t.cols,e())},B=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=p.createKernel((function(t,e){return t[this.thread.x][this.thread.y]*e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new a(t.rows,e.cols,r(t.data,e.data))},C=function(t,e){var r=p.createKernel((function(t){return t[this.thread.x][this.thread.y]*this.constants.number})).setOutput([t.rows,t.cols]).setConstants({number:e});return new a(t.rows,t.cols,r(t.data))},L=function(t){var e=p.createKernel((function(t){return t[this.thread.y][this.thread.x]})).setOutput([t.cols,t.rows]);return new a(t.cols,t.rows,e(t.data))},K=new(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(o,t);var e,r,n=(e=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=y(e);if(r){var o=y(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return l(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this)).addKernel("multiply",W),t.addKernel("elementWiseAdd",T),t.addKernel("elementWiseSubtract",z),t.addKernel("fillRandom",D),t.addKernel("setZeros",M),t.addKernel("elementWiseMultiply",B),t.addKernel("elementWiseMultiplyNumber",C),t.addKernel("elementWiseDivide",h),t.addKernel("elementWiseDivideNumber",b),t.addKernel("softmaxActivation",v),t.addKernel("softmaxLoss",d),t.addKernel("logisticActivation",w),t.addKernel("logisticDerivative",m),t.addKernel("logisticLoss",g),t.addKernel("tanhActivation",O),t.addKernel("tanhDerivative",S),t.addKernel("reluActivation",k),t.addKernel("reluDerivative",j),t.addKernel("softplusActivation",x),t.addKernel("softplusDerivative",P),t.addKernel("penalty",_),t.addKernel("sqrt",R),t.addKernel("purelinLoss",E),t.addKernel("transpose",L),t}return o}(o)),N=function(){return K};function A(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function F(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Z=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),F(this,"dimensions",null),F(this,"size",0),F(this,"layers",[]),this.dimensions=e}var e,n;return e=t,(n=[{key:"addLayer",value:function(t){return this.size++,this.layers.push(t),this}},{key:"getLayers",value:function(){return this.layers}},{key:"forward",value:function(t){var e=t;return this.layers.forEach((function(t){e=t.forward(e)})),e}},{key:"backward",value:function(t,e,r,n){for(var o=t.cols,i=N().execute("elementWiseSubtract",r,e),u=this.layers.length-1;u>=0;u-=1)i=this.layers[u].getBackPropagation().propagate(t,o,n,i)}},{key:"loss",value:function(t,e){return this.layers[this.layers.length-1].loss(t,e)}},{key:"error",value:function(t){return this.layers[this.layers.length-1].error(t)}},{key:"save",value:function(t){var e={dimensions:this.dimensions,layers:[]};this.layers.forEach((function(t){e.layers.push({type:t.getType(),size:t.getSize(),weights:{W:t.W.data,b:t.b.data}})}));var n=JSON.stringify(e);return new Promise((function(e,o){r.writeFile(t,n,(function(t){t&&(console.error(t),o()),e(n)}))}))}}])&&A(e.prototype,n),t}();var H;function q(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}!function(t){t.logistic="logistic",t.softmax="softmax",t.tanh="tanh",t.relu="relu",t.softplus="softplus",t.conv="conv",t.maxpool="maxpool",t.fullyconnected="fullyconnected",t.purelin="purelin"}(H||(H={}));var U=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),q(this,"layer",null),q(this,"previousLayer",null),this.layer=e,this.previousLayer=r};function I(t){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function J(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function V(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function G(t,e){return(G=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function X(t,e){if(e&&("object"===I(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Q(t){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&G(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Q(n);if(o){var r=Q(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return X(this,t)});function u(){return J(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){var o=null!==this.previousLayer?this.previousLayer.A:t,i=N().execute("multiply",n,o.transpose().conjugate());return this.layer.gW=N().execute("elementWiseAdd",N().execute("elementWiseDivideNumber",i,e),N().execute("elementWiseMultiplyNumber",this.layer.W,r/e)),this.layer.gb=N().execute("elementWiseDivideNumber",n.rowwiseSum(),e),null!==this.previousLayer?N().execute("elementWiseMultiply",N().execute("multiply",this.layer.W.transpose(),n),this.previousLayer.derivative(this.previousLayer.A)):new a}}])&&V(e.prototype,r),u}(U);function $(t){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function rt(t,e){return(rt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function nt(t,e){if(e&&("object"===$(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ot(t){return(ot=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var it=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&rt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ot(n);if(o){var r=ot(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return nt(this,t)});function u(){return tt(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){return n}}])&&et(e.prototype,r),u}(U);function ut(t){return(ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ct(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function at(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function st(t,e){return(st=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ft(t,e){if(e&&("object"===ut(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return lt(t)}function lt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function yt(t){return(yt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ht=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&st(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=yt(n);if(o){var r=yt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ft(this,t)});function u(){var t;ct(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return pt(lt(t=i.call.apply(i,[this].concat(r))),"previousLayer",null),t}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){for(var o=this.previousLayer,i=N().execute("setZeros",new a(o.Z.rows,o.Z.cols)),u=o.getFilterSize(),c=o.getStride(),s=o.getWidth(),f=o.getHeight(),l=(o.getDepth(),o.getOutputWidth()),y=o.getOutputHeight(),p=o.getOutputDepth(),h=0;h<e;h++)for(var b=0;b<p;b++)for(var v=0;v<y;v++)for(var d=0;d<l;d++){for(var w=c*d,m=-1/0,g=f*s*b,O=y*l*b,S=0,k=0,j=0,x=c*v;j<u;j++,x++)for(var P=0,_=w;P<u;P++,_++)m<o.Z.data[g+x*s+_][h]&&(m=o.Z.data[g+x*s+_][h],S=_,k=x);i.data[g+k*s+S][h]=n[O+v*l+d][h]}return i}}])&&at(e.prototype,r),u}(U);function bt(t){return(bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function wt(t,e){return(wt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function mt(t,e){if(e&&("object"===bt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return gt(t)}function gt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ot(t){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function St(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var kt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ot(n);if(o){var r=Ot(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return mt(this,t)});function u(){var t;vt(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return St(gt(t=i.call.apply(i,[this].concat(r))),"previousLayer",null),t}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){var o=this.previousLayer,i=o.getPadding(),u=o.getStride(),c=o.getFilterSize(),s=o.getOutputWidth(),f=o.getOutputHeight(),l=o.getOutputDepth(),y=o.getWidth(),p=o.getHeight(),h=o.getDepth(),b=N().execute("setZeros",new a((y+2*i)*(p+2*i)*h,e)),v=new a(y*p*h,e);o.derivative(o.A),o.gW=N().execute("setZeros",o.gW),o.gb=N().execute("setZeros",o.gb);for(var d=0;d<e;d++){for(var w=0;w<l;w++)for(var m=0;m<f;m++)for(var g=0;g<s;g++){for(var O=u*m,S=u*g,k=0;k<h;k++)for(var j=0,x=O,P=-i;j<c;j++,x++,P++)for(var _=0,R=S,E=-i;_<c;_++,R++,E++){b[k*(y+2*i)*(p+2*i)+x*(y+2*i)+R][d]+=o.W.data[w][k*c*c+j*c+_]*n[w*s*f+m*s+g][d];var W=0;0==i?W=o.Z.data[k*y*p+x*y+R][d]:P>=0&&E>=0&&P<p&&E<y&&(W=o.Z.data[k*y*p+P*y+E][d]),o.gW.data[w][k*c*c+j*c+_]+=W*n[w*(s*f)+m*s+g][d]/e}o.gb.data[w][0]+=n[w*(s*f)+m*s+g][d]/e}if(i>0)for(var T=0;T<h;T++)for(var z=-i,D=0;z<p+i;z++,D++)for(var M=-i,B=0;M<y+i;M++,B++)M>=0&&z>=0&&M<y&&z<p&&(v[T*y*p+z*y+M][d]=b[T*(y+2*i)*(p+2*i)+D*(y+2*i)+B][d])}return i>0?v:b}}])&&dt(e.prototype,r),u}(U);function jt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var xt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"create",value:function(t,e){if(null==t){if(e.is1D())return new Y(e,t);if(e.getType()==H.conv)return new it(e,t)}else{if(t.getType()==H.maxpool)return new ht(e,t);if(t.getType()==H.conv)return new kt(e,t);if(t.is1D()||t.getType()==H.fullyconnected)return new Y(e,t)}return null}}],null&&jt(e.prototype,null),r&&jt(e,r),t}();function Pt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _t(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Rt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),_t(this,"dimensions",null),_t(this,"lastLayer",null),_t(this,"network",null),this.dimensions=e,this.network=new Z(e)}var e,r;return e=t,(r=[{key:"createLayer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=new t;return"function"==typeof e&&e(r),null===this.lastLayer?this.firstLayerTransition(r):r.transition(this.lastLayer),r.configure(),r.setBackPropagation(xt.create(this.lastLayer,r)),this.network.addLayer(r),this.lastLayer=r,this}},{key:"getNetwork",value:function(){return this.network}}])&&Pt(e.prototype,r),t}();function Et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Wt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Tt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Wt(this,"width",0),Wt(this,"height",0),Wt(this,"depth",0),Wt(this,"previousLayer",null),Wt(this,"backPropagation",null),this.W=new a,this.b=new a,this.A=new a,this.Z=new a,this.gW=new a,this.gb=new a,this.vW=new a,this.cW=new a,this.vb=new a,this.cb=new a}var e,r;return e=t,(r=[{key:"setBackPropagation",value:function(t){return this.backPropagation=t,this}},{key:"getBackPropagation",value:function(){return this.backPropagation}},{key:"forward",value:function(t){return this.Z=N().execute("elementWiseAdd",N().execute("multiply",this.W,t),this.b.replicate(1,t.cols)),this.A=this.activation(this.Z),this.A}},{key:"setWidth",value:function(t){return this.width=t,this}},{key:"getWidth",value:function(){return this.width}},{key:"setHeight",value:function(t){return this.height=t,this}},{key:"getHeight",value:function(){return this.height}},{key:"setDepth",value:function(t){return this.depth=t,this}},{key:"getDepth",value:function(){return this.depth}},{key:"transition",value:function(t){return this.previousLayer=t,this}},{key:"penalty",value:function(){return N().execute("penalty",this.W)}}])&&Et(e.prototype,r),t}();function zt(t){return(zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Mt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Bt(t,e,r){return(Bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Nt(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function Ct(t,e){return(Ct=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Lt(t,e){if(e&&("object"===zt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Kt(t)}function Kt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Nt(t){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function At(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Ft=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ct(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Nt(n);if(o){var r=Nt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Lt(this,t)});function u(){var t;Dt(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return At(Kt(t=i.call.apply(i,[this].concat(r))),"depth",1),t}return e=u,(r=[{key:"configure",value:function(){this.W.resize(this.height,this.width),this.W=N().execute("fillRandom",this.W,this.width),this.b.resize(this.height,1),this.b=N().execute("fillRandom",this.b,this.width),this.gW.resize(this.height,this.width),this.gW=N().execute("setZeros",this.gW),this.gb.resize(this.height,1),this.gb=N().execute("setZeros",this.gb),this.cW.resize(this.height,this.width),this.cW=N().execute("setZeros",this.cW),this.cb.resize(this.height,1),this.cb=N().execute("setZeros",this.cb),this.vW.resize(this.height,this.width),this.vW=N().execute("setZeros",this.vW),this.vb.resize(this.height,1),this.vb=N().execute("setZeros",this.cb)}},{key:"is1D",value:function(){return!0}},{key:"is3D",value:function(){return!1}},{key:"transition",value:function(t){return t.is1D()?this.setWidth(t.getSize()):t.is3D()&&this.setWidth(t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth()),Bt(Nt(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){return this.setHeight(t[0]),this}},{key:"getSize",value:function(){return this.height}},{key:"getOutputWidth",value:function(){return this.width}},{key:"getOutputHeight",value:function(){return this.height}},{key:"getOutputDepth",value:function(){return 1}}])&&Mt(e.prototype,r),u}(Tt);function Zt(t){return(Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ut(t,e){return(Ut=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function It(t,e){if(e&&("object"===Zt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Jt(t){return(Jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Vt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ut(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Jt(n);if(o){var r=Jt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return It(this,t)});function u(){return Ht(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return N().execute("softmaxActivation",t)}},{key:"derivative",value:function(t){throw new Error("Unsupported usage.")}},{key:"getType",value:function(){return H.softmax}},{key:"loss",value:function(t,e){return N().execute("softmaxLoss",t,e)}},{key:"error",value:function(t){return-1/t}}])&&qt(e.prototype,r),u}(Ft);function Gt(t){return(Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Yt(t,e){return(Yt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function $t(t,e){if(e&&("object"===Gt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function te(t){return(te=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ee=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Yt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=te(n);if(o){var r=te(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return $t(this,t)});function u(){return Xt(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return N().execute("logisticActivation",t)}},{key:"derivative",value:function(t){return N().execute("logisticDerivative",t)}},{key:"getType",value:function(){return H.logistic}},{key:"loss",value:function(t,e){return N().execute("logisticLoss",t,e)}},{key:"error",value:function(t){return-1/t}}])&&Qt(e.prototype,r),u}(Ft);function re(t){return(re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ne(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function oe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ie(t,e){return(ie=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ue(t,e){if(e&&("object"===re(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ce(t){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ae=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ie(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ce(n);if(o){var r=ce(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ue(this,t)});function u(){return ne(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return N().execute("tanhActivation",t)}},{key:"derivative",value:function(t){return N().execute("tanhDerivative",t)}},{key:"getType",value:function(){return H.tanh}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}}])&&oe(e.prototype,r),u}(Ft);function se(t){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function le(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ye(t,e){return(ye=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function pe(t,e){if(e&&("object"===se(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function he(t){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var be=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ye(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=he(n);if(o){var r=he(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return pe(this,t)});function u(){return fe(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return N().execute("reluActivation",t)}},{key:"derivative",value:function(t){return N().execute("reluDerivative",t)}},{key:"getType",value:function(){return H.relu}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}}])&&le(e.prototype,r),u}(Ft);function ve(t){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function de(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function we(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function me(t,e){return(me=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ge(t,e){if(e&&("object"===ve(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Oe(t){return(Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Se=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&me(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Oe(n);if(o){var r=Oe(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ge(this,t)});function u(){return de(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return N().execute("softplusActivation",t)}},{key:"derivative",value:function(t){return N().execute("softplusDerivative",t)}},{key:"getType",value:function(){return H.softplus}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}}])&&we(e.prototype,r),u}(Ft),ke=function(t,e,r,n,o,i,u,c,s,f){for(var l=i*o*e,y=((n-i+2*c)/f+1)*((r-o+2*u)/s+1),p=0,h=N().execute("setZeros",new a(l,y)),b=-u;b+o<=r+u;b+=s)for(var v=-c;v+i<=n+c;v+=f){for(var d=0,w=0;w<e;w++)for(var m=r*n*w,g=0;g<o;g++)for(var O=0;O<i;O++)b+g>=0&&v+O>=0&&v+O<n&&b+g<r&&(h.data[d][p]=t.data[(g+b)*n+v+O+m][0]),d++;p++}return h},je=function(t,e,r,n,o,i,u,c){for(var s=(n-i)/c+1,f=(r-o)/u+1,l=e,y=0,p=N().execute("setZeros",new a(s*f*l,1)),h=0;h+o<=r;h+=u)for(var b=0;b+i<=n;b+=c){for(var v=0;v<e;v++){for(var d=-1/0,w=r*n*v,m=s*f*v,g=0;g<o;g++)for(var O=0;O<i;O++)d=Math.max(d,t.data[w+(g+h)*n+b+O][0]);p.data[m+y][0]=d}y++}return new a};function xe(t){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Re(t,e,r){return(Re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Te(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function Ee(t,e){return(Ee=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function We(t,e){if(e&&("object"===xe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Te(t){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ze=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ee(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Te(n);if(o){var r=Te(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return We(this,t)});function u(){return Pe(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"configure",value:function(){}},{key:"is1D",value:function(){return!1}},{key:"is3D",value:function(){return!0}},{key:"transition",value:function(t){return t.is3D()&&this.setSize([t.getOutputWidth(),t.getOutputHeight(),t.getOutputDepth()]),Re(Te(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){return this.setWidth(t[0]),this.setHeight(t[1]),this.setDepth(t[2]),this}},{key:"getSize",value:function(){return[this.getWidth(),this.getHeight(),this.getDepth()]}}])&&_e(e.prototype,r),u}(Tt);function De(t){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Me(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Be(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ce(t,e){return(Ce=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Le(t,e){if(e&&("object"===De(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ke(t)}function Ke(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ne(t){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ae(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Fe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ce(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ne(n);if(o){var r=Ne(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Le(this,t)});function u(){var t;Me(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Ae(Ke(t=i.call.apply(i,[this].concat(r))),"numFilters",32),Ae(Ke(t),"filterSize",4),Ae(Ke(t),"padding",1),Ae(Ke(t),"stride",1),t}return e=u,(r=[{key:"configure",value:function(){this.W.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.W=N().execute("fillRandom",this.W,this.width*this.height*this.depth),this.b.resize(this.numFilters,1),this.b=N().execute("fillRandom",this.b,.01),this.gW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.gW=N().execute("setZeros",this.gW),this.gb.resize(this.numFilters,1),this.gb=N().execute("setZeros",this.gb),this.cW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.cW=N().execute("setZeros",this.gb),this.cb.resize(this.numFilters,1),this.cb=N().execute("setZeros",this.cb),this.vW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.vW=N().execute("setZeros",this.vW),this.vb.resize(this.numFilters,1),this.vb=N().execute("setZeros",this.vb)}},{key:"getOutputHeight",value:function(){return(this.width-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.height-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.numFilters}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setNumFilters",value:function(t){return this.numFilters=t,this}},{key:"getNumFilters",value:function(){return this.numFilters}},{key:"setPadding",value:function(t){return this.padding=t,this}},{key:"getPadding",value:function(){return this.padding}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"forward",value:function(t){for(var e=new a(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols),r=0;r<t.cols;r+=1){var n=ke(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.padding,this.padding,this.stride,this.stride),o=this.Z=N().execute("elementWiseAdd",N().execute("multiply",this.W,n),this.b.replicate(1,t.cols)).rollToColMatrix();e.setCol(r,o)}return this.Z=e,this.activation(this.Z),this.A}},{key:"activation",value:function(t){return N().execute("reluActivation",t)}},{key:"derivative",value:function(t){return N().execute("reluDerivative",t)}},{key:"getType",value:function(){return H.conv}},{key:"loss",value:function(t,e){throw new Error("Unsupported.")}},{key:"error",value:function(t){throw new Error("Unsupported.")}}])&&Be(e.prototype,r),u}(ze);function Ze(t){return(Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function He(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ue(t,e){return(Ue=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ie(t,e){if(e&&("object"===Ze(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Je(t){return(Je=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ve=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ue(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Je(n);if(o){var r=Je(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ie(this,t)});function u(){return He(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"configure",value:function(){}},{key:"transition",value:function(t){if(!t.is3D())throw new Error("Invalid usage. Cannot fully connect with previous 1D layer.");if(t.getType()!=H.maxpool)throw new Error("Invalid usage. Cannot fully connect with previous non maxpool layer.");return this.filterSize=t.getOutputWidth(),this.padding=0,this.stride=1,this.width=t.getOutputWidth(),this.height=t.getOutputHeight(),this.depth=t.getOutputDepth(),this.numFilters=t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth(),this}},{key:"setSize",value:function(t){throw new Error("Unsupported")}},{key:"setFilterSize",value:function(t){throw new Error("Unsupported")}},{key:"setStride",value:function(t){throw new Error("Unsupported")}},{key:"setPadding",value:function(t){throw new Error("Unsupported")}},{key:"setWidth",value:function(t){throw new Error("Unsupported")}},{key:"setHeight",value:function(t){throw new Error("Unsupported")}},{key:"setDepth",value:function(t){throw new Error("Unsupported")}},{key:"setNumFilters",value:function(t){throw new Error("Unsupported")}}])&&qe(e.prototype,r),u}(Fe);function Ge(t){return(Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ye(t,e){return(Ye=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function $e(t,e){if(e&&("object"===Ge(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function tr(t){return(tr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var er=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ye(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=tr(n);if(o){var r=tr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return $e(this,t)});function u(){return Xe(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"configure",value:function(){this.backPropagation=new ht(this,this.previousLayer)}},{key:"getOutputHeight",value:function(){return(this.height-this.filterSize)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.width-this.filterSize)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.depth}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"forward",value:function(t){for(var e=new a(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols),r=0;r<t.cols;r+=1){var n=je(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.stride,this.stride).rollToColMatrix();e.setCol(r,n)}return this.Z=e,this.activation(this.Z),this.A}},{key:"activation",value:function(t){throw new Error("No activation for MAXPOOL layer.")}},{key:"derivative",value:function(t){throw new Error("No derivative for MAXPOOL layer.")}},{key:"getType",value:function(){return H.maxpool}},{key:"loss",value:function(t,e){throw new Error("Unsupported.")}},{key:"error",value:function(t){throw new Error("Unsupported.")}}])&&Qe(e.prototype,r),u}(ze);function rr(t){return(rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function or(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ir(t,e){return(ir=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ur(t,e){if(e&&("object"===rr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function cr(t){return(cr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ar=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ir(t,e)}(a,t);var e,n,o,i,u,c=(i=a,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=cr(i);if(u){var r=cr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ur(this,t)});function a(){return nr(this,a),c.apply(this,arguments)}return e=a,o=[{key:"fromJSON",value:function(t){return new Promise((function(e,n){r.readFile(t,(function(t,r){if(t)n(t);else{var o=JSON.parse(r.toString()),i=new a(o.dimensions);o.layers.forEach((function(t){var e=null;"logistic"===t.type?e=ee:"softmax"===t.type?e=Vt:"relu"===t.type?e=be:"softplus"===t.type?e=Se:"tanh"===t.type&&(e=ae),i.createLayer(e,(function(e){e.setSize(t.dimensions)}))}));var u=i.getNetwork();u.getLayers().forEach((function(t,e){t.W=o.layers.W,t.b=o.layers.b})),e(u)}}))}))}}],(n=[{key:"firstLayerTransition",value:function(t){t.setWidth(this.dimensions[0])}}])&&or(e.prototype,n),o&&or(e,o),a}(Rt);function sr(t){return(sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function yr(t,e){return(yr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function pr(t,e){if(e&&("object"===sr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function hr(t){return(hr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var br=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yr(t,e)}(a,t);var e,n,o,i,u,c=(i=a,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=hr(i);if(u){var r=hr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return pr(this,t)});function a(){return fr(this,a),c.apply(this,arguments)}return e=a,o=[{key:"fromJSON",value:function(t){return new Promise((function(e,n){r.readFile(t,(function(t,r){if(t)n(t);else{var o=JSON.parse(r.toString()),i=new a(o.dimensions);o.layers.forEach((function(t){var e=null;"logistic"===t.type?(e=ee,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"softmax"===t.type?(e=Vt,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"relu"===t.type?(e=be,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"softplus"===t.type?(e=Se,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"tanh"===t.type?(e=ae,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"conv"===t.type?(e=Fe,i.createLayer(e,(function(e){e.setSize(t.dimensions),e.setFilterSize(t.filterSize),e.setStride(t.stride),e.setNumFilters(t.numFilters),e.setPadding(t.padding)}))):"maxpool"===t.type?(e=er,i.createLayer(e,(function(e){e.setSize(t.dimensions),e.setFilterSize(t.filterSize),e.setStride(t.stride)}))):"fullyconnected"===t.type&&(e=er,i.createLayer(e))}));var u=i.getNetwork();u.getLayers().forEach((function(t,e){t.W=o.layers.W,t.b=o.layers.b})),e(u)}}))}))}}],(n=[{key:"firstLayerTransition",value:function(t){t.setSize(this.dimensions)}}])&&lr(e.prototype,n),o&&lr(e,o),a}(Rt);const vr=require("csvtojson");function dr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function wr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var mr=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),wr(this,"exampleSize",0),wr(this,"numberOfExamples",0),wr(this,"data",null),this.exampleSize=e,this.numberOfExamples=r;for(var o=[],i=0;i<r;i+=1){o[i]=[];for(var u=0;u<e;u+=1)o[i][u]=n[i][u].length?Number(n[i][u]):NaN}this.data=new a(this.exampleSize,this.numberOfExamples,o)}var e,r;return e=t,(r=[{key:"exampleAt",value:function(t){return this.data.col(t)}},{key:"getNumberOfExamples",value:function(){return this.numberOfExamples}},{key:"getBatch",value:function(t,e){return this.data.block(0,t,this.data.rows,e)}}])&&dr(e.prototype,r),t}();function gr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Or=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"fromCSV",value:function(t){return new Promise((function(e){vr({noheader:!0,output:"csv"}).fromFile(t).then((function(t){var r=t.length,n=t[0].length,o=new mr(n,r,t);e(o)}))}))}}],null&&gr(e.prototype,null),r&&gr(e,r),t}();function Sr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function kr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var jr=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),kr(this,"batchSize",0),kr(this,"t",0),kr(this,"learningRate",0)}var e,r;return e=t,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"setT",value:function(t){return this.t=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}}])&&Sr(e.prototype,r),t}();function xr(t){return(xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Rr(t,e){return(Rr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Er(t,e){if(e&&("object"===xr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Wr(t){return(Wr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Tr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Wr(n);if(o){var r=Wr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Er(this,t)});function u(){return Pr(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.adam(t,this.learningRate,this.t)}},{key:"adam",value:function(t,e,r){var n=.9,o=.999;t.vW=N().execute("elementWiseAdd",N().execute("elementWiseMultiplyNumber",t.vW,n),N().execute("elementWiseMultiplyNumber",t.gW,1-n));var i=N().execute("elementWiseDivideNumber",t.vW,1-Math.pow(n,r));t.cW=N().execute("elementWiseAdd",N().execute("elementWiseMultiplyNumber",t.cW,n),N().execute("elementWiseMultiplyNumber",t.gW,1-n));var u=N().execute("sqrt",N().execute("elementWiseMultiplyNumber",t.cW,1-Math.pow(o,r)));t.W=N().execute("elementWiseSubtract",t.W,N().execute("elementWiseMultiplyNumber",N().execute("elementWiseMultiply",i,u),e)),t.vb=N().execute("elementWiseAdd",N().execute("elementWiseMultiplyNumber",t.vb,n),N().execute("elementWiseMultiplyNumber",t.gb,1-n));var c=N().execute("elementWiseDivideNumber",t.vb,1-Math.pow(n,r));t.cb=N().execute("elementWiseAdd",N().execute("elementWiseMultiplyNumber",t.cb,o),N().execute("elementWiseMultiplyNumber",N().execute("elementWiseMultiply",t.gb,t.gb),1-o));var a=N().execute("sqrt",N().execute("elementWiseDivideNumber",t.cb,1-Math.pow(o,r)));t.b=N().execute("elementWiseSubtract",t.b,N().execute("elementWiseMultiplyNumber",N().execute("elementWiseDivide",c,a),e))}}])&&_r(e.prototype,r),u}(jr);function zr(t){return(zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Mr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Br(t,e){return(Br=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Cr(t,e){if(e&&("object"===zr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Lr(t){return(Lr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Kr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Br(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Lr(n);if(o){var r=Lr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Cr(this,t)});function u(){return Dr(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.gradientDescent(t,this.learningRate)}},{key:"gradientDescent",value:function(t,e){t.W=N().execute("elementWiseSubtract",t.W,N().execute("elementWiseMultiplyNumber",t.gW,e)),t.b=N().execute("elementWiseSubtract",t.b,N().execute("elementWiseMultiplyNumber",t.gb,e))}}])&&Mr(e.prototype,r),u}(jr);function Nr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ar(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Fr(t){return(Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Hr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function qr(t,e){return(qr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ur(t,e){if(e&&("object"===Fr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ir(t)}function Ir(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Jr(t){return(Jr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Vr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Gr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Jr(n);if(o){var r=Jr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ur(this,t)});function u(){var t;Zr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Vr(Ir(t=i.call.apply(i,[this].concat(r))),"batchSize",100),t}return e=u,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"train",value:function(t,e){var r=this,n=t.getNumberOfExamples(),o=(new Date).getTime(),i=0;this.optimizer.setBatchSize(this.batchSize);for(var u=0;u<this.iterations;u+=1){for(var c=(new Date).getTime(),a=0,s=0;a<n;a+=this.batchSize,s+=this.batchSize){var f=(new Date).getTime(),l=t.getBatch(s,this.batchSize),y=e.getBatch(s,this.batchSize),p=this.network.forward(l);if(this.network.backward(l,y,p,this.regularization),this.network.getLayers().forEach((function(t){r.optimizer.setT(++i),r.optimizer.optimize(t)})),this.verbose){var h=(new Date).getTime();console.log("Batch: ".concat(s," / ").concat(n," | Time: ").concat(h-f," ms | ").concat(h-c," ms."))}}if(this.verbose&&(u+1)%this.verboseStep==0){var b=(new Date).getTime(),v=this.cost(t,e);console.log("Iteration: ".concat(u+1," | Cost: ").concat(v.cost," | Accuracy: ").concat(v.accuracy,"% | Time: ").concat(b-o," ms."))}"function"==typeof this.stepCallback&&this.stepCallback({iteration:u})}}}])&&Hr(e.prototype,r),u}(function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ar(this,"network",null),Ar(this,"optimizer",null),Ar(this,"regularization",0),Ar(this,"iterations",1e3),Ar(this,"learningRate",.1),Ar(this,"verbose",!0),Ar(this,"verboseStep",1),Ar(this,"stepCallback",Function),this.network=e,this.optimizer=r}var e,r;return e=t,(r=[{key:"setRegularization",value:function(t){return this.regularization=t,this}},{key:"setIterations",value:function(t){return this.iterations=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}},{key:"setVerbose",value:function(t){return this.verbose=t,this}},{key:"setVerboseStep",value:function(t){return this.verboseStep=t,this}},{key:"setStepCallback",value:function(t){return this.stepCallback=t,this}},{key:"cost",value:function(t,e){var r=100,n=t.getNumberOfExamples(),o=Math.ceil(n/r),i=0,u=0,c=0;this.network.getLayers().forEach((function(t){c+=t.penalty()}));for(var a=0,s=0;a<n;a+=r,s+=1){var f=this.network.forward(t.getBatch(s,r)),l=e.getBatch(s,r),y=l.cols,p=this.network.loss(l,f);i+=(this.network.error(y)*p+this.regularization*c/(2*y))/(o*(y/r));for(var h=0;h<f.cols;h+=1)f.colMaxCoeffIndex(h)==f.colMaxCoeffIndex(h)&&u++}return{cost:i,accuracy:(u-1)/n*100}}}])&&Nr(e.prototype,r),t}());function Xr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Qr=function(){function t(e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(r="dataset")in this?Object.defineProperty(this,r,{value:null,enumerable:!0,configurable:!0,writable:!0}):this[r]=null,this.dataset=e}var e,r;return e=t,(r=[{key:"apply",value:function(){for(var t=0;t<this.dataset.getNumberOfExamples();t+=1)this.applyToExample(t);return this.dataset}}])&&Xr(e.prototype,r),t}();function Yr(t){return(Yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function en(t,e){return(en=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function rn(t,e){if(e&&("object"===Yr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return nn(t)}function nn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function on(t){return(on=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function un(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function cn(t){return(cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function an(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function sn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function fn(t,e){return(fn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ln(t,e){if(e&&("object"===cn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function yn(t){return(yn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pn(t){return(pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function vn(t,e){return(vn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function dn(t,e){if(e&&("object"===pn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return wn(t)}function wn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function mn(t){return(mn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function gn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var On={Builder1D:ar,Builder3D:br},Sn={Matrix:a},kn={SoftmaxLayer:Vt,LogisticLayer:ee,ReluLayer:be,SoftplusLayer:Se,TanhLayer:ae,ConvLayer:Fe,MaxPoolLayer:er,FullyConnectedLayer:Ve},jn={DatasetBuilder:Or},xn={OptimizerAdam:Tr,OptimizerGradientDescent:Kr},Pn={MiniBatchTrainer:Gr},_n={CallbackDatabaseModifier:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&en(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=on(n);if(o){var r=on(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return rn(this,t)});function u(){var t;$r(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return un(nn(t=i.call.apply(i,[this].concat(r))),"callback",(function(t){return t})),t}return e=u,(r=[{key:"applyToExample",value:function(t){for(var e=0;e<this.dataset.getNumberOfExamples();e+=1)for(var r=this.callback(this.dataset.exampleAt(e)),n=0;n<this.dataset.data.data.rows;n+=1)this.dataset.data.data[n][e]=r.data.data[n][0]}},{key:"setCallback",value:function(t){return this.callback=t,this}}])&&tn(e.prototype,r),u}(Qr),MinMaxScalingDatabaseModifier:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=yn(n);if(o){var r=yn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ln(this,t)});function u(){return an(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"applyToExample",value:function(t){for(var e=1/0,r=-1/0,n=0;n<this.dataset.getNumberOfExamples();n+=1)for(var o=this.dataset.exampleAt(n),i=0;i<o.rows;i+=1)e=Math.min(o.data[i][0]),r=Math.max(o.data[i][0]);var u=p.createKernel((function(t){return(t[this.thread.x][this.thread.y]-this.constants.min)/(this.constants.max-this.constants.min)})).setOutput([this.dataset.data.data.rows,this.dataset.data.data.cols]).setConstants({min:e,max:r});this.dataset.data.data=u(this.dataset.data.data)}}])&&sn(e.prototype,r),u}(Qr),MissingDataScalingDatabaseModifier:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=mn(n);if(o){var r=mn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return dn(this,t)});function u(){var t;hn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return gn(wn(t=i.call.apply(i,[this].concat(r))),"modificationType","mean"),t}return e=u,(r=[{key:"applyToExample",value:function(t){for(var e=this,r=[],n=0,o=0,i=0,u=0;u<this.dataset.getNumberOfExamples();u+=1)for(var c=this.dataset.exampleAt(u),a=0;a<c.data.rows;a+=1)isNaN(c[a][0])?r.push({row:a,col:c}):(o+=c[a][0],n++);"mean"===this.modificationType&&(i=o/n),r.forEach((function(t){var r=t.row,n=t.col;e.dataset.data.data[r][n]=i}))}},{key:"setModificationType",value:function(t){return this.modificationType=t,this}}])&&bn(e.prototype,r),u}(Qr)};module.exports=e})();
//# sourceMappingURL=impulse-ts.js.map