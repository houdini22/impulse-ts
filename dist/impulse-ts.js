(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}t.r(e),t.d(e,{Builders:()=>tn,Dataset:()=>nn,DatasetModifiers:()=>cn,Layers:()=>rn,Math:()=>en,Optimizers:()=>on,Trainers:()=>un});var i=new(require("gpu.js").GPU)({mode:"gpu"}),u=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r(this,t),o(this,"rows",0),o(this,"cols",0),o(this,"data",null),this.resize(e,n),i&&this.generateData(i)}var e,u;return e=t,(u=[{key:"resize",value:function(t,e){this.rows=t,this.cols=e,this.data=[];for(var r=0;r<this.rows;r+=1)this.data[r]=new Array(this.cols);return this}},{key:"generateData",value:function(t){this.data=[];for(var e=0;e<this.rows;e+=1)this.data[e]=new Array(this.cols);for(var r=0;r<this.cols;r+=1)for(var n=0;n<this.rows;n+=1)"number"==typeof t[r]?this.data[n][r]=t[r]:t[r]instanceof Float32Array?this.data[n][r]=t[r][n]:this.data[n][r]=0;return this}},{key:"toBuffer",value:function(){var t=new ArrayBuffer(this.rows*this.cols*64),e=new DataView(t,0,this.rows*this.cols*64);return this.data.forEach((function(t,r){e.setFloat64(r,t)})),t}},{key:"sum",value:function(){for(var t=0,e=0;e<this.rows;e+=1)for(var r=0;r<this.cols;r+=1)t+=this.data[e][r];return t}},{key:"colwiseSum",value:function(){for(var e=[],r=0;r<this.cols;r+=1){for(var n=0,o=0;o<this.rows;o+=1)n+=this.data[o][r];e[r]=[n]}return new t(1,this.cols,e)}},{key:"rowwiseSum",value:function(){for(var e=[],r=0;r<this.rows;r+=1){for(var n=0,o=0;o<this.rows;o+=1)n+=this.data[r][o];e[r]=[n]}return new t(this.rows,1,e)}},{key:"replicate",value:function(e,r){var n=this.data,o=[],i=null;if(1===e&&1===this.cols&&r>1){i=new t(this.rows,r);for(var u=0;u<this.rows;u+=1){o[u]=[];for(var c=0;c<r;c+=1)o[u][c]=n[u][0]}}else if(1===r&&1===this.rows&&e>1){i=new t(e,this.cols);for(var a=0;a<e;a+=1){o[a]=[];for(var f=0;f<this.cols;f+=1)o[a][f]=n[0][f]}}return i?(i.generateData(o),i):this}},{key:"transpose",value:function(){var e=i.createKernel((function(t){return t[this.thread.y][this.thread.x]})).setOutput([this.cols,this.rows]);return new t(this.cols,this.rows,e(this.data))}},{key:"conjugate",value:function(){return this}},{key:"colMaxCoeffIndex",value:function(t){for(var e=-1,r=-1/0,n=0;n<this.rows;n+=1)this.data[n][t]>r&&(r=this.data[n][t],e=n);return e}},{key:"block",value:function(e,r,n,o){for(var i=[],u=e,c=0;u<this.rows&&u<e+n;u+=1,c+=1){i[u]=new Array(o);for(var a=r,f=0;a<this.cols&&a<r+o;a+=1,f+=1)i[c][f]=this.data[u][a]}return new t(n,o,i)}},{key:"col",value:function(e){for(var r=[],n=0;n<this.rows;n+=1)r[n]=[this.data[n][e]];return new t(this.rows,1,r)}},{key:"setCol",value:function(t,e){for(var r=0;r<this.rows;r+=1)this.data[r][t]=e.data[r][0];return this}},{key:"rollToColMatrix",value:function(){for(var e=[],r=0,n=0;n<this.rows;n+=1){e[n]=[];for(var o=0;o<this.cols;o+=1)e[r++][0]=this.data[n][o]}return new t(this.rows*this.cols,1,e)}}])&&n(e.prototype,u),t}(),c=function(t,e){if(t.cols!==e.rows)throw new Error("DIMENSIONS error. m1.cols ".concat(t.cols," !== m2.rows ").concat(e.rows,"."));var r=i.createKernel((function(t,e){for(var r=0,n=0;n<this.constants.cols;n++)r+=t[this.thread.x][n]*e[n][this.thread.y];return r})).setOutput([t.rows,e.cols]).setConstants({cols:t.rows});return new u(t.rows,e.cols,r(t.data,e.data))},a=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=i.createKernel((function(t,e){return t[this.thread.x][this.thread.y]+e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new u(t.rows,e.cols,r(t.data,e.data))},f=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=i.createKernel((function(t,e){return t[this.thread.x][this.thread.y]-e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new u(t.rows,e.cols,r(t.data,e.data))},s=function(t,e){var r=i.createKernel((function(){return(Math.random()-.5)*Math.sqrt(2/this.constants.parameter)})).setOutput([t.rows,t.cols]).setConstants({parameter:e});return new u(t.rows,t.cols,r())},l=function(t){var e=i.createKernel((function(){return 0})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e())},y=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=i.createKernel((function(t,e){return t[this.thread.x][this.thread.y]*e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new u(t.rows,e.cols,r(t.data,e.data))},h=function(t,e){var r=i.createKernel((function(t){return t[this.thread.x][this.thread.y]*this.constants.number})).setOutput([t.rows,t.cols]).setConstants({number:e});return new u(t.rows,t.cols,r(t.data))},p=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=i.createKernel((function(t,e){return t[this.thread.x][this.thread.y]/e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new u(t.rows,e.cols,r(t.data,e.data))},b=function(t,e){var r=i.createKernel((function(t){return t[this.thread.x][this.thread.y]/this.constants.number})).setOutput([t.rows,t.cols]).setConstants({number:e});return new u(t.rows,t.cols,r(t.data))},v=function(t){var e=i.createKernel((function(t){return Math.max(0,t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))},d=function(t){var e=i.createKernel((function(t){return t[this.thread.x][this.thread.y]>0?1:0})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))},w=function(t){var e=i.createKernel((function(t){return Math.sqrt(t[this.thread.x][this.thread.y]+1e-8)})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))},m=function(t,e,r,n,o,i,c,a,f,s){for(var y=0,h=l(new u(i*o*e,((n-i+2*a)/s+1)*((r-o+2*c)/f+1))),p=-c;p+o<=r+c;p+=f)for(var b=-a;b+i<=n+a;b+=s){for(var v=0,d=0;d<e;d++)for(var w=r*n*d,m=0;m<o;m++)for(var g=0;g<i;g++)p+m>=0&&b+g>=0&&b+g<n&&p+m<r&&(h.data[v][y]=t.data[(m+p)*n+b+g+w][0]),v++;y++}return h},g=function(t,e,r,n,o,i,c,a){for(var f=(n-i)/a+1,s=(r-o)/c+1,y=0,h=l(new u(f*s*e,1)),p=0;p+o<=r;p+=c)for(var b=0;b+i<=n;b+=a){for(var v=0;v<e;v++){for(var d=-1/0,w=r*n*v,m=f*s*v,g=0;g<o;g++)for(var O=0;O<i;O++)d=Math.max(d,t.data[w+(g+p)*n+b+O][0]);h.data[m+y][0]=d}y++}return new u};const O=require("fs");function S(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function k(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const j=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),k(this,"dimensions",null),k(this,"size",0),k(this,"layers",[]),this.dimensions=e}var e,r;return e=t,(r=[{key:"addLayer",value:function(t){this.size++,this.layers.push(t)}},{key:"getLayers",value:function(){return this.layers}},{key:"forward",value:function(t){var e=t;return this.layers.forEach((function(t){e=t.forward(e)})),e}},{key:"backward",value:function(t,e,r,n){var o=function(t){return t.cols}(t),i=f(r,e);this.layers.reverse().forEach((function(e){i=e.getBackPropagation().propagate(t,o,n,i)}))}},{key:"loss",value:function(t,e){return this.layers[this.layers.length-1].loss(t,e)}},{key:"error",value:function(t){return this.layers[this.layers.length-1].error(t)}},{key:"save",value:function(t){var e={dimensions:this.dimensions,layers:[]};this.layers.forEach((function(t){e.layers.push({type:t.getType(),size:t.getSize(),weights:{W:t.W.data,b:t.b.data}})}));var r=JSON.stringify(e);return new Promise((function(e,n){O.writeFile(t,r,(function(t){t&&(console.error(t),n()),e(r)}))}))}}])&&S(e.prototype,r),t}();var P;function _(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}!function(t){t.logistic="logistic",t.softmax="softmax",t.tanh="tanh",t.relu="relu",t.softplus="softplus",t.conv="conv",t.maxpool="maxpool",t.fullyconnected="fullyconnected",t.purelin="purelin"}(P||(P={}));var E=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),_(this,"layer",null),_(this,"previousLayer",null),this.layer=e,this.previousLayer=r};function R(t){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function z(t,e){return(z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function W(t,e){if(e&&("object"===R(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function D(t){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&z(t,e)}(f,t);var e,r,n,o,i=(n=f,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=D(n);if(o){var r=D(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return W(this,t)});function f(){return x(this,f),i.apply(this,arguments)}return e=f,(r=[{key:"propagate",value:function(t,e,r,n){var o=null!==this.previousLayer?this.previousLayer.A:t,i=c(n,o.transpose().conjugate());return this.layer.gW=a(b(i,e),h(this.layer.W,r/e)),this.layer.gb=b(n.rowwiseSum(),e),null!==this.previousLayer?y(c(this.layer.W.transpose(),n),this.previousLayer.derivative(this.previousLayer.A)):new u}}])&&T(e.prototype,r),f}(E);function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function M(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function F(t,e){return(F=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function A(t,e){if(e&&("object"===C(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function N(t){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var K=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&F(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=N(n);if(o){var r=N(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return A(this,t)});function u(){return L(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){return n}}])&&M(e.prototype,r),u}(E);function H(t){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function U(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function q(t,e){return(q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function I(t,e){if(e&&("object"===H(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return J(t)}function J(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function V(t){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function G(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var X=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&q(t,e)}(c,t);var e,r,n,o,i=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=V(n);if(o){var r=V(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return I(this,t)});function c(){var t;U(this,c);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return G(J(t=i.call.apply(i,[this].concat(r))),"previousLayer",null),t}return e=c,(r=[{key:"propagate",value:function(t,e,r,n){for(var o=this.previousLayer,i=l(new u(o.Z.rows,o.Z.cols)),c=o.getFilterSize(),a=o.getStride(),f=o.getWidth(),s=o.getHeight(),y=(o.getDepth(),o.getOutputWidth()),h=o.getOutputHeight(),p=o.getOutputDepth(),b=0;b<e;b++)for(var v=0;v<p;v++)for(var d=0;d<h;d++)for(var w=0;w<y;w++){for(var m=a*w,g=-1/0,O=s*f*v,S=h*y*v,k=0,j=0,P=0,_=a*d;P<c;P++,_++)for(var E=0,R=m;E<c;E++,R++)g<o.Z.data[O+_*f+R][b]&&(g=o.Z.data[O+_*f+R][b],k=R,j=_);i.data[O+j*f+k][b]=n[S+d*y+w][b]}return i}}])&&Z(e.prototype,r),c}(E);function Q(t){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function tt(t,e){return(tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function et(t,e){if(e&&("object"===Q(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return rt(t)}function rt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function nt(t){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ot(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var it=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&tt(t,e)}(c,t);var e,r,n,o,i=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=nt(n);if(o){var r=nt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return et(this,t)});function c(){var t;Y(this,c);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return ot(rt(t=i.call.apply(i,[this].concat(r))),"previousLayer",null),t}return e=c,(r=[{key:"propagate",value:function(t,e,r,n){var o=this.previousLayer,i=o.getPadding(),c=o.getStride(),a=o.getFilterSize(),f=o.getOutputWidth(),s=o.getOutputHeight(),y=o.getOutputDepth(),h=o.getWidth(),p=o.getHeight(),b=o.getDepth(),v=l(new u((h+2*i)*(p+2*i)*b,e)),d=new u(h*p*b,e);o.derivative(o.A),o.gW=l(o.gW),o.gb=l(o.gb);for(var w=0;w<e;w++){for(var m=0;m<y;m++)for(var g=0;g<s;g++)for(var O=0;O<f;O++){for(var S=c*g,k=c*O,j=0;j<b;j++)for(var P=0,_=S,E=-i;P<a;P++,_++,E++)for(var R=0,x=k,T=-i;R<a;R++,x++,T++){v[j*(h+2*i)*(p+2*i)+_*(h+2*i)+x][w]+=o.W.data[m][j*a*a+P*a+R]*n[m*f*s+g*f+O][w];var z=0;0==i?z=o.Z.data[j*h*p+_*h+x][w]:E>=0&&T>=0&&E<p&&T<h&&(z=o.Z.data[j*h*p+E*h+T][w]),o.gW.data[m][j*a*a+P*a+R]+=z*n[m*(f*s)+g*f+O][w]/e}o.gb.data[m][0]+=n[m*(f*s)+g*f+O][w]/e}if(i>0)for(var W=0;W<b;W++)for(var D=-i,B=0;D<p+i;D++,B++)for(var C=-i,L=0;C<h+i;C++,L++)C>=0&&D>=0&&C<h&&D<p&&(d[W*h*p+D*h+C][w]=v[W*(h+2*i)*(p+2*i)+B*(h+2*i)+L][w])}return i>0?d:v}}])&&$(e.prototype,r),c}(E);function ut(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ct=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"create",value:function(t,e){if(null==t){if(e.is1D())return new B(e,t);if(e.getType()==P.conv)return new K(e,t)}else{if(t.getType()==P.maxpool)return new X(e,t);if(t.getType()==P.conv)return new it(e,t);if(t.is1D()||t.getType()==P.fullyconnected)return new B(e,t)}return null}}],null&&ut(e.prototype,null),r&&ut(e,r),t}();function at(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ft(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var st=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ft(this,"dimensions",null),ft(this,"lastLayer",null),ft(this,"network",null),this.dimensions=e,this.network=new j(e)}var e,r;return e=t,(r=[{key:"createLayer",value:function(t,e){var r=new t;"function"==typeof e&&e(r),null===this.lastLayer?this.firstLayerTransition(r):r.transition(this.lastLayer),r.configure(),r.setBackPropagation(ct.create(this.lastLayer,r)),this.network.addLayer(r),this.lastLayer=r}},{key:"getNetwork",value:function(){return this.network}}])&&at(e.prototype,r),t}();function lt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function yt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ht=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),yt(this,"width",0),yt(this,"height",0),yt(this,"depth",0),yt(this,"previousLayer",null),yt(this,"backPropagation",null),this.W=new u,this.b=new u,this.A=new u,this.Z=new u,this.gW=new u,this.gb=new u,this.vW=new u,this.cW=new u,this.vb=new u,this.cb=new u}var e,r;return e=t,(r=[{key:"setBackPropagation",value:function(t){return this.backPropagation=t,this}},{key:"getBackPropagation",value:function(){return this.backPropagation}},{key:"forward",value:function(t){return this.Z=a(c(this.W,t),this.b.replicate(1,t.cols)),this.A=this.activation(this.Z),this.A}},{key:"setWidth",value:function(t){this.width=t}},{key:"getWidth",value:function(){return this.width}},{key:"setHeight",value:function(t){this.height=t}},{key:"getHeight",value:function(){return this.height}},{key:"setDepth",value:function(t){this.depth=t}},{key:"getDepth",value:function(){return this.depth}},{key:"transition",value:function(t){return this.previousLayer=t,this}},{key:"penalty",value:function(){return t=this.W,e=i.createKernel((function(t){return Math.pow(t[this.thread.x][this.thread.y],2)})).setOutput([t.rows,t.cols]),new u(t.rows,t.cols,e(t.data)).sum();var t,e}}])&&lt(e.prototype,r),t}();function pt(t){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function vt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function dt(t,e,r){return(dt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ot(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function wt(t,e){return(wt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function mt(t,e){if(e&&("object"===pt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return gt(t)}function gt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ot(t){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function St(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var kt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ot(n);if(o){var r=Ot(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return mt(this,t)});function u(){var t;bt(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return St(gt(t=i.call.apply(i,[this].concat(r))),"depth",1),t}return e=u,(r=[{key:"configure",value:function(){this.W.resize(this.height,this.width),this.W=s(this.W,this.width),this.b.resize(this.height,1),this.b=s(this.b,this.width),this.gW.resize(this.height,this.width),this.gW=l(this.gW),this.gb.resize(this.height,1),this.gb=l(this.gb),this.cW.resize(this.height,this.width),this.cW=l(this.cW),this.cb.resize(this.height,1),this.cb=l(this.cb),this.vW.resize(this.height,this.width),this.vW=l(this.vW),this.vb.resize(this.height,1),this.vb=l(this.cb)}},{key:"is1D",value:function(){return!0}},{key:"is3D",value:function(){return!1}},{key:"transition",value:function(t){return t.is1D()?this.setWidth(t.getSize()):t.is3D()&&this.setWidth(t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth()),dt(Ot(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){this.setHeight(t[0])}},{key:"getSize",value:function(){return this.height}},{key:"getOutputWidth",value:function(){return this.width}},{key:"getOutputHeight",value:function(){return this.height}},{key:"getOutputDepth",value:function(){return 1}}])&&vt(e.prototype,r),u}(ht);function jt(t){return(jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Et(t,e){return(Et=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Rt(t,e){if(e&&("object"===jt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function xt(t){return(xt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Tt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Et(t,e)}(a,t);var e,r,n,o,c=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=xt(n);if(o){var r=xt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Rt(this,t)});function a(){return Pt(this,a),c.apply(this,arguments)}return e=a,(r=[{key:"activation",value:function(t){return function(t){var e=i.createKernel((function(t){return Math.exp(t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]),r=new u(t.rows,t.cols,e(t.data)),n=new u(1,t.cols,r.colwiseSum().data).replicate(t.rows,1);return new u(t.rows,t.cols,p(r,n).data)}(t)}},{key:"derivative",value:function(t){throw new Error("Unsupported usage.")}},{key:"getType",value:function(){return P.softmax}},{key:"loss",value:function(t,e){return function(t,e){var r=i.createKernel((function(t){return Math.log(t[this.thread.x][this.thread.y])})).setOutput([e.rows,e.cols]);return new u(t.rows,t.cols,y(t,new u(t.rows,t.cols,r(e.data))).data).sum()}(t,e)}},{key:"error",value:function(t){return-1/t}}])&&_t(e.prototype,r),a}(kt);function zt(t){return(zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Dt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Bt(t,e){return(Bt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ct(t,e){if(e&&("object"===zt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Lt(t){return(Lt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Mt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Bt(t,e)}(f,t);var e,r,n,o,c=(n=f,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Lt(n);if(o){var r=Lt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ct(this,t)});function f(){return Wt(this,f),c.apply(this,arguments)}return e=f,(r=[{key:"activation",value:function(t){return function(t){var e=i.createKernel((function(t){return 1/(1+Math.exp(-t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))}(t)}},{key:"derivative",value:function(t){return function(t){var e=i.createKernel((function(t){return t[this.thread.x][this.thread.y]*(1-t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))}(t)}},{key:"getType",value:function(){return P.logistic}},{key:"loss",value:function(t,e){return function(t,e){var r=i.createKernel((function(t){return Math.log(t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]),n=i.createKernel((function(t){return 1-t[this.thread.x][this.thread.y]})).setOutput([t.rows,t.cols]),o=i.createKernel((function(t){return Math.log(1-t[this.thread.x][this.thread.y])})).setOutput([e.rows,e.cols]);return a(y(t,new u(t.rows,t.cols,r(t.data))),y(new u(t.rows,t.cols,n(t.data)),new u(e.rows,e.cols,o(e.data)))).sum()}(t,e)}},{key:"error",value:function(t){return-1/t}}])&&Dt(e.prototype,r),f}(kt);function Ft(t){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function At(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Nt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Kt(t,e){return(Kt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ht(t,e){if(e&&("object"===Ft(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ut(t){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Zt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Kt(t,e)}(a,t);var e,r,n,o,c=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ut(n);if(o){var r=Ut(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ht(this,t)});function a(){return At(this,a),c.apply(this,arguments)}return e=a,(r=[{key:"activation",value:function(t){return function(t){var e=i.createKernel((function(t){return 2/(1+Math.exp(-2*t[this.thread.x][this.thread.y]))-1})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))}(t)}},{key:"derivative",value:function(t){return function(t){var e=i.createKernel((function(t){return 1-Math.pow(2/(1+Math.exp(-2*t[this.thread.x][this.thread.y]))-1,2)})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))}(t)}},{key:"getType",value:function(){return P.tanh}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}}])&&Nt(e.prototype,r),a}(kt);function qt(t){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function It(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Vt(t,e){return(Vt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Gt(t,e){if(e&&("object"===qt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Xt(t){return(Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Qt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Xt(n);if(o){var r=Xt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Gt(this,t)});function u(){return It(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return v(t)}},{key:"derivative",value:function(t){return d(t)}},{key:"getType",value:function(){return P.relu}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}}])&&Jt(e.prototype,r),u}(kt);function Yt(t){return(Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function te(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ee(t,e){return(ee=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function re(t,e){if(e&&("object"===Yt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ne(t){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var oe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ee(t,e)}(a,t);var e,r,n,o,c=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ne(n);if(o){var r=ne(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return re(this,t)});function a(){return $t(this,a),c.apply(this,arguments)}return e=a,(r=[{key:"activation",value:function(t){return function(t){var e=i.createKernel((function(t){return Math.log(1+Math.exp(t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))}(t)}},{key:"derivative",value:function(t){return function(t){var e=i.createKernel((function(t){return 1/(1+Math.exp(-t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new u(t.rows,t.cols,e(t.data))}(t)}},{key:"getType",value:function(){return P.softplus}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}}])&&te(e.prototype,r),a}(kt);function ie(t){return(ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ue(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ce(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ae(t,e,r){return(ae="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=le(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function fe(t,e){return(fe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function se(t,e){if(e&&("object"===ie(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function le(t){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ye=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fe(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=le(n);if(o){var r=le(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return se(this,t)});function u(){return ue(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"configure",value:function(){}},{key:"is1D",value:function(){return!1}},{key:"is3D",value:function(){return!0}},{key:"transition",value:function(t){return t.is3D()&&this.setSize([t.getOutputWidth(),t.getOutputHeight(),t.getOutputDepth()]),ae(le(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){this.setWidth(t[0]),this.setHeight(t[1]),this.setDepth(t[2])}},{key:"getSize",value:function(){return[this.getWidth(),this.getHeight(),this.getDepth()]}}])&&ce(e.prototype,r),u}(ht);function he(t){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function be(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ve(t,e){return(ve=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function de(t,e){if(e&&("object"===he(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return we(t)}function we(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function me(t){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ge(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Oe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ve(t,e)}(f,t);var e,r,n,o,i=(n=f,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=me(n);if(o){var r=me(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return de(this,t)});function f(){var t;pe(this,f);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return ge(we(t=i.call.apply(i,[this].concat(r))),"numFilters",32),ge(we(t),"filterSize",4),ge(we(t),"padding",1),ge(we(t),"stride",1),t}return e=f,(r=[{key:"configure",value:function(){this.W.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.W=s(this.W,this.width*this.height*this.depth),this.b.resize(this.numFilters,1),this.b=s(this.b,.01),this.gW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.gW=l(this.gW),this.gb.resize(this.numFilters,1),this.gb=l(this.gb),this.cW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.cW=l(this.gb),this.cb.resize(this.numFilters,1),this.cb=l(this.cb),this.vW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.vW=l(this.vW),this.vb.resize(this.numFilters,1),this.vb=l(this.vb)}},{key:"getOutputHeight",value:function(){return(this.width-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.height-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.numFilters}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setNumFilters",value:function(t){return this.numFilters=t,this}},{key:"getNumFilters",value:function(){return this.numFilters}},{key:"setPadding",value:function(t){return this.padding=t,this}},{key:"getPadding",value:function(){return this.padding}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"forward",value:function(t){for(var e=new u(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols),r=0;r<t.cols;r+=1){var n=m(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.padding,this.padding,this.stride,this.stride),o=this.Z=a(c(this.W,n),this.b.replicate(1,t.cols)).rollToColMatrix();e.setCol(r,o)}return this.Z=e,this.activation(this.Z),this.A}},{key:"activation",value:function(t){return v(t)}},{key:"derivative",value:function(t){return d(t)}},{key:"getType",value:function(){return P.conv}},{key:"loss",value:function(t,e){throw new Error("Unsupported.")}},{key:"error",value:function(t){throw new Error("Unsupported.")}}])&&be(e.prototype,r),f}(ye);function Se(t){return(Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ke(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function je(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Pe(t,e){return(Pe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _e(t,e){if(e&&("object"===Se(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ee(t){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Re=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pe(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ee(n);if(o){var r=Ee(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return _e(this,t)});function u(){return ke(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"configure",value:function(){}},{key:"transition",value:function(t){if(!t.is3D())throw new Error("Invalid usage. Cannot fully connect with previous 1D layer.");if(t.getType()!=P.maxpool)throw new Error("Invalid usage. Cannot fully connect with previous non maxpool layer.");return this.filterSize=t.getOutputWidth(),this.padding=0,this.stride=1,this.width=t.getOutputWidth(),this.height=t.getOutputHeight(),this.depth=t.getOutputDepth(),this.numFilters=t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth(),this}},{key:"setSize",value:function(t){throw new Error("Unsupported")}},{key:"setFilterSize",value:function(t){throw new Error("Unsupported")}},{key:"setStride",value:function(t){throw new Error("Unsupported")}},{key:"setPadding",value:function(t){throw new Error("Unsupported")}},{key:"setWidth",value:function(t){throw new Error("Unsupported")}},{key:"setHeight",value:function(t){throw new Error("Unsupported")}},{key:"setDepth",value:function(t){throw new Error("Unsupported")}},{key:"setNumFilters",value:function(t){throw new Error("Unsupported")}}])&&je(e.prototype,r),u}(Oe);function xe(t){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Te(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ze(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function We(t,e){return(We=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function De(t,e){if(e&&("object"===xe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Be(t){return(Be=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ce=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&We(t,e)}(c,t);var e,r,n,o,i=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Be(n);if(o){var r=Be(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return De(this,t)});function c(){return Te(this,c),i.apply(this,arguments)}return e=c,(r=[{key:"configure",value:function(){this.backPropagation=new X(this,this.previousLayer)}},{key:"getOutputHeight",value:function(){return(this.height-this.filterSize)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.width-this.filterSize)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.depth}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"forward",value:function(t){for(var e=new u(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols),r=0;r<t.cols;r+=1){var n=g(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.stride,this.stride).rollToColMatrix();e.setCol(r,n)}return this.Z=e,this.activation(this.Z),this.A}},{key:"activation",value:function(t){throw new Error("No activation for MAXPOOL layer.")}},{key:"derivative",value:function(t){throw new Error("No derivative for MAXPOOL layer.")}},{key:"getType",value:function(){return P.maxpool}},{key:"loss",value:function(t,e){throw new Error("Unsupported.")}},{key:"error",value:function(t){throw new Error("Unsupported.")}}])&&ze(e.prototype,r),c}(ye);function Le(t){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Me(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Fe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ae(t,e){return(Ae=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ne(t,e){if(e&&("object"===Le(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ke(t){return(Ke=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var He=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ae(t,e)}(c,t);var e,r,n,o,i,u=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ke(o);if(i){var r=Ke(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ne(this,t)});function c(){return Me(this,c),u.apply(this,arguments)}return e=c,n=[{key:"fromJSON",value:function(t){return new Promise((function(e,r){O.readFile(t,(function(t,n){if(t)r(t);else{var o=JSON.parse(n.toString()),i=new c(o.dimensions);o.layers.forEach((function(t){var e=null;"logistic"===t.type?e=Mt:"softmax"===t.type?e=Tt:"relu"===t.type?e=Qt:"softplus"===t.type?e=oe:"tanh"===t.type&&(e=Zt),i.createLayer(e,(function(e){e.setSize(t.dimensions)}))}));var u=i.getNetwork();u.getLayers().forEach((function(t,e){t.W=o.layers.W,t.b=o.layers.b})),e(u)}}))}))}}],(r=[{key:"firstLayerTransition",value:function(t){t.setWidth(this.dimensions[0])}}])&&Fe(e.prototype,r),n&&Fe(e,n),c}(st);function Ue(t){return(Ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ze(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ie(t,e){return(Ie=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Je(t,e){if(e&&("object"===Ue(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ve(t){return(Ve=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ge=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ie(t,e)}(c,t);var e,r,n,o,i,u=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ve(o);if(i){var r=Ve(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Je(this,t)});function c(){return Ze(this,c),u.apply(this,arguments)}return e=c,n=[{key:"fromJSON",value:function(t){return new Promise((function(e,r){O.readFile(t,(function(t,n){if(t)r(t);else{var o=JSON.parse(n.toString()),i=new c(o.dimensions);o.layers.forEach((function(t){var e=null;"logistic"===t.type?(e=Mt,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"softmax"===t.type?(e=Tt,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"relu"===t.type?(e=Qt,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"softplus"===t.type?(e=oe,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"tanh"===t.type?(e=Zt,i.createLayer(e,(function(e){e.setSize(t.dimensions)}))):"conv"===t.type?(e=Oe,i.createLayer(e,(function(e){e.setSize(t.dimensions),e.setFilterSize(t.filterSize),e.setStride(t.stride),e.setNumFilters(t.numFilters),e.setPadding(t.padding)}))):"maxpool"===t.type?(e=Ce,i.createLayer(e,(function(e){e.setSize(t.dimensions),e.setFilterSize(t.filterSize),e.setStride(t.stride)}))):"fullyconnected"===t.type&&(e=Ce,i.createLayer(e,(function(t){})))}));var u=i.getNetwork();u.getLayers().forEach((function(t,e){t.W=o.layers.W,t.b=o.layers.b})),e(u)}}))}))}}],(r=[{key:"firstLayerTransition",value:function(t){t.setSize(this.dimensions)}}])&&qe(e.prototype,r),n&&qe(e,n),c}(st);const Xe=require("csvtojson");function Qe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ye(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var $e=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ye(this,"exampleSize",0),Ye(this,"numberOfExamples",0),Ye(this,"data",null),this.exampleSize=e,this.numberOfExamples=r;for(var o=[],i=0;i<r;i+=1){o[i]=[];for(var c=0;c<e;c+=1)o[i][c]=n[i][c].length?Number(n[i][c]):NaN}this.data=new u(this.exampleSize,this.numberOfExamples,o)}var e,r;return e=t,(r=[{key:"exampleAt",value:function(t){return this.data.col(t)}},{key:"getNumberOfExamples",value:function(){return this.numberOfExamples}},{key:"getBatch",value:function(t,e){return this.data.block(0,t,this.data.rows,e)}}])&&Qe(e.prototype,r),t}();function tr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var er=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"fromCSV",value:function(t){return new Promise((function(e){Xe({noheader:!0,output:"csv"}).fromFile(t).then((function(t){var r=t.length,n=t[0].length,o=new $e(n,r,t);e(o)}))}))}}],null&&tr(e.prototype,null),r&&tr(e,r),t}();function rr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function nr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var or=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),nr(this,"batchSize",0),nr(this,"t",0),nr(this,"learningRate",0)}var e,r;return e=t,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"setT",value:function(t){return this.t=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}}])&&rr(e.prototype,r),t}();function ir(t){return(ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ur(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ar(t,e){return(ar=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function fr(t,e){if(e&&("object"===ir(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function sr(t){return(sr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var lr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ar(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=sr(n);if(o){var r=sr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return fr(this,t)});function u(){return ur(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.adam(t,this.learningRate,this.t)}},{key:"adam",value:function(t,e,r){var n=.9,o=.999;t.vW=a(h(t.vW,n),h(t.gW,1-n));var i=b(t.vW,1-Math.pow(n,r));t.cW=a(h(t.cW,n),h(t.gW,1-n));var u=w(h(t.cW,1-Math.pow(o,r)));t.W=f(t.W,h(y(i,u),e)),t.vb=a(h(t.vb,n),h(t.gb,1-n));var c=b(t.vb,1-Math.pow(n,r));t.cb=a(h(t.cb,o),h(y(t.gb,t.gb),1-o));var s=w(b(t.cb,1-Math.pow(o,r)));t.b=f(t.b,h(p(c,s),e))}}])&&cr(e.prototype,r),u}(or);function yr(t){return(yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function br(t,e){return(br=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function vr(t,e){if(e&&("object"===yr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dr(t){return(dr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var wr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&br(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=dr(n);if(o){var r=dr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return vr(this,t)});function u(){return hr(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.gradientDescent(t,this.learningRate)}},{key:"gradientDescent",value:function(t,e){t.W=f(t.W,h(t.gW,e)),t.b=f(t.b,h(t.gb,e))}}])&&pr(e.prototype,r),u}(or);function mr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function gr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Or(t){return(Or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Sr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function jr(t,e){return(jr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Pr(t,e){if(e&&("object"===Or(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _r(t)}function _r(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Er(t){return(Er=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Rr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var xr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Er(n);if(o){var r=Er(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Pr(this,t)});function u(){var t;Sr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Rr(_r(t=i.call.apply(i,[this].concat(r))),"batchSize",100),t}return e=u,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"train",value:function(t,e){var r=this,n=t.getNumberOfExamples(),o=(new Date).getTime(),i=0;this.optimizer.setBatchSize(this.batchSize);for(var u=0;u<this.iterations;u+=1){for(var c=(new Date).getTime(),a=0,f=0;a<n;a+=this.batchSize,f+=this.batchSize){var s=t.getBatch(f,this.batchSize),l=e.getBatch(f,this.batchSize),y=this.network.forward(s);if(this.network.backward(s,l,y,this.regularization),this.network.getLayers().forEach((function(t){r.optimizer.setT(++i),r.optimizer.optimize(t)})),this.verbose){var h=(new Date).getTime();console.log("Batch: ".concat(f+1," / ").concat(Math.ceil(n/this.batchSize)," | Time: ").concat(h-c," ms."))}}if(this.verbose&&(u+1)%this.verboseStep==0){var p=(new Date).getTime(),b=this.cost(t,e);console.log("Iteration: ".concat(u+1," | Cost: ").concat(b.cost," | Accuracy: ").concat(b.accuracy,"% | Time: ").concat(p-o," ms."))}"function"==typeof this.stepCallback&&this.stepCallback({iteration:u})}}}])&&kr(e.prototype,r),u}(function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),gr(this,"network",null),gr(this,"optimizer",null),gr(this,"regularization",0),gr(this,"iterations",1e3),gr(this,"learningRate",.1),gr(this,"verbose",!0),gr(this,"verboseStep",1),gr(this,"stepCallback",(function(){return null})),this.network=e,this.optimizer=r}var e,r;return e=t,(r=[{key:"setRegularization",value:function(t){return this.regularization=t,this}},{key:"setIterations",value:function(t){return this.iterations=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}},{key:"setVerbose",value:function(t){return this.verbose=t,this}},{key:"setVerboseStep",value:function(t){return this.verboseStep=t,this}},{key:"setStepCallback",value:function(t){return this.stepCallback=t,this}},{key:"cost",value:function(t,e){var r=100,n=t.getNumberOfExamples(),o=Math.ceil(n/r),i=0,u=0,c=0;this.network.getLayers().forEach((function(t){c+=t.penalty()}));for(var a=0,f=0;a<n;a+=r,f+=1){var s=this.network.forward(t.getBatch(f,r)),l=e.getBatch(f,r),y=l.cols,h=this.network.loss(l,s);i+=(this.network.error(y)*h+this.regularization*c/(2*y))/(o*(y/r));for(var p=0;p<s.cols;p+=1)s.colMaxCoeffIndex(p)==s.colMaxCoeffIndex(p)&&u++}return{cost:i,accuracy:(u-1)/n*100}}}])&&mr(e.prototype,r),t}());function Tr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var zr=function(){function t(e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(r="dataset")in this?Object.defineProperty(this,r,{value:null,enumerable:!0,configurable:!0,writable:!0}):this[r]=null,this.dataset=e}var e,r;return e=t,(r=[{key:"apply",value:function(){for(var t=0;t<this.dataset.getNumberOfExamples();t+=1)this.applyToExample(t);return this.dataset}}])&&Tr(e.prototype,r),t}();function Wr(t){return(Wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Br(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Cr(t,e){return(Cr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Lr(t,e){if(e&&("object"===Wr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Mr(t)}function Mr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Fr(t){return(Fr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ar(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Nr(t){return(Nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Kr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Hr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ur(t,e){return(Ur=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Zr(t,e){if(e&&("object"===Nr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function qr(t){return(qr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ir(t){return(Ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Gr(t,e){return(Gr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Xr(t,e){if(e&&("object"===Ir(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Qr(t)}function Qr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yr(t){return(Yr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $r(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var tn={Builder1D:He,Builder3D:Ge},en={Matrix:u,matrixMultiply:c,matrixSum:function(t){return t.sum()},matrixFillRandom:s,matrixElementWiseMultiply:y,matrixElementWiseDivide:p,matrixElementWiseAdd:a,matrixElementWiseSubtract:f},rn={SoftmaxLayer:Tt,LogisticLayer:Mt,ReluLayer:Qt,SoftplusLayer:oe,TanhLayer:Zt,ConvLayer:Oe,MaxPoolLayer:Ce,FullyConnectedLayer:Re},nn={DatasetBuilder:er},on={OptimizerAdam:lr,OptimizerGradientDescent:wr},un={MiniBatchTrainer:xr},cn={CallbackDatabaseModifier:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Cr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Fr(n);if(o){var r=Fr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Lr(this,t)});function u(){var t;Dr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Ar(Mr(t=i.call.apply(i,[this].concat(r))),"callback",(function(t){return t})),t}return e=u,(r=[{key:"applyToExample",value:function(t){for(var e=0;e<this.dataset.getNumberOfExamples();e+=1)for(var r=this.callback(this.dataset.exampleAt(e)),n=0;n<this.dataset.data.data.rows;n+=1)this.dataset.data.data[n][e]=r.data.data[n][0]}},{key:"setCallback",value:function(t){return this.callback=t,this}}])&&Br(e.prototype,r),u}(zr),MinMaxScalingDatabaseModifier:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ur(t,e)}(c,t);var e,r,n,o,u=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=qr(n);if(o){var r=qr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Zr(this,t)});function c(){return Kr(this,c),u.apply(this,arguments)}return e=c,(r=[{key:"applyToExample",value:function(t){for(var e=1/0,r=-1/0,n=0;n<this.dataset.getNumberOfExamples();n+=1)for(var o=this.dataset.exampleAt(n),u=0;u<o.rows;u+=1)e=Math.min(o.data[u][0]),r=Math.max(o.data[u][0]);var c=i.createKernel((function(t){return(t[this.thread.x][this.thread.y]-this.constants.min)/(this.constants.max-this.constants.min)})).setOutput([this.dataset.data.data.rows,this.dataset.data.data.cols]).setConstants({min:e,max:r});this.dataset.data.data=c(this.dataset.data.data)}}])&&Hr(e.prototype,r),c}(zr),MissingDataScalingDatabaseModifier:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Gr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Yr(n);if(o){var r=Yr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Xr(this,t)});function u(){var t;Jr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return $r(Qr(t=i.call.apply(i,[this].concat(r))),"modificationType","mean"),t}return e=u,(r=[{key:"applyToExample",value:function(t){for(var e=this,r=[],n=0,o=0,i=0,u=0;u<this.dataset.getNumberOfExamples();u+=1)for(var c=this.dataset.exampleAt(u),a=0;a<c.data.rows;a+=1)isNaN(c[a][0])?r.push({row:a,col:c}):(o+=c[a][0],n++);"mean"===this.modificationType&&(i=o/n),r.forEach((function(t){var r=t.row,n=t.col;e.dataset.data.data[r][n]=i}))}},{key:"setModificationType",value:function(t){return this.modificationType=t,this}}])&&Vr(e.prototype,r),u}(zr)};module.exports=e})();
//# sourceMappingURL=impulse-ts.js.map