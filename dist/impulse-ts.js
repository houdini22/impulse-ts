(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Computation:()=>Eo,Dataset:()=>To,DatasetBuilder:()=>ko,DatasetBuilderSource:()=>zo,DatasetModifier:()=>Ro,Layer:()=>jo,Math:()=>xo,NetworkBuilder:()=>So,Optimizer:()=>Po,Trainer:()=>_o});const r=require("fs");function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=function(){function t(){var e,r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r={},(e="kernels")in this?Object.defineProperty(this,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[e]=r}var e,r;return e=t,r=[{key:"addKernel",value:function(t,e){return this.kernels[t]=e,this}},{key:"execute",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.kernels[t].apply(null,r)}}],r&&n(e.prototype,r),t}();function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i(this,t),a(this,"rows",0),a(this,"cols",0),a(this,"data",null),this.resize(e,r),n&&this.generateData(n)}var e,r;return e=t,(r=[{key:"resize",value:function(t,e){this.rows=t,this.cols=e,this.data=[];for(var r=0;r<this.rows;r+=1)this.data[r]=new Array(this.cols);return this}},{key:"generateData",value:function(t){for(var e=[],r=0;r<this.rows;r+=1)e[r]=new Array(this.cols);for(var n=0;n<this.cols;n+=1)for(var o=0;o<this.rows;o+=1)"number"==typeof t[o]?e[o][n]=t[o]:t[o]instanceof Float32Array||t[o]&&"number"==typeof t[o][n]?e[o][n]=t[o][n]:e[o][n]=NaN;return this.data=e,this}},{key:"sum",value:function(){for(var t=0,e=0;e<this.rows;e+=1)for(var r=0;r<this.cols;r+=1)t+=this.data[e][r];return t}},{key:"colwiseSum",value:function(){for(var e=[],r=this.transpose(),n=0;n<r.rows;n+=1){e[n]=[0];for(var o=0;o<r.cols;o+=1)e[n][0]+=r.data[n][o]}return new t(this.rows,1,e)}},{key:"rowwiseSum",value:function(){for(var e=[[]],r=0;r<this.rows;r+=1){for(var n=0,o=0;o<this.cols;o+=1)n+=this.data[r][o];e[0].push(n)}return new t(1,this.rows,e)}},{key:"replicate",value:function(e,r){var n=this.data,o=[],i=null;if(1===e&&1===this.cols&&r>1){i=new t(this.rows,r);for(var u=0;u<this.rows;u+=1){o[u]=[];for(var a=0;a<r;a+=1)o[u][a]=n[u][0]}}else if(1===r&&1===this.rows&&e>1){i=new t(e,this.cols);for(var c=0;c<e;c+=1){o[c]=[];for(var f=0;f<this.cols;f+=1)o[c][f]=n[0][f]}}return i?(i.generateData(o),i):this}},{key:"transpose",value:function(){return A().execute("transpose",this)}},{key:"colMaxCoeffIndex",value:function(t){for(var e=-1,r=-1/0,n=0;n<this.rows;n+=1)this.data&&this.data[n][t]>r&&(r=this.data[n][t],e=n);return e}},{key:"block",value:function(e,r,n,o){for(var i=[],u=e,a=0;u<this.rows&&u<e+n;u+=1,a+=1){i[a]=new Array(o);for(var c=r,f=0;c<this.cols&&c<r+o;c+=1,f+=1)i[a][f]=this.data[u][c]}return new t(n,o,i)}},{key:"col",value:function(e){for(var r=[],n=0;n<this.rows;n+=1)r[n]=[this.data[n][e]];return new t(this.rows,1,r)}},{key:"setCol",value:function(t,e){for(var r=0;r<this.rows;r+=1)this.data&&e.data&&(this.data[r][t]=e.data[r][0]);return this}},{key:"rollToColMatrix",value:function(){for(var e=[],r=0,n=0;n<this.rows;n+=1){e[n]=[];for(var o=0;o<this.cols;o+=1)this.data&&(e[r++][0]=this.data[n][o])}return new t(this.rows*this.cols,1,e)}}])&&u(e.prototype,r),t}();function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}function l(t,e){if(e&&("object"===f(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},y(t)}var p=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)r[n][o]=t.data[n][o]/e.data[n][o]}return new c(t.rows,e.cols,r)},h=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)r[n][o]=t.data[n][o]/e}return new c(t.rows,t.cols,r)},b=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)e[r][n]=Math.exp(t.data[r][n])}var o=new c(t.rows,t.cols,e),i=new c(1,t.cols,o.colwiseSum().data).replicate(t.rows,1);return new c(t.rows,t.cols,p(o,i).data)},d=function(t,e){for(var r=[],n=0;n<e.rows;n+=1){r[n]=[];for(var o=0;o<e.cols;o+=1)r[n][o]=Math.log(e.data[n][o]+1e-8)}return new c(t.rows,t.cols,C(t,new c(t.rows,t.cols,r)).data).sum()},v=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)e[r][n]=1/(1+Math.exp(-t.data[r][n]))}return new c(t.rows,t.cols,e)},w=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)e[r][n]=t.data[r][n]*(1-t.data[r][n])}return new c(t.rows,t.cols,e)},m=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=Math.log(t.data[n][o]+1e-8))}for(var i=new c(t.rows,t.cols,r),u=[],a=0;a<t.rows;a+=1){u[a]=[];for(var f=0;f<t.cols;f+=1)t.data&&(u[a][f]=1-t.data[a][f])}for(var s=new c(t.rows,t.cols,u),l=[],y=0;y<e.rows;y+=1){l[y]=[];for(var p=0;p<e.cols;p+=1)e.data&&(l[y][p]=Math.log(1-e.data[y][p]+1e-8))}var h=new c(e.rows,e.cols,l);return z(C(M(t,-1),i),C(s,h)).sum()},g=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=2/(1+Math.exp(-2*t.data[r][n]))-1)}return new c(t.rows,t.cols,e)},O=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=1-Math.pow(2/(1+Math.exp(-2*t.data[r][n]))-1,2))}return new c(t.rows,t.cols,e)},S=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.max(0,t.data[r][n]))}return new c(t.rows,t.cols,e)},x=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=t.data[r][n]>0?1:0)}return new c(t.rows,t.cols,e)},j=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.log(1+Math.exp(t.data[r][n])))}return new c(t.rows,t.cols,e)},k=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=1/(1+Math.exp(-Math.log(1+Math.exp(t.data[r][n])))))}return new c(t.rows,t.cols,e)},P=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.pow(t.data[r][n],2))}return new c(t.rows,t.cols,e).sum()},_=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.sqrt(t.data[r][n]+1e-8))}return new c(t.rows,t.cols,e)},R=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=t.data[n][o]-Math.pow(e[n][o],2))}return new c(t.rows,t.cols,r).sum()},E=function(t,e){if(t.cols!==e.rows)throw new Error("DIMENSIONS error. m1.cols ".concat(t.cols," !== m2.rows ").concat(e.rows,"."));for(var r=[],n=0;n<t.rows;++n){r[n]=new Array(e.cols);for(var o=0;o<e.cols;++o){r[n][o]=0;for(var i=0;i<t.cols;++i)t.data&&e.data&&(r[n][o]+=t.data[n][i]*e.data[i][o])}}return new c(t.rows,e.cols,r)},T=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&e.data&&(r[n][o]=t.data[n][o]+e.data[n][o])}return new c(t.rows,t.cols,r)},z=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal: m1.rows ".concat(t.rows," !== m2.rows ").concat(e.rows));if(t.cols!==e.cols)throw new Error("COLS number not equal: m1.cols ".concat(t.cols," !== m2.cols ").concat(e.cols));for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&e.data&&(r[n][o]=t.data[n][o]-e.data[n][o])}return new c(t.rows,t.cols,r)},W=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)r[n][o]=(4*Math.random()-2)*Math.sqrt(2/e)}return new c(t.rows,t.cols,r)},D=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)e[r][n]=0}return new c(t.rows,t.cols,e)},C=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal: m1.rows ".concat(t.rows," !== m2.rows ").concat(e.rows));if(t.cols!==e.cols)throw new Error("COLS number not equal: m1.cols ".concat(t.cols," !== m2.cols ").concat(e.cols));for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&e.data&&(r[n][o]=t.data[n][o]*e.data[n][o])}return new c(t.rows,t.cols,r)},M=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=t.data[n][o]*e)}return new c(t.rows,t.cols,r)},L=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=Math.pow(t.data[n][o],e))}return new c(t.rows,t.cols,r)},K=function(t){for(var e=[],r=0;r<t.cols;r+=1){e[r]=[];for(var n=0;n<t.rows;n+=1)t.data&&(e[r][n]=t.data[n][r])}return new c(t.cols,t.rows,e)},B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(o,t);var e,r,n=(e=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=y(e);if(r){var o=y(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return l(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this)).addKernel("multiply",E),t.addKernel("add",T),t.addKernel("subtract",z),t.addKernel("fillRandom",W),t.addKernel("fillZeros",D),t.addKernel("elementWiseMultiply",C),t.addKernel("multiplyNumber",M),t.addKernel("elementWiseDivide",p),t.addKernel("divideNumber",h),t.addKernel("softmaxActivation",b),t.addKernel("softmaxLoss",d),t.addKernel("logisticActivation",v),t.addKernel("logisticDerivative",w),t.addKernel("logisticLoss",m),t.addKernel("tanhActivation",g),t.addKernel("tanhDerivative",O),t.addKernel("reluActivation",S),t.addKernel("reluDerivative",x),t.addKernel("softplusActivation",j),t.addKernel("softplusDerivative",k),t.addKernel("penalty",P),t.addKernel("sqrt",_),t.addKernel("purelinLoss",R),t.addKernel("transpose",K),t.addKernel("pow",L),t}return o}(o),N=new B,A=function(){return N};function F(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Z(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const q=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Z(this,"dimensions",null),Z(this,"size",0),Z(this,"layers",[]),this.dimensions=e}var e,n;return e=t,(n=[{key:"addLayer",value:function(t){return this.size++,this.layers.push(t),this}},{key:"getLayers",value:function(){return this.layers}},{key:"forward",value:function(t){var e=t;return this.layers.forEach((function(t){e=t.forward(e)})),e}},{key:"backward",value:function(t,e,r,n){for(var o=t.cols,i=A().execute("subtract",r,e),u=this.layers.length-1;u>=0;u-=1){var a=this.layers[u].getBackPropagation();a&&(i=a.propagate(t,o,n,i))}}},{key:"loss",value:function(t,e){return this.layers[this.layers.length-1].loss(t,e)}},{key:"error",value:function(t){return this.layers[this.layers.length-1].error(t)}},{key:"save",value:function(t){var e={dimensions:this.dimensions,layers:[]};this.layers.forEach((function(t){e.layers.push({type:t.getType(),size:t.getSize(),weights:{W:t.W.data,b:t.b.data}})}));var n=JSON.stringify(e);return new Promise((function(e,o){r.writeFile(t,n,(function(t){t&&(console.error(t),o()),e(n)}))}))}}])&&F(e.prototype,n),t}();var H;function U(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}!function(t){t.logistic="logistic",t.softmax="softmax",t.tanh="tanh",t.relu="relu",t.softplus="softplus",t.conv="conv",t.maxpool="maxpool",t.fullyconnected="fullyconnected",t.purelin="purelin"}(H||(H={}));var Q=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),U(this,"layer",null),U(this,"previousLayer",null),this.layer=e,this.previousLayer=r};function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function J(t,e){return J=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},J(t,e)}function V(t,e){if(e&&("object"===I(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function G(t){return G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},G(t)}var X=new(require("gpu.js").GPU)({mode:"gpu"}),Y=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=X.createKernel((function(t,e){return t[this.thread.x][this.thread.y]/e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new c(t.rows,t.cols,r(t.data,e.data))},$=function(t,e){var r=X.createKernel((function(t){return t[this.thread.x][this.thread.y]/this.constants.number})).setOutput([t.rows,t.cols]).setConstants({number:e});return new c(t.rows,t.cols,r(t.data))},tt=function(t){var e=X.createKernel((function(t){return Math.exp(t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]),r=new c(t.rows,t.cols,e(t.data)),n=new c(1,t.cols,r.colwiseSum().data).replicate(t.rows,1);return new c(t.rows,t.cols,Y(r,n).data)},et=function(t,e){var r=X.createKernel((function(t){return Math.log(t[this.thread.x][this.thread.y])})).setOutput([e.rows,e.cols]);return new c(t.rows,t.cols,mt(t,new c(t.rows,t.cols,r(e.data))).data).sum()},rt=function(t){var e=X.createKernel((function(t){return 1/(1+Math.exp(-t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new c(t.rows,t.cols,e(t.data))},nt=function(t){var e=X.createKernel((function(t){return t[this.thread.x][this.thread.y]*(1-t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]);return new c(t.rows,t.cols,e(t.data))},ot=function(t,e){var r=X.createKernel((function(t){return Math.log(t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]),n=X.createKernel((function(t){return 1-t[this.thread.x][this.thread.y]})).setOutput([t.rows,t.cols]),o=X.createKernel((function(t){return Math.log(1-t[this.thread.x][this.thread.y])})).setOutput([e.rows,e.cols]);return bt(mt(t,new c(t.rows,t.cols,r(t.data))),mt(new c(t.rows,t.cols,n(t.data)),new c(e.rows,e.cols,o(e.data)))).sum()},it=function(t){var e=X.createKernel((function(t){return 2/(1+Math.exp(-2*t[this.thread.x][this.thread.y]))-1})).setOutput([t.rows,t.cols]);return new c(t.rows,t.cols,e(t.data))},ut=function(t){var e=X.createKernel((function(t){return 1-Math.pow(2/(1+Math.exp(-2*t[this.thread.x][this.thread.y]))-1,2)})).setOutput([t.rows,t.cols]);return new c(t.rows,t.cols,e(t.data))},at=function(t){var e=X.createKernel((function(t){return Math.max(0,t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]);return new c(t.rows,t.cols,e(t.data))},ct=function(t){var e=X.createKernel((function(t){return t[this.thread.x][this.thread.y]>0?1:0})).setOutput([t.rows,t.cols]);return new c(t.rows,t.cols,e(t.data))},ft=function(t){var e=X.createKernel((function(t){return Math.log(1+Math.exp(t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new c(t.rows,t.cols,e(t.data))},st=function(t){var e=X.createKernel((function(t){return 1/(1+Math.exp(-t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new c(t.rows,t.cols,e(t.data))},lt=function(t){var e=X.createKernel((function(t){return Math.pow(t[this.thread.x][this.thread.y],2)})).setOutput([t.rows,t.cols]);return new c(t.rows,t.cols,e(t.data)).sum()},yt=function(t){var e=X.createKernel((function(t){return Math.sqrt(t[this.thread.x][this.thread.y]+1e-8)})).setOutput([t.rows,t.cols]);return new c(t.rows,t.cols,e(t.data))},pt=function(t,e){var r=X.createKernel((function(t,e){return e[this.thread.x][this.thread.y]-Math.pow(t[this.thread.x][this.thread.y],2)})).setOutput([t.rows,t.cols]);return new c(t.rows,t.cols,r(t.data)).sum()},ht=function(t,e){if(t.cols!==e.rows)throw new Error("DIMENSIONS error. m1.cols ".concat(t.cols," !== m2.rows ").concat(e.rows,"."));var r=X.createKernel((function(t,e){for(var r=0,n=0;n<this.constants.cols;n++)r+=t[this.thread.x][n]*e[n][this.thread.y];return r})).setOutput([t.rows,e.cols]).setConstants({cols:t.rows});return new c(t.rows,e.cols,r(t.data,e.data))},bt=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=X.createKernel((function(t,e){return t[this.thread.x][this.thread.y]+e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new c(t.rows,e.cols,r(t.data,e.data))},dt=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=X.createKernel((function(t,e){return t[this.thread.x][this.thread.y]-e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new c(t.rows,e.cols,r(t.data,e.data))},vt=function(t,e){var r=X.createKernel((function(){return Math.random()-.5})).setOutput([t.rows,t.cols]).setConstants({parameter:e});return new c(t.rows,t.cols,r())},wt=function(t){var e=X.createKernel((function(){return 0})).setOutput([t.rows,t.cols]);return new c(t.rows,t.cols,e())},mt=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=X.createKernel((function(t,e){return t[this.thread.x][this.thread.y]*e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new c(t.rows,e.cols,r(t.data,e.data))},gt=function(t,e){var r=X.createKernel((function(t){return t[this.thread.x][this.thread.y]*this.constants.number})).setOutput([t.rows,t.cols]).setConstants({number:e});return new c(t.rows,t.cols,r(t.data))},Ot=function(t){var e=X.createKernel((function(t){return t[this.thread.y][this.thread.x]})).setOutput([t.cols,t.rows]);return new c(t.cols,t.rows,e(t.data))},St=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&J(t,e)}(o,t);var e,r,n=(e=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=G(e);if(r){var o=G(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return V(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this)).addKernel("multiply",ht),t.addKernel("add",bt),t.addKernel("subtract",dt),t.addKernel("fillRandom",vt),t.addKernel("fillZeros",wt),t.addKernel("elementWiseMultiply",mt),t.addKernel("multiplyNumber",gt),t.addKernel("elementWiseDivide",Y),t.addKernel("divideNumber",$),t.addKernel("softmaxActivation",tt),t.addKernel("softmaxLoss",et),t.addKernel("logisticActivation",rt),t.addKernel("logisticDerivative",nt),t.addKernel("logisticLoss",ot),t.addKernel("tanhActivation",it),t.addKernel("tanhDerivative",ut),t.addKernel("reluActivation",at),t.addKernel("reluDerivative",ct),t.addKernel("softplusActivation",ft),t.addKernel("softplusDerivative",st),t.addKernel("penalty",lt),t.addKernel("sqrt",yt),t.addKernel("purelinLoss",pt),t.addKernel("transpose",Ot),t}return o}(o);function xt(t){return xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xt(t)}function jt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Pt(t,e){return Pt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Pt(t,e)}function _t(t,e){if(e&&("object"===xt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Rt(t){return Rt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Rt(t)}var Et=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Rt(n);if(o){var r=Rt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return _t(this,t)});function u(){return jt(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){var o=null!==this.previousLayer?this.previousLayer.A:t,i=A().execute("multiply",n,o.transpose());return this.layer.gW=A().execute("add",A().execute("divideNumber",i,e),A().execute("multiplyNumber",this.layer.W,r/e)),this.layer.gb=A().execute("divideNumber",n.rowwiseSum().transpose(),e),null!==this.previousLayer?A().execute("elementWiseMultiply",A().execute("multiply",this.layer.W.transpose(),n),this.previousLayer.derivative(this.previousLayer.A)):new c}}])&&kt(e.prototype,r),u}(Q);function Tt(t){return Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tt(t)}function zt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Wt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Dt(t,e){return Dt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Dt(t,e)}function Ct(t,e){if(e&&("object"===Tt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Mt(t){return Mt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Mt(t)}var Lt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Dt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Mt(n);if(o){var r=Mt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ct(this,t)});function u(){return zt(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){return n}}])&&Wt(e.prototype,r),u}(Q);function Kt(t){return Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kt(t)}function Bt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Nt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function At(t,e){return At=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},At(t,e)}function Ft(t,e){if(e&&("object"===Kt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Zt(t)}function Zt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function qt(t){return qt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},qt(t)}function Ht(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Ut=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&At(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=qt(n);if(o){var r=qt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ft(this,t)});function u(){var t;Bt(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Ht(Zt(t=i.call.apply(i,[this].concat(r))),"previousLayer",null),t}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){var o=this.previousLayer;if(o){for(var i=A().execute("fillZeros",new c(o.Z.rows,o.Z.cols)),u=o.getFilterSize(),a=o.getStride(),f=o.getWidth(),s=o.getHeight(),l=(o.getDepth(),o.getOutputWidth()),y=o.getOutputHeight(),p=o.getOutputDepth(),h=0;h<e;h++)for(var b=0;b<p;b++)for(var d=0;d<y;d++)for(var v=0;v<l;v++){for(var w=a*v,m=-1/0,g=s*f*b,O=y*l*b,S=0,x=0,j=0,k=a*d;j<u;j++,k++)for(var P=0,_=w;P<u;P++,_++)o.Z.data&&m<o.Z.data[g+k*f+_][h]&&(m=o.Z.data[g+k*f+_][h],S=_,x=k);i.data&&n.data&&(i.data[g+x*f+S][h]=n.data[O+d*l+v][h])}return i}return new c}}])&&Nt(e.prototype,r),u}(Q);function Qt(t){return Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qt(t)}function It(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Vt(t,e){return Vt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Vt(t,e)}function Gt(t,e){if(e&&("object"===Qt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Xt(t)}function Xt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yt(t){return Yt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Yt(t)}function $t(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var te=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Yt(n);if(o){var r=Yt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Gt(this,t)});function u(){var t;It(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return $t(Xt(t=i.call.apply(i,[this].concat(r))),"previousLayer",null),t}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){var o=this.previousLayer;if(o){var i=o.getPadding(),u=o.getStride(),a=o.getFilterSize(),f=o.getOutputWidth(),s=o.getOutputHeight(),l=o.getOutputDepth(),y=o.getWidth(),p=o.getHeight(),h=o.getDepth(),b=A().execute("fillZeros",new c((y+2*i)*(p+2*i)*h,e)),d=new c(y*p*h,e);o.derivative(o.A),o.gW=A().execute("fillZeros",o.gW),o.gb=A().execute("fillZeros",o.gb);for(var v=0;v<e;v++){for(var w=0;w<l;w++)for(var m=0;m<s;m++)for(var g=0;g<f;g++){for(var O=u*m,S=u*g,x=0;x<h;x++)for(var j=0,k=O,P=-i;j<a;j++,k++,P++)for(var _=0,R=S,E=-i;_<a;_++,R++,E++){o.W.data&&b.data&&n.data&&(b.data[x*(y+2*i)*(p+2*i)+k*(y+2*i)+R][v]+=o.W.data[w][x*a*a+j*a+_]*n.data[w*f*s+m*f+g][v]);var T=0;0==i?o.Z.data&&(T=o.Z.data[x*y*p+k*y+R][v]):P>=0&&E>=0&&P<p&&E<y&&o.Z.data&&(T=o.Z.data[x*y*p+P*y+E][v]),o.gW.data&&n.data&&(o.gW.data[w][x*a*a+j*a+_]+=T*n.data[w*(f*s)+m*f+g][v]/e)}o.gb.data&&n.data&&(o.gb.data[w][0]+=n.data[w*(f*s)+m*f+g][v]/e)}if(i>0)for(var z=0;z<h;z++)for(var W=-i,D=0;W<p+i;W++,D++)for(var C=-i,M=0;C<y+i;C++,M++)C>=0&&W>=0&&C<y&&W<p&&d.data&&b.data&&(d.data[z*y*p+W*y+C][v]=b.data[z*(y+2*i)*(p+2*i)+D*(y+2*i)+M][v])}return i>0?d:b}}}])&&Jt(e.prototype,r),u}(Q);function ee(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var re=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"create",value:function(t,e){if(null==t){if(e.is1D())return new Et(e,t);if(e.getType()==H.conv)return new Lt(e,t)}else{if(t.getType()==H.maxpool)return new Ut(e,t);if(t.getType()==H.conv)return new te(e,t);if(t.is1D()||t.getType()==H.fullyconnected)return new Et(e,t)}return null}}],null&&ee(e.prototype,null),r&&ee(e,r),t}();function ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function oe(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ie=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),oe(this,"dimensions",null),oe(this,"lastLayer",null),oe(this,"network",null),this.dimensions=e,this.network=new q(e)}var e,r;return e=t,r=[{key:"createLayer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.network){var r=new t;"function"==typeof e&&e(r),null===this.lastLayer?this.firstLayerTransition(r):r.transition(this.lastLayer),r.configure(),r.setBackPropagation(re.create(this.lastLayer,r)),this.network.addLayer(r),this.lastLayer=r}return this}},{key:"getNetwork",value:function(){return this.network}}],r&&ne(e.prototype,r),t}();function ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ae(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ce=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ae(this,"width",0),ae(this,"height",0),ae(this,"depth",0),ae(this,"previousLayer",null),ae(this,"backPropagation",null),this.W=new c,this.b=new c,this.A=new c,this.Z=new c,this.gW=new c,this.gb=new c,this.vW=new c,this.cW=new c,this.vb=new c,this.cb=new c}var e,r;return e=t,(r=[{key:"setBackPropagation",value:function(t){return this.backPropagation=t,this}},{key:"getBackPropagation",value:function(){return this.backPropagation}},{key:"forward",value:function(t){return this.Z=A().execute("add",A().execute("multiply",this.W,t),this.b.replicate(1,t.cols)),this.A=this.activation(this.Z),this.A}},{key:"setWidth",value:function(t){return this.width=t,this}},{key:"getWidth",value:function(){return this.width}},{key:"setHeight",value:function(t){return this.height=t,this}},{key:"getHeight",value:function(){return this.height}},{key:"setDepth",value:function(t){return this.depth=t,this}},{key:"getDepth",value:function(){return this.depth}},{key:"transition",value:function(t){return this.previousLayer=t,this}},{key:"penalty",value:function(){return A().execute("penalty",this.W)}}])&&ue(e.prototype,r),t}();function fe(t){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fe(t)}function se(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function le(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ye(t,e,r){return ye="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=de(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}},ye(t,e,r||t)}function pe(t,e){return pe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},pe(t,e)}function he(t,e){if(e&&("object"===fe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return be(t)}function be(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function de(t){return de=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},de(t)}function ve(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var we=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pe(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=de(n);if(o){var r=de(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return he(this,t)});function u(){var t;se(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return ve(be(t=i.call.apply(i,[this].concat(r))),"depth",1),t}return e=u,(r=[{key:"configure",value:function(){this.W.resize(this.height,this.width),this.W=A().execute("fillRandom",this.W,this.width),this.b.resize(this.height,1),this.b=A().execute("fillRandom",this.b,this.width),this.gW.resize(this.height,this.width),this.gW=A().execute("fillZeros",this.gW),this.gb.resize(this.height,1),this.gb=A().execute("fillZeros",this.gb),this.cW.resize(this.height,this.width),this.cW=A().execute("fillZeros",this.cW),this.cb.resize(this.height,1),this.cb=A().execute("fillZeros",this.cb),this.vW.resize(this.height,this.width),this.vW=A().execute("fillZeros",this.vW),this.vb.resize(this.height,1),this.vb=A().execute("fillZeros",this.cb)}},{key:"is1D",value:function(){return!0}},{key:"is3D",value:function(){return!1}},{key:"transition",value:function(t){return t.is1D()?this.setWidth(t.getSize()):t.is3D()&&this.setWidth(t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth()),ye(de(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){return this.setHeight(t),this}},{key:"getSize",value:function(){return this.height}},{key:"getOutputWidth",value:function(){return this.width}},{key:"getOutputHeight",value:function(){return this.height}},{key:"getOutputDepth",value:function(){return 1}}])&&le(e.prototype,r),u}(ce);function me(t){return me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},me(t)}function ge(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Oe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Se(t,e){return Se=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Se(t,e)}function xe(t,e){if(e&&("object"===me(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function je(t){return je=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},je(t)}var ke=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Se(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=je(n);if(o){var r=je(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return xe(this,t)});function u(){return ge(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return A().execute("softmaxActivation",t)}},{key:"derivative",value:function(t){throw new Error("Unsupported usage.")}},{key:"getType",value:function(){return H.softmax}},{key:"loss",value:function(t,e){return A().execute("softmaxLoss",t,e)}},{key:"error",value:function(t){return-1/t}}])&&Oe(e.prototype,r),u}(we);function Pe(t){return Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pe(t)}function _e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Re(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ee(t,e){return Ee=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ee(t,e)}function Te(t,e){if(e&&("object"===Pe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ze(t){return ze=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ze(t)}var We=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ee(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ze(n);if(o){var r=ze(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Te(this,t)});function u(){return _e(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return A().execute("logisticActivation",t)}},{key:"derivative",value:function(t){return A().execute("logisticDerivative",t)}},{key:"getType",value:function(){return H.logistic}},{key:"loss",value:function(t,e){return A().execute("logisticLoss",t,e)}},{key:"error",value:function(t){return 1/t}}])&&Re(e.prototype,r),u}(we);function De(t){return De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},De(t)}function Ce(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Me(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Le(t,e){return Le=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Le(t,e)}function Ke(t,e){if(e&&("object"===De(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Be(t){return Be=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Be(t)}var Ne=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Le(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Be(n);if(o){var r=Be(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ke(this,t)});function u(){return Ce(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return A().execute("tanhActivation",t)}},{key:"derivative",value:function(t){return A().execute("tanhDerivative",t)}},{key:"getType",value:function(){return H.tanh}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}}])&&Me(e.prototype,r),u}(we);function Ae(t){return Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ae(t)}function Fe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ze(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function qe(t,e){return qe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},qe(t,e)}function He(t,e){if(e&&("object"===Ae(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ue(t){return Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ue(t)}var Qe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qe(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ue(n);if(o){var r=Ue(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return He(this,t)});function u(){return Fe(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return A().execute("reluActivation",t)}},{key:"derivative",value:function(t){return A().execute("reluDerivative",t)}},{key:"getType",value:function(){return H.relu}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}}])&&Ze(e.prototype,r),u}(we);function Ie(t){return Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ie(t)}function Je(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ve(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ge(t,e){return Ge=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ge(t,e)}function Xe(t,e){if(e&&("object"===Ie(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ye(t){return Ye=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ye(t)}var $e=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ge(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ye(n);if(o){var r=Ye(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Xe(this,t)});function u(){return Je(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return A().execute("softplusActivation",t)}},{key:"derivative",value:function(t){return A().execute("softplusDerivative",t)}},{key:"getType",value:function(){return H.softplus}},{key:"loss",value:function(t,e){return 0}},{key:"error",value:function(t){return 0}}])&&Ve(e.prototype,r),u}(we),tr=function(t,e,r,n,o,i,u,a,f,s){for(var l=i*o*e,y=((n-i+2*a)/s+1)*((r-o+2*u)/f+1),p=0,h=A().execute("fillZeros",new c(l,y)),b=-u;b+o<=r+u;b+=f)for(var d=-a;d+i<=n+a;d+=s){for(var v=0,w=0;w<e;w++)for(var m=r*n*w,g=0;g<o;g++)for(var O=0;O<i;O++)b+g>=0&&d+O>=0&&d+O<n&&b+g<r&&h.data&&t.data&&h.data[v]&&(h.data[v][p]=t.data[(g+b)*n+d+O+m][0]),v++;p++}return h},er=function(t,e,r,n,o,i,u,a){for(var f=(n-i)/a+1,s=(r-o)/u+1,l=e,y=0,p=A().execute("fillZeros",new c(f*s*l,1)),h=0;h+o<=r;h+=u)for(var b=0;b+i<=n;b+=a){for(var d=0;d<e;d++){for(var v=-1/0,w=r*n*d,m=f*s*d,g=0;g<o;g++)for(var O=0;O<i;O++)v=Math.max(v,t.data[w+(g+h)*n+b+O][0]);p.data&&(p.data[m+y][0]=v)}y++}return new c},rr=function(t,e){return Math.round((t+Number.EPSILON)*Math.pow(10,e))/Math.pow(10,e)};function nr(t){return nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nr(t)}function or(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ir(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ur(t,e,r){return ur="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=fr(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}},ur(t,e,r||t)}function ar(t,e){return ar=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ar(t,e)}function cr(t,e){if(e&&("object"===nr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function fr(t){return fr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},fr(t)}var sr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ar(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=fr(n);if(o){var r=fr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return cr(this,t)});function u(){return or(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"configure",value:function(){}},{key:"is1D",value:function(){return!1}},{key:"is3D",value:function(){return!0}},{key:"transition",value:function(t){return t.is3D()&&this.setSize([t.getOutputWidth(),t.getOutputHeight(),t.getOutputDepth()]),ur(fr(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){return this.setWidth(t[0]),this.setHeight(t[1]),this.setDepth(t[2]),this}},{key:"getSize",value:function(){return[this.getWidth(),this.getHeight(),this.getDepth()]}}])&&ir(e.prototype,r),u}(ce);function lr(t){return lr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lr(t)}function yr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function hr(t,e){return hr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},hr(t,e)}function br(t,e){if(e&&("object"===lr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return dr(t)}function dr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function vr(t){return vr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},vr(t)}function wr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var mr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&hr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=vr(n);if(o){var r=vr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return br(this,t)});function u(){var t;yr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return wr(dr(t=i.call.apply(i,[this].concat(r))),"numFilters",32),wr(dr(t),"filterSize",4),wr(dr(t),"padding",1),wr(dr(t),"stride",1),t}return e=u,(r=[{key:"configure",value:function(){this.W.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.W=A().execute("fillRandom",this.W,this.width*this.height*this.depth),this.b.resize(this.numFilters,1),this.b=A().execute("fillRandom",this.b,.01),this.gW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.gW=A().execute("fillZeros",this.gW),this.gb.resize(this.numFilters,1),this.gb=A().execute("fillZeros",this.gb),this.cW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.cW=A().execute("fillZeros",this.gb),this.cb.resize(this.numFilters,1),this.cb=A().execute("fillZeros",this.cb),this.vW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.vW=A().execute("fillZeros",this.vW),this.vb.resize(this.numFilters,1),this.vb=A().execute("fillZeros",this.vb)}},{key:"getOutputHeight",value:function(){return(this.width-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.height-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.numFilters}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setNumFilters",value:function(t){return this.numFilters=t,this}},{key:"getNumFilters",value:function(){return this.numFilters}},{key:"setPadding",value:function(t){return this.padding=t,this}},{key:"getPadding",value:function(){return this.padding}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"forward",value:function(t){for(var e=new c(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols),r=0;r<t.cols;r+=1){var n=tr(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.padding,this.padding,this.stride,this.stride),o=A().execute("add",A().execute("multiply",this.W,n),this.b.replicate(1,t.cols));e.setCol(r,o.rollToColMatrix())}return this.Z=e,this.activation(this.Z),this.A}},{key:"activation",value:function(t){return A().execute("reluActivation",t)}},{key:"derivative",value:function(t){return A().execute("reluDerivative",t)}},{key:"getType",value:function(){return H.conv}},{key:"loss",value:function(t,e){throw new Error("Unsupported.")}},{key:"error",value:function(t){throw new Error("Unsupported.")}}])&&pr(e.prototype,r),u}(sr);function gr(t){return gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gr(t)}function Or(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function xr(t,e){return xr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},xr(t,e)}function jr(t,e){if(e&&("object"===gr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function kr(t){return kr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},kr(t)}var Pr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=kr(n);if(o){var r=kr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return jr(this,t)});function u(){return Or(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"configure",value:function(){}},{key:"transition",value:function(t){if(!t.is3D())throw new Error("Invalid usage. Cannot fully connect with previous 1D Layer.");if(t.getType()!=H.maxpool)throw new Error("Invalid usage. Cannot fully connect with previous non maxpool Layer.");return this.filterSize=t.getOutputWidth(),this.padding=0,this.stride=1,this.width=t.getOutputWidth(),this.height=t.getOutputHeight(),this.depth=t.getOutputDepth(),this.numFilters=t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth(),this}},{key:"setSize",value:function(t){return this}},{key:"setFilterSize",value:function(t){return this}},{key:"setStride",value:function(t){return this}},{key:"setPadding",value:function(t){return this}},{key:"setWidth",value:function(t){return this}},{key:"setHeight",value:function(t){return this}},{key:"setDepth",value:function(t){return this}},{key:"setNumFilters",value:function(t){return this}}])&&Sr(e.prototype,r),u}(mr);function _r(t){return _r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_r(t)}function Rr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Er(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Tr(t,e){return Tr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Tr(t,e)}function zr(t,e){if(e&&("object"===_r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Wr(t)}function Wr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Dr(t){return Dr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Dr(t)}function Cr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Mr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Tr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Dr(n);if(o){var r=Dr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return zr(this,t)});function u(){var t;Rr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Cr(Wr(t=i.call.apply(i,[this].concat(r))),"filterSize",0),Cr(Wr(t),"stride",0),t}return e=u,(r=[{key:"configure",value:function(){}},{key:"getOutputHeight",value:function(){return(this.height-this.filterSize)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.width-this.filterSize)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.depth}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"getPadding",value:function(){return 0}},{key:"forward",value:function(t){for(var e=new c(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols),r=0;r<t.cols;r+=1){var n=er(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.stride,this.stride).rollToColMatrix();e.setCol(r,n)}return this.Z=e,this.activation(this.Z),this.A}},{key:"activation",value:function(t){throw new Error("No activation for MAXPOOL Layer.")}},{key:"derivative",value:function(t){throw new Error("No derivative for MAXPOOL Layer.")}},{key:"getType",value:function(){return H.maxpool}},{key:"loss",value:function(t,e){throw new Error("Unsupported.")}},{key:"error",value:function(t){throw new Error("Unsupported.")}}])&&Er(e.prototype,r),u}(sr);function Lr(t){return Lr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lr(t)}function Kr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Br(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Nr(t,e){return Nr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Nr(t,e)}function Ar(t,e){if(e&&("object"===Lr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Fr(t){return Fr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Fr(t)}var Zr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Nr(t,e)}(f,t);var e,n,o,i,u,a=(i=f,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Fr(i);if(u){var r=Fr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ar(this,t)});function f(){return Kr(this,f),a.apply(this,arguments)}return e=f,o=[{key:"fromJSON",value:function(t){return new Promise((function(e,n){r.readFile(t,(function(t,r){if(t)n(t);else{var o=JSON.parse(r.toString()),i=new f(o.dimensions);o.layers.forEach((function(t){var e=null;"logistic"===t.type?e=We:"softmax"===t.type?e=ke:"relu"===t.type?e=Qe:"softplus"===t.type?e=$e:"tanh"===t.type&&(e=Ne),i.createLayer(e,(function(e){e.setSize(t.size)}))}));var u=i.getNetwork();u&&(u.getLayers().forEach((function(t,e){t.W=new c(o.layers[e].weights.W.length,o.layers[e].weights.W[0].length,o.layers[e].weights.W),t.b=new c(o.layers[e].weights.b.length,o.layers[e].weights.b[0].length,o.layers[e].weights.b)})),e(u))}}))}))}}],(n=[{key:"firstLayerTransition",value:function(t){t.setWidth(this.dimensions[0])}}])&&Br(e.prototype,n),o&&Br(e,o),f}(ie);function qr(t){return qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qr(t)}function Hr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ur(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Qr(t,e){return Qr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Qr(t,e)}function Ir(t,e){if(e&&("object"===qr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Jr(t){return Jr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Jr(t)}var Vr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Qr(t,e)}(c,t);var e,n,o,i,u,a=(i=c,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Jr(i);if(u){var r=Jr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ir(this,t)});function c(){return Hr(this,c),a.apply(this,arguments)}return e=c,o=[{key:"fromJSON",value:function(t){return new Promise((function(e,n){r.readFile(t,(function(t,r){if(t)n(t);else{var o=JSON.parse(r.toString()),i=new c(o.size);o.layers.forEach((function(t){"logistic"===t.type?i.createLayer(We,(function(e){e.setSize(t.size)})):"softmax"===t.type?i.createLayer(ke,(function(e){e.setSize(t.size)})):"relu"===t.type?i.createLayer(Qe,(function(e){e.setSize(t.size)})):"softplus"===t.type?i.createLayer($e,(function(e){e.setSize(t.size)})):"tanh"===t.type?i.createLayer(Ne,(function(e){e.setSize(t.size)})):"conv"===t.type?i.createLayer(mr,(function(e){e.setSize(t.size),e.setFilterSize(t.filterSize),e.setStride(t.stride),e.setNumFilters(t.numFilters),e.setPadding(t.padding)})):"maxpool"===t.type?i.createLayer(Mr,(function(e){e.setSize(t.size),e.setFilterSize(t.filterSize),e.setStride(t.stride)})):"fullyconnected"===t.type&&i.createLayer(Mr)}));var u=i.getNetwork();u&&(u.getLayers().forEach((function(t,e){t.W=o.layers.W,t.b=o.layers.b})),e(u))}}))}))}}],(n=[{key:"firstLayerTransition",value:function(t){this.dimensions&&t.setSize(this.dimensions)}}])&&Ur(e.prototype,n),o&&Ur(e,o),c}(ie);function Gr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Xr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Yr=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Xr(this,"exampleSize",0),Xr(this,"numberOfExamples",0),Xr(this,"data",null),this.exampleSize=e,this.numberOfExamples=r;for(var o=[],i=0;i<r;i+=1)for(var u=0;u<e;u+=1)o[u]||(o[u]=new Array(e)),n[i]||(console.log(i,u,n.length,n[0].length),console.trace(),process.exit()),"string"==typeof n[i][u]?o[u][i]=n[i][u].length?Number(n[i][u]):NaN:"number"==typeof n[i][u]&&(o[u][i]=n[i][u]);this.data=new c(this.exampleSize,this.numberOfExamples,o)}var e,r;return e=t,(r=[{key:"exampleAt",value:function(t){return this.data.col(t)}},{key:"getNumberOfExamples",value:function(){return this.numberOfExamples}},{key:"getExampleSize",value:function(){return this.exampleSize}},{key:"getBatch",value:function(e,r){var n=this.data.block(0,e,this.data.rows,r);return new t(n.rows,n.cols,n.transpose().data)}}])&&Gr(e.prototype,r),t}();const $r=require("csvtojson");function tn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var en=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"fromCSV",value:function(t){return new Promise((function(e){$r({noheader:!0,output:"csv"}).fromFile(t).then((function(t){var r=t.length,n=t[0].length,o=new Yr(n,r,t);e(o)}))}))}},{key:"fromSource",value:function(t){return new Promise((function(e){t.then((function(t){var r=t.parse();console.log(r);var n=r.cols,o=r.rows,i=new Yr(o,n,r.data);e(i)}))}))}}],null&&tn(e.prototype,null),r&&tn(e,r),t}();function rn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function nn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var on=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),nn(this,"batchSize",0),nn(this,"t",0),nn(this,"learningRate",0)}var e,r;return e=t,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"setT",value:function(t){return this.t=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}}])&&rn(e.prototype,r),t}();function un(t){return un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},un(t)}function an(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function fn(t,e){return fn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},fn(t,e)}function sn(t,e){if(e&&("object"===un(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ln(t){return ln=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ln(t)}var yn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ln(n);if(o){var r=ln(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return sn(this,t)});function u(){return an(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.adam(t,this.learningRate,this.t)}},{key:"adam",value:function(t,e,r){var n=.9,o=.999;t.vW=A().execute("add",A().execute("multiplyNumber",t.vW,n),A().execute("multiplyNumber",t.gW,1-n));var i=A().execute("divideNumber",t.vW,1-Math.pow(n,r));t.cW=A().execute("add",A().execute("multiplyNumber",t.cW,n),A().execute("multiplyNumber",t.gW,1-n));var u=A().execute("sqrt",A().execute("multiplyNumber",t.cW,1-Math.pow(o,r)));t.W=A().execute("subtract",t.W,A().execute("multiplyNumber",A().execute("elementWiseMultiply",i,u),e)),t.vb=A().execute("add",A().execute("multiplyNumber",t.vb,n),A().execute("multiplyNumber",t.gb,1-n));var a=A().execute("divideNumber",t.vb,1-Math.pow(n,r));t.cb=A().execute("add",A().execute("multiplyNumber",t.cb,o),A().execute("multiplyNumber",A().execute("elementWiseMultiply",t.gb,t.gb),1-o));var c=A().execute("sqrt",A().execute("divideNumber",t.cb,1-Math.pow(o,r)));t.b=A().execute("subtract",t.b,A().execute("multiplyNumber",A().execute("elementWiseDivide",a,c),e))}}])&&cn(e.prototype,r),u}(on);function pn(t){return pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pn(t)}function hn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function dn(t,e){return dn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},dn(t,e)}function vn(t,e){if(e&&("object"===pn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function wn(t){return wn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},wn(t)}var mn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&dn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=wn(n);if(o){var r=wn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return vn(this,t)});function u(){return hn(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.gradientDescent(t,this.learningRate)}},{key:"gradientDescent",value:function(t,e){t.W=A().execute("subtract",t.W,A().execute("multiplyNumber",t.gW,e)),t.b=A().execute("subtract",t.b,A().execute("multiplyNumber",t.gb,e))}}])&&bn(e.prototype,r),u}(on);function gn(t){return gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gn(t)}function On(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function xn(t,e){return xn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},xn(t,e)}function jn(t,e){if(e&&("object"===gn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function kn(t){return kn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},kn(t)}var Pn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=kn(n);if(o){var r=kn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return jn(this,t)});function u(){return On(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.adadelta(t,this.learningRate,this.t)}},{key:"adadelta",value:function(t,e,r){var n=.9;t.cW=A().execute("add",A().execute("multiplyNumber",t.cW,n),A().execute("multiplyNumber",A().execute("elementWiseMultiply",t.gW,t.gW),1-n));var o=A().execute("elementWiseMultiply",A().execute("multiplyNumber",A().execute("elementWiseDivide",A().execute("sqrt",t.vW),A().execute("sqrt",t.cW)),-1),t.gW);t.vW=A().execute("add",A().execute("multiplyNumber",t.cW,n),A().execute("multiplyNumber",A().execute("pow",o,2),1-n)),t.W=A().execute("add",t.W,o),t.cb=A().execute("add",A().execute("multiplyNumber",t.gb,n),A().execute("multiplyNumber",A().execute("elementWiseMultiply",t.gb,t.gb),1-n));var i=A().execute("elementWiseMultiply",A().execute("multiplyNumber",A().execute("elementWiseDivide",A().execute("sqrt",t.vb),t.cb),-1),t.gb);t.vb=A().execute("add",A().execute("multiplyNumber",t.cb,n),A().execute("multiplyNumber",A().execute("pow",t.cb,2),1-n)),t.b=A().execute("elementWiseMultiply",t.b,i)}}])&&Sn(e.prototype,r),u}(on);function _n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Rn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var En=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Rn(this,"network",null),Rn(this,"optimizer",null),Rn(this,"regularization",1e-8),Rn(this,"iterations",1e3),Rn(this,"learningRate",.01),Rn(this,"verbose",!0),Rn(this,"verboseStep",1),Rn(this,"stepCallback",(function(t){})),this.network=e,this.optimizer=r}var e,r;return e=t,r=[{key:"setRegularization",value:function(t){return this.regularization=t,this}},{key:"setIterations",value:function(t){return this.iterations=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}},{key:"setVerbose",value:function(t){return this.verbose=t,this}},{key:"setVerboseStep",value:function(t){return this.verboseStep=t,this}},{key:"setStepCallback",value:function(t){return this.stepCallback=t,this}},{key:"cost",value:function(t,e){var r=100,n=t.getNumberOfExamples(),o=Math.ceil(n/r),i=0,u=0,a=0;this.network.getLayers().forEach((function(t){a+=t.penalty()}));for(var c=0,f=0;c<n;c+=r,f+=r){var s=t.getBatch(f,r).data,l=e.getBatch(f,r).data,y=this.network.forward(s),p=l,h=p.cols,b=this.network.loss(p,y);i+=(this.network.error(h)*b+this.regularization*a/(2*h))/(o*(h/r));for(var d=0;d<y.cols;d+=1)y.colMaxCoeffIndex(d)===p.colMaxCoeffIndex(d)&&u++}return{cost:i,accuracy:(u-1)/n*100}}}],r&&_n(e.prototype,r),t}();function Tn(t){return Tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tn(t)}function zn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Wn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Dn(t,e){return Dn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Dn(t,e)}function Cn(t,e){if(e&&("object"===Tn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Mn(t)}function Mn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ln(t){return Ln=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ln(t)}function Kn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Bn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Dn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ln(n);if(o){var r=Ln(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Cn(this,t)});function u(){var t;zn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Kn(Mn(t=i.call.apply(i,[this].concat(r))),"batchSize",100),t}return e=u,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"train",value:function(t,e){var r=this,n=t.getNumberOfExamples(),o=(new Date).getTime(),i=0;this.optimizer.setBatchSize(this.batchSize),this.optimizer.setLearningRate(this.learningRate);for(var u=0;u<this.iterations;u+=1){for(var a=(new Date).getTime(),c=0,f=0;c<n;c+=this.batchSize,f+=this.batchSize){var s=(new Date).getTime(),l=t.getBatch(f,this.batchSize),y=e.getBatch(f,this.batchSize),p=this.network.forward(l.data);if(this.network.backward(l.data,y.data,p,this.regularization),this.optimizer.setT(++i),this.network.getLayers().forEach((function(t){r.optimizer.optimize(t)})),this.verbose){var h=(new Date).getTime();console.log("Batch: ".concat(f," / ").concat(n," | Batch time: ").concat(h-s,"ms | Time from start: ").concat(rr((h-a)/1e3,1),"s."))}}if(this.verbose&&(u+1)%this.verboseStep==0){var b=(new Date).getTime(),d=this.cost(t,e);console.log("Iteration: ".concat(u+1," | Cost: ").concat(rr(d.cost,5)," | Accuracy: ").concat(d.accuracy,"% | Time: ").concat((b-o)/100," s."))}"function"==typeof this.stepCallback&&this.stepCallback.call(null,{iteration:u})}return this}}])&&Wn(e.prototype,r),u}(En),Nn=function t(e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(r="dataset")in this?Object.defineProperty(this,r,{value:null,enumerable:!0,configurable:!0,writable:!0}):this[r]=null,this.dataset=e};function An(t){return An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},An(t)}function Fn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Zn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function qn(t,e){return qn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},qn(t,e)}function Hn(t,e){if(e&&("object"===An(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Un(t)}function Un(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Qn(t){return Qn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Qn(t)}function In(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Jn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Qn(n);if(o){var r=Qn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Hn(this,t)});function u(){var t;Fn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return In(Un(t=i.call.apply(i,[this].concat(r))),"callback",(function(t){return t})),t}return e=u,(r=[{key:"apply",value:function(){for(var t=0;t<this.dataset.getNumberOfExamples();t+=1)for(var e=this.callback(this.dataset.exampleAt(t)),r=0;r<this.dataset.data.rows;r+=1)e&&(this.dataset.data.data[r][t]=e.data[r][0]);return this.dataset}},{key:"setCallback",value:function(t){return this.callback=t,this}}])&&Zn(e.prototype,r),u}(Nn);function Vn(t){return Vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vn(t)}function Gn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Yn(t,e){return Yn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Yn(t,e)}function $n(t,e){if(e&&("object"===Vn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function to(t){return to=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},to(t)}var eo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Yn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=to(n);if(o){var r=to(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return $n(this,t)});function u(){return Gn(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"apply",value:function(){for(var t=1/0,e=-1/0,r=0;r<this.dataset.getNumberOfExamples();r+=1)for(var n=this.dataset.exampleAt(r),o=0;o<n.rows;o+=1)t>n.data[o][0]&&(t=n.data[o][0]),e<n.data[o][0]&&(e=n.data[o][0]);for(var i=0;i<this.dataset.getNumberOfExamples();i+=1)for(var u=this.dataset.exampleAt(i),a=0;a<u.rows;a+=1)this.dataset.data.data[a][i]=(u.data[a][0]-t)/(e-t);return this.dataset}}])&&Xn(e.prototype,r),u}(Nn);function ro(t){return ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ro(t)}function no(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function oo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function io(t,e){return io=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},io(t,e)}function uo(t,e){if(e&&("object"===ro(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ao(t)}function ao(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function co(t){return co=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},co(t)}function fo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var so,lo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&io(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=co(n);if(o){var r=co(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return uo(this,t)});function u(){var t;no(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return fo(ao(t=i.call.apply(i,[this].concat(r))),"modificationType","mean"),t}return e=u,(r=[{key:"apply",value:function(){for(var t=this,e=[],r=0,n=0,o=0,i=0;i<this.dataset.getNumberOfExamples();i+=1)for(var u=this.dataset.exampleAt(i),a=0;a<this.dataset.getExampleSize();a+=1)isNaN(u.data[a][0])||void 0===u.data[a][0]?e.push({row:a,col:u}):(n+=u.data[a][0],r++);return"mean"===this.modificationType&&(o=n/r),e.forEach((function(e){var r=e.row,n=e.col;t.dataset&&t.dataset.data&&t.dataset.data.data&&(t.dataset.data.data[r][n]=o)})),this.dataset}},{key:"setModificationType",value:function(t){return this.modificationType=t,this}}])&&oo(e.prototype,r),u}(Nn),yo=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)};function po(t){return po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},po(t)}function ho(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function bo(t,e){return bo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},bo(t,e)}function vo(t,e){if(e&&("object"===po(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return wo(t)}function wo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function mo(t){return mo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},mo(t)}function go(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}!function(t){t[t.UnquotedField=0]="UnquotedField",t[t.QuotedField=1]="QuotedField",t[t.QuotedQuote=2]="QuotedQuote"}(so||(so={}));var Oo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&bo(t,e)}(f,t);var e,n,o,i,u,a=(i=f,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=mo(i);if(u){var r=mo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return vo(this,t)});function f(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),go(wo(e=a.call(this)),"contentStr",""),go(wo(e),"matrixData",null),e.contentStr=t,e}return e=f,o=[{key:"fromLocalFile",value:function(t){return new Promise((function(e,n){r.readFile(t,(function(t,r){if(console.log("first"),t)console.log(t),n();else{var o=new f(r.toString("utf-8"));e(o)}}))}))}}],(n=[{key:"parse",value:function(){var t=this;return this.matrixData=[],this.contentStr.trim().split(/\n+/).forEach((function(e,r){return t.parseLine(e.trim(),r)})),new c(this.matrixData.length,this.matrixData[0].length,this.matrixData)}},{key:"parseLine",value:function(t,e){for(var r=this,n=so.UnquotedField,o=[],i=0,u=0;u<t.length;u+=1){var a=t.at(u);switch(n){case so.UnquotedField:switch(a){case",":o.push(""),i++;break;case'"':n=so.QuotedField;break;default:o[i]+=a}break;case so.QuotedField:'"'===a?n=so.QuotedQuote:o[i]+=a;break;case so.QuotedQuote:switch(a){case",":o.push(""),i++,n=so.UnquotedField;break;case'"':o[i]+='"',n=so.QuotedField;break;default:n=so.UnquotedField}}o.forEach((function(t,n){0===t.length&&(t=NaN),t=parseFloat(t),r.matrixData[n]||(r.matrixData[n]=[]),r.matrixData[n][e]=t}))}}}])&&ho(e.prototype,n),o&&ho(e,o),f}(yo),So={NetworkBuilder1D:Zr,NetworkBuilder3D:Vr},xo={Matrix:c},jo={SoftmaxLayer:ke,LogisticLayer:We,ReluLayer:Qe,SoftplusLayer:$e,TanhLayer:Ne,ConvLayer:mr,MaxPoolLayer:Mr,FullyConnectedLayer:Pr},ko={DatasetBuilder:en},Po={OptimizerAdam:yn,OptimizerGradientDescent:mn,OptimizerAdadelta:Pn},_o={MiniBatchTrainer:Bn},Ro={CallbackDatabaseModifier:Jn,MinMaxScalingDatabaseModifier:eo,MissingDataScalingDatabaseModifier:lo},Eo={ComputationCPU:B,ComputationGPU:St,setComputation:function(t){N=t},getComputation:A},To={Dataset:Yr},zo={DatasetBuilderSourceCSV:Oo};module.exports=e})();
//# sourceMappingURL=impulse-ts.js.map