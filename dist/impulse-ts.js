(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Computation:()=>Oi,Dataset:()=>Si,DatasetBuilder:()=>vi,DatasetBuilderSource:()=>ki,DatasetModifier:()=>gi,Layer:()=>di,Math:()=>bi,Network:()=>ji,NetworkBuilder:()=>pi,Optimizer:()=>wi,Trainer:()=>mi});const r=require("fs");function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o(this,"dimensions",null),o(this,"size",0),o(this,"layers",[]),this.dimensions=e}var e,i;return e=t,(i=[{key:"addLayer",value:function(t){return this.size++,this.layers.push(t),this}},{key:"getLayers",value:function(){return this.layers}},{key:"forward",value:function(t){var e=t;return this.layers.forEach((function(t){e=t.forward(e)})),e}},{key:"backward",value:function(t,e,r,n){for(var o=t.cols,i=r.subtract(e),u=this.layers.length-1;u>=0;u-=1)i=this.layers[u].getBackPropagation().propagate(t,o,n,this.layers[u].derivative(i))}},{key:"save",value:function(t){var e={dimensions:this.dimensions,layers:[]};this.layers.forEach((function(t){e.layers.push({type:t.getType(),size:t.getSize(),weights:{W:t.W.data,b:t.b.data}})}));var n=JSON.stringify(e);return new Promise((function(e,o){r.writeFile(t,n,(function(t){t&&(console.error(t),o()),e(n)}))}))}}])&&n(e.prototype,i),t}();function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=function(){function t(){var e,r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r={},(e="kernels")in this?Object.defineProperty(this,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[e]=r}var e,r;return e=t,r=[{key:"addKernel",value:function(t,e){return this.kernels[t]=e,this}},{key:"execute",value:function(t){if(!this.kernels[t])throw new Error("Kernel '".concat(t,"' not exists."));for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.kernels[t].apply(null,r)}}],r&&u(e.prototype,r),t}();function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}function f(t,e){if(e&&("object"===c(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}var y=new(require("gpu.js").GPU)({mode:"gpu"}),h=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=y.createKernel((function(t,e){return t[this.thread.x][this.thread.y]/e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new bt(t.rows,t.cols,r(t.data,e.data))},p=function(t,e){var r=y.createKernel((function(t){return t[this.thread.x][this.thread.y]/this.constants.number})).setOutput([t.rows,t.cols]).setConstants({number:e});return new bt(t.rows,t.cols,r(t.data))},b=function(t){var e=y.createKernel((function(t){return Math.exp(t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]),r=new bt(t.rows,t.cols,e(t.data)),n=new bt(1,t.cols,r.colwiseSum().data).replicate(t.rows,1);return new bt(t.rows,t.cols,h(r,n).data)},d=function(t,e){var r=y.createKernel((function(t){return Math.log(t[this.thread.x][this.thread.y])})).setOutput([e.rows,e.cols]);return new bt(t.rows,t.cols,W(t,new bt(t.rows,t.cols,r(e.data))).data).sum()},v=function(t){var e=y.createKernel((function(t){return 1/(1+Math.exp(-t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new bt(t.rows,t.cols,e(t.data))},w=function(t,e){var r=y.createKernel((function(t){return Math.log(t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]),n=y.createKernel((function(t){return 1-t[this.thread.x][this.thread.y]})).setOutput([t.rows,t.cols]),o=y.createKernel((function(t){return Math.log(1-t[this.thread.x][this.thread.y])})).setOutput([e.rows,e.cols]);return _(W(t,new bt(t.rows,t.cols,r(t.data))),W(new bt(t.rows,t.cols,n(t.data)),new bt(e.rows,e.cols,o(e.data)))).sum()},m=function(t){var e=y.createKernel((function(t){return 2/(1+Math.exp(-2*t[this.thread.x][this.thread.y]))-1})).setOutput([t.rows,t.cols]);return new bt(t.rows,t.cols,e(t.data))},g=function(t){var e=y.createKernel((function(t){return Math.max(0,t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]);return new bt(t.rows,t.cols,e(t.data))},O=function(t){var e=y.createKernel((function(t){return Math.log(1+Math.exp(t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new bt(t.rows,t.cols,e(t.data))},S=function(t){var e=y.createKernel((function(t){return Math.pow(t[this.thread.x][this.thread.y],2)})).setOutput([t.rows,t.cols]);return new bt(t.rows,t.cols,e(t.data)).sum()},k=function(t){var e=y.createKernel((function(t){return Math.sqrt(t[this.thread.x][this.thread.y]+1e-8)})).setOutput([t.rows,t.cols]);return new bt(t.rows,t.cols,e(t.data))},j=function(t,e){var r=y.createKernel((function(t,e){return e[this.thread.x][this.thread.y]-Math.pow(t[this.thread.x][this.thread.y],2)})).setOutput([t.rows,t.cols]);return new bt(t.rows,t.cols,r(t.data)).sum()},P=function(t,e){if(t.cols!==e.rows)throw new Error("DIMENSIONS error. m1.cols ".concat(t.cols," !== m2.rows ").concat(e.rows,"."));var r=y.createKernel((function(t,e){for(var r=0,n=0;n<this.constants.cols;n++)r+=t[this.thread.x][n]*e[n][this.thread.y];return r})).setOutput([t.rows,e.cols]).setConstants({cols:t.rows});return new bt(t.rows,e.cols,r(t.data,e.data))},_=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=y.createKernel((function(t,e){return t[this.thread.x][this.thread.y]+e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new bt(t.rows,e.cols,r(t.data,e.data))},R=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=y.createKernel((function(t,e){return t[this.thread.x][this.thread.y]-e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new bt(t.rows,e.cols,r(t.data,e.data))},x=function(t,e){var r=y.createKernel((function(){return Math.random()-.5})).setOutput([t.rows,t.cols]).setConstants({parameter:e});return new bt(t.rows,t.cols,r())},E=function(t){var e=y.createKernel((function(){return 0})).setOutput([t.rows,t.cols]);return new bt(t.rows,t.cols,e())},W=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=y.createKernel((function(t,e){return t[this.thread.x][this.thread.y]*e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new bt(t.rows,e.cols,r(t.data,e.data))},T=function(t,e){var r=y.createKernel((function(t){return t[this.thread.x][this.thread.y]*this.constants.number})).setOutput([t.rows,t.cols]).setConstants({number:e});return new bt(t.rows,t.cols,r(t.data))},z=function(t){var e=y.createKernel((function(t){return t[this.thread.y][this.thread.x]})).setOutput([t.cols,t.rows]);return new bt(t.cols,t.rows,e(t.data))},D=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(o,t);var e,r,n=(e=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=l(e);if(r){var o=l(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return f(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this)).addKernel("multiply",P),t.addKernel("add",_),t.addKernel("subtract",R),t.addKernel("fillRandom",x),t.addKernel("fillZeros",E),t.addKernel("elementWiseMultiply",W),t.addKernel("multiplyNumber",T),t.addKernel("elementWiseDivide",h),t.addKernel("divideNumber",p),t.addKernel("softmaxActivation",b),t.addKernel("softmaxLoss",d),t.addKernel("logisticActivation",v),t.addKernel("logisticLoss",w),t.addKernel("tanhActivation",m),t.addKernel("reluActivation",g),t.addKernel("softplusActivation",O),t.addKernel("penalty",S),t.addKernel("sqrt",k),t.addKernel("purelinLoss",j),t.addKernel("transpose",z),t}return o}(a);function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function B(t,e){return B=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},B(t,e)}function L(t,e){if(e&&("object"===C(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function M(t){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},M(t)}var K=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)r[n][o]=t.data[n][o]/e.data[n][o]}return new bt(t.rows,e.cols,r)},A=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)r[n][o]=t.data[n][o]/e}return new bt(t.rows,t.cols,r)},N=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)e[r][n]=1/(1+Math.exp(-t.data[r][n]))}return bt.from(e)},Z=function(t,e){for(var r=[],n=0;n<e.rows;n+=1){r[n]=[];for(var o=0;o<e.cols;o+=1)e.data&&(r[n][o]=Math.log(e.data[n][o]+1e-8))}for(var i=tt(new bt(e.rows,e.cols,r),t),u=[],a=0;a<t.rows;a+=1){u[a]=[];for(var c=0;c<t.cols;c+=1)t.data&&(u[a][c]=1-t.data[a][c])}for(var s=new bt(t.rows,t.cols,u),f=[],l=0;l<e.rows;l+=1){f[l]=[];for(var y=0;y<e.cols;y+=1)e.data&&(f[l][y]=Math.log(1-e.data[l][y]+1e-8))}var h=new bt(e.rows,e.cols,f);return G(tt(et(i,-1),t),tt(et(h,-1),rt(s,1))).sum()},F=function(t,e){return N(e).multiply(N(e).minusOne())},H=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)e[r][n]=(1-Math.exp(-2*t.data[r][n]))/(1+Math.exp(-2*t.data[r][n]))}return bt.from(e)},q=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.max(0,t.data[r][n]))}return new bt(t.rows,t.cols,e)},I=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=e.data[n][o]>0?1:0)}return tt(new bt(t.rows,t.cols,r),t)},Q=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.log(1+Math.exp(t.data[r][n])))}return new bt(t.rows,t.cols,e)},U=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.pow(t.data[r][n],2))}return new bt(t.rows,t.cols,e).sum()},V=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.sqrt(t.data[r][n]+1e-8))}return new bt(t.rows,t.cols,e)},J=function(t,e){if(t.cols!==e.rows)throw new Error("DIMENSIONS error. m1.cols ".concat(t.rows," ").concat(t.cols," !== m2.rows ").concat(e.rows," ").concat(e.cols,"."));for(var r=[],n=0;n<t.rows;++n){r[n]=new Array(e.cols);for(var o=0;o<e.cols;++o){r[n][o]=0;for(var i=0;i<t.cols;++i)t.data&&e.data&&(r[n][o]+=t.data[n][i]*e.data[i][o])}}return new bt(t.rows,e.cols,r)},G=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal. m1.cols ".concat(t.cols," !== m2.cols ").concat(e.cols));for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&e.data&&(r[n][o]=t.data[n][o]+e.data[n][o])}return new bt(t.rows,t.cols,r)},$=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal: m1.rows ".concat(t.rows," !== m2.rows ").concat(e.rows));if(t.cols!==e.cols)throw new Error("COLS number not equal: m1.cols ".concat(t.cols," !== m2.cols ").concat(e.cols));for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&e.data&&(r[n][o]=t.data[n][o]-e.data[n][o])}return new bt(t.rows,t.cols,r)},X=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)r[n][o]=(4*Math.random()-2)*Math.sqrt(2/e)}return new bt(t.rows,t.cols,r)},Y=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)e[r][n]=0}return new bt(t.rows,t.cols,e)},tt=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal: m1.rows ".concat(t.rows," !== m2.rows ").concat(e.rows));if(t.cols!==e.cols)throw new Error("COLS number not equal: m1.cols ".concat(t.cols," !== m2.cols ").concat(e.cols));for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&e.data&&(r[n][o]=t.data[n][o]*e.data[n][o])}return new bt(t.rows,t.cols,r)},et=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=t.data[n][o]*e)}return new bt(t.rows,t.cols,r)},rt=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=e-t.data[n][o])}return new bt(t.rows,t.cols,r)},nt=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=Math.pow(t.data[n][o],e))}return new bt(t.rows,t.cols,r)},ot=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=Math.log(t.data[n][o]+1e-8))}return new bt(t.rows,t.cols,r)},it=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=Math.log(1-t.data[n][o]))}return new bt(t.rows,t.cols,r)},ut=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)r[n][o]=t.data[n][o]+e}return new bt(t.rows,t.cols,r)},at=function(t){for(var e=[],r=0;r<t.cols;r+=1){e[r]=[];for(var n=0;n<t.rows;n+=1)t.data&&(e[r][n]=t.data[n][r])}return new bt(t.cols,t.rows,e)},ct=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&B(t,e)}(o,t);var e,r,n=(e=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=M(e);if(r){var o=M(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return L(this,t)});function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n.call(this)).addKernel("multiply",J),t.addKernel("add",G),t.addKernel("subtract",$),t.addKernel("subtractFromNumber",rt),t.addKernel("fillRandom",X),t.addKernel("fillZeros",Y),t.addKernel("elementWiseMultiply",tt),t.addKernel("multiplyNumber",et),t.addKernel("elementWiseDivide",K),t.addKernel("divideNumber",A),t.addKernel("logisticActivation",N),t.addKernel("logisticLoss",Z),t.addKernel("logisticBackpropagation",F),t.addKernel("tanhActivation",H),t.addKernel("reluActivation",q),t.addKernel("reluBackpropagation",I),t.addKernel("softplusActivation",Q),t.addKernel("penalty",U),t.addKernel("sqrt",V),t.addKernel("transpose",at),t.addKernel("pow",nt),t.addKernel("log",ot),t.addKernel("logMinusOne",it),t.addKernel("addNumber",ut),t}return o}(a),st=new ct,ft=function(){return st};function lt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ht(t,e,r){return e&&yt(t.prototype,e),r&&yt(t,r),t}function pt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var bt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;lt(this,t),pt(this,"rows",0),pt(this,"cols",0),pt(this,"data",null),this.resize(e,r),n&&this.generateData(n)}return ht(t,[{key:"resize",value:function(t,e){this.rows=t,this.cols=e,this.data=[];for(var r=0;r<this.rows;r+=1)this.data[r]=new Array(this.cols);return this}},{key:"generateData",value:function(t){for(var e=[],r=0;r<this.rows;r+=1)e[r]=new Array(this.cols);for(var n=0;n<this.cols;n+=1)for(var o=0;o<this.rows;o+=1)"number"==typeof t[o]?e[o][n]=t[o]:t[o]instanceof Float32Array||t[o]&&"number"==typeof t[o][n]?e[o][n]=t[o][n]:"string"==typeof t[o][n]?e[o][n]=t[o][n].length?Number(t[o][n]):NaN:e[o][n]=NaN;return this.data=e,this}},{key:"sum",value:function(){for(var t=0,e=0;e<this.rows;e+=1)for(var r=0;r<this.cols;r+=1)t+=this.data[e][r];return t}},{key:"colwiseSum",value:function(){for(var e=[],r=this.transpose(),n=0;n<r.rows;n+=1){e[n]=[0];for(var o=0;o<r.cols;o+=1)e[n][0]+=r.data[n][o]}return new t(this.cols,1,e)}},{key:"rowwiseSum",value:function(){for(var e=[[]],r=0;r<this.rows;r+=1){for(var n=0,o=0;o<this.cols;o+=1)n+=this.data[r][o];e[0].push(n)}return new t(1,this.rows,e)}},{key:"flatten",value:function(){for(var t=[],e=0;e<this.rows;e+=1)for(var r=0;r<this.cols;r+=1)t.push(this.data[e][r]);return t}},{key:"replicate",value:function(e,r){if(1===e&&1===this.cols&&r>1){for(var n=[],o=0;o<this.rows;o+=1){n[o]=[];for(var i=0;i<r;i+=1)n[o][i]=this.data[o][0]}return t.from(n)}if(1===r&&1===this.rows&&e>1){for(var u=[],a=0;a<e;a+=1){u[a]=[];for(var c=0;c<this.cols;c+=1)u[a][c]=this.data[0][c]}return t.from(u)}return this}},{key:"transpose",value:function(){return ft().execute("transpose",this)}},{key:"colMaxCoeffIndex",value:function(t){for(var e=-1,r=-1/0,n=0;n<this.rows;n+=1)this.data&&this.data[n][t]>r&&(r=this.data[n][t],e=n);return e}},{key:"block",value:function(e,r,n,o){for(var i=[],u=e,a=0;u<this.rows&&u<e+n;u+=1,a+=1){i[a]=new Array(o);for(var c=r,s=0;c<this.cols&&c<r+o;c+=1,s+=1)i[a][s]=this.data[u][c]}return new t(n,o,i)}},{key:"col",value:function(e){for(var r=[],n=0;n<this.rows;n+=1)r[n]=[this.data[n][e]];return new t(this.rows,1,r)}},{key:"setCol",value:function(t,e){for(var r=0;r<this.rows;r+=1)this.data&&e.data&&(this.data[r][t]=e.data[r][0]);return this}},{key:"rollToColMatrix",value:function(){for(var e=[],r=0,n=0;n<this.rows;n+=1)for(var o=0;o<this.cols;o+=1)e[r]=[],e[r++][0]=this.data[n][o];return t.from(e)}},{key:"mean",value:function(){for(var t=0,e=this.rows*this.cols,r=0;r<this.rows;r+=1)for(var n=0;n<this.cols;n+=1)t+=this.data[r][n];return t/e}},{key:"max",value:function(){for(var t=-1/0,e=0;e<this.rows;e+=1)for(var r=0;r<this.cols;r+=1)t=Math.max(this.data[e][r],t);return t}},{key:"setMax",value:function(e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=Math.max(this.data[n][o],e)}return t.from(r)}},{key:"setZeros",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=0}return t.from(e)}},{key:"setOnes",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=1}return t.from(e)}},{key:"setRandom",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=(4*Math.random()-2)*Math.sqrt(2/e)}return t.from(r)}},{key:"fraction",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=e/this.data[n][o]}return t.from(r)}},{key:"sqrt",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=Math.sqrt(this.data[r][n]+1e-8)}return t.from(e)}},{key:"dot",value:function(t){return ft().execute("multiply",this,t)}},{key:"multiply",value:function(e){if("number"==typeof e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=this.data[n][o]*e}return t.from(r)}for(var i=[],u=0;u<this.rows;u+=1){i[u]=[];for(var a=0;a<this.cols;a+=1)i[u][a]=this.data[u][a]*e.data[u][a]}return t.from(i)}},{key:"subtract",value:function(e){if(e instanceof t){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=this.data[n][o]-e.data[n][o]}return t.from(r)}for(var i=[],u=0;u<this.rows;u+=1){i[u]=[];for(var a=0;a<this.cols;a+=1)i[u][a]=this.data[u][a]-e}return t.from(i)}},{key:"forEach",value:function(e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=e(this.data[n][o])}return t.from(r)}},{key:"divide",value:function(e){if("number"==typeof e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=this.data[n][o]/e}return t.from(r)}if(e.rows!==this.rows||e.cols!==this.cols)throw new Error("Dimensions error (".concat(this.rows,", ").concat(this.cols,") !== (").concat(e.rows,", ").concat(e.cols,")"));for(var i=[],u=0;u<this.rows;u+=1){i[u]=[];for(var a=0;a<this.cols;a+=1)i[u][a]=this.data[u][a]/e.data[u][a]}return t.from(i)}},{key:"minusOne",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=1-this.data[r][n]}return t.from(e)}},{key:"subtractFromNumber",value:function(e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=e-this.data[n][o]}return t.from(r)}},{key:"add",value:function(e){if("number"==typeof e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=this.data[n][o]+e}return t.from(r)}if(e instanceof t){if(e.rows!==this.rows||e.cols!==this.cols)throw new Error("Dimention error: rows (x: ".concat(this.rows,", y: ").concat(this.cols,") !== (x: ").concat(e.rows,", y: ").concat(e.cols,")"));for(var i=[],u=0;u<this.rows;u+=1){i[u]=[];for(var a=0;a<this.cols;a+=1)i[u][a]=this.data[u][a]+e.data[u][a]}return t.from(i)}return this}},{key:"log",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=Math.log(this.data[r][n]+1e-8)}return t.from(e)}},{key:"tanh",value:function(){return this.exp().subtract(this.multiply(-1).exp()).divide(this.exp().add(this.multiply(-1).exp()))}},{key:"softmax",value:function(){var t=this.max();return this.subtract(t).exp().divide(this.rowwiseSum().replicate(1,this.cols).transpose())}},{key:"exp",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=Math.exp(this.data[r][n]+1e-8)}return t.from(e)}},{key:"pow",value:function(e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=Math.pow(this.data[n][o],e)}return t.from(r)}}],[{key:"from",value:function(e){var r;return new t(e.length,(null===(r=e[0])||void 0===r?void 0:r.length)||0,e)}}]),t}(),dt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;lt(this,t),pt(this,"rows",0),pt(this,"cols",0),pt(this,"depth",0),pt(this,"data",null),this.resize(e,r,n),o&&(this.data=o)}return ht(t,[{key:"resize",value:function(t,e,r){this.rows=t,this.cols=e,this.depth=r,this.data=[];for(var n=0;n<this.rows;n+=1){this.data[n]=new Array(e);for(var o=0;o<this.cols;o+=1)this.data[n][o]=new Array(r)}return this}},{key:"setZeros",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=new Array(this.cols);for(var n=0;n<this.cols;n+=1){e[r][n]=new Array(this.depth);for(var o=0;o<this.cols;o+=1)e[r][n][o]=0}}return new t(this.rows,this.cols,this.depth,e)}}]),t}();function vt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function wt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var mt,gt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),wt(this,"dimensions",null),wt(this,"size",0),wt(this,"layers",[]),this.dimensions=e}var e,r;return e=t,(r=[{key:"addLayer",value:function(t){return this.size++,this.layers.push(t),this}},{key:"getLayers",value:function(){return this.layers}},{key:"sample",value:function(t){for(var e=this.layers[0].Waa,r=this.layers[0].Wax,n=this.layers[0].Wya,o=this.layers[0].by,i=this.layers[0].b,u=this.layers[0].getWidth(),a=this.layers[0].getWidth(),c=[],s=t["\n"],f=new bt(u,1).setZeros(),l=new bt(a,1).setZeros(),y=-1,h=0;y!=s&&50!=h;){var p=r.dot(f).add(e.dot(l)).add(i).tanh();n.dot(p).add(o).softmax().flatten(),y=parseInt(String(Math.random()*u)),c.push(y),(f=new bt(u,1)).data[y][0]=1,l=p,h=1}}},{key:"forward",value:function(t,e){}},{key:"backward",value:function(t,e,r,n){for(var o=t.cols,i=r.subtract(e),u=this.layers.length-1;u>=0;u-=1)i=this.layers[u].getBackPropagation().propagate(t,o,n,this.layers[u].derivative(i))}}])&&vt(e.prototype,r),t}();function Ot(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}!function(t){t.logistic="logistic",t.softmax="softmax",t.tanh="tanh",t.relu="relu",t.softplus="softplus",t.conv="conv",t.maxpool="maxpool",t.fullyconnected="fullyconnected",t.purelin="purelin",t.rnnlayer="rnnlayer"}(mt||(mt={}));var St=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ot(this,"layer",null),Ot(this,"previousLayer",null),this.layer=e,this.previousLayer=r};function kt(t){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kt(t)}function jt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Pt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _t(t,e){return _t=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},_t(t,e)}function Rt(t,e){if(e&&("object"===kt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function xt(t){return xt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},xt(t)}var Et=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_t(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=xt(n);if(o){var r=xt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Rt(this,t)});function u(){return jt(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){var o=null!==this.previousLayer?this.previousLayer.A:t;if(this.layer.gW=n.dot(o.transpose()).divide(e),this.layer.gW=this.layer.gW.add(this.layer.W.multiply(r).divide(e)),this.layer.gb=n.rowwiseSum().transpose().divide(e),null!==this.previousLayer){var i=this.layer.W.transpose().dot(n);if(i.rows!==o.rows||i.cols!==o.cols)throw console.log(this.layer.W.rows,this.layer.W.cols,n.rows,n.cols,this.layer.gW.rows,this.layer.gW.cols),new Error("Dimension error 1. (".concat(i.rows,", ").concat(i.cols,") | (").concat(o.rows,", ").concat(o.cols,")"));if(this.layer.gW.rows!==this.layer.W.rows||this.layer.gW.cols!==this.layer.W.cols)throw new Error("Dimension error 2. (".concat(this.layer.gW.rows,", ").concat(this.layer.gW.cols,") | (").concat(this.layer.W.rows,", ").concat(this.layer.W.cols,")"));if(this.layer.gb.rows!==this.layer.b.rows||this.layer.gb.cols!==this.layer.b.cols)throw new Error("Dimension error 3. (".concat(this.layer.gb.rows,", ").concat(this.layer.gb.cols,") | (").concat(this.layer.b.rows,", ").concat(this.layer.b.cols,")"));return i}return new bt}}])&&Pt(e.prototype,r),u}(St);function Wt(t){return Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wt(t)}function Tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function zt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Dt(t,e){return Dt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Dt(t,e)}function Ct(t,e){if(e&&("object"===Wt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Bt(t){return Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Bt(t)}var Lt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Dt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Bt(n);if(o){var r=Bt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ct(this,t)});function u(){return Tt(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){return n}}])&&zt(e.prototype,r),u}(St);function Mt(t){return Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mt(t)}function Kt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function At(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Nt(t,e){return Nt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Nt(t,e)}function Zt(t,e){if(e&&("object"===Mt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ft(t)}function Ft(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ht(t){return Ht=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ht(t)}function qt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var It=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Nt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ht(n);if(o){var r=Ht(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Zt(this,t)});function u(){var t;Kt(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return qt(Ft(t=i.call.apply(i,[this].concat(r))),"previousLayer",null),t}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){var o=this.previousLayer;if(o){for(var i=ft().execute("fillZeros",new bt(o.Z.rows,o.Z.cols)),u=o.getFilterSize(),a=o.getStride(),c=o.getWidth(),s=o.getHeight(),f=(o.getDepth(),o.getOutputWidth()),l=o.getOutputHeight(),y=o.getOutputDepth(),h=0;h<e;h++)for(var p=0;p<y;p++)for(var b=0;b<l;b++)for(var d=0;d<f;d++){for(var v=a*d,w=-1/0,m=s*c*p,g=l*f*p,O=0,S=0,k=0,j=a*b;k<u;k++,j++)for(var P=0,_=v;P<u;P++,_++)o.Z.data&&w<o.Z.data[m+j*c+_][h]&&(w=o.Z.data[m+j*c+_][h],O=_,S=j);i.data&&n.data&&(i.data[m+S*c+O][h]=n.data[g+b*f+d][h])}return i}return new bt}}])&&At(e.prototype,r),u}(St);function Qt(t){return Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qt(t)}function Ut(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Jt(t,e){return Jt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Jt(t,e)}function Gt(t,e){if(e&&("object"===Qt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return $t(t)}function $t(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Xt(t){return Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Xt(t)}function Yt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var te=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Jt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Xt(n);if(o){var r=Xt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Gt(this,t)});function u(){var t;Ut(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Yt($t(t=i.call.apply(i,[this].concat(r))),"previousLayer",null),t}return e=u,(r=[{key:"propagate",value:function(t,e,r,n){var o=this.previousLayer;if(o){var i=o.getPadding(),u=o.getStride(),a=o.getFilterSize(),c=o.getOutputWidth(),s=o.getOutputHeight(),f=o.getOutputDepth(),l=o.getWidth(),y=o.getHeight(),h=o.getDepth(),p=ft().execute("fillZeros",new bt((l+2*i)*(y+2*i)*h,e)),b=new bt(l*y*h,e);o.gW=ft().execute("fillZeros",o.gW),o.gb=ft().execute("fillZeros",o.gb);for(var d=0;d<e;d++){for(var v=0;v<f;v++)for(var w=0;w<s;w++)for(var m=0;m<c;m++){for(var g=u*w,O=u*m,S=0;S<h;S++)for(var k=0,j=g,P=-i;k<a;k++,j++,P++)for(var _=0,R=O,x=-i;_<a;_++,R++,x++){o.W.data&&p.data&&n.data&&(p.data[S*(l+2*i)*(y+2*i)+j*(l+2*i)+R][d]+=o.W.data[v][S*a*a+k*a+_]*n.data[v*c*s+w*c+m][d]);var E=0;0==i?o.Z.data&&(E=o.Z.data[S*l*y+j*l+R][d]):P>=0&&x>=0&&P<y&&x<l&&o.Z.data&&(E=o.Z.data[S*l*y+P*l+x][d]),o.gW.data&&n.data&&(o.gW.data[v][S*a*a+k*a+_]+=E*n.data[v*(c*s)+w*c+m][d]/e)}o.gb.data&&n.data&&(o.gb.data[v][0]+=n.data[v*(c*s)+w*c+m][d]/e)}if(i>0)for(var W=0;W<h;W++)for(var T=-i,z=0;T<y+i;T++,z++)for(var D=-i,C=0;D<l+i;D++,C++)D>=0&&T>=0&&D<l&&T<y&&b.data&&p.data&&(b.data[W*l*y+T*l+D][d]=p.data[W*(l+2*i)*(y+2*i)+z*(l+2*i)+C][d])}return i>0?b:p}}}])&&Vt(e.prototype,r),u}(St);function ee(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var re=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"create",value:function(t,e){if(null==t){if(e.is1D())return new Et(e,t);if(e.getType()==mt.conv)return new Lt(e,t)}else{if(t.getType()==mt.maxpool)return new It(e,t);if(t.getType()==mt.conv)return new te(e,t);if(t.is1D()||t.getType()==mt.fullyconnected)return new Et(e,t)}return null}}],null&&ee(e.prototype,null),r&&ee(e,r),t}();function ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function oe(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ie=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),oe(this,"dimensions",null),oe(this,"lastLayer",null),oe(this,"network",null),this.dimensions=e,this.network=new i(e)}var e,r;return e=t,r=[{key:"createLayer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=new t;return"function"==typeof e&&e(r),null===this.lastLayer?this.firstLayerTransition(r):r.transition(this.lastLayer),r.configure(),r.setBackPropagation(re.create(this.lastLayer,r)),this.network.addLayer(r),this.lastLayer=r,this}},{key:"getNetwork",value:function(){return this.network}}],r&&ne(e.prototype,r),t}();function ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ae(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ce=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ae(this,"width",0),ae(this,"height",0),ae(this,"depth",0),ae(this,"previousLayer",null),ae(this,"backPropagation",null)}var e,r;return e=t,(r=[{key:"setBackPropagation",value:function(t){return this.backPropagation=t,this}},{key:"getBackPropagation",value:function(){return this.backPropagation}},{key:"setWidth",value:function(t){return this.width=t,this}},{key:"getWidth",value:function(){return this.width}},{key:"setHeight",value:function(t){return this.height=t,this}},{key:"getHeight",value:function(){return this.height}},{key:"setDepth",value:function(t){return this.depth=t,this}},{key:"getDepth",value:function(){return this.depth}},{key:"transition",value:function(t){return this.previousLayer=t,this}}])&&ue(e.prototype,r),t}();function se(t){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},se(t)}function fe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function le(t,e,r){return le="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=be(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}},le(t,e,r||t)}function ye(t,e){return ye=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ye(t,e)}function he(t,e){if(e&&("object"===se(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return pe(t)}function pe(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function be(t){return be=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},be(t)}var de=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ye(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=be(n);if(o){var r=be(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return he(this,t)});function u(){var t,e,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),1,(r="depth")in(e=pe(t=i.call(this)))?Object.defineProperty(e,r,{value:1,enumerable:!0,configurable:!0,writable:!0}):e[r]=1,t.W=new bt,t.b=new bt,t.A=new bt,t.Z=new bt,t.gW=new bt,t.gb=new bt,t.vW=new bt,t.vb=new bt,t.sW=new bt,t.sb=new bt,t.dW=new bt,t.db=new bt,t}return e=u,(r=[{key:"configure",value:function(){this.W.resize(this.getHeight(),this.getWidth()),this.W=this.W.setRandom(this.previousLayer?this.previousLayer.getHeight():this.getHeight()),this.b.resize(this.getHeight(),1),this.b=this.b.setRandom(this.previousLayer?this.previousLayer.getHeight():this.getHeight()),this.gW.resize(this.getHeight(),this.getWidth()),this.gW=this.W.setZeros(),this.gb.resize(this.getHeight(),1),this.gb=this.gb.setZeros(),this.sW.resize(this.getHeight(),this.getWidth()),this.sW=this.sW.setZeros(),this.sb.resize(this.getHeight(),1),this.sb=this.sb.setZeros(),this.vW.resize(this.getHeight(),this.getWidth()),this.vW=this.vW.setZeros(),this.vb.resize(this.getHeight(),1),this.vb=this.vb.setZeros(),this.dW.resize(this.getHeight(),this.getWidth()),this.dW=this.dW.setZeros(),this.db.resize(this.getHeight(),1),this.db=this.db.setZeros()}},{key:"forward",value:function(t){return this.Z=this.W.dot(t).add(this.b.replicate(1,t.cols)),this.A=this.activation(this.Z),this.A}},{key:"is1D",value:function(){return!0}},{key:"is3D",value:function(){return!1}},{key:"transition",value:function(t){return t.is1D()?this.setWidth(t.getSize()):t.is3D()&&this.setWidth(t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth()),le(be(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){return this.setHeight(t),this}},{key:"getSize",value:function(){return this.height}},{key:"getOutputWidth",value:function(){return this.width}},{key:"getOutputHeight",value:function(){return this.height}},{key:"getOutputDepth",value:function(){return 1}},{key:"penalty",value:function(){return this.W.pow(2).sum()}}])&&fe(e.prototype,r),u}(ce);function ve(t){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ve(t)}function we(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function me(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ge(t,e){return ge=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ge(t,e)}function Oe(t,e){if(e&&("object"===ve(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Se(t){return Se=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Se(t)}var ke=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ge(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Se(n);if(o){var r=Se(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Oe(this,t)});function u(){return we(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.softmax()}},{key:"getType",value:function(){return mt.softmax}},{key:"derivative",value:function(t){return t.multiply(-1).add(1).fraction(1)}}])&&me(e.prototype,r),u}(de);function je(t){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},je(t)}function Pe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Re(t,e){return Re=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Re(t,e)}function xe(t,e){if(e&&("object"===je(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ee(t){return Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ee(t)}var We=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Re(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ee(n);if(o){var r=Ee(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return xe(this,t)});function u(){return Pe(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.multiply(-1).exp().add(1).fraction(1)}},{key:"getType",value:function(){return mt.logistic}},{key:"derivative",value:function(t){return t.multiply(this.activation(t).multiply(this.activation(t.minusOne())))}}])&&_e(e.prototype,r),u}(de);function Te(t){return Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Te(t)}function ze(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function De(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ce(t,e){return Ce=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ce(t,e)}function Be(t,e){if(e&&("object"===Te(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Le(t){return Le=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Le(t)}var Me=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ce(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Le(n);if(o){var r=Le(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Be(this,t)});function u(){return ze(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.tanh()}},{key:"getType",value:function(){return mt.tanh}},{key:"derivative",value:function(t){return this.activation(t).pow(2).minusOne()}}])&&De(e.prototype,r),u}(de);function Ke(t){return Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ke(t)}function Ae(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ze(t,e){return Ze=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ze(t,e)}function Fe(t,e){if(e&&("object"===Ke(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function He(t){return He=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},He(t)}var qe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ze(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=He(n);if(o){var r=He(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Fe(this,t)});function u(){return Ae(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.setMax(0)}},{key:"getType",value:function(){return mt.relu}},{key:"derivative",value:function(t){return ft().execute("reluBackpropagation",t,this.A)}}])&&Ne(e.prototype,r),u}(de);function Ie(t){return Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ie(t)}function Qe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ve(t,e){return Ve=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ve(t,e)}function Je(t,e){if(e&&("object"===Ie(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ge(t){return Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ge(t)}var $e=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ve(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ge(n);if(o){var r=Ge(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Je(this,t)});function u(){return Qe(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.exp().add(1).log()}},{key:"getType",value:function(){return mt.softplus}},{key:"derivative",value:function(t){return t.multiply(-1).exp().add(1).fraction(1)}}])&&Ue(e.prototype,r),u}(de),Xe=function(t,e,r,n,o,i,u,a,c,s){for(var f=0,l=[[]],y=-u;y+o<=r+u;y+=c)for(var h=-a;h+i<=n+a;h+=s){for(var p=0,b=0;b<e;b++)for(var d=r*n*b,v=0;v<o;v++)for(var w=0;w<i;w++)y+v>=0&&h+w>=0&&h+w<n&&y+v<r&&(l[f][p]=t.data[(v+y)*n+h+w+d][0]),p++;l[++f]=[]}return bt.from(l)},Ye=function(t,e,r,n,o,i,u,a){for(var c=(n-i)/a+1,s=(r-o)/u+1,f=e,l=0,y=ft().execute("fillZeros",new bt(c*s*f,1)),h=0;h+o<=r;h+=u)for(var p=0;p+i<=n;p+=a){for(var b=0;b<e;b++){for(var d=-1/0,v=r*n*b,w=c*s*b,m=0;m<o;m++)for(var g=0;g<i;g++)d=Math.max(d,t.data[v+(m+h)*n+p+g][0]);y.data&&(y.data[w+l][0]=d)}l++}return new bt},tr=function(t,e){return Math.round((t+Number.EPSILON)*Math.pow(10,e))/Math.pow(10,e)};function er(t){return er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},er(t)}function rr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function nr(t,e,r){return nr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ur(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}},nr(t,e,r||t)}function or(t,e){return or=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},or(t,e)}function ir(t,e){if(e&&("object"===er(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ur(t){return ur=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ur(t)}var ar=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&or(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ur(n);if(o){var r=ur(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ir(this,t)});function u(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this)).W=new bt,t.b=new bt,t.A=new bt,t.Z=new bt,t.gW=new bt,t.gb=new bt,t.vW=new bt,t.vb=new bt,t.sW=new bt,t.sb=new bt,t.dW=new bt,t.db=new bt,t}return e=u,(r=[{key:"configure",value:function(){}},{key:"is1D",value:function(){return!1}},{key:"is3D",value:function(){return!0}},{key:"transition",value:function(t){return t.is3D()&&this.setSize([t.getOutputWidth(),t.getOutputHeight(),t.getOutputDepth()]),nr(ur(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){return this.setWidth(t[0]),this.setHeight(t[1]),this.setDepth(t[2]),this}},{key:"getSize",value:function(){return[this.getWidth(),this.getHeight(),this.getDepth()]}},{key:"penalty",value:function(){return this.W.pow(2).sum()}}])&&rr(e.prototype,r),u}(ce);function cr(t){return cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cr(t)}function sr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function lr(t,e){return lr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},lr(t,e)}function yr(t,e){if(e&&("object"===cr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return hr(t)}function hr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function pr(t){return pr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},pr(t)}function br(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var dr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=pr(n);if(o){var r=pr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return yr(this,t)});function u(){var t;sr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return br(hr(t=i.call.apply(i,[this].concat(r))),"numFilters",32),br(hr(t),"filterSize",4),br(hr(t),"padding",1),br(hr(t),"stride",1),t}return e=u,(r=[{key:"configure",value:function(){this.W.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.W=ft().execute("fillRandom",this.W,this.width*this.height*this.depth),this.b.resize(this.numFilters,1),this.b=ft().execute("fillRandom",this.b,.01),this.gW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.gW=ft().execute("fillZeros",this.gW),this.gb.resize(this.numFilters,1),this.gb=ft().execute("fillZeros",this.gb),this.sW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.sW=ft().execute("fillZeros",this.gb),this.sb.resize(this.numFilters,1),this.sb=ft().execute("fillZeros",this.sb),this.vW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.vW=ft().execute("fillZeros",this.vW),this.vb.resize(this.numFilters,1),this.vb=ft().execute("fillZeros",this.vb)}},{key:"getOutputHeight",value:function(){return(this.width-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.height-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.numFilters}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setNumFilters",value:function(t){return this.numFilters=t,this}},{key:"getNumFilters",value:function(){return this.numFilters}},{key:"setPadding",value:function(t){return this.padding=t,this}},{key:"getPadding",value:function(){return this.padding}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"forward",value:function(t){for(var e=new bt(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols),r=0;r<t.cols;r+=1){var n=Xe(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.padding,this.padding,this.stride,this.stride);console.log(n.rows,n.cols,this.W.rows,this.W.cols),process.exit();var o=this.W.dot(n).add(this.b.replicate(1,n.cols));e.setCol(r,o.rollToColMatrix())}return this.Z=e,this.activation(this.Z),this.A}},{key:"activation",value:function(t){return t}},{key:"getType",value:function(){return mt.conv}},{key:"derivative",value:function(t){return t}}])&&fr(e.prototype,r),u}(ar);function vr(t){return vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vr(t)}function wr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function gr(t,e){return gr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},gr(t,e)}function Or(t,e){if(e&&("object"===vr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Sr(t){return Sr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Sr(t)}var kr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Sr(n);if(o){var r=Sr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Or(this,t)});function u(){return wr(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"configure",value:function(){}},{key:"transition",value:function(t){if(!t.is3D())throw new Error("Invalid usage. Cannot fully connect with previous 1D Layer.");if(t.getType()!=mt.maxpool)throw new Error("Invalid usage. Cannot fully connect with previous non maxpool Layer.");return this.filterSize=t.getOutputWidth(),this.padding=0,this.stride=1,this.width=t.getOutputWidth(),this.height=t.getOutputHeight(),this.depth=t.getOutputDepth(),this.numFilters=t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth(),this}},{key:"setSize",value:function(t){return this}},{key:"setFilterSize",value:function(t){return this}},{key:"setStride",value:function(t){return this}},{key:"setPadding",value:function(t){return this}},{key:"setWidth",value:function(t){return this}},{key:"setHeight",value:function(t){return this}},{key:"setDepth",value:function(t){return this}},{key:"setNumFilters",value:function(t){return this}},{key:"derivative",value:function(t){return t}}])&&mr(e.prototype,r),u}(dr);function jr(t){return jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jr(t)}function Pr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Rr(t,e){return Rr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Rr(t,e)}function xr(t,e){if(e&&("object"===jr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Er(t)}function Er(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Wr(t){return Wr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Wr(t)}function Tr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var zr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Wr(n);if(o){var r=Wr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return xr(this,t)});function u(){var t;Pr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Tr(Er(t=i.call.apply(i,[this].concat(r))),"filterSize",0),Tr(Er(t),"stride",0),t}return e=u,(r=[{key:"configure",value:function(){}},{key:"getOutputHeight",value:function(){return(this.height-this.filterSize)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.width-this.filterSize)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.depth}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"getPadding",value:function(){return 0}},{key:"forward",value:function(t){for(var e=new bt(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols),r=0;r<t.cols;r+=1){var n=Ye(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.stride,this.stride).rollToColMatrix();e.setCol(r,n)}return this.Z=e,this.activation(this.Z),this.A}},{key:"activation",value:function(t){return t}},{key:"getType",value:function(){return mt.maxpool}},{key:"derivative",value:function(t){return t}}])&&_r(e.prototype,r),u}(ar);function Dr(t){return Dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dr(t)}function Cr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Br(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Lr(t,e){return Lr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Lr(t,e)}function Mr(t,e){if(e&&("object"===Dr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Kr(t)}function Kr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ar(t){return Ar=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ar(t)}function Nr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Zr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Lr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ar(n);if(o){var r=Ar(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Mr(this,t)});function u(){var t;Cr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Nr(Kr(t=i.call.apply(i,[this].concat(r))),"Wax",null),Nr(Kr(t),"Waa",null),Nr(Kr(t),"Wya",null),Nr(Kr(t),"b",null),Nr(Kr(t),"by",null),t}return e=u,(r=[{key:"configure",value:function(){this.Wax=new bt(this.getWidth(),this.getHeight()),this.Wax=this.Wax.setRandom(this.getWidth()),this.Waa=new bt(this.getWidth(),this.getWidth()),this.Waa=this.Waa.setRandom(this.getWidth()),this.Wya=new bt(this.getDepth(),this.getWidth()),this.Wya=this.Wax.setRandom(this.getWidth()),this.b=new bt(this.getWidth(),1),this.b=this.b.setZeros(),this.by=new bt(this.getDepth(),1),this.by=this.by.setZeros()}},{key:"forward",value:function(t,e){var r=this.Wax.dot(t).add(this.Waa.dot(e)).add(this.b);return[r,this.Wya.dot(r).add(this.by).softmax()]}},{key:"activation",value:function(t){return t}},{key:"getType",value:function(){return mt.rnnlayer}},{key:"derivative",value:function(t){return t}},{key:"is1D",value:function(){return!0}},{key:"is3D",value:function(){return!1}},{key:"setSize",value:function(t){return this.setWidth(t[0]),this.setHeight(t[1]),this.setDepth(t[2]),this}},{key:"getSize",value:function(){return this.height}},{key:"getOutputWidth",value:function(){return this.width}},{key:"getOutputHeight",value:function(){return this.height}},{key:"getOutputDepth",value:function(){return this.depth}},{key:"penalty",value:function(){return 0}}])&&Br(e.prototype,r),u}(ce);function Fr(t){return Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fr(t)}function Hr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ir(t,e){return Ir=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ir(t,e)}function Qr(t,e){if(e&&("object"===Fr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ur(t){return Ur=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ur(t)}var Vr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ir(t,e)}(c,t);var e,n,o,i,u,a=(i=c,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ur(i);if(u){var r=Ur(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Qr(this,t)});function c(){return Hr(this,c),a.apply(this,arguments)}return e=c,o=[{key:"fromJSON",value:function(t){return new Promise((function(e,n){r.readFile(t,(function(t,r){if(t)n(t);else{var o=JSON.parse(r.toString()),i=new c(o.dimensions);o.layers.forEach((function(t){var e=null;"logistic"===t.type?e=We:"softmax"===t.type?e=ke:"relu"===t.type?e=qe:"softplus"===t.type?e=$e:"tanh"===t.type&&(e=Me),i.createLayer(e,(function(e){e.setSize(t.size)}))}));var u=i.getNetwork();u.getLayers().forEach((function(t,e){t.W=new bt(o.layers[e].weights.W.length,o.layers[e].weights.W[0].length,o.layers[e].weights.W),t.b=new bt(o.layers[e].weights.b.length,o.layers[e].weights.b[0].length,o.layers[e].weights.b)})),e(u)}}))}))}}],(n=[{key:"firstLayerTransition",value:function(t){t.setWidth(this.dimensions[0])}}])&&qr(e.prototype,n),o&&qr(e,o),c}(ie);function Jr(t){return Jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jr(t)}function Gr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Xr(t,e){return Xr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Xr(t,e)}function Yr(t,e){if(e&&("object"===Jr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function tn(t){return tn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},tn(t)}var en=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Xr(t,e)}(c,t);var e,n,o,i,u,a=(i=c,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=tn(i);if(u){var r=tn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Yr(this,t)});function c(){return Gr(this,c),a.apply(this,arguments)}return e=c,o=[{key:"fromJSON",value:function(t){return new Promise((function(e,n){r.readFile(t,(function(t,r){if(t)n(t);else{var o=JSON.parse(r.toString()),i=new c(o.size);o.layers.forEach((function(t){"logistic"===t.type?i.createLayer(We,(function(e){e.setSize(t.size)})):"softmax"===t.type?i.createLayer(ke,(function(e){e.setSize(t.size)})):"relu"===t.type?i.createLayer(qe,(function(e){e.setSize(t.size)})):"softplus"===t.type?i.createLayer($e,(function(e){e.setSize(t.size)})):"tanh"===t.type?i.createLayer(Me,(function(e){e.setSize(t.size)})):"conv"===t.type?i.createLayer(dr,(function(e){e.setSize(t.size),e.setFilterSize(t.filterSize),e.setStride(t.stride),e.setNumFilters(t.numFilters),e.setPadding(t.padding)})):"maxpool"===t.type?i.createLayer(zr,(function(e){e.setSize(t.size),e.setFilterSize(t.filterSize),e.setStride(t.stride)})):"fullyconnected"===t.type&&i.createLayer(zr)}));var u=i.getNetwork();u&&(u.getLayers().forEach((function(t,e){t.W=o.layers.W,t.b=o.layers.b})),e(u))}}))}))}}],(n=[{key:"firstLayerTransition",value:function(t){this.dimensions&&t.setSize(this.dimensions)}}])&&$r(e.prototype,n),o&&$r(e,o),c}(ie);function rn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function on(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var un=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(rn(this,t),on(this,"exampleSize",0),on(this,"numberOfExamples",0),on(this,"data",null),this.exampleSize=e,this.numberOfExamples=r,n){for(var o=[],i=0;i<e;i+=1){o[i]=new Array(r);for(var u=0;u<r;u+=1)"string"==typeof n[i][u]?o[i][u]=n[i][u].length?Number(n[i][u]):NaN:"number"==typeof n[i][u]&&(o[i][u]=n[i][u])}this.data=new bt(this.exampleSize,this.numberOfExamples,o)}}var e,r,n;return e=t,n=[{key:"fromMatrix",value:function(e){var r=new t;return r.exampleSize=e.rows,r.numberOfExamples=e.cols,r.data=e,r}}],(r=[{key:"exampleAt",value:function(t){return this.data.col(t)}},{key:"getNumberOfExamples",value:function(){return this.numberOfExamples}},{key:"getExampleSize",value:function(){return this.exampleSize}},{key:"getBatch",value:function(e,r){var n=this.data.block(0,e,this.data.rows,r);return t.fromMatrix(n)}}])&&nn(e.prototype,r),n&&nn(e,n),t}();function an(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var cn=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"fromSource",value:function(t){return new Promise((function(e){t.then((function(t){var r=t.parse(),n=r.cols,o=r.rows,i=new un(o,n,r.data);e(i)}))}))}}],null&&an(e.prototype,null),r&&an(e,r),t}();function sn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function fn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ln(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var yn=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ln(this,"vocabularySize",0),ln(this,"dataSize",0),ln(this,"data",""),this.data=e.toLowerCase();var r,n=function(t){if(Array.isArray(t))return sn(t)}(r=new Set(this.data.split("").sort()))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||function(t,e){if(t){if("string"==typeof t)return sn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?sn(t,e):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();this.chars=n,this.dataSize=this.data.length,this.vocabularySize=n.length}var e,r;return e=t,r=[{key:"getExamples",value:function(){return this.data.replace(/\n+/,"\n").split("\n").map((function(t){return t+"\n"}))}},{key:"getVocabularySize",value:function(){return this.vocabularySize}},{key:"getCharsLength",value:function(){return this.chars.length}},{key:"getCharIndices",value:function(){var t={};return this.chars.forEach((function(e,r){t[e]=r})),t}},{key:"buildData",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=[],n=[],o=0;o<this.data.length;o+=e)r.push(this.data.substr(o,t)),n.push(this.data[o+t]);return[r,n]}},{key:"vectorization",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,o=t.length,i=new dt(o,n,r).setZeros(),u=new bt(o,r).setZeros(),a=this.getCharIndices();return t.forEach((function(t,r){t.split("").forEach((function(t,e){i.data[r][e][a[t]]=1})),u.data[r][a[e[r]]]=1})),[i,u]}}],r&&fn(e.prototype,r),t}();function hn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var pn=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"fromSource",value:function(t){return new Promise((function(e){t.then((function(t){var r=t.parse();e(new yn(r))}))}))}}],null&&hn(e.prototype,null),r&&hn(e,r),t}();function bn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function dn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var vn=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),dn(this,"batchSize",0),dn(this,"t",0),dn(this,"learningRate",0)}var e,r;return e=t,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"setT",value:function(t){return this.t=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}}])&&bn(e.prototype,r),t}();function wn(t){return wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wn(t)}function mn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function On(t,e){return On=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},On(t,e)}function Sn(t,e){if(e&&("object"===wn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return kn(t)}function kn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function jn(t){return jn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},jn(t)}function Pn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var _n=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&On(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=jn(n);if(o){var r=jn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Sn(this,t)});function u(){var t;mn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Pn(kn(t=i.call.apply(i,[this].concat(r))),"beta1",.9),Pn(kn(t),"beta2",.999),t}return e=u,(r=[{key:"setBeta1",value:function(t){return this.beta1=t,this}},{key:"setBeta2",value:function(t){return this.beta2=t,this}},{key:"optimize",value:function(t){this.adam(t,this.learningRate,this.t)}},{key:"adam",value:function(t,e,r){t.vW=t.vW.multiply(this.beta1).add(t.gW.multiply(1-this.beta1)),t.vb=t.vb.multiply(this.beta1).add(t.gb.multiply(1-this.beta1)),t.sW=t.sW.multiply(this.beta2).add(t.gW.pow(2).multiply(1-this.beta2)),t.sb=t.sb.multiply(this.beta2).add(t.gb.pow(2).multiply(1-this.beta2));var n=t.vW.divide(1-Math.pow(this.beta1,2)),o=t.vb.divide(1-Math.pow(this.beta1,2)),i=t.sW.divide(1-Math.pow(this.beta2,2)),u=t.sb.divide(1-Math.pow(this.beta2,2));t.W=t.W.subtract(n.multiply(e).divide(i.sqrt().add(1e-8))),t.b=t.b.subtract(o.multiply(e).divide(u.sqrt().add(1e-8)))}}])&&gn(e.prototype,r),u}(vn);function Rn(t){return Rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rn(t)}function xn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function En(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Wn(t,e){return Wn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Wn(t,e)}function Tn(t,e){if(e&&("object"===Rn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function zn(t){return zn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},zn(t)}var Dn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Wn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=zn(n);if(o){var r=zn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Tn(this,t)});function u(){return xn(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.gradientDescent(t,this.learningRate)}},{key:"gradientDescent",value:function(t,e){t.W=t.W.subtract(t.gW.multiply(e)),t.b=t.b.subtract(t.b.multiply(e))}}])&&En(e.prototype,r),u}(vn);function Cn(t){return Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cn(t)}function Bn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ln(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mn(t,e){return Mn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Mn(t,e)}function Kn(t,e){if(e&&("object"===Cn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function An(t){return An=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},An(t)}var Nn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=An(n);if(o){var r=An(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Kn(this,t)});function u(){return Bn(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.adagrad(t,this.learningRate)}},{key:"adagrad",value:function(t,e){t.dW=t.dW.add(t.gW.pow(2)),t.W=t.W.subtract(t.gW.multiply(e).divide(t.dW.sqrt().add(1e-8)).multiply(t.gW)),t.db=t.db.add(t.gb.pow(2)),t.b=t.b.subtract(t.db.multiply(e).divide(t.db.sqrt().add(1e-8)).multiply(t.gb))}}])&&Ln(e.prototype,r),u}(vn);function Zn(t){return Zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zn(t)}function Fn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Hn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function qn(t,e){return qn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},qn(t,e)}function In(t,e){if(e&&("object"===Zn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Qn(t)}function Qn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Un(t){return Un=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Un(t)}function Vn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Jn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Un(n);if(o){var r=Un(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return In(this,t)});function u(){var t;Fn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Vn(Qn(t=i.call.apply(i,[this].concat(r))),"beta",.9),t}return e=u,(r=[{key:"optimize",value:function(t){this.momentum(t,this.learningRate)}},{key:"setBeta",value:function(t){return this.beta=t,this}},{key:"momentum",value:function(t,e){t.vW=t.gW.multiply(this.beta).add(t.gW.multiply(1-this.beta)),t.vb=t.gb.multiply(this.beta).add(t.gb.multiply(1-this.beta)),t.W=t.W.subtract(t.vW.multiply(e)),t.b=t.b.subtract(t.vb.multiply(e))}}])&&Hn(e.prototype,r),u}(vn);function Gn(t){return Gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gn(t)}function $n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Yn(t,e){return Yn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Yn(t,e)}function to(t,e){if(e&&("object"===Gn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return eo(t)}function eo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ro(t){return ro=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ro(t)}function no(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var oo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Yn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ro(n);if(o){var r=ro(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return to(this,t)});function u(){var t;$n(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return no(eo(t=i.call.apply(i,[this].concat(r))),"alpha",.001),no(eo(t),"beta",.9),t}return e=u,(r=[{key:"setBeta",value:function(t){return this.beta=t,this}},{key:"setAlpha",value:function(t){return this.alpha=t,this}},{key:"optimize",value:function(t){this.rmsprop(t,this.learningRate,this.alpha,this.beta)}},{key:"rmsprop",value:function(t,e,r,n){t.sW=t.sW.multiply(n).add(t.gW.pow(2).multiply(1-n)),t.sb=t.sb.multiply(n).add(t.gb.pow(2).multiply(1-n)),t.W=t.W.subtract(t.gW.multiply(r).divide(t.sW.sqrt().add(1e-8))),t.b=t.b.subtract(t.gb.multiply(r).divide(t.sb.sqrt().add(1e-8)))}}])&&Xn(e.prototype,r),u}(vn);function io(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function uo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ao=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),uo(this,"network",null),uo(this,"optimizer",null),uo(this,"regularization",1e-4),uo(this,"iterations",1e3),uo(this,"learningRate",.001),uo(this,"verbose",!0),uo(this,"verboseStep",1),uo(this,"stepCallback",(function(t){})),this.network=e,this.optimizer=r}var e,r;return e=t,r=[{key:"setRegularization",value:function(t){return this.regularization=t,this}},{key:"setIterations",value:function(t){return this.iterations=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}},{key:"setVerbose",value:function(t){return this.verbose=t,this}},{key:"setVerboseStep",value:function(t){return this.verboseStep=t,this}},{key:"setStepCallback",value:function(t){return this.stepCallback=t,this}},{key:"cost",value:function(t,e){var r=t.cols,n=0,o=0;this.network.getLayers().forEach((function(t){o+=t.penalty()}));for(var i=this.network.forward(t),u=e,a=-1/r*e.multiply(i.log()).sum()+this.regularization/(o*(2*t.cols)),c=0;c<i.cols;c+=1)i.colMaxCoeffIndex(c)===u.colMaxCoeffIndex(c)&&n++;return{cost:a,accuracy:n/r*100}}}],r&&io(e.prototype,r),t}();function co(t){return co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},co(t)}function so(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function lo(t,e){return lo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},lo(t,e)}function yo(t,e){if(e&&("object"===co(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ho(t)}function ho(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function po(t){return po=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},po(t)}function bo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var vo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lo(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=po(n);if(o){var r=po(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return yo(this,t)});function u(){var t;so(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return bo(ho(t=i.call.apply(i,[this].concat(r))),"batchSize",100),t}return e=u,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"train",value:function(t,e){var r=this,n=t.getNumberOfExamples(),o=0;this.optimizer.setBatchSize(this.batchSize),this.optimizer.setLearningRate(this.learningRate);for(var i=0;i<this.iterations;i+=1){for(var u=(new Date).getTime(),a=(new Date).getTime(),c=0,s=0;c<n;c+=this.batchSize,s+=this.batchSize){var f=(new Date).getTime(),l=t.getBatch(s,this.batchSize),y=e.getBatch(s,this.batchSize),h=this.network.forward(l.data);if(this.network.backward(l.data,y.data,h,this.regularization),this.optimizer.setT(++o),this.network.getLayers().forEach((function(t){r.optimizer.optimize(t)})),this.verbose){var p=this.cost(l.data,y.data),b=(new Date).getTime();console.log("Batch: ".concat(s," / ").concat(n," | Batch time: ").concat(b-f,"ms | Time from start: ").concat(tr((b-a)/1e3,1),"s. | Cost: ").concat(tr(p.cost,2)," | Acc: ").concat(p.accuracy))}}if(this.verbose&&(i+1)%this.verboseStep==0){var d=(new Date).getTime(),v=this.cost(t.data,e.data);console.log("Iteration: ".concat(i+1," | Cost: ").concat(tr(v.cost,5)," | Accuracy: ").concat(v.accuracy,"% | Time: ").concat((d-u)/1e3," s."))}this.stepCallback({iteration:i})}return this}}])&&fo(e.prototype,r),u}(ao);function wo(t){return wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wo(t)}function mo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function go(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Oo(t,e){return Oo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Oo(t,e)}function So(t,e){if(e&&("object"===wo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ko(t){return ko=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ko(t)}var jo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Oo(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ko(n);if(o){var r=ko(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return So(this,t)});function u(){return mo(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"train",value:function(t,e){var r=this,n=t.getNumberOfExamples(),o=0;this.optimizer.setBatchSize(n),this.optimizer.setLearningRate(this.learningRate);for(var i=0;i<this.iterations;i+=1){var u=(new Date).getTime(),a=this.network.forward(t.data);if(this.network.backward(t.data,e.data,a,this.regularization),this.optimizer.setT(++o),this.network.getLayers().forEach((function(t){r.optimizer.optimize(t)})),this.verbose&&(i+1)%this.verboseStep==0){var c=this.cost(t.data,e.data),s=(new Date).getTime();console.log("Iteration: ".concat(i+1," | Cost: ").concat(tr(c.cost,5)," | Accuracy: ").concat(tr(c.accuracy,2),"% | Time: ").concat((s-u)/1e3," s."))}this.stepCallback({iteration:i})}return this}}])&&go(e.prototype,r),u}(ao),Po=function t(e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(r="dataset")in this?Object.defineProperty(this,r,{value:null,enumerable:!0,configurable:!0,writable:!0}):this[r]=null,this.dataset=e};function _o(t){return _o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_o(t)}function Ro(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Eo(t,e){return Eo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Eo(t,e)}function Wo(t,e){if(e&&("object"===_o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return To(t)}function To(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function zo(t){return zo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},zo(t)}function Do(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Co=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Eo(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=zo(n);if(o){var r=zo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Wo(this,t)});function u(){var t;Ro(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Do(To(t=i.call.apply(i,[this].concat(r))),"callback",(function(t){return t})),t}return e=u,(r=[{key:"apply",value:function(){for(var t=0;t<this.dataset.getNumberOfExamples();t+=1)for(var e=this.callback(this.dataset.exampleAt(t)),r=0;r<this.dataset.data.rows;r+=1)e&&(this.dataset.data.data[r][t]=e.data[r][0]);return this.dataset}},{key:"setCallback",value:function(t){return this.callback=t,this}}])&&xo(e.prototype,r),u}(Po);function Bo(t){return Bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bo(t)}function Lo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Mo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ko(t,e){return Ko=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ko(t,e)}function Ao(t,e){if(e&&("object"===Bo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function No(t){return No=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},No(t)}var Zo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ko(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=No(n);if(o){var r=No(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ao(this,t)});function u(){return Lo(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"apply",value:function(){for(var t=1/0,e=-1/0,r=0;r<this.dataset.getNumberOfExamples();r+=1)for(var n=this.dataset.exampleAt(r),o=0;o<n.rows;o+=1)t>n.data[o][0]&&(t=n.data[o][0]),e<n.data[o][0]&&(e=n.data[o][0]);for(var i=0;i<this.dataset.getNumberOfExamples();i+=1)for(var u=this.dataset.exampleAt(i),a=0;a<u.rows;a+=1)this.dataset.data.data[a][i]=(u.data[a][0]-t)/(e-t);return this.dataset}}])&&Mo(e.prototype,r),u}(Po);function Fo(t){return Fo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fo(t)}function Ho(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Io(t,e){return Io=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Io(t,e)}function Qo(t,e){if(e&&("object"===Fo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Uo(t)}function Uo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Vo(t){return Vo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Vo(t)}function Jo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Go=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Io(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Vo(n);if(o){var r=Vo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Qo(this,t)});function u(){var t;Ho(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Jo(Uo(t=i.call.apply(i,[this].concat(r))),"modificationType","mean"),t}return e=u,(r=[{key:"apply",value:function(){for(var t=this,e=[],r=0,n=0,o=0,i=0;i<this.dataset.getNumberOfExamples();i+=1)for(var u=this.dataset.exampleAt(i),a=0;a<this.dataset.getExampleSize();a+=1)isNaN(u.data[a][0])||void 0===u.data[a][0]?e.push({row:a,col:u}):(n+=u.data[a][0],r++);return"mean"===this.modificationType&&(o=n/r),e.forEach((function(e){var r=e.row,n=e.col;t.dataset&&t.dataset.data&&t.dataset.data.data&&(t.dataset.data.data[r][n]=o)})),this.dataset}},{key:"setModificationType",value:function(t){return this.modificationType=t,this}}])&&qo(e.prototype,r),u}(Po),$o=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)};const Xo=require("csvtojson");function Yo(t){return Yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yo(t)}function ti(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ei(t,e){return ei=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ei(t,e)}function ri(t,e){if(e&&("object"===Yo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ni(t)}function ni(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function oi(t){return oi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},oi(t)}function ii(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ui;!function(t){t[t.UnquotedField=0]="UnquotedField",t[t.QuotedField=1]="QuotedField",t[t.QuotedQuote=2]="QuotedQuote"}(ui||(ui={}));var ai=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ei(t,e)}(a,t);var e,r,n,o,i,u=(o=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=oi(o);if(i){var r=oi(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ri(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),ii(ni(e=u.call(this)),"data",null),ii(ni(e),"matrixData",null),e.data=t,e}return e=a,n=[{key:"fromLocalFile",value:function(t){return new Promise((function(e){Xo({noheader:!0,output:"csv"}).fromFile(t).then((function(t){e(new a(t))}))}))}}],(r=[{key:"parse",value:function(){var t=this.data.length,e=this.data[0].length;return new bt(t,e,this.data).transpose()}}])&&ti(e.prototype,r),n&&ti(e,n),a}($o);function ci(t){return ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ci(t)}function si(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function fi(t,e){return fi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},fi(t,e)}function li(t,e){if(e&&("object"===ci(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return yi(t)}function yi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hi(t){return hi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},hi(t)}var pi={NetworkBuilder1D:Vr,NetworkBuilder3D:en},bi={Matrix:bt},di={SoftmaxLayer:ke,LogisticLayer:We,ReluLayer:qe,SoftplusLayer:$e,TanhLayer:Me,ConvLayer:dr,MaxPoolLayer:zr,FullyConnectedLayer:kr,RNNLayer:Zr},vi={DatasetBuilder:cn,DatasetVocabularyBuilder:pn},wi={OptimizerAdam:_n,OptimizerGradientDescent:Dn,OptimizerAdagrad:Nn,OptimizerMomentum:Jn,OptimizerRMSProp:oo},mi={MiniBatchTrainer:vo,Trainer:jo},gi={CallbackDatabaseModifier:Co,MinMaxScalingDatabaseModifier:Zo,MissingDataScalingDatabaseModifier:Go},Oi={ComputationCPU:ct,ComputationGPU:D,setComputation:function(t){st=t},getComputation:ft},Si={Dataset:un},ki={DatasetBuilderSourceCSV:ai,DatasetVocabularyBuilderSourceTextFile:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fi(t,e)}(c,(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}));var e,n,o,i,u,a=(i=c,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=hi(i);if(u){var r=hi(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return li(this,t)});function c(t){var e,r,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),"",(n="data")in(r=yi(e=a.call(this)))?Object.defineProperty(r,n,{value:"",enumerable:!0,configurable:!0,writable:!0}):r.data="",e.data=t,e}return e=c,o=[{key:"fromLocalFile",value:function(t){return new Promise((function(e,n){r.readFile(t,(function(t,r){t?n(t):e(new c(r.toString("utf-8")))}))}))}}],(n=[{key:"parse",value:function(){return this.data}}])&&si(e.prototype,n),o&&si(e,o),c}()},ji={NetworkRNN:gt};module.exports=e})();
//# sourceMappingURL=impulse-ts.js.map