(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Computation:()=>Yu,Dataset:()=>$u,DatasetBuilder:()=>Vu,DatasetBuilderSource:()=>Gu,DatasetModifier:()=>Xu,Layer:()=>Uu,Math:()=>qu,Network:()=>ta,NetworkBuilder:()=>Iu,Optimizer:()=>Qu,Trainer:()=>Ju});const r=require("fs");function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,u(n.key),n)}}function i(t,e,r){return(e=u(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t){var e=function(t,e){if("object"!==n(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,"string");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===n(e)?e:String(e)}var a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,"dimensions",null),i(this,"size",0),i(this,"layers",[]),this.dimensions=e}var e,n;return e=t,(n=[{key:"addLayer",value:function(t){return this.size++,this.layers.push(t),this}},{key:"getLayers",value:function(){return this.layers}},{key:"forward",value:function(t){var e=t;return this.layers.forEach((function(t){e=t.forward(e)})),e}},{key:"backward",value:function(t,e,r,n){for(var o=t.cols,i=r.subtract(e),u=this.layers.length-1;u>=0;u-=1)i=this.layers[u].getBackPropagation().propagate(t,o,n,this.layers[u],this.layers[u].derivative(i))}},{key:"save",value:function(t){var e={dimensions:this.dimensions,layers:[]};this.layers.forEach((function(t){e.layers.push({type:t.getType(),size:t.getSize(),weights:{W:t.W.data,b:t.b.data}})}));var n=JSON.stringify(e);return new Promise((function(e,o){r.writeFile(t,n,(function(t){t&&(console.error(t),o()),e(n)}))}))}}])&&o(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function f(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function l(t){var e=function(t,e){if("object"!==c(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===c(e)?e:String(e)}var s=function(){function t(){var e,r,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=this,n={},(r=l(r="kernels"))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n}var e,r;return e=t,r=[{key:"addKernel",value:function(t,e){return this.kernels[t]=e,this}},{key:"execute",value:function(t){if(!this.kernels[t])throw new Error("Kernel '".concat(t,"' not exists."));for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.kernels[t].apply(null,r)}}],r&&f(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function p(t,e){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},p(t,e)}function h(t,e){if(e&&("object"===y(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function b(t){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},b(t)}var v=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=gpu.createKernel((function(t,e){return t[this.thread.x][this.thread.y]/e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new wt(t.rows,t.cols,r(t.data,e.data))},d=function(t,e){var r=gpu.createKernel((function(t){return t[this.thread.x][this.thread.y]/this.constants.number})).setOutput([t.rows,t.cols]).setConstants({number:e});return new wt(t.rows,t.cols,r(t.data))},m=function(t){var e=gpu.createKernel((function(t){return Math.exp(t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]),r=new wt(t.rows,t.cols,e(t.data)),n=new wt(1,t.cols,r.colwiseSum().data).replicate(t.rows,1);return new wt(t.rows,t.cols,v(r,n).data)},w=function(t,e){var r=gpu.createKernel((function(t){return Math.log(t[this.thread.x][this.thread.y])})).setOutput([e.rows,e.cols]);return new wt(t.rows,t.cols,D(t,new wt(t.rows,t.cols,r(e.data))).data).sum()},g=function(t){var e=gpu.createKernel((function(t){return 1/(1+Math.exp(-t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new wt(t.rows,t.cols,e(t.data))},O=function(t,e){var r=gpu.createKernel((function(t){return Math.log(t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]),n=gpu.createKernel((function(t){return 1-t[this.thread.x][this.thread.y]})).setOutput([t.rows,t.cols]),o=gpu.createKernel((function(t){return Math.log(1-t[this.thread.x][this.thread.y])})).setOutput([e.rows,e.cols]);return x(D(t,new wt(t.rows,t.cols,r(t.data))),D(new wt(t.rows,t.cols,n(t.data)),new wt(e.rows,e.cols,o(e.data)))).sum()},S=function(t){var e=gpu.createKernel((function(t){return 2/(1+Math.exp(-2*t[this.thread.x][this.thread.y]))-1})).setOutput([t.rows,t.cols]);return new wt(t.rows,t.cols,e(t.data))},j=function(t){var e=gpu.createKernel((function(t){return Math.max(0,t[this.thread.x][this.thread.y])})).setOutput([t.rows,t.cols]);return new wt(t.rows,t.cols,e(t.data))},P=function(t){var e=gpu.createKernel((function(t){return Math.log(1+Math.exp(t[this.thread.x][this.thread.y]))})).setOutput([t.rows,t.cols]);return new wt(t.rows,t.cols,e(t.data))},k=function(t){var e=gpu.createKernel((function(t){return Math.pow(t[this.thread.x][this.thread.y],2)})).setOutput([t.rows,t.cols]);return new wt(t.rows,t.cols,e(t.data)).sum()},E=function(t){var e=gpu.createKernel((function(t){return Math.sqrt(t[this.thread.x][this.thread.y]+1e-8)})).setOutput([t.rows,t.cols]);return new wt(t.rows,t.cols,e(t.data))},_=function(t,e){var r=gpu.createKernel((function(t,e){return e[this.thread.x][this.thread.y]-Math.pow(t[this.thread.x][this.thread.y],2)})).setOutput([t.rows,t.cols]);return new wt(t.rows,t.cols,r(t.data)).sum()},R=function(t,e){if(t.cols!==e.rows)throw new Error("DIMENSIONS error. m1.cols ".concat(t.cols," !== m2.rows ").concat(e.rows,"."));var r=gpu.createKernel((function(t,e){for(var r=0,n=0;n<this.constants.cols;n++)r+=t[this.thread.x][n]*e[n][this.thread.y];return r})).setOutput([t.rows,e.cols]).setConstants({cols:t.rows});return new wt(t.rows,e.cols,r(t.data,e.data))},x=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=gpu.createKernel((function(t,e){return t[this.thread.x][this.thread.y]+e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new wt(t.rows,e.cols,r(t.data,e.data))},W=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=gpu.createKernel((function(t,e){return t[this.thread.x][this.thread.y]-e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new wt(t.rows,e.cols,r(t.data,e.data))},T=function(t,e){var r=gpu.createKernel((function(){return Math.random()-.5})).setOutput([t.rows,t.cols]).setConstants({parameter:e});return new wt(t.rows,t.cols,r())},z=function(t){var e=gpu.createKernel((function(){return 0})).setOutput([t.rows,t.cols]);return new wt(t.rows,t.cols,e())},D=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");var r=gpu.createKernel((function(t,e){return t[this.thread.x][this.thread.y]*e[this.thread.x][this.thread.y]})).setOutput([t.rows,e.cols]);return new wt(t.rows,e.cols,r(t.data,e.data))},C=function(t,e){var r=gpu.createKernel((function(t){return t[this.thread.x][this.thread.y]*this.constants.number})).setOutput([t.rows,t.cols]).setConstants({number:e});return new wt(t.rows,t.cols,r(t.data))},M=function(t){var e=gpu.createKernel((function(t){return t[this.thread.y][this.thread.x]})).setOutput([t.cols,t.rows]);return new wt(t.cols,t.rows,e(t.data))},B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=b(r);if(n){var o=b(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return h(this,t)});function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this)).addKernel("multiply",R),t.addKernel("add",x),t.addKernel("subtract",W),t.addKernel("fillRandom",T),t.addKernel("fillZeros",z),t.addKernel("elementWiseMultiply",D),t.addKernel("multiplyNumber",C),t.addKernel("elementWiseDivide",v),t.addKernel("divideNumber",d),t.addKernel("softmaxActivation",m),t.addKernel("softmaxLoss",w),t.addKernel("logisticActivation",g),t.addKernel("logisticLoss",O),t.addKernel("tanhActivation",S),t.addKernel("reluActivation",j),t.addKernel("softplusActivation",P),t.addKernel("penalty",k),t.addKernel("sqrt",E),t.addKernel("purelinLoss",_),t.addKernel("transpose",M),t}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(s);function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function A(t,e){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},A(t,e)}function N(t,e){if(e&&("object"===L(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function K(t){return K=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},K(t)}var Z=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal.");for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)r[n][o]=t.data[n][o]/e.data[n][o]}return new wt(t.rows,e.cols,r)},F=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)r[n][o]=t.data[n][o]/e}return new wt(t.rows,t.cols,r)},H=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)e[r][n]=1/(1+Math.exp(-t.data[r][n]))}return wt.from(e)},I=function(t,e){for(var r=[],n=0;n<e.rows;n+=1){r[n]=[];for(var o=0;o<e.cols;o+=1)e.data&&(r[n][o]=Math.log(e.data[n][o]+1e-8))}for(var i=nt(new wt(e.rows,e.cols,r),t),u=[],a=0;a<t.rows;a+=1){u[a]=[];for(var c=0;c<t.cols;c+=1)t.data&&(u[a][c]=1-t.data[a][c])}for(var f=new wt(t.rows,t.cols,u),l=[],s=0;s<e.rows;s+=1){l[s]=[];for(var y=0;y<e.cols;y+=1)e.data&&(l[s][y]=Math.log(1-e.data[s][y]+1e-8))}var p=new wt(e.rows,e.cols,l);return G(nt(ot(i,-1),t),nt(ot(p,-1),it(f,1))).sum()},q=function(t,e){return H(e).multiply(H(e).minusOne())},U=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)e[r][n]=(1-Math.exp(-2*t.data[r][n]))/(1+Math.exp(-2*t.data[r][n]))}return wt.from(e)},V=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.max(0,t.data[r][n]))}return new wt(t.rows,t.cols,e)},Q=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=e.data[n][o]>0?1:0)}return nt(new wt(t.rows,t.cols,r),t)},J=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.log(1+Math.exp(t.data[r][n])))}return new wt(t.rows,t.cols,e)},X=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.pow(t.data[r][n],2))}return new wt(t.rows,t.cols,e).sum()},Y=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)t.data&&(e[r][n]=Math.sqrt(t.data[r][n]+1e-8))}return new wt(t.rows,t.cols,e)},$=function(t,e){if(t.cols!==e.rows)throw new Error("DIMENSIONS error. m1.cols ".concat(t.rows," ").concat(t.cols," !== m2.rows ").concat(e.rows," ").concat(e.cols,"."));for(var r=[],n=0;n<t.rows;++n){r[n]=new Array(e.cols);for(var o=0;o<e.cols;++o){r[n][o]=0;for(var i=0;i<t.cols;++i)t.data&&e.data&&(r[n][o]+=t.data[n][i]*e.data[i][o])}}return new wt(t.rows,e.cols,r)},G=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal.");if(t.cols!==e.cols)throw new Error("COLS number not equal. m1.cols ".concat(t.cols," !== m2.cols ").concat(e.cols));for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&e.data&&(r[n][o]=t.data[n][o]+e.data[n][o])}return new wt(t.rows,t.cols,r)},tt=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal: m1.rows ".concat(t.rows," !== m2.rows ").concat(e.rows));if(t.cols!==e.cols)throw new Error("COLS number not equal: m1.cols ".concat(t.cols," !== m2.cols ").concat(e.cols));for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&e.data&&(r[n][o]=t.data[n][o]-e.data[n][o])}return new wt(t.rows,t.cols,r)},et=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)r[n][o]=(4*Math.random()-2)*Math.sqrt(2/e)}return new wt(t.rows,t.cols,r)},rt=function(t){for(var e=[],r=0;r<t.rows;r+=1){e[r]=[];for(var n=0;n<t.cols;n+=1)e[r][n]=0}return new wt(t.rows,t.cols,e)},nt=function(t,e){if(t.rows!==e.rows)throw new Error("ROWS number not equal: m1.rows ".concat(t.rows," !== m2.rows ").concat(e.rows));if(t.cols!==e.cols)throw new Error("COLS number not equal: m1.cols ".concat(t.cols," !== m2.cols ").concat(e.cols));for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&e.data&&(r[n][o]=t.data[n][o]*e.data[n][o])}return new wt(t.rows,t.cols,r)},ot=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=t.data[n][o]*e)}return new wt(t.rows,t.cols,r)},it=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=e-t.data[n][o])}return new wt(t.rows,t.cols,r)},ut=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=Math.pow(t.data[n][o],e))}return new wt(t.rows,t.cols,r)},at=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=Math.log(t.data[n][o]+1e-8))}return new wt(t.rows,t.cols,r)},ct=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)t.data&&(r[n][o]=Math.log(1-t.data[n][o]))}return new wt(t.rows,t.cols,r)},ft=function(t,e){for(var r=[],n=0;n<t.rows;n+=1){r[n]=[];for(var o=0;o<t.cols;o+=1)r[n][o]=t.data[n][o]+e}return new wt(t.rows,t.cols,r)},lt=function(t){for(var e=[],r=0;r<t.cols;r+=1){e[r]=[];for(var n=0;n<t.rows;n+=1)t.data&&(e[r][n]=t.data[n][r])}return new wt(t.cols,t.rows,e)},st=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&A(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=K(r);if(n){var o=K(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return N(this,t)});function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this)).addKernel("multiply",$),t.addKernel("add",G),t.addKernel("subtract",tt),t.addKernel("subtractFromNumber",it),t.addKernel("fillRandom",et),t.addKernel("fillZeros",rt),t.addKernel("elementWiseMultiply",nt),t.addKernel("multiplyNumber",ot),t.addKernel("elementWiseDivide",Z),t.addKernel("divideNumber",F),t.addKernel("logisticActivation",H),t.addKernel("logisticLoss",I),t.addKernel("logisticBackpropagation",q),t.addKernel("tanhActivation",U),t.addKernel("reluActivation",V),t.addKernel("reluBackpropagation",Q),t.addKernel("softplusActivation",J),t.addKernel("penalty",X),t.addKernel("sqrt",Y),t.addKernel("transpose",lt),t.addKernel("pow",ut),t.addKernel("log",at),t.addKernel("logMinusOne",ct),t.addKernel("addNumber",ft),t}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(s),yt=new st,pt=function(){return yt};function ht(t){return ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ht(t)}function bt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function vt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,mt(n.key),n)}}function dt(t,e,r){return(e=mt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mt(t){var e=function(t,e){if("object"!==ht(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ht(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===ht(e)?e:String(e)}var wt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;bt(this,t),dt(this,"rows",0),dt(this,"cols",0),dt(this,"data",null),this.resize(e,r),n&&this.generateData(n)}var e,r,n;return e=t,r=[{key:"resize",value:function(t,e){this.rows=t,this.cols=e,this.data=[];for(var r=0;r<this.rows;r+=1)this.data[r]=new Array(this.cols);return this}},{key:"generateData",value:function(t){for(var e=[],r=0;r<this.rows;r+=1)e[r]=new Array(this.cols);for(var n=0;n<this.cols;n+=1)for(var o=0;o<this.rows;o+=1)"number"==typeof t[o]?e[o][n]=t[o]:t[o]instanceof Float32Array||t[o]&&"number"==typeof t[o][n]?e[o][n]=t[o][n]:"string"==typeof t[o][n]?e[o][n]=t[o][n].length?Number(t[o][n]):NaN:e[o][n]=NaN;return this.data=e,this}},{key:"sum",value:function(){for(var t=0,e=0;e<this.rows;e+=1)for(var r=0;r<this.cols;r+=1)t+=this.data[e][r];return t}},{key:"colwiseSum",value:function(){for(var e=[],r=this.transpose(),n=0;n<r.rows;n+=1){e[n]=[0];for(var o=0;o<r.cols;o+=1)e[n][0]+=r.data[n][o]}return new t(this.cols,1,e)}},{key:"rowwiseSum",value:function(){for(var e=[[]],r=0;r<this.rows;r+=1){for(var n=0,o=0;o<this.cols;o+=1)n+=this.data[r][o];e[0].push(n)}return new t(1,this.rows,e)}},{key:"flatten",value:function(){for(var t=[],e=0;e<this.rows;e+=1)for(var r=0;r<this.cols;r+=1)t.push(this.data[e][r]);return t}},{key:"replicate",value:function(e,r){if(1===e&&1===this.cols&&r>1){for(var n=[],o=0;o<this.rows;o+=1){n[o]=[];for(var i=0;i<r;i+=1)n[o][i]=this.data[o][0]}return t.from(n)}if(1===r&&1===this.rows&&e>1){for(var u=[],a=0;a<e;a+=1){u[a]=[];for(var c=0;c<this.cols;c+=1)u[a][c]=this.data[0][c]}return t.from(u)}return this}},{key:"transpose",value:function(){return pt().execute("transpose",this)}},{key:"colMaxCoeffIndex",value:function(t){for(var e=-1,r=-1/0,n=0;n<this.rows;n+=1)this.data&&this.data[n][t]>r&&(r=this.data[n][t],e=n);return e}},{key:"rowMaxCoeffIndex",value:function(t){for(var e=-1,r=-1/0,n=0;n<this.cols;n+=1)this.data[t][n]>r&&(r=this.data[t][n],e=n);return e}},{key:"block",value:function(e,r,n,o){for(var i=[],u=e,a=0;u<this.rows&&u<e+n;u+=1,a+=1){i[a]=new Array(o);for(var c=r,f=0;c<this.cols&&c<r+o;c+=1,f+=1)i[a][f]=this.data[u][c]}return new t(n,o,i)}},{key:"col",value:function(e){for(var r=[],n=0;n<this.rows;n+=1)r[n]=[this.data[n][e]];return new t(this.rows,1,r)}},{key:"row",value:function(e){for(var r=[],n=0;n<this.cols;n+=1)r[n]=[this.data[e][n]];return new t(this.cols,1,r)}},{key:"setCol",value:function(t,e){for(var r=0;r<this.rows;r+=1)this.data&&e.data&&(this.data[r][t]=e.data[r][0]);return this}},{key:"sigmoid",value:function(){return this.multiply(-1).exp().add(1).fraction(1)}},{key:"rollToColMatrix",value:function(){for(var e=[],r=0,n=0;n<this.rows;n+=1)for(var o=0;o<this.cols;o+=1)e[r]=[],e[r++][0]=this.data[n][o];return t.from(e)}},{key:"abs",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=Math.abs(this.data[r][n])}return t.from(e)}},{key:"mean",value:function(){for(var t=0,e=this.rows*this.cols,r=0;r<this.rows;r+=1)for(var n=0;n<this.cols;n+=1)t+=this.data[r][n];return t/e}},{key:"max",value:function(){for(var t=-1/0,e=0;e<this.rows;e+=1)for(var r=0;r<this.cols;r+=1)t=Math.max(this.data[e][r],t);return t}},{key:"setMax",value:function(e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=Math.min(this.data[n][o],e)}return t.from(r)}},{key:"setMin",value:function(e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=Math.max(this.data[n][o],e)}return t.from(r)}},{key:"setZeros",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=0}return t.from(e)}},{key:"setOnes",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=1}return t.from(e)}},{key:"setRandom",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=(4*Math.random()-2)*Math.sqrt(2/e)}return t.from(r)}},{key:"fraction",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=e/this.data[n][o]}return t.from(r)}},{key:"sqrt",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=Math.sqrt(this.data[r][n]+1e-8)}return t.from(e)}},{key:"dot",value:function(t){return pt().execute("multiply",this,t)}},{key:"multiply",value:function(e){if("number"==typeof e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=this.data[n][o]*e}return t.from(r)}if(e.rows!==this.rows||this.cols!==e.cols)throw new Error("Dimension error: ".concat(this.shape()," !== ").concat(e.shape()));for(var i=[],u=0;u<this.rows;u+=1){i[u]=[];for(var a=0;a<this.cols;a+=1)i[u][a]=this.data[u][a]*e.data[u][a]}return t.from(i)}},{key:"subtract",value:function(e){if(e instanceof t){if(this.rows!==e.rows||this.cols!==e.cols)throw new Error("Dimensions error: ".concat(this.rows,", ").concat(this.cols," !== ").concat(e.rows,", ").concat(e.cols));for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=this.data[n][o]-e.data[n][o]}return t.from(r)}for(var i=[],u=0;u<this.rows;u+=1){i[u]=[];for(var a=0;a<this.cols;a+=1)i[u][a]=this.data[u][a]-e}return t.from(i)}},{key:"forEach",value:function(e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=e(this.data[n][o])}return t.from(r)}},{key:"shape",value:function(){return[this.rows,this.cols]}},{key:"divide",value:function(e){if("number"==typeof e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=this.data[n][o]/e}return t.from(r)}if(e.rows!==this.rows||e.cols!==this.cols)throw new Error("Dimensions error (".concat(this.rows,", ").concat(this.cols,") !== (").concat(e.rows,", ").concat(e.cols,")"));for(var i=[],u=0;u<this.rows;u+=1){i[u]=[];for(var a=0;a<this.cols;a+=1)i[u][a]=this.data[u][a]/e.data[u][a]}return t.from(i)}},{key:"minusOne",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=1-this.data[r][n]}return t.from(e)}},{key:"subtractFromNumber",value:function(e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=e-this.data[n][o]}return t.from(r)}},{key:"add",value:function(e){if("number"==typeof e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=this.data[n][o]+e}return t.from(r)}if(e instanceof t){if(e.rows!==this.rows||e.cols!==this.cols)throw new Error("Dimention error: rows (x: ".concat(this.rows,", y: ").concat(this.cols,") !== (x: ").concat(e.rows,", y: ").concat(e.cols,")"));for(var i=[],u=0;u<this.rows;u+=1){i[u]=[];for(var a=0;a<this.cols;a+=1)i[u][a]=this.data[u][a]+e.data[u][a]}return t.from(i)}return this}},{key:"log",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=Math.log(this.data[r][n]+1e-8)}return t.from(e)}},{key:"tanh",value:function(){return this.exp().subtract(this.multiply(-1).exp()).divide(this.exp().add(this.multiply(-1).exp()))}},{key:"softmax",value:function(){var t=this.max()-1e-8;return this.subtract(t).exp().divide(this.rowwiseSum().replicate(this.cols,1).transpose())}},{key:"exp",value:function(){for(var e=[],r=0;r<this.rows;r+=1){e[r]=[];for(var n=0;n<this.cols;n+=1)e[r][n]=Math.exp(this.data[r][n]+1e-8)}return t.from(e)}},{key:"pow",value:function(e){for(var r=[],n=0;n<this.rows;n+=1){r[n]=[];for(var o=0;o<this.cols;o+=1)r[n][o]=Math.pow(this.data[n][o],e)}return t.from(r)}}],n=[{key:"from",value:function(e){var r;return new t(e.length,(null===(r=e[0])||void 0===r?void 0:r.length)||0,e)}}],r&&vt(e.prototype,r),n&&vt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function gt(t){return gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gt(t)}function Ot(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,u,a=[],c=!0,f=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==e);c=!0);}catch(t){f=!0,o=t}finally{try{if(!c&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(f)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return St(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?St(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function St(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function jt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,kt(n.key),n)}}function Pt(t,e,r){return(e=kt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function kt(t){var e=function(t,e){if("object"!==gt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==gt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===gt(e)?e:String(e)}var Et,_t=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Pt(this,"dimensions",null),Pt(this,"size",0),Pt(this,"layers",[]),this.dimensions=e}var e,r;return e=t,(r=[{key:"addLayer",value:function(t){return this.size++,this.layers.push(t),this}},{key:"getLayers",value:function(){return this.layers}},{key:"loss",value:function(t,e){return-Math.log(1/t)*e}},{key:"sample",value:function(t){for(var e=this.layers[0].Waa,r=this.layers[0].Wax,n=this.layers[0].Wya,o=this.layers[0].by,i=this.layers[0].b,u=[],a=t.getCharIndices(),c=a["\n"],f=t.getChars(),l=new wt(this.dimensions[1],1).setZeros(),s=new wt(this.dimensions[0],1).setRandom(this.dimensions[1]),y=-1,p=0;y!=c&&50!=p;){var h=r.dot(l).add(e.dot(s)).add(i).setMin(.001).tanh(),b=n.dot(h).add(o).softmax();y=a[f[b.colMaxCoeffIndex(0)]],l=new wt(this.dimensions[1],1).setZeros();var v=b.colMaxCoeffIndex(0);-1===v&&(v=Math.floor(Math.random()*this.dimensions[1]),y=a[f[v]]),l.data[v][0]=1,u.push(y),s=h,p+=1}return 50===p&&u.push(c),u.map((function(t){return f[t]})).join("")}},{key:"forward",value:function(t,e,r){for(var n=[null],o=[r],i=[null],u=0,a=1;a<=t.rows;a+=1){n[a]=new wt(this.dimensions[1],this.dimensions[0]).setZeros(),n[a].data[t.data[a-1][0]][0]=1;var c=Ot(this.layers[0].forward(n[a],o[a-1]),2),f=c[0],l=c[1];o[a]=f,i[a]=l,u+=0}return this.layers[0].A=o,this.layers[0].X=n,this.layers[0].Y=i,[u]}},{key:"backward",value:function(t){for(var e=this.layers[0].A,r=this.layers[0].X,n=(this.layers[0].Y,new wt(this.layers[0].Wax.rows,this.layers[0].Wax.cols).setZeros()),o=new wt(this.layers[0].Waa.rows,this.layers[0].Waa.cols).setZeros(),i=new wt(this.layers[0].Wya.rows,this.layers[0].Wya.cols).setZeros(),u=new wt(this.layers[0].db.rows,this.layers[0].db.cols).setZeros(),a=new wt(this.layers[0].dby.rows,this.layers[0].dby.cols).setZeros(),c=new wt(this.layers[0].daNext.rows,this.layers[0].daNext.rows).setZeros(),f=t.rows-1;f>=1;f-=1){var l=wt.from(e[f].data);l.data[t.data[f-1][0]][0]-=1;var s=this.layers[0].backward(l,r[f],e[f],e[f-1]),y=s.dWax,p=s.dWya,h=s.dWaa,b=s.db,v=s.dby,d=s.daNext;n=n.add(y.replicate(1,n.cols)),o=o.add(h.replicate(1,o.cols)),i=i.add(p),u=u.add(b),a=a.add(v),c=c.add(d)}this.layers[0].dWax=n.setMin(-5).setMax(5),this.layers[0].dWaa=o.setMin(-5).setMax(5),this.layers[0].dWya=i.setMin(-5).setMax(5),this.layers[0].db=a.setMin(-5).setMax(5),this.layers[0].dby=a.setMin(-5).setMax(5),this.layers[0].daNext=c.setMin(-5).setMax(5)}},{key:"optimize",value:function(t,e,r,n){var o=Ot(this.forward(t,e,r),1)[0];return this.backward(t),this.layers[0].Wax=this.layers[0].Wax.add(this.layers[0].dWax.replicate(1,this.getDimensions()[2]).multiply(-n)),this.layers[0].Waa=this.layers[0].Waa.add(this.layers[0].dWaa.multiply(-n)),this.layers[0].Wya=this.layers[0].Wya.add(this.layers[0].dWya.multiply(-n)),[o,this.layers[0].A[t.rows-1]]}},{key:"getDimensions",value:function(){return this.dimensions}}])&&jt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Rt(t){return Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rt(t)}function xt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,zt(n.key),n)}}function Wt(t,e,r){return e&&xt(t.prototype,e),r&&xt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Tt(t,e,r){return(e=zt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function zt(t){var e=function(t,e){if("object"!==Rt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Rt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Rt(e)?e:String(e)}!function(t){t.logistic="logistic",t.softmax="softmax",t.tanh="tanh",t.relu="relu",t.softplus="softplus",t.conv="conv",t.maxpool="maxpool",t.fullyconnected="fullyconnected",t.purelin="purelin",t.rnnlayer="rnnlayer"}(Et||(Et={}));var Dt=Wt((function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Tt(this,"layer",null),Tt(this,"previousLayer",null),this.layer=e,this.previousLayer=r}));function Ct(t){return Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ct(t)}function Mt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Bt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Ct(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ct(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ct(o)?o:String(o)),n)}var o}function Lt(t,e){return Lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Lt(t,e)}function At(t,e){if(e&&("object"===Ct(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Nt(t){return Nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Nt(t)}var Kt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Nt(n);if(o){var r=Nt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return At(this,t)});function u(){return Mt(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"propagate",value:function(t,e,r,n,o){var i=null!==this.previousLayer?this.previousLayer.A:t,u=o.dot(i.transpose());if(this.layer.gW=u.divide(e).add(n.W.multiply(r/e)),this.layer.gb=o.rowwiseSum().transpose().divide(e),null!==this.previousLayer){var a=this.layer.W.transpose().dot(o);if(a.rows!==i.rows||a.cols!==i.cols)throw new Error("Dimension error 1. (".concat(a.rows,", ").concat(a.cols,") | (").concat(i.rows,", ").concat(i.cols,")"));if(this.layer.gW.rows!==this.layer.W.rows||this.layer.gW.cols!==this.layer.W.cols)throw new Error("Dimension error 2. (".concat(this.layer.gW.rows,", ").concat(this.layer.gW.cols,") | (").concat(this.layer.W.rows,", ").concat(this.layer.W.cols,")"));if(this.layer.gb.rows!==this.layer.b.rows||this.layer.gb.cols!==this.layer.b.cols)throw new Error("Dimension error 3. (".concat(this.layer.gb.rows,", ").concat(this.layer.gb.cols,") | (").concat(this.layer.b.rows,", ").concat(this.layer.b.cols,")"));return a}return new wt}}])&&Bt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Dt);function Zt(t){return Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zt(t)}function Ft(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ht(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Zt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Zt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Zt(o)?o:String(o)),n)}var o}function It(t,e){return It=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},It(t,e)}function qt(t,e){if(e&&("object"===Zt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ut(t){return Ut=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ut(t)}var Vt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&It(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ut(n);if(o){var r=Ut(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return qt(this,t)});function u(){return Ft(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"propagate",value:function(t,e,r,n,o){return o}}])&&Ht(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Dt);function Qt(t){return Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qt(t)}function Jt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,re(n.key),n)}}function Yt(t,e){return Yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Yt(t,e)}function $t(t,e){if(e&&("object"===Qt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Gt(t)}function Gt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function te(t){return te=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},te(t)}function ee(t,e,r){return(e=re(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function re(t){var e=function(t,e){if("object"!==Qt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Qt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Qt(e)?e:String(e)}var ne=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Yt(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=te(n);if(o){var r=te(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return $t(this,t)});function u(){var t;Jt(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return ee(Gt(t=i.call.apply(i,[this].concat(r))),"previousLayer",null),t}return e=u,(r=[{key:"propagate",value:function(t,e,r,n,o){var i=this.previousLayer;if(i){for(var u=pt().execute("fillZeros",new wt(i.Z.rows,i.Z.cols)),a=i.getFilterSize(),c=i.getStride(),f=i.getWidth(),l=i.getHeight(),s=(i.getDepth(),i.getOutputWidth()),y=i.getOutputHeight(),p=i.getOutputDepth(),h=0;h<e;h++)for(var b=0;b<p;b++)for(var v=0;v<y;v++)for(var d=0;d<s;d++){for(var m=c*d,w=-1/0,g=l*f*b,O=y*s*b,S=0,j=0,P=0,k=c*v;P<a;P++,k++)for(var E=0,_=m;E<a;E++,_++)i.Z.data&&w<i.Z.data[g+k*f+_][h]&&(w=i.Z.data[g+k*f+_][h],S=_,j=k);u.data&&o.data&&(u.data[g+j*f+S][h]=o.data[O+v*s+d][h])}return u}return new wt}}])&&Xt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Dt);function oe(t){return oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oe(t)}function ie(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ye(n.key),n)}}function ae(t,e){return ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ae(t,e)}function ce(t,e){if(e&&("object"===oe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return fe(t)}function fe(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function le(t){return le=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},le(t)}function se(t,e,r){return(e=ye(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ye(t){var e=function(t,e){if("object"!==oe(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===oe(e)?e:String(e)}var pe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ae(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=le(n);if(o){var r=le(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ce(this,t)});function u(){var t;ie(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return se(fe(t=i.call.apply(i,[this].concat(r))),"previousLayer",null),t}return e=u,(r=[{key:"propagate",value:function(t,e,r,n,o){var i=this.previousLayer;if(i){var u=i.getPadding(),a=i.getStride(),c=i.getFilterSize(),f=i.getOutputWidth(),l=i.getOutputHeight(),s=i.getOutputDepth(),y=i.getWidth(),p=i.getHeight(),h=i.getDepth(),b=pt().execute("fillZeros",new wt((y+2*u)*(p+2*u)*h,e)),v=new wt(y*p*h,e);i.gW=pt().execute("fillZeros",i.gW),i.gb=pt().execute("fillZeros",i.gb);for(var d=0;d<e;d++){for(var m=0;m<s;m++)for(var w=0;w<l;w++)for(var g=0;g<f;g++){for(var O=a*w,S=a*g,j=0;j<h;j++)for(var P=0,k=O,E=-u;P<c;P++,k++,E++)for(var _=0,R=S,x=-u;_<c;_++,R++,x++){i.W.data&&b.data&&o.data&&(b.data[j*(y+2*u)*(p+2*u)+k*(y+2*u)+R][d]+=i.W.data[m][j*c*c+P*c+_]*o.data[m*f*l+w*f+g][d]);var W=0;0==u?i.Z.data&&(W=i.Z.data[j*y*p+k*y+R][d]):E>=0&&x>=0&&E<p&&x<y&&i.Z.data&&(W=i.Z.data[j*y*p+E*y+x][d]),i.gW.data&&o.data&&(i.gW.data[m][j*c*c+P*c+_]+=W*o.data[m*(f*l)+w*f+g][d]/e)}i.gb.data&&o.data&&(i.gb.data[m][0]+=o.data[m*(f*l)+w*f+g][d]/e)}if(u>0)for(var T=0;T<h;T++)for(var z=-u,D=0;z<p+u;z++,D++)for(var C=-u,M=0;C<y+u;C++,M++)C>=0&&z>=0&&C<y&&z<p&&v.data&&b.data&&(v.data[T*y*p+z*y+C][d]=b.data[T*(y+2*u)*(p+2*u)+D*(y+2*u)+M][d])}return u>0?v:b}}}])&&ue(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Dt);function he(t){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},he(t)}function be(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==he(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==he(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===he(o)?o:String(o)),n)}var o}var ve=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"create",value:function(t,e){if(null==t){if(e.is1D())return new Kt(e,t);if(e.getType()==Et.conv)return new Vt(e,t)}else{if(t.getType()==Et.maxpool)return new ne(e,t);if(t.getType()==Et.conv)return new pe(e,t);if(t.is1D()||t.getType()==Et.fullyconnected)return new Kt(e,t)}return null}}],null&&be(e.prototype,null),r&&be(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function de(t){return de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},de(t)}function me(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function we(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Oe(n.key),n)}}function ge(t,e,r){return(e=Oe(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Oe(t){var e=function(t,e){if("object"!==de(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==de(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===de(e)?e:String(e)}var Se=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ge(this,"dimensions",null),ge(this,"size",0),ge(this,"layers",[]),this.dimensions=e}var e,r;return e=t,(r=[{key:"addLayer",value:function(t){return this.size++,this.layers.push(t),this}},{key:"getLayers",value:function(){return this.layers}},{key:"loss",value:function(t,e){return-Math.log(1/t)*e}},{key:"sample",value:function(t){}},{key:"forward",value:function(t,e){for(var r=this,n=(t.length,t[0].rows),o=t[0].cols,i=this.layers[0].Wy.rows,u=this.layers[0].Wy.cols,a=(new Array(u).map((function(){return new wt(n,o).setZeros()})),new Array(u).map((function(){return new wt(n,o).setZeros()})),new Array(i).map((function(){return new wt(n,o).setZeros()})),e),c=new wt(u,n).setZeros(),f=function(e){var n=[];t.forEach((function(t,r){n[r]=[];for(var o=0;o<t.rows;o+=1)n[r].push(t.data[o][e])}));var o,i,u=wt.from(n),f=(o=r.layers[0].forward(u,a,c),i=3,function(t){if(Array.isArray(t))return t}(o)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,u,a=[],c=!0,f=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==e);c=!0);}catch(t){f=!0,o=t}finally{try{if(!c&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(f)throw o}}return a}}(o,i)||function(t,e){if(t){if("string"==typeof t)return me(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?me(t,e):void 0}}(o,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());f[0],f[1],f[2]},l=0;l<o;l+=1)f(l)}},{key:"backward",value:function(t){t.length,t[0].rows;for(var e=t[0].cols,r=(this.layers[0].x1.rows,e-1);r>=0;r-=1);}}])&&we(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function je(t){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},je(t)}function Pe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ke(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_e(n.key),n)}}function Ee(t,e,r){return(e=_e(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _e(t){var e=function(t,e){if("object"!==je(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===je(e)?e:String(e)}var Re=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DNN";Pe(this,t),Ee(this,"dimensions",null),Ee(this,"lastLayer",null),Ee(this,"network",null),this.dimensions=e,"DNN"===r?this.network=new a(this.dimensions):"RNN"===r?this.network=new _t(this.dimensions):"LSTM"===r&&(this.network=new Se(this.dimensions))}var e,r;return e=t,r=[{key:"createLayer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=new t;return"function"==typeof e&&e(r),null===this.lastLayer?this.firstLayerTransition(r):r.transition(this.lastLayer),r.configure(),r.setBackPropagation(ve.create(this.lastLayer,r)),this.network.addLayer(r),this.lastLayer=r,this}},{key:"getNetwork",value:function(){return this.network}}],r&&ke(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function xe(t){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xe(t)}function We(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ze(n.key),n)}}function Te(t,e,r){return(e=ze(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ze(t){var e=function(t,e){if("object"!==xe(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==xe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===xe(e)?e:String(e)}var De=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Te(this,"width",0),Te(this,"height",0),Te(this,"depth",0),Te(this,"previousLayer",null),Te(this,"backPropagation",null)}var e,r;return e=t,(r=[{key:"setBackPropagation",value:function(t){return this.backPropagation=t,this}},{key:"getBackPropagation",value:function(){return this.backPropagation}},{key:"setWidth",value:function(t){return this.width=t,this}},{key:"getWidth",value:function(){return this.width}},{key:"setHeight",value:function(t){return this.height=t,this}},{key:"getHeight",value:function(){return this.height}},{key:"setDepth",value:function(t){return this.depth=t,this}},{key:"getDepth",value:function(){return this.depth}},{key:"transition",value:function(t){return this.previousLayer=t,this}}])&&We(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ce(t){return Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ce(t)}function Me(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Fe(n.key),n)}}function Be(){return Be="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Le(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Be.apply(this,arguments)}function Le(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ze(t)););return t}function Ae(t,e){return Ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ae(t,e)}function Ne(t,e){if(e&&("object"===Ce(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ke(t)}function Ke(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ze(t){return Ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ze(t)}function Fe(t){var e=function(t,e){if("object"!==Ce(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ce(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Ce(e)?e:String(e)}var He=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ae(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ze(n);if(o){var r=Ze(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ne(this,t)});function u(){var t,e,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),e=Ke(t=i.call(this)),1,(r=Fe(r="depth"))in e?Object.defineProperty(e,r,{value:1,enumerable:!0,configurable:!0,writable:!0}):e[r]=1,t.W=new wt,t.b=new wt,t.A=new wt,t.Z=new wt,t.gW=new wt,t.gb=new wt,t.vW=new wt,t.vb=new wt,t.sW=new wt,t.sb=new wt,t.dW=new wt,t.db=new wt,t}return e=u,(r=[{key:"configure",value:function(){this.W.resize(this.getHeight(),this.getWidth()),this.W=this.W.setRandom(this.previousLayer?this.previousLayer.getHeight():this.getHeight()),this.b.resize(this.getHeight(),1),this.b=this.b.setRandom(this.previousLayer?this.previousLayer.getHeight():this.getHeight()),this.gW.resize(this.getHeight(),this.getWidth()),this.gW=this.W.setZeros(),this.gb.resize(this.getHeight(),1),this.gb=this.gb.setZeros(),this.sW.resize(this.getHeight(),this.getWidth()),this.sW=this.sW.setZeros(),this.sb.resize(this.getHeight(),1),this.sb=this.sb.setZeros(),this.vW.resize(this.getHeight(),this.getWidth()),this.vW=this.vW.setZeros(),this.vb.resize(this.getHeight(),1),this.vb=this.vb.setZeros(),this.dW.resize(this.getHeight(),this.getWidth()),this.dW=this.dW.setZeros(),this.db.resize(this.getHeight(),1),this.db=this.db.setZeros()}},{key:"forward",value:function(t){return this.Z=this.W.dot(t).add(this.b.replicate(1,t.cols)),this.A=this.activation(this.Z),this.A}},{key:"is1D",value:function(){return!0}},{key:"is3D",value:function(){return!1}},{key:"transition",value:function(t){return t.is1D()?this.setWidth(t.getSize()):t.is3D()&&this.setWidth(t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth()),Be(Ze(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){return this.setHeight(t),this}},{key:"getSize",value:function(){return this.height}},{key:"getOutputWidth",value:function(){return this.width}},{key:"getOutputHeight",value:function(){return this.height}},{key:"getOutputDepth",value:function(){return 1}},{key:"penalty",value:function(){return this.W.pow(2).sum()}}])&&Me(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(De);function Ie(t){return Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ie(t)}function qe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Ie(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ie(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ie(o)?o:String(o)),n)}var o}function Ve(t,e){return Ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ve(t,e)}function Qe(t,e){if(e&&("object"===Ie(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Je(t){return Je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Je(t)}var Xe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ve(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Je(n);if(o){var r=Je(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Qe(this,t)});function u(){return qe(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.softmax()}},{key:"getType",value:function(){return Et.softmax}},{key:"derivative",value:function(t){return t.multiply(-1).add(1).fraction(1)}}])&&Ue(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(He);function Ye(t){return Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ye(t)}function $e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ge(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Ye(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ye(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ye(o)?o:String(o)),n)}var o}function tr(t,e){return tr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tr(t,e)}function er(t,e){if(e&&("object"===Ye(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function rr(t){return rr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},rr(t)}var nr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=rr(n);if(o){var r=rr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return er(this,t)});function u(){return $e(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.multiply(-1).exp().add(1).fraction(1)}},{key:"getType",value:function(){return Et.logistic}},{key:"derivative",value:function(t){return t.multiply(this.activation(t).multiply(this.activation(t.minusOne())))}}])&&Ge(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(He);function or(t){return or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},or(t)}function ir(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ur(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==or(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==or(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===or(o)?o:String(o)),n)}var o}function ar(t,e){return ar=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ar(t,e)}function cr(t,e){if(e&&("object"===or(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function fr(t){return fr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fr(t)}var lr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ar(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=fr(n);if(o){var r=fr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return cr(this,t)});function u(){return ir(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.tanh()}},{key:"getType",value:function(){return Et.tanh}},{key:"derivative",value:function(t){return this.activation(t).pow(2).minusOne()}}])&&ur(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(He);function sr(t){return sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sr(t)}function yr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==sr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==sr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===sr(o)?o:String(o)),n)}var o}function hr(t,e){return hr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},hr(t,e)}function br(t,e){if(e&&("object"===sr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function vr(t){return vr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vr(t)}var dr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=vr(n);if(o){var r=vr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return br(this,t)});function u(){return yr(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.setMax(0)}},{key:"getType",value:function(){return Et.relu}},{key:"derivative",value:function(t){return pt().execute("reluBackpropagation",t,this.A)}}])&&pr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(He);function mr(t){return mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mr(t)}function wr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==mr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==mr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===mr(o)?o:String(o)),n)}var o}function Or(t,e){return Or=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Or(t,e)}function Sr(t,e){if(e&&("object"===mr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function jr(t){return jr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},jr(t)}var Pr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Or(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=jr(n);if(o){var r=jr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Sr(this,t)});function u(){return wr(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"activation",value:function(t){return t.exp().add(1).log()}},{key:"getType",value:function(){return Et.softplus}},{key:"derivative",value:function(t){return t.multiply(-1).exp().add(1).fraction(1)}}])&&gr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(He),kr=function(t,e,r,n,o,i,u,a,c,f){for(var l=0,s=new wt(((n-i+2*a)/f+1)*((r-o+2*u)/c+1),i*o*e).setZeros(),y=-u;y+o<=r+u;y+=c)for(var p=-a;p+i<=n+a;p+=f){for(var h=0,b=0;b<e;b++)for(var v=r*n*b,d=0;d<o;d++)for(var m=0;m<i;m++)y+d>=0&&p+m>=0&&p+m<n&&y+d<r&&(s.data[l][h]=t.data[(d+y)*n+p+m+v][0]),h++;l++}return s},Er=function(t,e,r,n,o,i,u,a){for(var c=(n-i)/a+1,f=(r-o)/u+1,l=0,s=new wt(c*f*e,1).setZeros(),y=0;y+o<=r;y+=u)for(var p=0;p+i<=n;p+=a){for(var h=0;h<e;h++){for(var b=-1/0,v=r*n*h,d=c*f*h,m=0;m<o;m++)for(var w=0;w<i;w++)b=Math.max(b,t.data[v+(m+y)*n+p+w][0]);s.data[d+l][0]=b}l++}return s},_r=function(t,e){return Math.round((t+Number.EPSILON)*Math.pow(10,e))/Math.pow(10,e)};function Rr(t){return Rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rr(t)}function xr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Rr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Rr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Rr(o)?o:String(o)),n)}var o}function Wr(){return Wr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Tr(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Wr.apply(this,arguments)}function Tr(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Cr(t)););return t}function zr(t,e){return zr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},zr(t,e)}function Dr(t,e){if(e&&("object"===Rr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Cr(t){return Cr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Cr(t)}var Mr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Cr(n);if(o){var r=Cr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Dr(this,t)});function u(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this)).W=new wt,t.b=new wt,t.A=new wt,t.Z=new wt,t.gW=new wt,t.gb=new wt,t.vW=new wt,t.vb=new wt,t.sW=new wt,t.sb=new wt,t.dW=new wt,t.db=new wt,t}return e=u,(r=[{key:"configure",value:function(){}},{key:"is1D",value:function(){return!1}},{key:"is3D",value:function(){return!0}},{key:"transition",value:function(t){return t.is3D()&&this.setSize([t.getOutputWidth(),t.getOutputHeight(),t.getOutputDepth()]),Wr(Cr(u.prototype),"transition",this).call(this,t),this}},{key:"setSize",value:function(t){return this.setWidth(t[0]),this.setHeight(t[1]),this.setDepth(t[2]),this}},{key:"getSize",value:function(){return[this.getWidth(),this.getHeight(),this.getDepth()]}},{key:"penalty",value:function(){return this.W.pow(2).sum()}}])&&xr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(De);function Br(t){return Br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Br(t)}function Lr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ar(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ir(n.key),n)}}function Nr(t,e){return Nr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Nr(t,e)}function Kr(t,e){if(e&&("object"===Br(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Zr(t)}function Zr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Fr(t){return Fr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Fr(t)}function Hr(t,e,r){return(e=Ir(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ir(t){var e=function(t,e){if("object"!==Br(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Br(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Br(e)?e:String(e)}var qr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Fr(n);if(o){var r=Fr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Kr(this,t)});function u(){var t;Lr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Hr(Zr(t=i.call.apply(i,[this].concat(r))),"numFilters",32),Hr(Zr(t),"filterSize",4),Hr(Zr(t),"padding",1),Hr(Zr(t),"stride",1),t}return e=u,(r=[{key:"configure",value:function(){this.W.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.W=this.W.setRandom(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth()),this.b.resize(this.numFilters,1),this.b=this.b.setRandom(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth()),this.gW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.gW=this.gW.setZeros(),this.gb.resize(this.numFilters,1),this.gb=this.gb.setZeros(),this.sW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.sW=this.sW.setZeros(),this.sb.resize(this.numFilters,1),this.sb=this.sb.setZeros(),this.vW.resize(this.numFilters,this.filterSize*this.filterSize*this.depth),this.vW=this.vW.setZeros(),this.vb.resize(this.numFilters,1),this.vb=this.vb.setZeros()}},{key:"getOutputHeight",value:function(){return(this.width-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.height-this.filterSize+2*this.padding)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.numFilters}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setNumFilters",value:function(t){return this.numFilters=t,this}},{key:"getNumFilters",value:function(){return this.numFilters}},{key:"setPadding",value:function(t){return this.padding=t,this}},{key:"getPadding",value:function(){return this.padding}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"forward",value:function(t){for(var e=new wt(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols).setZeros(),r=0;r<t.cols;r+=1){var n=kr(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.padding,this.padding,this.stride,this.stride),o=this.W.dot(n.transpose()).add(this.b.replicate(1,n.rows));e.setCol(r,o.rollToColMatrix())}return this.Z=e,this.A=this.activation(this.Z),this.A}},{key:"activation",value:function(t){return t.setMin(0)}},{key:"getType",value:function(){return Et.conv}},{key:"derivative",value:function(t){return pt().execute("reluBackpropagation",t,this.A)}}])&&Ar(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Mr);function Ur(t){return Ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ur(t)}function Vr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Ur(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ur(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ur(o)?o:String(o)),n)}var o}function Jr(t,e){return Jr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Jr(t,e)}function Xr(t,e){if(e&&("object"===Ur(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Yr(t){return Yr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Yr(t)}var $r=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Jr(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Yr(n);if(o){var r=Yr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Xr(this,t)});function u(){return Vr(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"transition",value:function(t){if(!t.is3D())throw new Error("Invalid usage. Cannot fully connect with previous 1D Layer.");if(t.getType()!=Et.maxpool)throw new Error("Invalid usage. Cannot fully connect with previous non maxpool Layer.");return this.filterSize=t.getOutputWidth(),this.padding=0,this.stride=1,this.width=t.getOutputWidth(),this.height=t.getOutputHeight(),this.depth=t.getOutputDepth(),this.numFilters=t.getOutputWidth()*t.getOutputHeight()*t.getOutputDepth(),this}},{key:"setSize",value:function(t){return this}},{key:"setFilterSize",value:function(t){return this}},{key:"setStride",value:function(t){return this}},{key:"setPadding",value:function(t){return this}},{key:"setWidth",value:function(t){return this}},{key:"setHeight",value:function(t){return this}},{key:"setDepth",value:function(t){return this}},{key:"setNumFilters",value:function(t){return this}}])&&Qr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(qr);function Gr(t){return Gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gr(t)}function tn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function en(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,cn(n.key),n)}}function rn(t,e){return rn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},rn(t,e)}function nn(t,e){if(e&&("object"===Gr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return on(t)}function on(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function un(t){return un=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},un(t)}function an(t,e,r){return(e=cn(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function cn(t){var e=function(t,e){if("object"!==Gr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Gr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Gr(e)?e:String(e)}var fn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=un(n);if(o){var r=un(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return nn(this,t)});function u(){var t;tn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return an(on(t=i.call.apply(i,[this].concat(r))),"filterSize",0),an(on(t),"stride",0),t}return e=u,(r=[{key:"configure",value:function(){}},{key:"getOutputHeight",value:function(){return(this.height-this.filterSize)/this.stride+1}},{key:"getOutputWidth",value:function(){return(this.width-this.filterSize)/this.stride+1}},{key:"getOutputDepth",value:function(){return this.depth}},{key:"setFilterSize",value:function(t){return this.filterSize=t,this}},{key:"getFilterSize",value:function(){return this.filterSize}},{key:"setStride",value:function(t){return this.stride=t,this}},{key:"getStride",value:function(){return this.stride}},{key:"getPadding",value:function(){return 0}},{key:"forward",value:function(t){for(var e=new wt(this.getOutputWidth()*this.getOutputHeight()*this.getOutputDepth(),t.cols),r=0;r<t.cols;r+=1){var n=Er(t.col(r),this.depth,this.height,this.width,this.filterSize,this.filterSize,this.stride,this.stride);e.setCol(r,n.rollToColMatrix())}return this.Z=e,this.A=this.activation(this.Z),this.A}},{key:"activation",value:function(t){return t}},{key:"getType",value:function(){return Et.maxpool}},{key:"derivative",value:function(t){return t}}])&&en(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Mr);function ln(t){return ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ln(t)}function sn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,mn(n.key),n)}}function pn(t,e){return pn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pn(t,e)}function hn(t,e){if(e&&("object"===ln(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return bn(t)}function bn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function vn(t){return vn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vn(t)}function dn(t,e,r){return(e=mn(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mn(t){var e=function(t,e){if("object"!==ln(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ln(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===ln(e)?e:String(e)}var wn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=vn(n);if(o){var r=vn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return hn(this,t)});function u(){var t;sn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return dn(bn(t=i.call.apply(i,[this].concat(r))),"Wax",null),dn(bn(t),"Waa",null),dn(bn(t),"Wya",null),dn(bn(t),"b",null),dn(bn(t),"by",null),dn(bn(t),"dWax",null),dn(bn(t),"dWaa",null),dn(bn(t),"dWya",null),dn(bn(t),"db",null),dn(bn(t),"dby",null),dn(bn(t),"Y",[]),dn(bn(t),"A",[]),dn(bn(t),"X",[]),dn(bn(t),"aNext",null),dn(bn(t),"aPrev",null),dn(bn(t),"daNext",null),t}return e=u,(r=[{key:"configure",value:function(){this.Wax=new wt(this.getWidth(),this.getHeight()),this.Wax=this.Wax.setRandom(this.getWidth()),this.Waa=new wt(this.getWidth(),this.getWidth()),this.Waa=this.Waa.setRandom(this.getWidth()),this.Wya=new wt(this.getDepth(),this.getWidth()),this.Wya=this.Wya.setRandom(this.getDepth()),this.b=new wt(this.getWidth(),1),this.b=this.b.setRandom(this.getWidth()),this.by=new wt(this.getDepth(),1),this.by=this.by.setRandom(this.getDepth()),this.dWax=new wt(this.getWidth(),this.getHeight()),this.dWax=this.dWax.setZeros(),this.dWaa=new wt(this.getWidth(),this.getWidth()),this.dWaa=this.dWaa.setZeros(),this.dWya=new wt(this.getDepth(),this.getWidth()),this.dWya=this.dWya.setZeros(),this.db=new wt(this.getWidth(),1),this.db=this.db.setZeros(),this.dby=new wt(this.getDepth(),1),this.dby=this.dby.setZeros(),this.daNext=new wt(this.getWidth(),this.getWidth()),this.daNext=this.daNext.setZeros()}},{key:"forward",value:function(t,e){var r=this.Wax.dot(t).add(this.Waa.dot(e).replicate(1,this.getWidth())).add(this.b.replicate(1,t.cols)).tanh(),n=this.Wya.dot(r).add(this.by.replicate(1,t.cols)).softmax();return this.A.push(r),this.X.push(t),this.Y.push(n),this.aPrev=e,[r,n]}},{key:"backward",value:function(t,e,r,n){var o=r.pow(2).minusOne().multiply(t),i=o.dot(e.transpose()),u=o.dot(n.transpose()),a=this.db,c=this.dby;return{dWax:i,dWya:this.dWya,dWaa:u,db:a,dby:c,daNext:this.Waa.transpose().dot(o)}}},{key:"activation",value:function(t){return t}},{key:"getType",value:function(){return Et.rnnlayer}},{key:"derivative",value:function(t){return t}},{key:"is1D",value:function(){return!0}},{key:"is3D",value:function(){return!1}},{key:"setSize",value:function(t){return this.setWidth(t[0]),this.setHeight(t[1]),this.setDepth(t[2]),this}},{key:"getSize",value:function(){return this.height}},{key:"getOutputWidth",value:function(){return this.width}},{key:"getOutputHeight",value:function(){return this.height}},{key:"getOutputDepth",value:function(){return this.depth}},{key:"penalty",value:function(){return 0}},{key:"getWidth",value:function(){return this.width}}])&&yn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(De);function gn(t){return gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gn(t)}function On(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Rn(n.key),n)}}function jn(t,e){return jn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},jn(t,e)}function Pn(t,e){if(e&&("object"===gn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return kn(t)}function kn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function En(t){return En=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},En(t)}function _n(t,e,r){return(e=Rn(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Rn(t){var e=function(t,e){if("object"!==gn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==gn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===gn(e)?e:String(e)}var xn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&jn(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=En(n);if(o){var r=En(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Pn(this,t)});function u(){var t;On(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return _n(kn(t=i.call.apply(i,[this].concat(r))),"Wf",null),_n(kn(t),"bf",null),_n(kn(t),"Wi",null),_n(kn(t),"bi",null),_n(kn(t),"Wc",null),_n(kn(t),"bc",null),_n(kn(t),"Wo",null),_n(kn(t),"bo",null),_n(kn(t),"Wy",null),_n(kn(t),"by",null),_n(kn(t),"dxt",null),_n(kn(t),"dWf",null),_n(kn(t),"dWi",null),_n(kn(t),"dWc",null),_n(kn(t),"dWo",null),_n(kn(t),"dbf",null),_n(kn(t),"dbi",null),_n(kn(t),"dbc",null),_n(kn(t),"dbo",null),t}return e=u,(r=[{key:"configure",value:function(){}},{key:"forward",value:function(t,e,r){var n=t.rows,o=t.cols,i=(this.Wy.rows,this.Wy.cols),u=new wt(n+i,o),a=this.Wf.dot(u).add(this.bf).sigmoid(),c=this.Wi.dot(u).add(this.bi).sigmoid(),f=this.Wc.dot(u).add(this.bc).tanh(),l=a.multiply(r).add(c.multiply(f)),s=this.Wo.dot(u).add(this.bo).sigmoid().multiply(l.tanh());return this.Wy.dot(s).add(this.by).softmax(),[s,r]}},{key:"backward",value:function(t,e){}},{key:"activation",value:function(t){return t}},{key:"getType",value:function(){return Et.rnnlayer}},{key:"derivative",value:function(t){return t}},{key:"is1D",value:function(){return!0}},{key:"is3D",value:function(){return!1}},{key:"setSize",value:function(t){return this.setWidth(t[0]),this.setHeight(t[1]),this.setDepth(t[2]),this}},{key:"getSize",value:function(){return this.height}},{key:"getOutputWidth",value:function(){return this.width}},{key:"getOutputHeight",value:function(){return this.height}},{key:"getOutputDepth",value:function(){return this.depth}},{key:"penalty",value:function(){return 0}}])&&Sn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(De);function Wn(t){return Wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wn(t)}function Tn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function zn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Wn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Wn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Wn(o)?o:String(o)),n)}var o}function Dn(t,e){return Dn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Dn(t,e)}function Cn(t,e){if(e&&("object"===Wn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Mn(t){return Mn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Mn(t)}var Bn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Dn(t,e)}(c,t);var e,n,o,i,u,a=(i=c,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Mn(i);if(u){var r=Mn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Cn(this,t)});function c(){return Tn(this,c),a.apply(this,arguments)}return e=c,o=[{key:"fromJSON",value:function(t){return new Promise((function(e,n){r.readFile(t,(function(t,r){if(t)n(t);else{var o=JSON.parse(r.toString()),i=new c(o.dimensions);o.layers.forEach((function(t){var e=null;"logistic"===t.type?e=nr:"softmax"===t.type?e=Xe:"relu"===t.type?e=dr:"softplus"===t.type?e=Pr:"tanh"===t.type&&(e=lr),i.createLayer(e,(function(e){e.setSize(t.size)}))}));var u=i.getNetwork();u.getLayers().forEach((function(t,e){t.W=new wt(o.layers[e].weights.W.length,o.layers[e].weights.W[0].length,o.layers[e].weights.W),t.b=new wt(o.layers[e].weights.b.length,o.layers[e].weights.b[0].length,o.layers[e].weights.b)})),e(u)}}))}))}}],(n=[{key:"firstLayerTransition",value:function(t){t.setWidth(this.dimensions[0])}}])&&zn(e.prototype,n),o&&zn(e,o),Object.defineProperty(e,"prototype",{writable:!1}),c}(Re);function Ln(t){return Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ln(t)}function An(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Nn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Ln(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ln(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ln(o)?o:String(o)),n)}var o}function Kn(t,e){return Kn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Kn(t,e)}function Zn(t,e){if(e&&("object"===Ln(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Fn(t){return Fn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Fn(t)}var Hn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Kn(t,e)}(c,t);var e,n,o,i,u,a=(i=c,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Fn(i);if(u){var r=Fn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Zn(this,t)});function c(){return An(this,c),a.apply(this,arguments)}return e=c,o=[{key:"fromJSON",value:function(t){return new Promise((function(e,n){r.readFile(t,(function(t,r){if(t)n(t);else{var o=JSON.parse(r.toString()),i=new c(o.size);o.layers.forEach((function(t){"logistic"===t.type?i.createLayer(nr,(function(e){e.setSize(t.size)})):"softmax"===t.type?i.createLayer(Xe,(function(e){e.setSize(t.size)})):"relu"===t.type?i.createLayer(dr,(function(e){e.setSize(t.size)})):"softplus"===t.type?i.createLayer(Pr,(function(e){e.setSize(t.size)})):"tanh"===t.type?i.createLayer(lr,(function(e){e.setSize(t.size)})):"conv"===t.type?i.createLayer(qr,(function(e){e.setSize(t.size),e.setFilterSize(t.filterSize),e.setStride(t.stride),e.setNumFilters(t.numFilters),e.setPadding(t.padding)})):"maxpool"===t.type?i.createLayer(fn,(function(e){e.setSize(t.size),e.setFilterSize(t.filterSize),e.setStride(t.stride)})):"fullyconnected"===t.type&&i.createLayer(fn)}));var u=i.getNetwork();u&&(u.getLayers().forEach((function(t,e){t.W=o.layers.W,t.b=o.layers.b})),e(u))}}))}))}}],(n=[{key:"firstLayerTransition",value:function(t){this.dimensions&&t.setSize(this.dimensions)}}])&&Nn(e.prototype,n),o&&Nn(e,o),Object.defineProperty(e,"prototype",{writable:!1}),c}(Re);function In(t){return In="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},In(t)}function qn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Un(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Qn(n.key),n)}}function Vn(t,e,r){return(e=Qn(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Qn(t){var e=function(t,e){if("object"!==In(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==In(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===In(e)?e:String(e)}var Jn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(qn(this,t),Vn(this,"exampleSize",0),Vn(this,"numberOfExamples",0),Vn(this,"data",null),this.exampleSize=e,this.numberOfExamples=r,n){for(var o=[],i=0;i<e;i+=1){o[i]=new Array(r);for(var u=0;u<r;u+=1)"string"==typeof n[i][u]?o[i][u]=n[i][u].length?Number(n[i][u]):NaN:"number"==typeof n[i][u]&&(o[i][u]=n[i][u])}this.data=new wt(this.exampleSize,this.numberOfExamples,o)}}var e,r,n;return e=t,n=[{key:"fromMatrix",value:function(e){var r=new t;return r.exampleSize=e.rows,r.numberOfExamples=e.cols,r.data=e,r}}],(r=[{key:"exampleAt",value:function(t){return this.data.col(t)}},{key:"getNumberOfExamples",value:function(){return this.numberOfExamples}},{key:"getExampleSize",value:function(){return this.exampleSize}},{key:"getBatch",value:function(e,r){var n=this.data.block(0,e,this.data.rows,r);return t.fromMatrix(n)}}])&&Un(e.prototype,r),n&&Un(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Xn(t){return Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xn(t)}function Yn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Xn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Xn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Xn(o)?o:String(o)),n)}var o}var $n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"fromSource",value:function(t){return new Promise((function(e){t.then((function(t){var r=t.parse(),n=r.cols,o=r.rows,i=new Jn(o,n,r.data);e(i)}))}))}}],null&&Yn(e.prototype,null),r&&Yn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Gn(t){return Gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gn(t)}function to(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function eo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,no(n.key),n)}}function ro(t,e,r){return(e=no(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function no(t){var e=function(t,e){if("object"!==Gn(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Gn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Gn(e)?e:String(e)}var oo=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ro(this,"vocabularySize",0),ro(this,"dataSize",0),ro(this,"data",""),this.data=e.toLowerCase();var r,n=function(t){if(Array.isArray(t))return to(t)}(r=new Set(this.data.split("").sort()))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||function(t,e){if(t){if("string"==typeof t)return to(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?to(t,e):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();this.chars=n,this.dataSize=this.data.length,this.vocabularySize=n.length}var e,r;return e=t,r=[{key:"getExamples",value:function(){return this.data.replace(/\n+/,"\n").split("\n").map((function(t){return t+"\n"}))}},{key:"getVocabularySize",value:function(){return this.vocabularySize}},{key:"getCharsLength",value:function(){return this.chars.length}},{key:"getCharIndices",value:function(){var t={};return this.chars.forEach((function(e,r){t[e]=r})),t}},{key:"buildData",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=[],n=[],o=0;o<this.data.length-t;o+=e)r.push(this.data.substr(o,t)),n.push(this.data[o+t]);return[r,n]}},{key:"vectorization",value:function(t,e){var r=this,n=t.length,o=new Array(n),i=this.getCharIndices(),u=new wt(n,this.chars.length).setZeros();return t.forEach((function(t,n){o[n]=new wt(t.length,r.chars.length).setZeros(),t.split("").forEach((function(t,e){o[n].data[e][i[t]]=1})),u.data[n][i[e[n]]]=1})),[o,u]}},{key:"getChars",value:function(){return this.chars}},{key:"getExampleX",value:function(t){var e=this,r=this.getExamples()[t],n=[];return r.split("").forEach((function(t,r){n[r]=[e.getCharIndices()[t]]})),wt.from(n)}},{key:"getExampleY",value:function(t){var e=this,r=this.getExamples()[t],n=[];return r.split("").forEach((function(t,r){n[r]=[e.getCharIndices()[t]]})),wt.from(n)}}],r&&eo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function io(t){return io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},io(t)}function uo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==io(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==io(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===io(o)?o:String(o)),n)}var o}var ao=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"fromSource",value:function(t){return new Promise((function(e){t.then((function(t){var r=t.parse();e(new oo(r))}))}))}}],null&&uo(e.prototype,null),r&&uo(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function co(t){return co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},co(t)}function fo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,so(n.key),n)}}function lo(t,e,r){return(e=so(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function so(t){var e=function(t,e){if("object"!==co(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==co(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===co(e)?e:String(e)}var yo=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),lo(this,"batchSize",0),lo(this,"t",0),lo(this,"learningRate",0)}var e,r;return e=t,(r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"setT",value:function(t){return this.t=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}}])&&fo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function po(t){return po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},po(t)}function ho(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,So(n.key),n)}}function vo(t,e){return vo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},vo(t,e)}function mo(t,e){if(e&&("object"===po(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return wo(t)}function wo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function go(t){return go=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},go(t)}function Oo(t,e,r){return(e=So(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function So(t){var e=function(t,e){if("object"!==po(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==po(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===po(e)?e:String(e)}var jo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vo(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=go(n);if(o){var r=go(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return mo(this,t)});function u(){var t;ho(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Oo(wo(t=i.call.apply(i,[this].concat(r))),"beta1",.9),Oo(wo(t),"beta2",.999),t}return e=u,(r=[{key:"setBeta1",value:function(t){return this.beta1=t,this}},{key:"setBeta2",value:function(t){return this.beta2=t,this}},{key:"optimize",value:function(t){this.adam(t,this.learningRate,this.t)}},{key:"adam",value:function(t,e,r){t.vW=t.vW.multiply(this.beta1).add(t.gW.multiply(1-this.beta1)),t.vb=t.vb.multiply(this.beta1).add(t.gb.multiply(1-this.beta1)),t.sW=t.sW.multiply(this.beta2).add(t.sW.pow(2).multiply(1-this.beta2)),t.sb=t.sb.multiply(this.beta2).add(t.sb.pow(2).multiply(1-this.beta2));var n=t.vW.divide(1-Math.pow(this.beta1,2)),o=t.vb.divide(1-Math.pow(this.beta1,2)),i=t.sW.add(1e-8).sqrt(),u=t.sb.add(1e-8).sqrt();t.W=t.W.subtract(n.divide(i).multiply(e)),t.b=t.b.subtract(o.divide(u).multiply(e))}}])&&bo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(yo);function Po(t){return Po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Po(t)}function ko(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Eo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Po(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Po(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Po(o)?o:String(o)),n)}var o}function _o(t,e){return _o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_o(t,e)}function Ro(t,e){if(e&&("object"===Po(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function xo(t){return xo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},xo(t)}var Wo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_o(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=xo(n);if(o){var r=xo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ro(this,t)});function u(){return ko(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.gradientDescent(t,this.learningRate)}},{key:"gradientDescent",value:function(t,e){t.W=t.W.subtract(t.gW.multiply(e)),t.b=t.b.subtract(t.b.multiply(e))}}])&&Eo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(yo);function To(t){return To="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},To(t)}function zo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Do(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==To(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==To(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===To(o)?o:String(o)),n)}var o}function Co(t,e){return Co=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Co(t,e)}function Mo(t,e){if(e&&("object"===To(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Bo(t){return Bo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Bo(t)}var Lo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Co(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Bo(n);if(o){var r=Bo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Mo(this,t)});function u(){return zo(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"optimize",value:function(t){this.adagrad(t,this.learningRate)}},{key:"adagrad",value:function(t,e){t.dW=t.dW.add(t.gW.pow(2)),t.W=t.W.subtract(t.gW.multiply(e).divide(t.dW.sqrt().add(1e-8)).multiply(t.gW)),t.db=t.db.add(t.gb.pow(2)),t.b=t.b.subtract(t.db.multiply(e).divide(t.db.sqrt().add(1e-8)).multiply(t.gb))}}])&&Do(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(yo);function Ao(t){return Ao="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ao(t)}function No(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ko(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Uo(n.key),n)}}function Zo(t,e){return Zo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Zo(t,e)}function Fo(t,e){if(e&&("object"===Ao(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ho(t)}function Ho(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Io(t){return Io=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Io(t)}function qo(t,e,r){return(e=Uo(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Uo(t){var e=function(t,e){if("object"!==Ao(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ao(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Ao(e)?e:String(e)}var Vo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Zo(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Io(n);if(o){var r=Io(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Fo(this,t)});function u(){var t;No(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return qo(Ho(t=i.call.apply(i,[this].concat(r))),"beta",.9),t}return e=u,(r=[{key:"optimize",value:function(t){this.momentum(t,this.learningRate)}},{key:"setBeta",value:function(t){return this.beta=t,this}},{key:"momentum",value:function(t,e){t.vW=t.gW.multiply(this.beta).add(t.gW.multiply(1-this.beta)),t.vb=t.gb.multiply(this.beta).add(t.gb.multiply(1-this.beta)),t.W=t.W.subtract(t.vW.multiply(e)),t.b=t.b.subtract(t.vb.multiply(e))}}])&&Ko(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(yo);function Qo(t){return Qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qo(t)}function Jo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ri(n.key),n)}}function Yo(t,e){return Yo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Yo(t,e)}function $o(t,e){if(e&&("object"===Qo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Go(t)}function Go(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ti(t){return ti=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ti(t)}function ei(t,e,r){return(e=ri(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ri(t){var e=function(t,e){if("object"!==Qo(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Qo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Qo(e)?e:String(e)}var ni=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Yo(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ti(n);if(o){var r=ti(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return $o(this,t)});function u(){var t;Jo(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return ei(Go(t=i.call.apply(i,[this].concat(r))),"alpha",.001),ei(Go(t),"beta",.9),t}return e=u,(r=[{key:"setBeta",value:function(t){return this.beta=t,this}},{key:"setAlpha",value:function(t){return this.alpha=t,this}},{key:"optimize",value:function(t){this.rmsprop(t,this.learningRate,this.alpha,this.beta)}},{key:"rmsprop",value:function(t,e,r,n){t.sW=t.sW.multiply(n).add(t.gW.pow(2).multiply(1-n)),t.sb=t.sb.multiply(n).add(t.gb.pow(2).multiply(1-n)),t.W=t.W.subtract(t.gW.multiply(r).divide(t.sW.sqrt().add(1e-8))),t.b=t.b.subtract(t.gb.multiply(r).divide(t.sb.sqrt().add(1e-8)))}}])&&Xo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(yo);function oi(t){return oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oi(t)}function ii(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ai(n.key),n)}}function ui(t,e,r){return(e=ai(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ai(t){var e=function(t,e){if("object"!==oi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==oi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===oi(e)?e:String(e)}var ci=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ui(this,"network",null),ui(this,"optimizer",null),ui(this,"regularization",1e-4),ui(this,"iterations",1e3),ui(this,"learningRate",.001),ui(this,"verbose",!0),ui(this,"verboseStep",1),ui(this,"stepCallback",(function(t){})),this.network=e,this.optimizer=r}var e,r;return e=t,r=[{key:"setRegularization",value:function(t){return this.regularization=t,this}},{key:"setIterations",value:function(t){return this.iterations=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}},{key:"setVerbose",value:function(t){return this.verbose=t,this}},{key:"setVerboseStep",value:function(t){return this.verboseStep=t,this}},{key:"setStepCallback",value:function(t){return this.stepCallback=t,this}},{key:"cost",value:function(t,e){var r=t.getNumberOfExamples(),n=0,o=0;this.network.getLayers().forEach((function(t){o+=t.penalty()}));for(var i=this.network.forward(t.data),u=e.data,a=-1/r*u.multiply(i.log()).sum()+this.regularization/(o*(2*t.data.cols)),c=0;c<i.cols;c+=1)i.colMaxCoeffIndex(c)===u.colMaxCoeffIndex(c)&&n++;return{cost:a,accuracy:n/r*100}}}],r&&ii(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function fi(t){return fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fi(t)}function li(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function si(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,di(n.key),n)}}function yi(t,e){return yi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yi(t,e)}function pi(t,e){if(e&&("object"===fi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return hi(t)}function hi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function bi(t){return bi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},bi(t)}function vi(t,e,r){return(e=di(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function di(t){var e=function(t,e){if("object"!==fi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==fi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===fi(e)?e:String(e)}var mi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yi(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=bi(n);if(o){var r=bi(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return pi(this,t)});function u(){var t;li(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return vi(hi(t=i.call.apply(i,[this].concat(r))),"batchSize",100),t}return e=u,r=[{key:"setBatchSize",value:function(t){return this.batchSize=t,this}},{key:"cost",value:function(t,e){var r=this.batchSize,n=t.getNumberOfExamples(),o=(Math.ceil(n/r),0),i=0,u=0;this.network.getLayers().forEach((function(t){u=t.penalty()})),(new Date).getTime(),(new Date).getTime();for(var a=0,c=0;a<n;a+=this.batchSize,c+=this.batchSize){(new Date).getTime();var f=t.getBatch(c,this.batchSize),l=e.getBatch(c,this.batchSize),s=this.network.forward(f.data);o+=-1/n*l.data.multiply(s.log()).sum()+this.regularization/(u*(2*t.data.cols));for(var y=0;y<s.cols;y+=1)s.colMaxCoeffIndex(y)===l.data.colMaxCoeffIndex(y)&&i++}return{cost:o,accuracy:i/n*100}}},{key:"train",value:function(t,e){var r=this,n=t.getNumberOfExamples(),o=0;this.optimizer.setBatchSize(this.batchSize),this.optimizer.setLearningRate(this.learningRate);for(var i=0;i<this.iterations;i+=1){for(var u=(new Date).getTime(),a=(new Date).getTime(),c=0,f=0;c<n;c+=this.batchSize,f+=this.batchSize){var l=(new Date).getTime(),s=t.getBatch(f,this.batchSize),y=e.getBatch(f,this.batchSize),p=this.network.forward(s.data);if(this.network.backward(s.data,y.data,p,this.regularization),this.optimizer.setT(++o),this.network.getLayers().forEach((function(t){r.optimizer.optimize(t)})),this.verbose){var h=this.cost(s,y),b=(new Date).getTime();console.log("Batch: ".concat(f," / ").concat(n," | Batch time: ").concat(b-l,"ms | Time from start: ").concat(_r((b-a)/1e3,1),"s. | Cost: ").concat(_r(h.cost,2)," | Acc: ").concat(h.accuracy))}}if(this.verbose&&(i+1)%this.verboseStep==0){var v=(new Date).getTime(),d=this.cost(t,e);console.log("Iteration: ".concat(i+1," | Cost: ").concat(_r(d.cost,5)," | Accuracy: ").concat(d.accuracy,"% | Time: ").concat((v-u)/1e3," s."))}this.stepCallback({iteration:i})}return this}}],r&&si(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(ci);function wi(t){return wi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wi(t)}function gi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Oi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==wi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==wi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===wi(o)?o:String(o)),n)}var o}function Si(t,e){return Si=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Si(t,e)}function ji(t,e){if(e&&("object"===wi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Pi(t){return Pi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Pi(t)}var ki=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Si(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Pi(n);if(o){var r=Pi(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ji(this,t)});function u(){return gi(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"train",value:function(t,e){var r=this,n=t.getNumberOfExamples(),o=0;this.optimizer.setBatchSize(n),this.optimizer.setLearningRate(this.learningRate);for(var i=0;i<this.iterations;i+=1){var u=(new Date).getTime(),a=this.network.forward(t.data);if(this.network.backward(t.data,e.data,a,this.regularization),this.optimizer.setT(++o),this.network.getLayers().forEach((function(t){r.optimizer.optimize(t)})),this.verbose&&(i+1)%this.verboseStep==0){var c=this.cost(t,e),f=(new Date).getTime();console.log("Iteration: ".concat(i+1," | Cost: ").concat(_r(c.cost,5)," | Accuracy: ").concat(_r(c.accuracy,2),"% | Time: ").concat((f-u)/1e3," s."))}this.stepCallback({iteration:i})}return this}}])&&Oi(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(ci);function Ei(t){return Ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ei(t)}function _i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,u,a=[],c=!0,f=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==e);c=!0);}catch(t){f=!0,o=t}finally{try{if(!c&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(f)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Ri(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ri(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ri(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function xi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ti(n.key),n)}}function Wi(t,e,r){return(e=Ti(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ti(t){var e=function(t,e){if("object"!==Ei(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ei(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Ei(e)?e:String(e)}var zi=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Wi(this,"network",null),Wi(this,"iterations",1e3),Wi(this,"learningRate",.01),this.network=e}var e,r;return e=t,(r=[{key:"train",value:function(t){for(var e=this.network.loss(t.getVocabularySize(),7),r=_i(t.buildData(100),2),n=r[0],o=r[1],i=_i(t.vectorization(n,o),2),u=i[0],a=i[1],c=new wt(this.network.getDimensions()[0],this.network.getDimensions()[0]).setZeros(),f=0;f<this.iterations;f+=1){var l=f%u.length;e=_i(this.network.forward(u[l],a,c),1)[0];var s=_i(this.network.optimize(u[l],a,c,this.learningRate),2),y=s[0];c=s[1],e=.999*e+.001*y,console.log("Iteration ".concat(f+1," | Loss: ").concat(e," | Sample: ").concat(this.network.sample(t).trim()))}return[e]}},{key:"setIterations",value:function(t){return this.iterations=t,this}},{key:"setLearningRate",value:function(t){return this.learningRate=t,this}}])&&xi(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Di(t){return Di="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Di(t)}function Ci(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Bi(n.key),n)}}function Mi(t,e,r){return e&&Ci(t.prototype,e),r&&Ci(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Bi(t){var e=function(t,e){if("object"!==Di(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Di(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Di(e)?e:String(e)}var Li=Mi((function t(e){var r,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,(n=Bi(n="dataset"))in r?Object.defineProperty(r,n,{value:null,enumerable:!0,configurable:!0,writable:!0}):r[n]=null,this.dataset=e}));function Ai(t){return Ai="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ai(t)}function Ni(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ki(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ui(n.key),n)}}function Zi(t,e){return Zi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Zi(t,e)}function Fi(t,e){if(e&&("object"===Ai(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Hi(t)}function Hi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ii(t){return Ii=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ii(t)}function qi(t,e,r){return(e=Ui(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ui(t){var e=function(t,e){if("object"!==Ai(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ai(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Ai(e)?e:String(e)}var Vi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Zi(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ii(n);if(o){var r=Ii(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Fi(this,t)});function u(){var t;Ni(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return qi(Hi(t=i.call.apply(i,[this].concat(r))),"callback",(function(t){return t})),t}return e=u,(r=[{key:"apply",value:function(){for(var t=0;t<this.dataset.getNumberOfExamples();t+=1)for(var e=this.callback(this.dataset.exampleAt(t)),r=0;r<this.dataset.data.rows;r+=1)e&&(this.dataset.data.data[r][t]=e.data[r][0]);return this.dataset}},{key:"setCallback",value:function(t){return this.callback=t,this}}])&&Ki(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Li);function Qi(t){return Qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qi(t)}function Ji(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Qi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Qi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Qi(o)?o:String(o)),n)}var o}function Yi(t,e){return Yi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Yi(t,e)}function $i(t,e){if(e&&("object"===Qi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Gi(t){return Gi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Gi(t)}var tu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Yi(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Gi(n);if(o){var r=Gi(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return $i(this,t)});function u(){return Ji(this,u),i.apply(this,arguments)}return e=u,(r=[{key:"apply",value:function(t){for(var e=1/0,r=-1/0,n=0;n<t.getNumberOfExamples();n+=1)for(var o=t.exampleAt(n),i=0;i<o.rows;i+=1)e>o.data[i][0]&&(e=o.data[i][0]),r<o.data[i][0]&&(r=o.data[i][0]);for(var u=0;u<t.getNumberOfExamples();u+=1)for(var a=t.exampleAt(u),c=0;c<a.rows;c+=1)t.data.data[c][u]=(a.data[c][0]-e)/(r-e);return t}}])&&Xi(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Li);function eu(t){return eu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eu(t)}function ru(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nu(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,fu(n.key),n)}}function ou(t,e){return ou=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ou(t,e)}function iu(t,e){if(e&&("object"===eu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return uu(t)}function uu(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function au(t){return au=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},au(t)}function cu(t,e,r){return(e=fu(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function fu(t){var e=function(t,e){if("object"!==eu(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==eu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===eu(e)?e:String(e)}var lu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ou(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=au(n);if(o){var r=au(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return iu(this,t)});function u(){var t;ru(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return cu(uu(t=i.call.apply(i,[this].concat(r))),"modificationType","mean"),t}return e=u,(r=[{key:"apply",value:function(t){for(var e=[],r=0,n=0,o=0,i=0;i<t.getNumberOfExamples();i+=1)for(var u=t.exampleAt(i),a=0;a<t.getExampleSize();a+=1)isNaN(u.data[a][0])||void 0===u.data[a][0]?e.push({row:a,col:u}):(n+=u.data[a][0],r++);return"mean"===this.modificationType&&(o=n/r),e.forEach((function(e){var r=e.row,n=e.col;t.data.data[r][n]=o})),t}},{key:"setModificationType",value:function(t){return this.modificationType=t,this}}])&&nu(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Li);function su(t){return su="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},su(t)}function yu(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,du(n.key),n)}}function pu(t,e){return pu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pu(t,e)}function hu(t,e){if(e&&("object"===su(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return bu(t)}function bu(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function vu(t){return vu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vu(t)}function du(t){var e=function(t,e){if("object"!==su(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==su(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===su(e)?e:String(e)}var mu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pu(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=vu(n);if(o){var r=vu(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return hu(this,t)});function u(t){var e,r,n,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),r=bu(e=i.call(this,t)),o=[],(n=du(n="sortList"))in r?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o,e}return e=u,(r=[{key:"apply",value:function(t){var e=this,r=0,n=wt.from(t.data.transpose().data.sort((function(t,n){return void 0===e.sortList[r]&&(e.sortList[r]=Math.random()-.5),r+=1,e.sortList[r-1]}))).transpose().data;return new Jn(t.getExampleSize(),t.getNumberOfExamples(),n)}}])&&yu(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(Li);function wu(t){return wu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wu(t)}function gu(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==wu(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==wu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===wu(o)?o:String(o)),n)}var o}function Ou(t,e,r){return e&&gu(t.prototype,e),r&&gu(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var Su=Ou((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}));const ju=require("csvtojson");function Pu(t){return Pu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pu(t)}function ku(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Tu(n.key),n)}}function Eu(t,e){return Eu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Eu(t,e)}function _u(t,e){if(e&&("object"===Pu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ru(t)}function Ru(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function xu(t){return xu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},xu(t)}function Wu(t,e,r){return(e=Tu(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Tu(t){var e=function(t,e){if("object"!==Pu(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Pu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Pu(e)?e:String(e)}var zu;!function(t){t[t.UnquotedField=0]="UnquotedField",t[t.QuotedField=1]="QuotedField",t[t.QuotedQuote=2]="QuotedQuote"}(zu||(zu={}));var Du=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Eu(t,e)}(a,t);var e,r,n,o,i,u=(o=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=xu(o);if(i){var r=xu(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return _u(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),Wu(Ru(e=u.call(this)),"data",null),Wu(Ru(e),"matrixData",null),e.data=t,e}return e=a,n=[{key:"fromLocalFile",value:function(t){return new Promise((function(e){ju({noheader:!0,output:"csv"}).fromFile(t).then((function(t){e(new a(t))}))}))}}],(r=[{key:"parse",value:function(){var t=this.data.length,e=this.data[0].length;return new wt(t,e,this.data).transpose()}}])&&ku(e.prototype,r),n&&ku(e,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Su);function Cu(t){return Cu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cu(t)}function Mu(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Cu(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Cu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Cu(o)?o:String(o)),n)}var o}function Bu(t,e,r){return e&&Mu(t.prototype,e),r&&Mu(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Lu(t){return Lu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lu(t)}function Au(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Hu(n.key),n)}}function Nu(t,e){return Nu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Nu(t,e)}function Ku(t,e){if(e&&("object"===Lu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Zu(t)}function Zu(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Fu(t){return Fu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Fu(t)}function Hu(t){var e=function(t,e){if("object"!==Lu(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Lu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Lu(e)?e:String(e)}var Iu={NetworkBuilder1D:Bn,NetworkBuilder3D:Hn},qu={Matrix:wt},Uu={SoftmaxLayer:Xe,LogisticLayer:nr,ReluLayer:dr,SoftplusLayer:Pr,TanhLayer:lr,ConvLayer:qr,MaxPoolLayer:fn,FullyConnectedLayer:$r,RecurrentLayer:wn,LSTMLayer:xn},Vu={DatasetBuilder:$n,DatasetVocabularyBuilder:ao},Qu={OptimizerAdam:jo,OptimizerGradientDescent:Wo,OptimizerAdagrad:Lo,OptimizerMomentum:Vo,OptimizerRMSProp:ni},Ju={MiniBatchTrainer:mi,Trainer:ki,RNNTrainer:zi},Xu={CallbackDatasetModifier:Vi,MinMaxScalingDatasetModifier:tu,MissingDataScalingDatasetModifier:lu,ShuffleDatasetModifier:mu},Yu={ComputationCPU:st,ComputationGPU:B,setComputation:function(t){yt=t},getComputation:pt},$u={Dataset:Jn},Gu={DatasetBuilderSourceCSV:Du,DatasetVocabularyBuilderSourceTextFile:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nu(t,e)}(c,t);var e,n,o,i,u,a=(i=c,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Fu(i);if(u){var r=Fu(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ku(this,t)});function c(t){var e,r,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),r=Zu(e=a.call(this)),"",(n=Hu(n="data"))in r?Object.defineProperty(r,n,{value:"",enumerable:!0,configurable:!0,writable:!0}):r[n]="",e.data=t,e}return e=c,o=[{key:"fromLocalFile",value:function(t){return new Promise((function(e,n){r.readFile(t,(function(t,r){t?n(t):e(new c(r.toString("utf-8")))}))}))}}],(n=[{key:"parse",value:function(){return this.data}}])&&Au(e.prototype,n),o&&Au(e,o),Object.defineProperty(e,"prototype",{writable:!1}),c}(Bu((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)})))},ta={NetworkRNN:_t};module.exports=e})();
//# sourceMappingURL=impulse-ts.js.map